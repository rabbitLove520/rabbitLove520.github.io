[{"categories":["verilog","ç¡¬ä»¶"],"content":"åŸºæœ¬è¯­æ³• Verilog HDLï¼ˆç®€ç§° Verilog ï¼‰æ˜¯ä¸€ç§ç¡¬ä»¶æè¿°è¯­è¨€ï¼Œç”¨äºæ•°å­—ç”µè·¯çš„ç³»ç»Ÿè®¾è®¡ã€‚å¯å¯¹ç®—æ³•çº§ã€é—¨çº§ã€å¼€å…³çº§ç­‰å¤šç§æŠ½è±¡è®¾è®¡å±‚æ¬¡è¿›è¡Œå»ºæ¨¡ã€‚ Verilog ç»§æ‰¿äº† C è¯­è¨€çš„å¤šç§æ“ä½œç¬¦å’Œç»“æ„ï¼Œä¸å¦ä¸€ç§ç¡¬ä»¶æè¿°è¯­è¨€ VHDL ç›¸æ¯”ï¼Œè¯­æ³•ä¸æ˜¯å¾ˆä¸¥æ ¼ï¼Œä»£ç æ›´åŠ ç®€æ´ï¼Œæ›´å®¹æ˜“ä¸Šæ‰‹ã€‚ Verilog ä¸ä»…å®šä¹‰äº†è¯­æ³•ï¼Œè¿˜å¯¹è¯­æ³•ç»“æ„éƒ½å®šä¹‰äº†æ¸…æ™°çš„ä»¿çœŸè¯­ä¹‰ã€‚å› æ­¤ï¼ŒVerilog ç¼–å†™çš„æ•°å­—æ¨¡å‹å°±èƒ½å¤Ÿä½¿ç”¨ Verilog ä»¿çœŸå™¨è¿›è¡ŒéªŒè¯ã€‚ å½“ç„¶å¯ä»¥ï¼ä»¥ä¸‹æ˜¯ Verilog HDLï¼ˆç¡¬ä»¶æè¿°è¯­è¨€ï¼‰çš„åŸºç¡€è¯­æ³•æ€»ç»“ï¼Œé€‚åˆåˆå­¦è€…å¿«é€ŸæŒæ¡æ ¸å¿ƒæ¦‚å¿µï¼Œä¹Ÿæ–¹ä¾¿ä½ åç»­è¿›è¡Œæ•°å­—ç”µè·¯è®¾è®¡ã€ä»¿çœŸå’Œç»¼åˆã€‚ ","date":"2026-01-18","objectID":"/verilog_learning/:1:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ§± ä¸€ã€åŸºæœ¬ç»“æ„ ","date":"2026-01-18","objectID":"/verilog_learning/:2:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"1. æ¨¡å—ï¼ˆModuleï¼‰â€”â€” è®¾è®¡çš„åŸºæœ¬å•å…ƒ module module_name ( input wire [N-1:0] in1, input wire clk, output reg [M-1:0] out ); // å†…éƒ¨é€»è¾‘ï¼šassignã€alwaysã€å®ä¾‹åŒ–ç­‰ endmodule æ‰€æœ‰è®¾è®¡éƒ½ä» module ... endmodule å¼€å§‹ã€‚ ç«¯å£åˆ—è¡¨å¯é€‰ï¼ˆç©ºæ¨¡å—å¯ä¸å†™æ‹¬å·å†…å®¹ï¼‰ã€‚ ç«¯å£é»˜è®¤ç±»å‹ï¼šinput â†’ wireï¼Œoutput â†’ wireï¼ˆé™¤éæ˜¾å¼å£°æ˜ä¸º regï¼‰ã€‚ ","date":"2026-01-18","objectID":"/verilog_learning/:2:1","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ”¤ äºŒã€æ•°æ®ç±»å‹ ","date":"2026-01-18","objectID":"/verilog_learning/:3:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"1. wireï¼ˆçº¿ç½‘å‹ï¼‰ è¡¨ç¤ºç»“æ„è¿æ¥ï¼Œä¸èƒ½å­˜å‚¨å€¼ã€‚ ç”± assignã€é—¨çº§å…ƒä»¶æˆ–æ¨¡å—è¾“å‡ºé©±åŠ¨ã€‚ é»˜è®¤ 1 ä½ï¼Œå¤šä½éœ€ [N-1:0] å£°æ˜ã€‚ wire a; wire [7:0] data; assign a = b \u0026 c; ","date":"2026-01-18","objectID":"/verilog_learning/:3:1","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"2. regï¼ˆå¯„å­˜å™¨å‹ï¼‰ ä¸æ˜¯ä¸€å®šå¯¹åº”ç¡¬ä»¶å¯„å­˜å™¨ï¼ åªèƒ½åœ¨ always æˆ– initial å—ä¸­èµ‹å€¼ã€‚ ç”¨äºè¿‡ç¨‹èµ‹å€¼ï¼ˆæ—¶åºæˆ–ç»„åˆé€»è¾‘ï¼‰ã€‚ reg [3:0] counter; always @(posedge clk) counter \u003c= counter + 1; ","date":"2026-01-18","objectID":"/verilog_learning/:3:2","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"3. å‘é‡ å½“ä½å®½å¤§äº 1 æ—¶ï¼Œwire æˆ– reg å³å¯å£°æ˜ä¸ºå‘é‡çš„å½¢å¼ã€‚ä¾‹å¦‚ï¼š reg [3:0] counter ; //å£°æ˜4bitä½å®½çš„å¯„å­˜å™¨counter wire [32-1:0] gpio_data; //å£°æ˜32bitä½å®½çš„çº¿å‹å˜é‡gpio_data wire [8:2] addr ; //å£°æ˜7bitä½å®½çš„çº¿å‹å˜é‡addrï¼Œä½å®½èŒƒå›´ä¸º8:2 reg [0:31] data ; //å£°æ˜32bitä½å®½çš„å¯„å­˜å™¨å˜é‡data, æœ€é«˜æœ‰æ•ˆä½ä¸º0 å¯¹äºä¸Šé¢çš„å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šæŸä¸€ä½æˆ–è‹¥å¹²ç›¸é‚»ä½ï¼Œä½œä¸ºå…¶ä»–é€»è¾‘ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š wire [9:0] data_low = data[0:9] ; addr_temp[3:2] = addr[8:7] + 1'b1 ; âœ… ç»„åˆé€»è¾‘ç”¨ regï¼Ÿå¯ä»¥ï¼åªè¦åœ¨ always @(*) ä¸­ï¼Œç»¼åˆå·¥å…·ä¼šç”Ÿæˆç»„åˆé€»è¾‘ã€‚ ","date":"2026-01-18","objectID":"/verilog_learning/:3:3","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"âš™ï¸ ä¸‰ã€èµ‹å€¼æ–¹å¼ ","date":"2026-01-18","objectID":"/verilog_learning/:4:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"1. è¿ç»­èµ‹å€¼ï¼ˆContinuous Assignmentï¼‰ assign y = a \u0026 b; // ä»…ç”¨äº wire ","date":"2026-01-18","objectID":"/verilog_learning/:4:1","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"2. è¿‡ç¨‹èµ‹å€¼ï¼ˆProcedural Assignmentï¼‰ åœ¨ always æˆ– initial ä¸­ä½¿ç”¨ï¼š é˜»å¡èµ‹å€¼ =ï¼šé¡ºåºæ‰§è¡Œï¼ˆå¸¸ç”¨äºç»„åˆé€»è¾‘ï¼‰ éé˜»å¡èµ‹å€¼ \u003c=ï¼šå¹¶è¡Œæ›´æ–°ï¼ˆå¿…é¡»ç”¨äºæ—¶åºé€»è¾‘ï¼‰ always @(*) begin y = a + b; // é˜»å¡ï¼Œç»„åˆé€»è¾‘ end always @(posedge clk) begin q \u003c= d; // éé˜»å¡ï¼Œæ—¶åºé€»è¾‘ï¼ˆè§¦å‘å™¨ï¼‰ end ","date":"2026-01-18","objectID":"/verilog_learning/:4:2","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ”„ å››ã€å¸¸ç”¨è¯­å¥å— ","date":"2026-01-18","objectID":"/verilog_learning/:5:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"1. always å— æè¿°æ—¶åºæˆ–ç»„åˆé€»è¾‘ã€‚ æ•æ„Ÿåˆ—è¡¨ï¼š always @(posedge clk) â†’ æ—¶åº always @(posedge clk or negedge rst_n) â†’ å¸¦å¼‚æ­¥å¤ä½ always @(*) â†’ è‡ªåŠ¨åŒ…å«æ‰€æœ‰è¾“å…¥ï¼ˆæ¨èç”¨äºç»„åˆé€»è¾‘ï¼‰ ","date":"2026-01-18","objectID":"/verilog_learning/:5:1","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"2. initial å— ä»…ç”¨äºä»¿çœŸï¼ˆtestbenchï¼‰ï¼Œä¸å¯ç»¼åˆã€‚ é€šå¸¸ç”¨äºåˆå§‹åŒ–ã€äº§ç”Ÿæ¿€åŠ±ã€‚ initial begin clk = 0; forever #5 clk = ~clk; // 10ns å‘¨æœŸæ—¶é’Ÿ end ","date":"2026-01-18","objectID":"/verilog_learning/:5:2","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ”¢ äº”ã€æ•°å€¼è¡¨ç¤º å†™æ³• å«ä¹‰ 1'b0 1 ä½äºŒè¿›åˆ¶ 0 4'b1010 4 ä½äºŒè¿›åˆ¶ 1010 8'hFF 8 ä½åå…­è¿›åˆ¶ FFï¼ˆ=255ï¼‰ 16'd100 16 ä½åè¿›åˆ¶ 100 32'o77 32 ä½å…«è¿›åˆ¶ 77 'b101 é»˜è®¤å®½åº¦ï¼ˆé€šå¸¸ 32 ä½ï¼‰ é»˜è®¤å®½åº¦ç”±å·¥å…·å†³å®šï¼Œå»ºè®®æ˜¾å¼æŒ‡å®šä½å®½ï¼ ","date":"2026-01-18","objectID":"/verilog_learning/:6:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ§® å…­ã€è¿ç®—ç¬¦ ç±»å‹ è¿ç®—ç¬¦ è¯´æ˜ æŒ‰ä½ \u0026, |, ^, ~ ä½œç”¨äºæ¯ä¸€ä½ å½’çº¦ \u0026a, |a, ^a å°†å‘é‡å‹ç¼©ä¸º 1 ä½ é€»è¾‘ \u0026\u0026, ||, ! è¿”å› 1-bit å¸ƒå°”ç»“æœ å…³ç³» ==, !=, \u003e, \u003c ç§»ä½ \u003c\u003c, \u003e\u003e é€»è¾‘ç§»ä½ æ‹¼æ¥ {a, b, 4'b0} æ‹¼æ¥æ“ä½œç¬¦ æ¡ä»¶ c ? a : b ä¸‰ç›®è¿ç®—ç¬¦ ","date":"2026-01-18","objectID":"/verilog_learning/:7:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ”Œ ä¸ƒã€æ¨¡å—å®ä¾‹åŒ–ï¼ˆè°ƒç”¨ï¼‰ ","date":"2026-01-18","objectID":"/verilog_learning/:8:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"1. ä½ç½®å…³è”ï¼ˆä¸æ¨èï¼‰ and_gate u1 (in1, in2, out); ","date":"2026-01-18","objectID":"/verilog_learning/:8:1","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"2. å‘½åå…³è”ï¼ˆæ¨èï¼‰ and_gate u1 ( .a(in1), .b(in2), .y(out) ); ","date":"2026-01-18","objectID":"/verilog_learning/:8:2","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ“¦ å…«ã€å‚æ•°åŒ–è®¾è®¡ï¼ˆå¯é…ç½®ï¼‰ module decoder #( parameter N = 3 )( input wire [N-1:0] addr, output wire [(1\u003c\u003cN)-1:0] y ); // ... endmodule // å®ä¾‹åŒ–æ—¶é‡å®šä¹‰å‚æ•° decoder #(.N(4)) u_dec (.addr(addr4), .y(y16)); ","date":"2026-01-18","objectID":"/verilog_learning/:9:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ§ª ä¹ã€Testbench åŸºç¡€ç»“æ„ module tb_xxx; reg clk, rst; reg [7:0] data_in; wire [7:0] data_out; // DUT å®ä¾‹åŒ– my_module u_dut (.clk(clk), .data_in(data_in), .data_out(data_out)); // æ—¶é’Ÿç”Ÿæˆ initial begin clk = 0; forever #5 clk = ~clk; end // æ¿€åŠ± initial begin $dumpfile(\"wave.vcd\"); $dumpvars(0, tb_xxx); rst = 1; data_in = 0; #20 rst = 0; #10 data_in = 8'hAA; #100 $finish; end endmodule ","date":"2026-01-18","objectID":"/verilog_learning/:10:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"âœ… åã€å¯ç»¼åˆ vs ä¸å¯ç»¼åˆ å¯ç»¼åˆï¼ˆèƒ½å˜æˆç¡¬ä»¶ï¼‰ ä¸å¯ç»¼åˆï¼ˆä»…ä»¿çœŸï¼‰ assign $display, $monitor always @(posedge clk) $finish, $stop æœ‰é™çŠ¶æ€æœºã€è®¡æ•°å™¨ forever, #delay å‚æ•°åŒ–æ¨¡å— initialï¼ˆé™¤ RAM åˆå§‹åŒ–ï¼‰ ğŸ’¡ ä»¿çœŸå¯ç”¨ä»»ä½•è¯­æ³•ï¼Œä½†ç»¼åˆåªæ”¯æŒå­é›†ï¼ ","date":"2026-01-18","objectID":"/verilog_learning/:11:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ¯ æ€»ç»“å£è¯€ wire è¿çº¿ï¼Œreg èµ‹å€¼ ç»„åˆ @(*)ï¼Œæ—¶åº @(posedge clk) æ—¶åºç”¨ \u003c=ï¼Œç»„åˆç”¨ = æ¨¡å—ç”¨å‘½åå…³è”ï¼Œå‚æ•°ç”¨ #() testbench ç”¨ initial + $dumpfile ","date":"2026-01-18","objectID":"/verilog_learning/:12:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ç®€å•æ¨¡å—è°ƒç”¨ä¾‹å­ è¿™é‡Œä½¿ç”¨ Icarus Verilogï¼ˆiverilogï¼‰ åšä»¿çœŸå·¥å…·ï¼Œä¸‹è½½åœ°å€ ç›®å½•ç»“æ„å¯ä»¥éå¸¸ç®€å•ï¼Œå› ä¸ºå®ƒæ˜¯å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸å¼ºåˆ¶è¦æ±‚ç‰¹å®šé¡¹ç›®ç»“æ„ã€‚ä½†ä¸ºäº†æ¸…æ™°å’Œå¯ç»´æŠ¤æ€§ï¼Œå»ºè®®é‡‡ç”¨å¦‚ä¸‹ç»„ç»‡æ–¹å¼ï¼š ","date":"2026-01-18","objectID":"/verilog_learning/:13:0","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ“ æ¨èçš„ç›®å½•ç»“æ„ï¼ˆé’ˆå¯¹ä½ çš„ 01 ç¤ºä¾‹ï¼‰ your_project/ â”œâ”€â”€ src/ # å­˜æ”¾è®¾è®¡æºæ–‡ä»¶ï¼ˆDesignï¼‰ â”‚ â”œâ”€â”€ and_gate.v â”‚ â””â”€â”€ top.v â””â”€â”€ tb/ # å­˜æ”¾æµ‹è¯•å¹³å°ï¼ˆTestbenchï¼‰ â””â”€â”€ tb_top.v æˆ–è€…æ›´ç®€å•çš„æ‰å¹³ç»“æ„ï¼ˆé€‚åˆå°é¡¹ç›®ï¼‰ï¼š your_project/ â”œâ”€â”€ and_gate.v â”œâ”€â”€ top.v â””â”€â”€ tb_top.v âœ… å¯¹äºä½ è¿™ä¸ªå°ä¾‹å­ï¼Œæ‰å¹³ç»“æ„å®Œå…¨è¶³å¤Ÿã€‚ ","date":"2026-01-18","objectID":"/verilog_learning/:13:1","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["verilog","ç¡¬ä»¶"],"content":"ğŸ”§ å…·ä½“æ“ä½œæ­¥éª¤ï¼ˆä»¥æ‰å¹³ç»“æ„ä¸ºä¾‹ï¼‰ 1. åˆ›å»ºä¸‰ä¸ªæ–‡ä»¶ and_gate.v top.v tb_top.v å†…å®¹åˆ†åˆ«å¦‚ä¸‹ï¼š â–¶ and_gate.v module and_gate ( input wire a, input wire b, output wire y ); assign y = a \u0026 b; endmodule â–¶ top.v module top ( input wire in1, input wire in2, output wire out ); and_gate u_and ( .a(in1), .b(in2), .y(out) ); endmodule â–¶ tb_top.v `timescale 1ns / 1ps module tb_top; reg in1; reg in2; wire out; top u_dut ( .in1(in1), .in2(in2), .out(out) ); initial begin $display(\"Time\\tin1\\tin2\\tout\"); $monitor(\"%0t\\t%b\\t%b\\t%b\", $time, in1, in2, out); in1 = 0; in2 = 0; #10; in1 = 0; in2 = 1; #10; in1 = 1; in2 = 0; #10; in1 = 1; in2 = 1; #10; $finish; end endmodule 2. æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥è¯¥ç›®å½• cd your_project 3. ç¼–è¯‘æ‰€æœ‰ Verilog æ–‡ä»¶ iverilog -o sim top.v and_gate.v tb_top.v ğŸ’¡ é¡ºåºæ— å…³ç´§è¦ï¼Œä½† testbench å¿…é¡»åŒ…å«é¡¶å±‚ä»¿çœŸæ¨¡å—ï¼ˆè¿™é‡Œæ˜¯ tb_topï¼‰ï¼Œè€Œ iverilog ä¼šè‡ªåŠ¨è§£ææ¨¡å—ä¾èµ–ã€‚ ä½ ä¹Ÿå¯ä»¥ç®€å†™ä¸ºï¼š iverilog -o sim *.v 4. è¿è¡Œä»¿çœŸ vvp sim 5. æŸ¥çœ‹è¾“å‡ºï¼ˆé¢„æœŸï¼‰ Time in1 in2 out 0 0 0 0 10 0 1 0 20 1 0 0 30 1 1 1 âœ… æˆåŠŸï¼ å‚è€ƒ: verilog-project-1 ","date":"2026-01-18","objectID":"/verilog_learning/:13:2","tags":["pytorch"],"title":"Verilogå­¦ä¹ ","uri":"/verilog_learning/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"Triton å®˜ç½‘ä»‹ç»ï¼šTriton æ˜¯ä¸€ç§ç”¨äºå¹¶è¡Œç¼–ç¨‹çš„è¯­è¨€å’Œç¼–è¯‘å™¨ã€‚å®ƒæ—¨åœ¨æä¾›ä¸€ä¸ªåŸºäº Python çš„ç¼–ç¨‹ç¯å¢ƒï¼Œä»¥é«˜æ•ˆç¼–å†™è‡ªå®šä¹‰ DNN è®¡ç®—å†…æ ¸ï¼Œå¹¶èƒ½å¤Ÿåœ¨ç°ä»£ GPU ç¡¬ä»¶ä¸Šä»¥æœ€å¤§ååé‡è¿è¡Œã€‚ ç®€å•è®²ï¼Œå°±æ˜¯å¯ä»¥ç”¨Pythonå†™GPUç®—å­ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:1:0","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"BNSD æ™®é€šçš„Attentionæ˜¯å•å¤´æ³¨æ„åŠ›ï¼š è¾“å…¥å½¢çŠ¶ï¼š[batch_size, seq_len, d_model] Q: [batch_size, seq_len, d_k] K: [batch_size, seq_len, d_k] V: [batch_size, seq_len, d_v] åœ¨æ ‡å‡† Transformer ä¸­é€šå¸¸è®¾ d_k = d_v = d_modelã€‚ ä½†æ›´å¸¸ç”¨æ˜¯å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:2:0","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰ åœ¨æ·±åº¦å­¦ä¹ ç‰¹åˆ«æ˜¯Transformeræ¶æ„ä¸­çš„Attentionæœºåˆ¶é‡Œï¼Œqueryã€keyã€value çš„ç»´åº¦é€šå¸¸è¢«æè¿°ä¸º (B, N, S, D) æˆ–ç±»ä¼¼çš„æ ¼å¼ï¼Œå…¶ä¸­ï¼š âœ… B = Batch size âœ… S = Sequence lengthï¼ˆåºåˆ—é•¿åº¦ï¼‰ âœ… N = Number of attention headsï¼ˆæ³¨æ„åŠ›å¤´æ•°ï¼‰ âœ… D = Dimension per headï¼ˆæ¯ä¸ªå¤´çš„ç»´åº¦ï¼‰ ","date":"2025-10-26","objectID":"/triton_attention/:2:1","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"è¯¦ç»†è§£é‡Šï¼š B (Batch Size) è¡¨ç¤ºä¸€æ¬¡å‰å‘ä¼ æ’­ä¸­å¤„ç†çš„æ ·æœ¬æ•°é‡ã€‚æ¯”å¦‚ä¸€æ¬¡å¤„ç†32ä¸ªå¥å­ï¼ŒB=32ã€‚ S (Sequence Length) è¡¨ç¤ºæ¯ä¸ªæ ·æœ¬ä¸­çš„ token æ•°é‡ã€‚æ¯”å¦‚ä¸€ä¸ªå¥å­æœ‰50ä¸ªè¯ï¼ŒS=50ã€‚ N (Number of Heads) åœ¨å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰ä¸­ï¼Œquery/key/value ä¼šè¢«æ‹†åˆ†æˆ N ä¸ªâ€œå¤´â€ï¼Œæ¯ä¸ªå¤´ç‹¬ç«‹è®¡ç®—æ³¨æ„åŠ›ã€‚æ¯”å¦‚ N=8ã€‚ D (Dimension per Head) æ¯ä¸ªæ³¨æ„åŠ›å¤´çš„å‘é‡ç»´åº¦ã€‚åŸå§‹çš„ embedding ç»´åº¦ï¼ˆå¦‚512ï¼‰ä¼šè¢«å¹³å‡åˆ†é…åˆ°æ¯ä¸ªå¤´ä¸Šã€‚ä¾‹å¦‚ï¼šæ€»ç»´åº¦512ï¼Œ8ä¸ªå¤´ â†’ D = 512 / 8 = 64ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:2:2","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"ç¤ºä¾‹ï¼ˆBERT-baseï¼‰ å‡è®¾ï¼š batch_size = 32 seq_len = 128 d_model = 768 num_heads = 12 head_dim = 768 // 12 = 64 é‚£ä¹ˆ query çš„å½¢çŠ¶å°±æ˜¯ï¼š ğŸ‘‰ [32, 12, 128, 64] â€”â€” å³ BNSD ","date":"2025-10-26","objectID":"/triton_attention/:2:3","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"ä¸ºä»€ä¹ˆæ˜¯ BNSDï¼Ÿ BNSDï¼ˆ[Batch, Num_heads, Seq_len, Head_dim]ï¼‰æˆä¸ºä¸»æµå¸ƒå±€çš„æ ¸å¿ƒåŸå› åœ¨äº å®ƒä¸æ³¨æ„åŠ›è®¡ç®—çš„æ•°å­¦æœ¬è´¨å’Œ GPU ç¡¬ä»¶æ‰§è¡Œæ¨¡å‹é«˜åº¦åŒ¹é…ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:2:4","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"æœ€ç®€å•çš„Attentionç®—å­ Attentionå…¬å¼ $$ \\text{Attention}(Q, K, V) = \\text{softmax}\\left( \\frac{Q K^\\top}{\\sqrt{d_k}} \\right) V $$ import torch import torch.nn.functional as F def simple_attention(query, key, value): \"\"\" æœ€ç®€å•çš„ scaled dot-product attention Args: query: (..., seq_len_q, d_k) key: (..., seq_len_k, d_k) value: (..., seq_len_k, d_v) Returns: output: (..., seq_len_q, d_v) attention_weights: (..., seq_len_q, seq_len_k) \"\"\" d_k = query.size(-1) scores = torch.matmul(query, key.transpose(-2, -1)) / torch.sqrt(torch.tensor(d_k, dtype=torch.float32)) attention_weights = F.softmax(scores, dim=-1) output = torch.matmul(attention_weights, value) return output, attention_weights # ç¤ºä¾‹ç”¨æ³• if __name__ == \"__main__\": # å‡è®¾ batch_size=2, seq_len=3, d_k=d_v=4 batch_size, seq_len, d_k, d_v = 2, 3, 4, 4 Q = torch.randn(batch_size, seq_len, d_k) K = torch.randn(batch_size, seq_len, d_k) V = torch.randn(batch_size, seq_len, d_v) output, weights = simple_attention(Q, K, V) print(\"Output shape:\", output.shape) # [2, 3, 4] print(\"Weights shape:\", weights.shape) # [2, 3, 3] è¿™ä¸ªå®ç°æ²¡æœ‰ maskã€æ²¡æœ‰å¤šå¤´ã€æ²¡æœ‰çº¿æ€§å˜æ¢ï¼Œæ˜¯æœ€æ ¸å¿ƒã€æœ€ç®€åŒ–çš„ attention é€»è¾‘ã€‚é€‚åˆå­¦ä¹ ç†è§£ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:3:0","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"å…³é”®éƒ¨åˆ†è§£é‡Š queryã€keyã€value æ˜¯æ ‡å‡†çš„æ³¨æ„åŠ›ä¸‰å…ƒç»„ã€‚ è®¡ç®— query å’Œ key çš„ç‚¹ç§¯ï¼ˆç›¸ä¼¼åº¦ï¼‰ã€‚ é™¤ä»¥ sqrt(d_k) è¿›è¡Œç¼©æ”¾ï¼ˆé˜²æ­¢ç‚¹ç§¯è¿‡å¤§å¯¼è‡´ softmax æ¢¯åº¦æ¶ˆå¤±ï¼‰ã€‚ å¯¹ç»“æœåš softmax å¾—åˆ°æ³¨æ„åŠ›æƒé‡ã€‚ ç”¨æƒé‡å¯¹ value åŠ æƒæ±‚å’Œï¼Œå¾—åˆ°è¾“å‡ºã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:3:1","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"Transfomeræ¨¡å‹ å·¦è¾¹æ˜¯Encoderï¼Œå³è¾¹æ˜¯Decoder åœ¨æ¨ç†é˜¶æ®µï¼Œæ²¡æœ‰â€œOutputs (shifted right)â€è¿™ä¸ªæ˜ç¡®çš„è¾“å…¥ã€‚ è¿™ä¸ªæ¦‚å¿µæ˜¯è®­ç»ƒé˜¶æ®µä¸ºäº†æ¨¡æ‹Ÿæ¨ç†è¡Œä¸ºè€Œè®¾è®¡çš„ä¸€ç§â€œæŠ€å·§â€æˆ–â€œæ•™å­¦å·¥å…·â€ã€‚ æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼š ","date":"2025-10-26","objectID":"/triton_attention/:4:0","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"1. è®­ç»ƒé˜¶æ®µçš„ â€œOutputs (shifted right)â€ æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ åœ¨è®­ç»ƒæ—¶ï¼Œæˆ‘ä»¬ä¸ºäº†å¹¶è¡Œé«˜æ•ˆï¼Œä¼šä¸€æ¬¡æ€§æŠŠæ•´ä¸ªç›®æ ‡åºåˆ—ï¼ˆæ¯”å¦‚ â€œæˆ‘ çˆ± ä½  â€ï¼‰å–‚ç»™Decoderã€‚ é—®é¢˜ï¼š å¦‚æœç›´æ¥è¾“å…¥ â€œæˆ‘ çˆ± ä½  â€ï¼Œåœ¨é¢„æµ‹ç¬¬ä¸€ä¸ªè¯ â€œæˆ‘â€ çš„æ—¶å€™ï¼Œæ¨¡å‹å°±ä¼šâ€œå·çœ‹â€åˆ°åé¢çš„ â€œçˆ±â€ã€â€œä½ â€ï¼Œè¿™è¿åäº†â€œæ ¹æ®ä¸Šæ–‡é¢„æµ‹ä¸‹ä¸€ä¸ªè¯â€çš„è‡ªå›å½’æ³•åˆ™ã€‚è¿™è¢«ç§°ä¸ºä¿¡æ¯æ³„éœ²ã€‚ è§£å†³æ–¹æ¡ˆï¼š â€œShifted Rightâ€ï¼ˆå³ç§»ï¼‰ Decoderçš„è¾“å…¥ï¼š æˆ‘ä»¬æŠŠç›®æ ‡åºåˆ—çš„å¼€å§‹ç¬¦ \u003csos\u003e æ”¾åœ¨æœ€å‰é¢ï¼Œå¹¶å»æ‰æœ€åä¸€ä¸ªè¯ï¼Œå˜æˆï¼š\u003csos\u003e æˆ‘ çˆ± è®­ç»ƒæ ‡ç­¾/ç›®æ ‡ï¼š å°±æ˜¯åŸå§‹çš„ç›®æ ‡åºåˆ—ï¼Œä½†å»æ‰å¼€å§‹ç¬¦ï¼Œå˜æˆï¼šæˆ‘ çˆ± ä½  \u003ceos\u003e è¿™æ ·ï¼Œå½“Decoderçš„è¾“å…¥æ˜¯ \u003csos\u003e æˆ‘ çˆ± æ—¶ï¼Œå®ƒè¢«è¦æ±‚å¹¶è¡Œåœ°è¾“å‡º æˆ‘ çˆ± ä½  \u003ceos\u003eã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå¯¹åº”å…³ç³»ï¼š è¾“å…¥ (Shifted Right) â†’ æ¨¡å‹è¢«è¦æ±‚é¢„æµ‹çš„è¾“å‡º \u003csos\u003e â†’ æˆ‘ \u003csos\u003e æˆ‘ â†’ çˆ± \u003csos\u003e æˆ‘ çˆ± â†’ ä½  \u003csos\u003e æˆ‘ çˆ± ä½  â†’ \u003ceos\u003e é€šè¿‡æ©ç è‡ªæ³¨æ„åŠ›ï¼Œç¡®ä¿åœ¨è®¡ç®—æ¯ä¸ªä½ç½®çš„è¾“å‡ºæ—¶ï¼Œåªèƒ½çœ‹åˆ°å®ƒè‡ªå·±å’Œå®ƒå·¦è¾¹çš„è¾“å…¥ã€‚è¿™æ ·ï¼Œå¯¹äºâ€œé¢„æµ‹â€˜çˆ±â€™â€è¿™ä¸ªä»»åŠ¡ï¼Œæ¨¡å‹çš„è¾“å…¥èƒ½çœ‹åˆ° \u003csos\u003e å’Œ â€œæˆ‘â€ï¼Œä½†çœ‹ä¸åˆ°åé¢çš„â€œçˆ±â€å’Œâ€œä½ â€ï¼Œå®Œç¾æ¨¡æ‹Ÿäº†æ¨ç†æ—¶çš„æƒ…å†µã€‚ æ‰€ä»¥ï¼Œâ€œOutputs (shifted right)â€æ˜¯è®­ç»ƒæ—¶ä¸ºäº†å¹¶è¡ŒåŒ–è€Œæ„é€ çš„ä¸€ä¸ªâ€œä¼ªè¾“å…¥â€ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:1","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"2. æ¨ç†é˜¶æ®µçš„è¾“å…¥æ˜¯ä»€ä¹ˆï¼Ÿ æ¨ç†æ—¶ï¼Œæˆ‘ä»¬æ²¡æœ‰å®Œæ•´çš„ç›®æ ‡åºåˆ—ï¼Œå› æ­¤æ— æ³•æ„é€ ä¸€ä¸ªâ€œshifted rightâ€çš„ç‰ˆæœ¬ã€‚æ¨ç†çš„è¾“å…¥æ˜¯åŠ¨æ€ç”Ÿæˆçš„ã€‚ æ¨ç†è¾“å…¥ = èµ·å§‹ç¬¦ + æ¨¡å‹è‡ªå·±å†å²ç”Ÿæˆçš„å…¨éƒ¨ä»¤ç‰Œ è¿™ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯è¿›è¡Œçš„ï¼š åˆå§‹è¾“å…¥ï¼š [\u003csos\u003e] ç¬¬ä¸€è½®è¾“å‡ºï¼š æ¨¡å‹æ¥æ”¶ [\u003csos\u003e]ï¼Œè¾“å‡ºç¬¬ä¸€ä¸ªè¯ æˆ‘ã€‚ æ›´æ–°è¾“å…¥ï¼š å°† æˆ‘ è¿½åŠ åˆ°è¾“å…¥ä¸­ï¼Œå¾—åˆ° [\u003csos\u003e, æˆ‘] ç¬¬äºŒè½®è¾“å‡ºï¼š æ¨¡å‹æ¥æ”¶ [\u003csos\u003e, æˆ‘]ï¼Œè¾“å‡ºä¸‹ä¸€ä¸ªè¯ çˆ±ã€‚ æ›´æ–°è¾“å…¥ï¼š å°† çˆ± è¿½åŠ åˆ°è¾“å…¥ä¸­ï¼Œå¾—åˆ° [\u003csos\u003e, æˆ‘, çˆ±] â€¦ å¦‚æ­¤å¾ªç¯ï¼Œç›´åˆ°ç”Ÿæˆ \u003ceos\u003eã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:2","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"æ€»ç»“å¯¹æ¯” é˜¶æ®µ è¾“å…¥æ¥æº â€œOutputs (shifted right)â€ï¼Ÿ è®­ç»ƒ æ¥è‡ªè®­ç»ƒæ•°æ®é›†ä¸­å‡†å¤‡å¥½çš„å®Œæ•´ç›®æ ‡åºåˆ—ã€‚ æœ‰ã€‚è¿™æ˜¯ä¸€ä¸ªä¸ºäº†å¹¶è¡Œè®­ç»ƒè€Œç‰¹æ„æ„é€ çš„è¾“å…¥ã€‚ æ¨ç† æ¥è‡ªæ¨¡å‹è‡ªèº«å‰ä¸€æ­¥çš„è¾“å‡ºï¼ŒåŠ¨æ€æ‹¼æ¥è€Œæˆã€‚ æ²¡æœ‰ã€‚å› ä¸ºæ ¹æœ¬æ²¡æœ‰ç°æˆçš„â€œOutputsâ€å¯ä¾›â€œShiftâ€ã€‚ ä¸€ä¸ªå½¢è±¡çš„æ¯”å–»ï¼š è®­ç»ƒï¼š åƒè€å¸ˆåœ¨æ•™å­¦ç”Ÿå®Œå½¢å¡«ç©ºã€‚è€å¸ˆç›´æ¥æŠŠä¸€æ•´æ®µæ–‡å­—ï¼ˆshifted rightï¼‰ç»™å­¦ç”Ÿçœ‹ï¼Œä½†ç”¨çº¸ç›–ä½åé¢çš„éƒ¨åˆ†ï¼ˆæ©ç ï¼‰ï¼Œè®©å­¦ç”ŸåŒæ—¶å¡«å†™æ‰€æœ‰çš„ç©ºã€‚ æ¨ç†ï¼š åƒå­¦ç”Ÿè‡ªå·±å†™ä½œæ–‡ã€‚ä»–åªèƒ½ä»ç¬¬ä¸€ä¸ªå­—å¼€å§‹å†™ï¼Œå†™ä¸‹çš„æ¯ä¸€ä¸ªå­—éƒ½æˆä¸ºä¸‹æ–‡çš„åŸºç¡€ã€‚ä»–ä¸å¯èƒ½æå‰æ‹¿åˆ°ä¸€ç¯‡â€œå³ç§»â€çš„ä½œæ–‡ã€‚ å› æ­¤ï¼Œâ€œOutputs (shifted right)â€æ˜¯è®­ç»ƒé˜¶æ®µç‹¬æœ‰çš„ä¸€ä¸ªæ•°æ®å‡†å¤‡æ­¥éª¤ï¼Œåœ¨æ¨ç†é˜¶æ®µä¸å­˜åœ¨ã€‚ æ¨ç†é˜¶æ®µçš„è¾“å…¥æ˜¯è‡ªå›å½’åœ°ã€é€æ­¥æ„å»ºèµ·æ¥çš„ã€‚ ##æ˜¯çš„ï¼ŒTransformer ä¸­çš„ FFNï¼ˆFeed-Forward Networkï¼Œå‰é¦ˆç¥ç»ç½‘ç»œï¼‰å±‚æœ¬è´¨ä¸Šæ˜¯ç”±ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼ˆFully Connected Layersï¼‰ç»„æˆçš„ï¼Œä¸­é—´å¤¹ç€ä¸€ä¸ªéçº¿æ€§æ¿€æ´»å‡½æ•°ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:3","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"FFNå±‚ï¼š åœ¨åŸå§‹çš„ Transformer è®ºæ–‡ï¼ˆã€ŠAttention is All You Needã€‹ï¼‰ä¸­ï¼ŒFFN å±‚çš„ç»“æ„å¦‚ä¸‹ï¼š FFN(x) = Wâ‚‚ * GELU(Wâ‚ * x + bâ‚) + bâ‚‚ æˆ–è€…åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ä½¿ç”¨çš„æ˜¯ ReLUï¼š FFN(x) = Wâ‚‚ * ReLU(Wâ‚ * x + bâ‚) + bâ‚‚ å…¶ä¸­ï¼š Wâ‚ å’Œ Wâ‚‚ æ˜¯å¯å­¦ä¹ çš„æƒé‡çŸ©é˜µï¼ˆå³å…¨è¿æ¥å±‚çš„å‚æ•°ï¼‰ï¼Œ bâ‚ å’Œ bâ‚‚ æ˜¯åç½®é¡¹ï¼Œ GELU æˆ– ReLU æ˜¯éçº¿æ€§æ¿€æ´»å‡½æ•°ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:4","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"ä¸ºä»€ä¹ˆè¯´å®ƒä»¬æ˜¯â€œå…¨è¿æ¥â€ï¼Ÿ ç¬¬ä¸€å±‚ï¼šå°†è¾“å…¥å‘é‡ï¼ˆç»´åº¦ä¸º d_modelï¼‰çº¿æ€§å˜æ¢åˆ°ä¸€ä¸ªæ›´é«˜ç»´çš„éšè—ç©ºé—´ï¼ˆç»´åº¦é€šå¸¸ä¸º 4 * d_modelï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„çº¿æ€§å˜æ¢ â†’ å…¨è¿æ¥å±‚ã€‚ æ¿€æ´»å‡½æ•°ï¼šå¼•å…¥éçº¿æ€§ï¼ˆå¦‚ ReLUã€GELUï¼‰ã€‚ ç¬¬äºŒå±‚ï¼šå°†éšè—å±‚å‘é‡å†çº¿æ€§å˜æ¢å›åŸå§‹ç»´åº¦ d_model â†’ å¦ä¸€ä¸ªå…¨è¿æ¥å±‚ã€‚ è¿™ä¸¤ä¸ªçº¿æ€§å˜æ¢éƒ½æ²¡æœ‰ä½¿ç”¨å·ç§¯ã€å¾ªç¯ç»“æ„æˆ–æ³¨æ„åŠ›æœºåˆ¶ï¼Œçº¯ç²¹æ˜¯çŸ©é˜µä¹˜æ³• + åç½®ï¼Œå› æ­¤å®Œå…¨ç¬¦åˆâ€œå…¨è¿æ¥å±‚â€çš„å®šä¹‰ã€‚ è¡¥å……è¯´æ˜ï¼š æ¯ä¸ªä½ç½®ç‹¬ç«‹å¤„ç†ï¼šFFN å¯¹åºåˆ—ä¸­æ¯ä¸ªä½ç½®çš„è¡¨ç¤ºç‹¬ç«‹åº”ç”¨ç›¸åŒçš„ç½‘ç»œç»“æ„ï¼ˆå³æƒé‡å…±äº«ï¼‰ï¼Œè¿™ä¸è‡ªæ³¨æ„åŠ›æœºåˆ¶ä¸åŒï¼ˆè‡ªæ³¨æ„åŠ›æ˜¯è·¨ä½ç½®äº¤äº’çš„ï¼‰ã€‚ å‚æ•°é‡å¤§ï¼šç”±äºéšè—å±‚ç»´åº¦é€šå¸¸æ˜¯ d_model çš„ 4 å€ï¼ŒFFN æ˜¯ Transformer ä¸­å‚æ•°é‡æœ€å¤§çš„éƒ¨åˆ†ä¹‹ä¸€ï¼ˆé€šå¸¸è¶…è¿‡æ³¨æ„åŠ›æœºåˆ¶ï¼‰ã€‚ å˜ä½“å­˜åœ¨ï¼šè™½ç„¶æ ‡å‡† FFN æ˜¯ä¸¤ä¸ªå…¨è¿æ¥å±‚ï¼Œä½†åç»­ç ”ç©¶ä¹Ÿæ¢ç´¢äº†å…¶ä»–ç»“æ„ï¼ˆå¦‚ä½¿ç”¨å·ç§¯ã€ç¨€ç–è¿æ¥ã€MoE ç­‰ï¼‰ï¼Œä½†åœ¨åŸå§‹ Transformer å’Œç»å¤§å¤šæ•°å®ç°ä¸­ï¼ŒFFN å°±æ˜¯ä¸¤ä¸ªå…¨è¿æ¥å±‚ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:5","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"æ€»ç»“ï¼š âœ… æ˜¯çš„ï¼ŒTransformer ä¸­çš„ FFN å±‚ç”±ä¸¤ä¸ªå…¨è¿æ¥å±‚æ„æˆï¼Œä¸­é—´åŠ ä¸€ä¸ªéçº¿æ€§æ¿€æ´»å‡½æ•°ã€‚è¿™æ˜¯å…¶æ ‡å‡†å’Œæœ€å¹¿æ³›ä½¿ç”¨çš„ç»“æ„ã€‚ åœ¨ä½ æåˆ°çš„ Transformer æ¶æ„å›¾ï¼ˆä¾‹å¦‚ https://transformers.run/assets/img/attention/transformer.jpegï¼‰ä¸­ï¼Œâ€œAdd \u0026 Normâ€ æ˜¯ â€œAdd and Layer Normalizationâ€ çš„ç¼©å†™ï¼Œå®ƒæ˜¯ Transformer æ¨¡å‹ä¸­ä¸€ä¸ªå…³é”®çš„å­å±‚ç»“æ„ï¼Œç”¨äºç¨³å®šè®­ç»ƒã€åŠ é€Ÿæ”¶æ•›å¹¶æå‡æ¨¡å‹æ€§èƒ½ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:6","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"Add \u0026 Norm ä¸€å¥è¯è§£é‡Šï¼š â€œAdd \u0026 Normâ€ = æ®‹å·®è¿æ¥ï¼ˆAddï¼‰ + å±‚å½’ä¸€åŒ–ï¼ˆLayer Normalizationï¼‰ å®ƒå‡ºç°åœ¨ Encoder å’Œ Decoder çš„æ¯ä¸ªå­æ¨¡å—ä¹‹åï¼Œå…·ä½“æœ‰ä¸¤ä¸ªä½ç½®ï¼š è‡ªæ³¨æ„åŠ›ï¼ˆæˆ– cross-attentionï¼‰ä¹‹å å‰é¦ˆç¥ç»ç½‘ç»œï¼ˆFeed Forwardï¼‰ä¹‹å ","date":"2025-10-26","objectID":"/triton_attention/:4:7","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"ğŸ” è¯¦ç»†æ‹†è§£ï¼š 1. Addï¼ˆæ®‹å·®è¿æ¥ / Residual Connectionï¼‰ å°†å­å±‚çš„è¾“å…¥å’Œå­å±‚çš„è¾“å‡ºç›¸åŠ ï¼š output = sublayer(input) + input ä½œç”¨ï¼š ç¼“è§£æ·±å±‚ç½‘ç»œä¸­çš„æ¢¯åº¦æ¶ˆå¤±é—®é¢˜ï¼› å…è®¸ä¿¡æ¯ç›´æ¥â€œè·³è¿‡â€æŸäº›å±‚ï¼Œä¿ç•™åŸå§‹ç‰¹å¾ï¼› æ˜¯ ResNet æ€æƒ³åœ¨ Transformer ä¸­çš„åº”ç”¨ã€‚ 2. Normï¼ˆLayer Normalizationï¼‰ å¯¹ Add ä¹‹åçš„ç»“æœåšå±‚å½’ä¸€åŒ–ï¼š normalized_output = LayerNorm(sublayer(input) + input) LayerNorm æ˜¯å¯¹å•ä¸ªæ ·æœ¬çš„æ‰€æœ‰ç‰¹å¾ç»´åº¦åšå½’ä¸€åŒ–ï¼ˆä¸ BatchNorm ä¸åŒï¼Œä¸ä¾èµ– batchï¼‰ï¼› ä½œç”¨ï¼š ç¨³å®šéšè—å±‚åˆ†å¸ƒï¼› åŠ é€Ÿè®­ç»ƒï¼› å‡å°‘å¯¹åˆå§‹åŒ–å’Œå­¦ä¹ ç‡çš„æ•æ„Ÿæ€§ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:8","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"ğŸ“¦ åœ¨ Transformer ä¸­çš„å…·ä½“ä½ç½®ï¼š Encoder å±‚ç»“æ„ï¼ˆé‡å¤ N æ¬¡ï¼‰ï¼š Input â”‚ â”œâ”€â†’ [Multi-Head Self-Attention] â”€â”€â†’ Add \u0026 Norm â”€â”€â†’ â”‚ â””â”€â†’ [Feed Forward Network] â”€â”€â”€â”€â”€â”€â”€â†’ Add \u0026 Norm â”€â”€â†’ Output Decoder å±‚ç»“æ„ï¼ˆé‡å¤ N æ¬¡ï¼‰ï¼š Input â”‚ â”œâ”€â†’ [Masked Multi-Head Self-Attention] â”€â”€â†’ Add \u0026 Norm â”€â”€â†’ â”‚ â”œâ”€â†’ [Multi-Head Cross-Attention] â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Add \u0026 Norm â”€â”€â†’ â”‚ â””â”€â†’ [Feed Forward Network] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Add \u0026 Norm â”€â”€â†’ Output âš ï¸ æ³¨æ„ï¼šåŸå§‹è®ºæ–‡ä¸­æ˜¯ å…ˆåšå­å±‚è®¡ç®— â†’ å† Add â†’ å† Normï¼ˆPost-LNï¼‰ã€‚ ä½†ç°åœ¨å¾ˆå¤šå˜ä½“ï¼ˆå¦‚ Pre-LNï¼‰ä¼šæŠŠ LayerNorm æ”¾åœ¨å­å±‚ä¹‹å‰ï¼Œè®­ç»ƒæ›´ç¨³å®šã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:9","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"ğŸ§  ä¸¾ä¸ªç®€å•ä¾‹å­ï¼ˆæ•°å€¼ç¤ºæ„ï¼‰ï¼š å‡è®¾æŸå±‚è¾“å…¥æ˜¯å‘é‡ x = [1.0, 2.0]ï¼Œç»è¿‡è‡ªæ³¨æ„åŠ›åè¾“å‡º y = [0.8, 2.2]ã€‚ Addï¼ˆæ®‹å·®ï¼‰ï¼š z = x + y = [1.0+0.8, 2.0+2.2] = [1.8, 4.2] Normï¼ˆLayerNormï¼‰ï¼š å¯¹ [1.8, 4.2] åšå½’ä¸€åŒ–ï¼ˆå‡å‡å€¼ã€é™¤æ ‡å‡†å·® + å¯å­¦ä¹ ç¼©æ”¾/åç§»ï¼‰ï¼Œå¾—åˆ°æ ‡å‡†åŒ–åçš„å‘é‡ï¼Œæ¯”å¦‚ [âˆ’1, 1]ï¼ˆç®€åŒ–ç¤ºæ„ï¼‰ã€‚ è¿™ä¸ªç»“æœå°±ä½œä¸ºä¸‹ä¸€å±‚çš„è¾“å…¥ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:10","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"â“ä¸ºä»€ä¹ˆå« â€œAdd \u0026 Normâ€ è€Œä¸æ˜¯ â€œNorm \u0026 Addâ€ï¼Ÿ å› ä¸ºé¡ºåºæ˜¯å…ˆ Addï¼Œå† Normï¼ˆåœ¨åŸå§‹ Transformer ä¸­ï¼‰ï¼› è™½ç„¶åå­—æ˜¯ â€œAdd \u0026 Normâ€ï¼Œä½†å®é™…æ˜¯ä¸¤ä¸ªæ“ä½œçš„ç»„åˆï¼Œä¸æ˜¯å¹¶è¡Œçš„ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:4:11","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"âœ… æ€»ç»“ï¼š ç»„ä»¶ ä½œç”¨ Add æ®‹å·®è¿æ¥ï¼Œä¿ç•™åŸå§‹ä¿¡æ¯ï¼Œç¼“è§£æ¢¯åº¦æ¶ˆå¤± Norm å±‚å½’ä¸€åŒ–ï¼Œç¨³å®šè®­ç»ƒï¼ŒåŠ é€Ÿæ”¶æ•› Add \u0026 Norm Transformer çš„æ ‡å‡†å­å±‚åå¤„ç†æ¨¡å—ï¼Œæå‡æ¨¡å‹æ·±åº¦å’Œæ€§èƒ½ å®ƒæ˜¯ Transformer èƒ½å †å å¤šå±‚ï¼ˆå¦‚ 6 å±‚ã€12 å±‚ç”šè‡³æ›´å¤šï¼‰è€Œä¾ç„¶å¯è®­ç»ƒçš„å…³é”®è®¾è®¡ä¹‹ä¸€ï¼ å¦‚æœä½ çœ‹åˆ°å›¾ä¸­æ¯ä¸ªæ–¹æ¡†ï¼ˆAttention / FFNï¼‰åé¢éƒ½è·Ÿç€ä¸€ä¸ª â€œAdd \u0026 Normâ€ï¼Œç°åœ¨ä½ å°±çŸ¥é“å®ƒåœ¨åšä»€ä¹ˆå•¦ ğŸ˜Š ","date":"2025-10-26","objectID":"/triton_attention/:4:12","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"MLPï¼ˆMulti-Layer Perceptronï¼Œå¤šå±‚æ„ŸçŸ¥æœºï¼‰ MLPï¼ˆMulti-Layer Perceptronï¼Œå¤šå±‚æ„ŸçŸ¥æœºï¼‰å’Œ FFNï¼ˆFeed-Forward Networkï¼Œå‰é¦ˆç½‘ç»œï¼‰è¿™ä¸¤ä¸ªæœ¯è¯­åœ¨æ·±åº¦å­¦ä¹ ä¸­ç»å¸¸å‡ºç°ï¼Œå®ƒä»¬å¯†åˆ‡ç›¸å…³ï¼Œä½†åœ¨ä¸åŒä¸Šä¸‹æ–‡ä¸­å¯èƒ½æœ‰ç»†å¾®å·®åˆ«ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:5:0","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"1. MLPï¼ˆå¤šå±‚æ„ŸçŸ¥æœºï¼‰ MLP æ˜¯æœ€æ—©ã€æœ€ç»å…¸çš„ç¥ç»ç½‘ç»œç»“æ„ä¹‹ä¸€ã€‚ å®ƒç”±**å¤šä¸ªå…¨è¿æ¥å±‚ï¼ˆDense Layerï¼‰**å †å è€Œæˆï¼Œé€šå¸¸åŒ…æ‹¬ï¼š è¾“å…¥å±‚ ä¸€ä¸ªæˆ–å¤šä¸ªéšè—å±‚ï¼ˆæ¯ä¸ªéšè—å±‚åå¸¸æ¥éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼Œå¦‚ ReLUï¼‰ è¾“å‡ºå±‚ ç‰¹ç‚¹ï¼šå‰é¦ˆï¼ˆæ— ç¯ã€æ— åé¦ˆï¼‰ã€å…¨è¿æ¥ã€éçº¿æ€§æ¿€æ´»ã€‚ ç”¨é€”ï¼šå¯ç”¨äºåˆ†ç±»ã€å›å½’ç­‰ä»»åŠ¡ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:5:1","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"2. FFNï¼ˆå‰é¦ˆç½‘ç»œï¼‰ FFN æ˜¯ä¸€ä¸ªæ›´å¹¿ä¹‰çš„æœ¯è¯­ï¼Œæ³›æŒ‡æ‰€æœ‰å‰é¦ˆç»“æ„çš„ç¥ç»ç½‘ç»œï¼ˆå³ä¿¡å·å•å‘ä»å‰å‘åä¼ æ’­ï¼Œä¸å½¢æˆå¾ªç¯ï¼‰ã€‚ MLP æ˜¯ FFN çš„ä¸€ä¸ªç‰¹ä¾‹ã€‚ åœ¨ç°ä»£ Transformer æ¶æ„ä¸­ï¼Œâ€œFFN layerâ€ é€šå¸¸æŒ‡ä¸€ä¸ªä¸¤å±‚å…¨è¿æ¥ç½‘ç»œï¼š FFN(x) = max(0, xWâ‚ + bâ‚)Wâ‚‚ + bâ‚‚ å³ï¼šçº¿æ€§å˜æ¢ â†’ ReLUï¼ˆæˆ– GELUï¼‰â†’ çº¿æ€§å˜æ¢ã€‚ è¿™ç§ FFN å±‚ç»“æ„ä¸Šå°±æ˜¯ä¸€ä¸ªå°å‹ MLPï¼ˆé€šå¸¸åªæœ‰1ä¸ªéšè—å±‚ï¼‰ï¼ŒåµŒå…¥åœ¨ Transformer çš„æ¯ä¸ª Encoder/Decoder block ä¸­ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:5:2","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"ä¸»è¦åŒºåˆ«æ€»ç»“ï¼š æ–¹é¢ MLP FFNï¼ˆç‰¹æŒ‡ Transformer ä¸­çš„ FFN å±‚ï¼‰ èŒƒç•´ ä¸€ç§å…·ä½“çš„ç½‘ç»œç»“æ„ ä¸€ç±»ç½‘ç»œï¼ˆå¹¿ä¹‰ï¼‰æˆ–ä¸€ä¸ªæ¨¡å—ï¼ˆç‹­ä¹‰ï¼‰ ç»“æ„ å¯å«å¤šä¸ªéšè—å±‚ é€šå¸¸åªæœ‰1ä¸ªéšè—å±‚ï¼ˆä¸¤å±‚çº¿æ€§ï¼‰ ä½¿ç”¨åœºæ™¯ ç‹¬ç«‹æ¨¡å‹ï¼ˆå¦‚åˆ†ç±»å™¨ï¼‰ ä½œä¸ºå­æ¨¡å—åµŒå…¥å¤§æ¨¡å‹ï¼ˆå¦‚ Transformerï¼‰ æ¿€æ´»å‡½æ•° ReLUã€tanh ç­‰ ReLU æˆ– GELUï¼ˆTransformer å¸¸ç”¨ï¼‰ ç®€å•è¯´ï¼šåœ¨ Transformer ä¸­æ‰€è¯´çš„ â€œFFN layerâ€ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæµ…å±‚ MLPï¼ˆé€šå¸¸2å±‚ï¼‰ï¼Œè€Œ MLP æœ¬èº«ä¹Ÿå¯ä»¥çœ‹ä½œæ˜¯ç”±å¤šä¸ª FFN å±‚å †å è€Œæˆçš„ç½‘ç»œã€‚ å¦‚æœä½ åœ¨é˜…è¯» Transformer ç›¸å…³è®ºæ–‡ï¼Œçœ‹åˆ° â€œFFNâ€ï¼ŒåŸºæœ¬ç­‰ä»·äºä¸€ä¸ªå¸¦æ¿€æ´»å‡½æ•°çš„ä¸¤å±‚å…¨è¿æ¥ç½‘ç»œï¼Œè¿™æ˜¯ MLP çš„ä¸€ä¸ªç®€åŒ–ç‰¹ä¾‹ã€‚ ","date":"2025-10-26","objectID":"/triton_attention/:5:3","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["æ·±åº¦å­¦ä¹ ","python","Triton"],"content":"å‚è€ƒ Transformer æ¨¡å‹ ","date":"2025-10-26","objectID":"/triton_attention/:6:0","tags":[],"title":"Tritonå†™Attentionç®—å­","uri":"/triton_attention/"},{"categories":["python","Triton"],"content":"Triton å®˜ç½‘ä»‹ç»ï¼šTriton æ˜¯ä¸€ç§ç”¨äºå¹¶è¡Œç¼–ç¨‹çš„è¯­è¨€å’Œç¼–è¯‘å™¨ã€‚å®ƒæ—¨åœ¨æä¾›ä¸€ä¸ªåŸºäº Python çš„ç¼–ç¨‹ç¯å¢ƒï¼Œä»¥é«˜æ•ˆç¼–å†™è‡ªå®šä¹‰ DNN è®¡ç®—å†…æ ¸ï¼Œå¹¶èƒ½å¤Ÿåœ¨ç°ä»£ GPU ç¡¬ä»¶ä¸Šä»¥æœ€å¤§ååé‡è¿è¡Œã€‚ ç®€å•è®²ï¼Œå°±æ˜¯å¯ä»¥ç”¨Pythonå†™GPUç®—å­ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:1:0","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"ç®€å•çš„Addç®—å­ import torch import triton import triton.language as tl # å®šä¹‰ kernel å‡½æ•°ï¼Œæ‰§è¡Œé€å…ƒç´ åŠ æ³• @triton.jit def add_kernel( x_ptr, y_ptr, output_ptr, n_elements, BLOCK_SIZE: tl.constexpr ): # è·å–å½“å‰çº¿ç¨‹çš„ ID pid = tl.program_id(0) # è®¡ç®—å½“å‰ block å†…çš„ç´¢å¼• offsets = pid * BLOCK_SIZE + tl.arange(0, BLOCK_SIZE) # é€šè¿‡ masks é˜²æ­¢è¶Šç•Œè®¿é—® mask = offsets \u003c n_elements # ä»å…¨å±€å†…å­˜ä¸­åŠ è½½ x å’Œ y çš„å…ƒç´  x = tl.load(x_ptr + offsets, mask=mask) y = tl.load(y_ptr + offsets, mask=mask) # æ‰§è¡Œé€å…ƒç´ åŠ æ³• output = x + y # å°†ç»“æœå†™å›åˆ°å…¨å±€å†…å­˜ tl.store(output_ptr + offsets, output, mask=mask) data = [i for i in range(1, 1023)] # ç‰¹æ„è®¾ç½®äº†1022ä¸ªå…ƒç´ ï¼Œè®©128ä¸æ•´é™¤ # æµ‹è¯•æ•°æ® x = torch.tensor(data, device='cuda') y = torch.tensor(data, device='cuda') output = torch.empty_like(x) # æ¯ä¸ª block çš„çº¿ç¨‹æ•° block_size = 128 grid = triton.cdiv(x.numel(), block_size) # å¯åŠ¨ kernelï¼Œæ‰§è¡Œé€å…ƒç´ åŠ æ³• add_kernel[(grid,)](x, y, output, x.numel(), BLOCK_SIZE=block_size) print(output) # æ£€æŸ¥ç»“æœæ˜¯å¦æ­£ç¡® print(torch.allclose(output, x + y)) è¿è¡Œä¸Šé¢ä»£ç ï¼Œå¯ä»¥å¾—åˆ°ç»“æœï¼š tensor([ 2, 4, 6, ..., 2040, 2042, 2044], device='cuda:0') True ","date":"2025-10-02","objectID":"/triton_learning/:2:0","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"å…³é”®éƒ¨åˆ†è§£é‡Š @triton.jit è£…é¥°å™¨ï¼šè¿™ä¸ªè£…é¥°å™¨å°† Python å‡½æ•° JIT ç¼–è¯‘ä¸º Triton kernelã€‚å‡½æ•°çš„è¾“å…¥å¯ä»¥æ˜¯å¼ é‡æŒ‡é’ˆã€æ•´æ•°æˆ–ç¼–è¯‘æ—¶å¸¸é‡ã€‚ tl.program_id(0)ï¼šè¿”å›å½“å‰çº¿ç¨‹å—çš„å”¯ä¸€ IDï¼Œç±»ä¼¼äº CUDA ä¸­çš„ blockIdx.xã€‚ tl.arange(0, BLOCK_SIZE)ï¼šä¸ºå½“å‰çº¿ç¨‹å—ä¸­çš„æ¯ä¸ªçº¿ç¨‹åˆ†é…ç´¢å¼•ã€‚ x.numel()è¡¨ç¤ºxçš„å…ƒç´ ä¸ªæ•°ï¼Œtriton.cdiv(x.numel(), block_size)å°±æ˜¯å‘ä¸Šå–æ•´ï¼Œä¿è¯gridæ•°é‡è¶³å¤Ÿã€‚ tl.load() å’Œ tl.store()ï¼šç”¨äºä»å…¨å±€å†…å­˜åŠ è½½æ•°æ®å’Œå°†æ•°æ®å­˜å‚¨å›å…¨å±€å†…å­˜ã€‚ maskï¼šç”¨æ¥é˜²æ­¢è¶Šç•Œè®¿é—®ï¼ˆå³ç¡®ä¿çº¿ç¨‹è®¿é—®çš„æ•°æ®åœ¨å¼ é‡èŒƒå›´å†…ï¼‰ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:2:1","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"Softmaxç®—å­ ","date":"2025-10-02","objectID":"/triton_learning/:3:0","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"Naive Softmaxå®ç° é¦–å…ˆï¼Œä½¿ç”¨pytorchå®ç°ä¸€ä¸ªrow-wiseçš„naive softmax: import torch def naive_softmax(x): \"\"\"Compute row-wise softmax of X using native pytorch We subtract the maximum element in order to avoid overflows. Softmax is invariant to this shift. \"\"\" # read MN elements ; write M elements; è¯»å–MNå…ƒç´ ï¼›å†™Mä¸ªå…ƒç´  x_max = x.max(dim=1)[0] # read MN + M elements ; write MN elements; è¯»å–MN+Må…ƒç´ ï¼›å†™å…¥MNå…ƒç´  z = x - x_max[:, None] # read MN elements ; write MN elements; è¯»å–MNå…ƒç´ ï¼›å†™å…¥MNå…ƒç´  numerator = torch.exp(z) # read MN elements ; write M elements; è¯»å–MNå…ƒç´ ï¼›å†™Mä¸ªå…ƒç´  denominator = numerator.sum(dim=1) # read MN + M elements ; write MN elements; è¯»å–MN Må…ƒç´ ï¼›å†™å…¥MNå…ƒç´  ret = numerator / denominator[:, None] # in total: read 5MN + 2M elements ; wrote 3MN + 2M elements; return ret # å…±ï¼šè¯»å–5MN+2Må…ƒç´ ï¼›å†™äº†3MN+2Mä¸ªå…ƒç´  ä¸ºä»€ä¹ˆå« â€œnaiveâ€ï¼ˆæœ´ç´ ï¼‰ï¼Ÿ å®ƒä½¿ç”¨äº† å¤šä¸ªä¸­é—´å¼ é‡ï¼ˆx_max, z, numerator, denominator, retï¼‰ï¼Œæ¯ä¸ªéƒ½å ç”¨æ˜¾å­˜ã€‚ æ¯ä¸€æ­¥éƒ½æ˜¯ç‹¬ç«‹çš„ PyTorch æ“ä½œï¼Œæ— æ³•èåˆï¼ˆkernel fusionï¼‰ï¼Œå¯¼è‡´å¤šæ¬¡è¯»å†™å…¨å±€å†…å­˜ã€‚ åœ¨ GPU ä¸Šï¼Œè¿™ä¼šå¸¦æ¥ è¾ƒé«˜çš„å†…å­˜å¸¦å®½å‹åŠ› å’Œ è¾ƒä½çš„è®¡ç®—æ•ˆç‡ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:3:1","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"Nè¾ƒå°çš„Tritonç‰ˆsoftmax import triton import triton.language as tl import torch @triton.jit def softmax_kernel( output_ptr, # è¾“å‡ºæŒ‡é’ˆ input_ptr, # è¾“å…¥æŒ‡é’ˆ input_row_stride, # è¾“å…¥æ¯è¡Œçš„æ­¥é•¿ï¼ˆä»¥å…ƒç´ ä¸ºå•ä½ï¼‰ output_row_stride, # è¾“å‡ºæ¯è¡Œçš„æ­¥é•¿ n_cols, # æ¯è¡Œçš„åˆ—æ•° N BLOCK_SIZE: tl.constexpr, # æ¯ä¸ªçº¿ç¨‹å—å¤„ç†çš„åˆ—æ•° ): # è·å–å½“å‰å¤„ç†çš„è¡Œç´¢å¼• row_idx = tl.program_id(0) # è®¡ç®—è¯¥è¡Œåœ¨å…¨å±€å†…å­˜ä¸­çš„èµ·å§‹åœ°å€ row_start_ptr = input_ptr + row_idx * input_row_stride # ä½¿ç”¨å‘é‡åŒ–åŠ è½½ï¼ˆå¦‚æœ BLOCK_SIZE æ˜¯ 128 çš„å€æ•°ç­‰ï¼‰ col_offsets = tl.arange(0, BLOCK_SIZE) input_ptrs = row_start_ptr + col_offsets # æ©ç ï¼šé˜²æ­¢è¶Šç•Œè®¿é—® mask = col_offsets \u003c n_cols # åŠ è½½è¾“å…¥è¡Œ row = tl.load(input_ptrs, mask=mask, other=-float('inf')) # æ•°å€¼ç¨³å®šï¼šå‡å»æœ€å¤§å€¼ row_max = tl.max(row, axis=0) row_minus_max = row - row_max # è®¡ç®— exp exp_row = tl.exp(row_minus_max) # æ±‚å’Œ exp_sum = tl.sum(exp_row, axis=0) # å½’ä¸€åŒ– softmax_output = exp_row / exp_sum # å­˜å‚¨ç»“æœ output_row_start = output_ptr + row_idx * output_row_stride output_ptrs = output_row_start + col_offsets tl.store(output_ptrs, softmax_output, mask=mask) def softmax(x: torch.Tensor): \"\"\" å¯¹è¾“å…¥å¼ é‡ x çš„æœ€åä¸€ç»´æ‰§è¡Œ softmaxã€‚ å‡è®¾ x æ˜¯ 2D å¼ é‡ (M, N) \"\"\" assert x.is_cuda, \"Input must be on GPU\" assert x.dim() == 2, \"Only 2D tensors supported for now\" M, N = x.shape # é€‰æ‹©åˆé€‚çš„ BLOCK_SIZEï¼ˆå¿…é¡»æ˜¯ 2 çš„å¹‚ï¼Œä¸” \u003c= 4096ï¼‰ BLOCK_SIZE = triton.next_power_of_2(N) BLOCK_SIZE = min(BLOCK_SIZE, 4096) # Triton é™åˆ¶æœ€å¤§ BLOCK_SIZE # åˆ†é…è¾“å‡ºå¼ é‡ output = torch.empty_like(x) # å¯åŠ¨å†…æ ¸ grid = (M,) # æ¯è¡Œä¸€ä¸ªç¨‹åº softmax_kernel[grid]( output, x, x.stride(0), # input_row_stride output.stride(0), # output_row_stride N, BLOCK_SIZE=BLOCK_SIZE, ) return output # æµ‹è¯• M, N = 128, 512 x = torch.randn(M, N, device='cuda') y_torch = torch.softmax(x, dim=-1) y_triton = softmax(x) # æ£€æŸ¥æ•°å€¼è¯¯å·® print(\"Max diff:\", (y_torch - y_triton).abs().max().item()) assert torch.allclose(y_torch, y_triton, atol=1e-5), \"Results don't match!\" print(\"âœ… Triton softmax matches PyTorch!\") ","date":"2025-10-02","objectID":"/triton_learning/:3:2","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"è¯´æ˜ æ•°å€¼ç¨³å®šæ€§ï¼šé€šè¿‡å‡å»æ¯è¡Œæœ€å¤§å€¼é¿å… exp æº¢å‡ºã€‚ å¹¶è¡Œæ€§ï¼šæ¯è¡Œç”±ä¸€ä¸ª Triton ç¨‹åºï¼ˆprogramï¼‰å¤„ç†ï¼Œåˆ©ç”¨ BLOCK_SIZE ä¸ªçº¿ç¨‹å¹¶è¡ŒåŠ è½½/è®¡ç®—è¯¥è¡Œã€‚ å†…å­˜è®¿é—®ï¼šä½¿ç”¨ mask é¿å…è¶Šç•Œè¯»å†™ï¼Œé€‚ç”¨äº N ä¸æ˜¯ BLOCK_SIZE æ•´æ•°å€çš„æƒ…å†µã€‚ BLOCK_SIZEï¼šè‡ªåŠ¨é€‰æ‹©æœ€æ¥è¿‘ N çš„ 2 çš„å¹‚ï¼Œä½†ä¸è¶…è¿‡ 4096ï¼ˆTriton çš„é™åˆ¶ï¼‰ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:3:3","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"ä¸ºå•¥éœ€è¦input_row_strideè¿™æ ·çš„å‚æ•° input_row_strideï¼ˆä»¥åŠ output_row_strideï¼‰å‚æ•°çš„å­˜åœ¨ï¼Œæ˜¯ä¸ºäº†è®© Triton å†…æ ¸èƒ½å¤Ÿæ­£ç¡®å¤„ç†éè¿ç»­å†…å­˜å¸ƒå±€ï¼ˆnon-contiguous tensorsï¼‰ï¼Œå°¤å…¶æ˜¯è·¨æ­¥ï¼ˆstridedï¼‰å¼ é‡ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:4:0","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"1. ä»€ä¹ˆæ˜¯ strideï¼ˆæ­¥é•¿ï¼‰ï¼Ÿ åœ¨ PyTorchï¼ˆä»¥åŠå¤§å¤šæ•°å¼ é‡åº“ï¼‰ä¸­ï¼Œä¸€ä¸ªå¼ é‡åœ¨å†…å­˜ä¸­æ˜¯ä¸€ç»´çº¿æ€§å­˜å‚¨çš„ï¼Œä½†é€šè¿‡ shape å’Œ stride æ¥è§£é‡Šå…¶å¤šç»´ç»“æ„ã€‚ ä¾‹å¦‚ï¼š x = torch.randn(4, 8) # shape=(4,8) print(x.stride()) # é€šå¸¸æ˜¯ (8, 1) stride[0] = 8ï¼šè¡¨ç¤ºç¬¬ 0 ç»´ï¼ˆè¡Œï¼‰æ¯å¢åŠ  1ï¼Œå†…å­˜åœ°å€è·³è¿‡ 8 ä¸ªå…ƒç´ ã€‚ stride[1] = 1ï¼šè¡¨ç¤ºç¬¬ 1 ç»´ï¼ˆåˆ—ï¼‰æ¯å¢åŠ  1ï¼Œå†…å­˜åœ°å€è·³è¿‡ 1 ä¸ªå…ƒç´ ã€‚ æ‰€ä»¥ï¼Œx[i, j] å¯¹åº”çš„å†…å­˜åç§»æ˜¯ï¼ši * stride[0] + j * stride[1]ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:4:1","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"2. ä¸ºä»€ä¹ˆä¸èƒ½å‡è®¾ stride æ˜¯å›ºå®šçš„ï¼Ÿ å› ä¸º PyTorch å¼ é‡ä¸ä¸€å®šæ˜¯è¿ç»­çš„ï¼ä¾‹å¦‚ï¼š æƒ…å†µä¸€ï¼šè½¬ç½®ï¼ˆtransposeï¼‰ x = torch.randn(4, 8) y = x.t() # shape=(8,4), stride=(1, 8) â† æ³¨æ„ï¼ ç°åœ¨ y çš„ç¬¬ 0 ç»´ï¼ˆåŸåˆ—ï¼‰çš„ stride æ˜¯ 1ï¼Œç¬¬ 1 ç»´ï¼ˆåŸè¡Œï¼‰çš„ stride æ˜¯ 8ã€‚ å¦‚æœä½ çš„å†…æ ¸å‡è®¾â€œæ¯è¡Œè¿ç»­å­˜å‚¨ï¼ˆstride=åˆ—æ•°ï¼‰â€ï¼Œé‚£ä¹ˆå¯¹ y è°ƒç”¨ softmax å°±ä¼šå‡ºé”™ï¼ æƒ…å†µäºŒï¼šåˆ‡ç‰‡ï¼ˆsliceï¼‰ x = torch.randn(10, 20) z = x[::2, :] # å–å¶æ•°è¡Œï¼Œshape=(5,20)ï¼Œä½† stride[0] = 40ï¼ˆä¸æ˜¯20ï¼ï¼‰ æƒ…å†µä¸‰ï¼šview / reshape åçš„éè¿ç»­å¼ é‡ æŸäº› reshape æ“ä½œå¯èƒ½äº§ç”Ÿéè¿ç»­å†…å­˜å¸ƒå±€ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:4:2","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"3. å¦‚æœä¸ä¼  stride ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ å‡è®¾ä½ å†™æ­»ï¼š row_start_ptr = input_ptr + row_idx * n_cols # âŒ é”™è¯¯ï¼ è¿™åªåœ¨å¼ é‡æ˜¯è¡Œè¿ç»­ï¼ˆrow-major, contiguousï¼‰æ—¶æ‰æ­£ç¡®ã€‚ä¸€æ—¦é‡åˆ°è½¬ç½®æˆ–åˆ‡ç‰‡å¼ é‡ï¼Œå°±ä¼šï¼š è¯»å–é”™è¯¯çš„å†…å­˜ä½ç½® å¯¼è‡´ç»“æœå®Œå…¨é”™è¯¯ ç”šè‡³è¶Šç•Œè®¿é—®ï¼ˆsegmentation faultï¼‰ ","date":"2025-10-02","objectID":"/triton_learning/:4:3","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"4. æ­£ç¡®åšæ³•ï¼šä½¿ç”¨å®é™… stride é€šè¿‡ä¼ å…¥ x.stride(0)ï¼ˆå³ç¬¬ 0 ç»´çš„ strideï¼‰ï¼ŒTriton å†…æ ¸å¯ä»¥æ­£ç¡®è®¡ç®—æ¯ä¸€è¡Œçš„èµ·å§‹åœ°å€ï¼š row_start_ptr = input_ptr + row_idx * input_row_stride è¿™æ ·æ— è®ºå¼ é‡æ˜¯å¦è¿ç»­ã€æ˜¯å¦è½¬ç½®ã€æ˜¯å¦åˆ‡ç‰‡ï¼Œéƒ½èƒ½æ­£ç¡®è®¿é—®æ•°æ®ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:4:4","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"5. å®é™…ä¾‹å­å¯¹æ¯” x = torch.randn(2, 4, device='cuda') y = x.t() # shape=(4,2), stride=(1, 4) # æ­£ç¡®è°ƒç”¨ï¼ˆä¼  strideï¼‰ï¼š softmax(y) # å†…æ ¸ä½¿ç”¨ y.stride(0) == 1ï¼Œæ­£ç¡®ï¼ # é”™è¯¯å®ç°ï¼ˆå‡è®¾ stride = n_cols = 2ï¼‰ï¼š # ä¼šè®¤ä¸ºç¬¬0è¡Œåœ¨ 0*2=0ï¼Œç¬¬1è¡Œåœ¨ 1*2=2ï¼Œ... # ä½†å®é™…ä¸Šç¬¬1è¡Œåœ¨å†…å­˜åç§» 1*1 = 1ï¼ ","date":"2025-10-02","objectID":"/triton_learning/:4:5","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"6. è¡¥å……ï¼šä¸ºä»€ä¹ˆ output ä¹Ÿéœ€è¦ strideï¼Ÿ å› ä¸ºè¾“å‡ºå¼ é‡ output = torch.empty_like(x) ä¼šç»§æ‰¿è¾“å…¥çš„å†…å­˜å¸ƒå±€ï¼ˆåŒ…æ‹¬ strideï¼‰ã€‚æ‰€ä»¥ä½ ä¹Ÿå¿…é¡»ç”¨ output.stride(0) æ¥æ­£ç¡®å†™å…¥ç»“æœã€‚ ä½†å…¶å®æˆ‘è¿™ä¸ªSoftmaxç®—å­ï¼Œæ›´é€šç”¨ä¸€ç‚¹ï¼Œä¹Ÿåº”è¯¥åŠ å…¥åˆ—çš„strideã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:4:6","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"meanç®—å­ è¿™ä¸ªä¾‹å­æœ‰ç‚¹å¤æ‚ import torch import triton import triton.language as tl @triton.jit def mean_kernel( input_ptr, output_ptr, input_stride0, input_stride1, input_stride2, output_stride0, output_stride1, M, # size before reduction dim N, # size of reduction dim K, # size after reduction dim BLOCK_SIZE: tl.constexpr, ): \"\"\" Kernel for computing mean along a single dimension. Input is viewed as (M, N, K) where N is the dimension being reduced. \"\"\" # Program ID gives us which output element we're computing pid = tl.program_id(0) # Compute output indices m_idx = pid // K k_idx = pid % K # Bounds check if m_idx \u003e= M or k_idx \u003e= K: return # Accumulate sum across reduction dimension acc = 0.0 for n_start in range(0, N, BLOCK_SIZE): n_offsets = n_start + tl.arange(0, BLOCK_SIZE) mask = n_offsets \u003c N # Calculate input indices input_idx = ( m_idx * input_stride0 + n_offsets * input_stride1 + k_idx * input_stride2 ) # Load and accumulate vals = tl.load(input_ptr + input_idx, mask=mask, other=0.0) acc += tl.sum(vals) # Compute mean and store mean_val = acc / N output_idx = m_idx * output_stride0 + k_idx * output_stride1 tl.store(output_ptr + output_idx, mean_val) def mean_dim( input: torch.Tensor, dim: int, keepdim: bool = False, dtype: torch.dtype | None = None, ) -\u003e torch.Tensor: \"\"\" Triton implementation of torch.mean with single dimension reduction. Args: input: Input tensor dim: Single dimension along which to compute mean keepdim: Whether to keep the reduced dimension dtype: Output dtype. If None, uses input dtype (or float32 for integer inputs) Returns: Tensor with mean values along specified dimension \"\"\" # Validate inputs assert input.is_cuda, \"Input must be a CUDA tensor\" assert ( -input.ndim \u003c= dim \u003c input.ndim ), f\"Invalid dimension {dim} for tensor with {input.ndim} dimensions\" # Handle negative dim if dim \u003c 0: dim = dim + input.ndim # Handle dtype if dtype is None: if input.dtype in [torch.int8, torch.int16, torch.int32, torch.int64]: dtype = torch.float32 else: dtype = input.dtype # Convert input to appropriate dtype if needed if input.dtype != dtype: input = input.to(dtype) # Get input shape and strides shape = list(input.shape) # Calculate dimensions for kernel M = 1 for i in range(dim): M *= shape[i] N = shape[dim] K = 1 for i in range(dim + 1, len(shape)): K *= shape[i] # Reshape input to 3D view (M, N, K) input_3d = input.reshape(M, N, K) # Create output shape if keepdim: output_shape = shape.copy() output_shape[dim] = 1 else: output_shape = shape[:dim] + shape[dim + 1 :] # Create output tensor output = torch.empty(output_shape, dtype=dtype, device=input.device) # Reshape output for kernel if keepdim: output_2d = output.reshape(M, 1, K).squeeze(1) else: output_2d = output.reshape(M, K) # Launch kernel grid = (M * K,) BLOCK_SIZE = 1024 mean_kernel[grid]( input_3d, output_2d, input_3d.stride(0), input_3d.stride(1), input_3d.stride(2), output_2d.stride(0), output_2d.stride(1) if output_2d.ndim \u003e 1 else 0, M, N, K, BLOCK_SIZE, ) return output def mean_batch_invariant(input, dim, keepdim=False, dtype: torch.dtype | None = None): assert dtype is None or dtype == torch.float32, f\"unsupported dtype: {dtype}\" if len(dim) == 1: return mean_dim(input, dim[0], keepdim=keepdim) else: assert input.dtype in { torch.float16, torch.bfloat16, torch.float32, }, \"only float types supported for now\" n_elems = 1 for d in dim: n_elems *= input.shape[d] return torch.sum(input, dim=dim, keepdim=keepdim, dtype=torch.float32) / n_elems def test_mean_batch_invariant(): # è®¾ç½®éšæœºç§å­ä»¥ç¡®ä¿ç»“æœå¯é‡å¤ torch.manual_seed(42) # å®šä¹‰æµ‹è¯•çš„ç»´åº¦å’Œå¤§å° test_cases = [ # ä¸€ç»´å¼ é‡ (1024, ), # # äºŒç»´å¼ é‡ # (512, 512), # # ä¸‰ç»´å¼ é‡ # (16, 32, 2048), # (2048, 4096, 64), ] # å®šä¹‰å…è®¸çš„è¯¯å·®èŒƒå›´ atol = 1e-3 rtol = 1e-3 for shape in test_cases: # ç”Ÿæˆéšæœºæµ‹è¯•æ•°æ® input_tensor = torch.randn(*shape, dtype=torch.float32, device='npu:0') input_dim = input_tensor.ndim # print(f\"input = {input_tensor}, dim = {input_dim}\") # æµ‹è¯•æŒ‡å®šç»´åº¦å‡å€¼ for dim in range(input_dim): # ç²¾åº¦æµ‹è¯• output_torch = torch.mean(input_tensor, dim=dim, keepdim=T","date":"2025-10-02","objectID":"/triton_learning/:5:0","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"ä»€ä¹ˆæ—¶å€™ä¼šè¿”å› copyï¼Ÿ å½“å¼ é‡çš„å†…å­˜å¸ƒå±€ï¼ˆç”± stride å†³å®šï¼‰ä¸å…è®¸åœ¨ä¸å¤åˆ¶æ•°æ®çš„æƒ…å†µä¸‹å½¢æˆç›®æ ‡å½¢çŠ¶æ—¶ï¼Œreshape å°±å¿…é¡»è¿”å›ä¸€ä¸ª copyã€‚ å…·ä½“æ¥è¯´ï¼Œå¦‚æœåŸå¼ é‡ä¸æ˜¯è¿ç»­çš„ï¼ˆcontiguousï¼‰ï¼Œå¹¶ä¸”ç›®æ ‡å½¢çŠ¶æ— æ³•é€šè¿‡è°ƒæ•´ stride æ¥è¡¨ç¤ºï¼Œé‚£ä¹ˆ reshape å°±ä¼šè§¦å‘æ•°æ®å¤åˆ¶ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:5:1","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"ä¸¾ä¸ªä¾‹å­ import torch # åˆ›å»ºä¸€ä¸ªéè¿ç»­çš„å¼ é‡ x = torch.arange(12).reshape(3, 4) # shape: (3, 4) y = x.t() # è½¬ç½® -\u003e shape: (4, 3)ï¼Œä½†å†…å­˜ä¸è¿ç»­ print(\"y.is_contiguous():\", y.is_contiguous()) # False # å°è¯• reshape z = y.reshape(12) print(\"z.is_contiguous():\", z.is_contiguous()) # True # æ£€æŸ¥æ˜¯å¦æ˜¯ viewï¼šä¿®æ”¹ z æ˜¯å¦ä¼šå½±å“ yï¼Ÿ # æ³¨æ„ï¼šå¦‚æœ z æ˜¯ y çš„ viewï¼Œé‚£ä¹ˆä¿®æ”¹ z ä¼šå½±å“ yï¼ˆæˆ–åº•å±‚æ•°æ®ï¼‰ # ä½† reshape è¿”å›çš„ z æ˜¯ copyï¼Œæ‰€ä»¥ä¸ä¼šå½±å“ y z[0] = -999 print(\"y[0, 0]:\", y[0, 0]) # ä»ç„¶æ˜¯ 0ï¼Œè¯´æ˜ z æ˜¯ copy è¾“å‡ºç±»ä¼¼ï¼š y.is_contiguous(): False z.is_contiguous(): True y[0, 0]: 0 è¿™è¯´æ˜ï¼šå› ä¸º y æ˜¯éè¿ç»­çš„ï¼ˆç”± .t() äº§ç”Ÿï¼‰ï¼Œy.reshape(12) æ— æ³•åªé€šè¿‡ä¿®æ”¹ stride æ¥å±•å¹³ï¼Œæ‰€ä»¥ PyTorch å¿…é¡»å¤åˆ¶æ•°æ®ï¼Œè¿”å›ä¸€ä¸ªæ–°å¼ é‡ï¼ˆcopyï¼‰ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:5:2","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"å¯¹æ¯”ï¼šè¿ç»­å¼ é‡çš„ reshapeï¼ˆè¿”å› viewï¼‰ a = torch.arange(12) # contiguous b = a.reshape(3, 4) # view b[0, 0] = 888 print(a[0]) # è¾“å‡º 888ï¼Œè¯´æ˜æ˜¯ view ","date":"2025-10-02","objectID":"/triton_learning/:5:3","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"æ€»ç»“ torch.reshape() ä¼˜å…ˆè¿”å› viewï¼› å½“è¾“å…¥å¼ é‡ä¸è¿ç»­ä¸”ç›®æ ‡å½¢çŠ¶æ— æ³•é€šè¿‡ stride è¡¨è¾¾æ—¶ï¼Œä¼šè¿”å› copyï¼› åˆ¤æ–­æ˜¯å¦æ˜¯ view çš„ä¸€ä¸ªå®ç”¨æ–¹å¼ï¼šæ£€æŸ¥ .is_contiguous() æˆ–é€šè¿‡ä¿®æ”¹å…ƒç´ çœ‹æ˜¯å¦å½±å“åŸå¼ é‡ï¼ˆä½†åè€…ä¸æ¨èç”¨äºç”Ÿäº§ä»£ç ï¼‰ï¼› å¦‚æœä½ æ˜ç¡®éœ€è¦ viewï¼Œå¯ä½¿ç”¨ .view()ï¼šå®ƒåœ¨æ— æ³•åˆ›å»º view æ—¶ä¼šæŠ¥é”™ï¼› å¦‚æœä½ æ˜ç¡®éœ€è¦æ–°å†…å­˜ï¼Œå¯ä»¥ç”¨ .reshape().clone() æˆ–å…ˆ .contiguous() å† .view()ã€‚ ","date":"2025-10-02","objectID":"/triton_learning/:5:4","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["python","Triton"],"content":"è‡ªåŠ¨è°ƒä¼˜autotune import torch import triton import triton.language as tl import time # å®šä¹‰ autotune çš„é…ç½® @triton.autotune( configs=[ triton.Config({'BLOCK_SIZE': 128}), triton.Config({'BLOCK_SIZE': 256}), triton.Config({'BLOCK_SIZE': 512}), triton.Config({'BLOCK_SIZE': 1024}), ], key=['n'], ) @triton.jit def add_kernel( x_ptr, y_ptr, output_ptr, n, BLOCK_SIZE: tl.constexpr, ): pid = tl.program_id(axis=0) offsets = pid * BLOCK_SIZE + tl.arange(0, BLOCK_SIZE) mask = offsets \u003c n x = tl.load(x_ptr + offsets, mask=mask) y = tl.load(y_ptr + offsets, mask=mask) output = x + y tl.store(output_ptr + offsets, output, mask=mask) def add(x: torch.Tensor, y: torch.Tensor): output = torch.empty_like(x) n = x.numel() grid = lambda meta: (triton.cdiv(n, meta['BLOCK_SIZE']),) add_kernel[grid](x, y, output, n) return output # æµ‹è¯• if __name__ == \"__main__\": torch.manual_seed(0) for i in range(5): size = 98431 # é2çš„å¹‚ï¼Œæ›´èƒ½ä½“ç° autotune çš„ä½œç”¨ x = torch.rand(size, dtype=torch.float32, device='npu:0') y = torch.rand(size, dtype=torch.float32, device='npu:0') start = time.time() output = add(x, y) torch.npu.synchronize() end = time.time() print(output[:5]) # æ‰“å°å‰5ä¸ªå…ƒç´ éªŒè¯æ­£ç¡®æ€§ print(f\"Kernel time: {(end - start) * 1000:.4f} ms\") ","date":"2025-10-02","objectID":"/triton_learning/:6:0","tags":[],"title":"Tritonå†™ç®€å•ç®—å­","uri":"/triton_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"backwardå‡½æ•° backward() æ˜¯æ·±åº¦å­¦ä¹ æ¡†æ¶ï¼ˆå¦‚ PyTorchï¼‰ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼šè‡ªåŠ¨è®¡ç®—æŸå¤±å‡½æ•°å¯¹æ¨¡å‹å‚æ•°çš„æ¢¯åº¦ï¼ˆgradientï¼‰ï¼Œä¸ºåç»­çš„å‚æ•°æ›´æ–°ï¼ˆæ¯”å¦‚ç”¨ SGDã€Adam ç­‰ä¼˜åŒ–å™¨ï¼‰æä¾›ä¾æ®ã€‚ ","date":"2024-12-30","objectID":"/torch_learning/:1:0","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"âœ… ä¸€å¥è¯æ¦‚æ‹¬ï¼š loss.backward() ä¼šä»æŸå¤±æ ‡é‡å¼€å§‹ï¼Œåå‘ä¼ æ’­ï¼ŒæŠŠæ¢¯åº¦è‡ªåŠ¨å­˜åˆ°æ¯ä¸ª requires_grad=True çš„å¼ é‡çš„ .grad å±æ€§ä¸­ã€‚ ","date":"2024-12-30","objectID":"/torch_learning/:1:1","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"ğŸ§  ä¸¾ä¸ªä¾‹å­ï¼ˆPyTorch é£æ ¼ï¼‰ import torch # å®šä¹‰å‚æ•°ï¼ˆéœ€è¦æ¢¯åº¦ï¼‰ w = torch.tensor([2.0], requires_grad=True) # æ ‡é‡å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯å‘é‡ # è¾“å…¥å’Œæ ‡ç­¾ x = torch.tensor([3.0]) y_true = torch.tensor([7.0]) # å‰å‘è®¡ç®—ï¼šé¢„æµ‹ = w * x y_pred = w * x # è®¡ç®—æŸå¤±ï¼ˆæ ‡é‡ï¼‰ loss = (y_pred - y_true) ** 2 # æ¯”å¦‚ MSEï¼Œè¿™é‡Œæ²¡é™¤2 print(\"loss:\", loss) # loss = (2*3 - 7)^2 = (-1)^2 = 1 # åå‘ä¼ æ’­ï¼ loss.backward() print(\"w.grad:\", w.grad) # è¾“å‡ºï¼štensor([-6.]) ğŸ” æ‰‹åŠ¨éªŒè¯æ¢¯åº¦æ˜¯å¦æ­£ç¡®ï¼Ÿ æŸå¤±å‡½æ•°ï¼š $$ \\mathcal{L} = (w x - y)^2 $$ å¯¹ (w) æ±‚å¯¼ï¼š $$ \\frac{\\partial \\mathcal{L}}{\\partial w} = 2(w x - y) \\cdot x = 2(6 - 7) \\cdot 3 = -6 $$ âœ… å’Œ w.grad ä¸€è‡´ï¼ ","date":"2024-12-30","objectID":"/torch_learning/:1:2","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"ğŸ”„ backward() èƒŒååšäº†ä»€ä¹ˆï¼Ÿ æ„å»ºè®¡ç®—å›¾ï¼ˆåŠ¨æ€å›¾ï¼‰ï¼š PyTorch åœ¨å‰å‘è®¡ç®—æ—¶ï¼Œä¼šæ‚„æ‚„è®°å½•æ‰€æœ‰æ“ä½œï¼ˆå¦‚ *, +, **2ï¼‰ï¼Œå½¢æˆä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ã€‚ ä» loss å¼€å§‹åå‘éå†å›¾ï¼š åˆ©ç”¨é“¾å¼æ³•åˆ™ï¼ˆchain ruleï¼‰ï¼Œé€å±‚è®¡ç®—æ¯ä¸ªä¸­é—´å˜é‡ã€æ¯ä¸ªå‚æ•°çš„æ¢¯åº¦ã€‚ ç´¯åŠ æ¢¯åº¦åˆ° .gradï¼š å¦‚æœå¤šæ¬¡è°ƒç”¨ backward()ï¼Œæ¢¯åº¦ä¼šç´¯åŠ ï¼ˆæ‰€ä»¥è®­ç»ƒå¾ªç¯ä¸­é€šå¸¸è¦ optimizer.zero_grad() æ¸…é›¶ï¼‰ã€‚ ","date":"2024-12-30","objectID":"/torch_learning/:1:3","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"âš ï¸ æ³¨æ„äº‹é¡¹ é—®é¢˜ è¯´æ˜ åªèƒ½å¯¹æ ‡é‡è°ƒç”¨ backward() å¦‚æœ loss æ˜¯å‘é‡ï¼Œéœ€æŒ‡å®š grad_tensorsï¼Œæˆ–å…ˆç”¨ .sum()/.mean() å˜æˆæ ‡é‡ æ¢¯åº¦ä¼šç´¯åŠ  æ¯æ¬¡ backward() ä¸ä¼šè¦†ç›– .gradï¼Œè€Œæ˜¯ +=ï¼Œæ‰€ä»¥è®­ç»ƒæ—¶è¦æ¸…é›¶ åªå¯¹ requires_grad=True çš„å¼ é‡è®¡ç®—æ¢¯åº¦ é»˜è®¤ torch.tensor(...) çš„ requires_grad=False ","date":"2024-12-30","objectID":"/torch_learning/:1:4","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"ğŸ§© åœ¨è®­ç»ƒå¾ªç¯ä¸­çš„å…¸å‹ç”¨æ³• for data, target in dataloader: optimizer.zero_grad() # ğŸ‘ˆ æ¸…é›¶ä¸Šä¸€æ­¥çš„æ¢¯åº¦ output = model(data) loss = criterion(output, target) loss.backward() # ğŸ‘ˆ åå‘ä¼ æ’­ï¼šè®¡ç®— d(loss)/d(params) optimizer.step() # ğŸ‘ˆ ç”¨æ¢¯åº¦æ›´æ–°å‚æ•°ï¼ˆå¦‚ w -= lr * w.gradï¼‰ ","date":"2024-12-30","objectID":"/torch_learning/:1:5","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"æ€»ç»“ æ¦‚å¿µ è¯´æ˜ backward() è‡ªåŠ¨æ±‚å¯¼ï¼Œè®¡ç®—æŸå¤±å¯¹æ‰€æœ‰å¯å­¦ä¹ å‚æ•°çš„æ¢¯åº¦ ç»“æœå­˜å‚¨åœ¨å“ªï¼Ÿ param.gradï¼ˆå’Œ param åŒ shapeï¼‰ ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ æ²¡æœ‰å®ƒï¼Œå°±æ— æ³•ç”¨æ¢¯åº¦ä¸‹é™æ›´æ–°æ¨¡å‹å‚æ•° åº•å±‚åŸç†ï¼Ÿ åŠ¨æ€è®¡ç®—å›¾ + é“¾å¼æ³•åˆ™ + åå‘ä¼ æ’­ ","date":"2024-12-30","objectID":"/torch_learning/:1:6","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"@ è¿ç®—ç¬¦ å®é™…ä¸Šï¼Œ@ è¿ç®—ç¬¦åœ¨ PyTorch ä¸­å°±æ˜¯ torch.matmul çš„è¯­æ³•ç³–ã€‚ w = torch.randn(12, 1) # åˆ—å‘é‡ (12, 1) x = torch.randn(12, 1) # åˆ—å‘é‡ (12, 1) result = w.t() @ x # (1, 1) æ ‡é‡ï¼Œ print(result) ","date":"2024-12-30","objectID":"/torch_learning/:2:0","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"åº•å±‚å¯¹åº”å…³ç³» è¡¨è¾¾å¼ ç­‰ä»·å‡½æ•° a @ bï¼ˆ1D @ 1Dï¼‰ torch.dot(a, b) a @ bï¼ˆ1D @ 2Dï¼‰ torch.mv(b.t(), a).t() æˆ–è‡ªåŠ¨å¤„ç† a @ bï¼ˆ2D @ 2Dï¼‰ torch.mm(a, b) a @ bï¼ˆ3D @ 3Dï¼‰ torch.bmm(a, b) a @ bï¼ˆé«˜ç»´ï¼‰ torch.matmul(a, b) ","date":"2024-12-30","objectID":"/torch_learning/:2:1","tags":["pytorch"],"title":"pytorchå­¦ä¹ å“ˆ","uri":"/torch_learning/"},{"categories":["llm"],"content":"Q K V åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œå¾ˆå¤š LLM çš„è®­ç»ƒéƒ½ä½¿ç”¨ Transformer æ¶æ„ï¼Œè€Œåœ¨ Transformer æ¶æ„ä¸­è®¡ç®—çš„è¿‡ç¨‹æ¶‰åŠåˆ°çš„æœ€å…³é”®çš„å°±æ˜¯æ³¨æ„åŠ›ï¼Œå®ƒæ˜¯æ•´ä¸ªè¿‡ç¨‹ä¸­é‡è¦çš„åŸºç¡€ã€‚æ³¨æ„åŠ›æŠ½è±¡å‡ºäº† 3 ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œåœ¨è®¡ç®—è¿‡ç¨‹ä¸­å¯¹åº”ç€ 3 ä¸ªçŸ©é˜µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š Queryï¼šåœ¨è‡ªä¸»æç¤ºä¸‹ï¼Œè‡ªä¸»æç¤ºçš„å†…å®¹ï¼Œå¯¹åº”ç€çŸ©é˜µ Q Keysï¼šåœ¨éè‡ªä¸»æç¤ºä¸‹ï¼Œè¿›å…¥è§†è§‰ç³»ç»Ÿçš„çº¿ç´¢ï¼Œå¯¹åº”ç€çŸ©é˜µ K Valuesï¼šä½¿ç”¨ Query ä» Keys ä¸­åŒ¹é…å¾—åˆ°çš„çº¿ç´¢ï¼ŒåŸºäºè¿™äº›çº¿ç´¢å¾—åˆ°çš„è¿›å…¥è§†è§‰ç³»ç»Ÿä¸­ç„¦ç‚¹å†…å®¹ï¼Œå¯¹åº”ç€çŸ©é˜µ V æˆ‘ä»¬è¦è®­ç»ƒçš„æ¨¡å‹ï¼Œè¾“å…¥çš„å¥å­æœ‰ n ä¸ª tokenï¼Œè€Œé€šè¿‡é€‰æ‹©å¹¶ä½¿ç”¨æŸä¸ª Embedding æ¨¡å‹è·å–åˆ°æ¯ä¸ª token çš„ Word Embeddingï¼Œæ¯ä¸ª Word Embedding æ˜¯ä¸€ä¸ª d ç»´å‘é‡ã€‚æœ¬æ–‡æˆ‘ä»¬è¯¦ç»†è¯´æ˜è‡ªæ³¨æ„åŠ›ï¼ˆSelf-Attentionï¼‰çš„è®¡ç®—è¿‡ç¨‹ï¼Œåœ¨è¿›è¡Œè§£é‡Šè¯´æ˜ä¹‹å‰ï¼Œå…ˆå®šä¹‰ä¸€äº›æ ‡è¯†ç¬¦å·ä»¥æ–¹ä¾¿åé¢é˜è¿°ä½¿ç”¨ï¼š å‚è€ƒ Transformerå›¾è§£ ","date":"2024-12-01","objectID":"/llm_learning/:1:0","tags":["llm"],"title":"Attentionæœºåˆ¶å­¦ä¹ ","uri":"/llm_learning/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"Bç«™è§†é¢‘ Ascend Cç®—å­å¼€å‘ä¸­çº§æ•™ç¨‹ Tilingè¿‡ç¨‹å¯ä»¥åœ¨Hostä¾§å®Œæˆç”¨äºåŠ¨æ€shapeã€‚ ","date":"2024-11-08","objectID":"/ascend_c/:1:0","tags":["Ascend"],"title":"Ascend Cå­¦ä¹ ","uri":"/ascend_c/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"ä¸€ä¸ªä¾‹å­ csvåœ¨è¿™é‡Œä¸‹è½½ import torch import torchvision import torch.nn as nn import torch.optim as optim from torchvision import datasets, transforms # æ•°æ®é¢„å¤„ç† transform = transforms.Compose([ transforms.ToTensor(), transforms.Normalize((0.5,), (0.5,)) ]) # åŠ è½½æ•°æ®é›† train_dataset = datasets.MNIST('data/', train=True, download=True, transform=transform) test_dataset = datasets.MNIST('data/', train=False, download=True, transform=transform) train_loader = torch.utils.data.DataLoader(train_dataset, batch_size=64, shuffle=True) test_loader = torch.utils.data.DataLoader(test_dataset, batch_size=64, shuffle=False) # å®šä¹‰ç¥ç»ç½‘ç»œæ¨¡å‹ class NeuralNetwork(nn.Module): def __init__(self): super(NeuralNetwork, self).__init__() self.layer1 = nn.Linear(784, 128) self.layer2 = nn.Linear(128, 64) self.layer3 = nn.Linear(64, 10) def forward(self, x): x = torch.relu(self.layer1(x)) x = torch.relu(self.layer2(x)) x = self.layer3(x) return x # å®ä¾‹åŒ–æ¨¡å‹ model = NeuralNetwork() # å®šä¹‰æŸå¤±å‡½æ•°å’Œä¼˜åŒ–å™¨ loss_func = nn.CrossEntropyLoss() optimizer = optim.SGD(model.parameters(), lr=0.01) # è®­ç»ƒæ¨¡å‹ epochs = 5 for epoch in range(epochs): for batch, (images, labels) in enumerate(train_loader): optimizer.zero_grad() outputs = model(images.view(-1, 784)) loss = loss_func(outputs, labels) loss.backward() optimizer.step() # åœ¨æµ‹è¯•é›†ä¸Šè¯„ä¼°æ¨¡å‹ with torch.no_grad(): correct = 0 total = 0 for images, labels in test_loader: outputs = model(images.view(-1, 784)) _, predicted = torch.max(outputs, 1) total += labels.size(0) correct += (predicted == labels).sum().item() accuracy = correct / total print(f\"Accuracy: {accuracy}\") ä»¥ä¸Šä»£ç åˆ†ä¸ºå‡ ä¸ªè¿‡ç¨‹ æ•°æ®é¢„å¤„ç† - å®šä¹‰äº†æ•°æ®çš„è½¬æ¢æ“ä½œï¼ŒåŒ…æ‹¬å°†å›¾åƒè½¬æ¢ä¸ºå¼ é‡å¹¶è¿›è¡Œæ ‡å‡†åŒ–ã€‚ æ•°æ®åŠ è½½ - åŠ è½½äº† MNIST æ•°æ®é›†çš„è®­ç»ƒé›†å’Œæµ‹è¯•é›†ï¼Œå¹¶åˆ›å»ºäº†æ•°æ®åŠ è½½å™¨ã€‚ æ¨¡å‹å®šä¹‰ - æ„å»ºäº†ä¸€ä¸ªåŒ…å«ä¸‰å±‚çº¿æ€§å±‚çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚ æŸå¤±å‡½æ•°ä¸ä¼˜åŒ–å™¨å®šä¹‰ - é€‰æ‹©äº†äº¤å‰ç†µæŸå¤±å‡½æ•°ï¼Œå¹¶ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ï¼ˆSGDï¼‰ä½œä¸ºä¼˜åŒ–å™¨ã€‚ æ¨¡å‹è®­ç»ƒ - é€šè¿‡å¤šä¸ªè½®æ¬¡ï¼ˆepochsï¼‰çš„è¿­ä»£ï¼Œå¯¹æ¨¡å‹è¿›è¡Œè®­ç»ƒã€‚åœ¨æ¯ä¸ªæ‰¹æ¬¡çš„æ•°æ®ä¸­ï¼Œè®¡ç®—æŸå¤±ï¼Œè¿›è¡Œåå‘ä¼ æ’­å’Œå‚æ•°æ›´æ–°ã€‚ æ¨¡å‹è¯„ä¼° - åœ¨æµ‹è¯•é›†ä¸Šå¯¹è®­ç»ƒå¥½çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œè®¡ç®—é¢„æµ‹æ­£ç¡®çš„æ•°é‡å¹¶å¾—å‡ºå‡†ç¡®ç‡ã€‚ ","date":"2024-10-29","objectID":"/my_pytorch/:1:0","tags":["pytorch"],"title":"pytorchæ‰‹å†™æ•°å­—è¯†åˆ«","uri":"/my_pytorch/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"å®‰è£…Keras Keras 2 æ˜¯ä¸€ä¸ªè¾ƒæ—§çš„ç‰ˆæœ¬ï¼ˆæœ€æ–°ä¸»ç‰ˆæœ¬ä¸º Keras 3ï¼Œä½†è®¸å¤šç”¨æˆ·ä»åœ¨ä½¿ç”¨ Keras 2.xï¼Œå°¤å…¶æ˜¯é…åˆ TensorFlow 1.x æˆ– 2.x æ—©æœŸç‰ˆæœ¬ï¼‰ã€‚ è£…TensorFlow 2.15çš„æ—¶å€™ï¼ŒKeras 2è‡ªåŠ¨å°±å¸¦ä¸Šäº†ã€‚ pip install tensorflow==2.15.0 ","date":"2024-10-25","objectID":"/keras_first/:1:0","tags":["Keras"],"title":"Keras ç®€å•å°è¯•","uri":"/keras_first/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"ä¸€ä¸ªdemo import tensorflow as tf import keras print(f\"TensorFlowç‰ˆæœ¬: {tf.__version__}\") print(f\"Kerasç‰ˆæœ¬: {keras.__version__}\") # åˆ›å»ºä¸€ä¸ªç®€å•çš„æ¨¡å‹ model = keras.Sequential([ keras.layers.Dense(128, activation='relu', input_shape=(784,)), keras.layers.Dense(10, activation='softmax') ]) print(\"æ¨¡å‹åˆ›å»ºæˆåŠŸï¼\") è§†é¢‘è¯¾ç¨‹ ","date":"2024-10-25","objectID":"/keras_first/:2:0","tags":["Keras"],"title":"Keras ç®€å•å°è¯•","uri":"/keras_first/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"å®ç°çº¿æ€§å›å½’ import keras import numpy as np import matplotlib matplotlib.use('Qt5Agg') import matplotlib.pyplot as plt # SequentialæŒ‰é¡ºåºæ„æˆçš„æ¨¡å‹ from keras.models import Sequential # Denseå…¨è¿æ¥å±‚ from keras.layers import Dense # ä½¿ç”¨numpyç”Ÿæˆ100ä¸ªéšæœºç‚¹ x_data = np.random.rand(100) noise = np.random.normal(0, 0.01, x_data.shape) y_data = x_data*0.1 + 0.2 + noise # æ„å»ºä¸€ä¸ªé¡ºåºæ¨¡å‹ model= Sequential() # åœ¨æ¨¡å‹ä¸­æ·»åŠ ä¸€ä¸ªå…¨è¿æ¥å±‚ model.add(Dense(units=1, input_dim=1)) # sgdï¼šStochasticgradientdescentï¼Œéšæœºæ¢¯åº¦ä¸‹é™æ³• # mseï¼šMean Squared Errorï¼Œå‡æ–¹è¯¯å·® model.compile(optimizer='sgd', loss='mse') # è®­ç»ƒ3001ä¸ªæ‰¹æ¬¡ for step in range(3001): # æ¯æ¬¡è®­ç»ƒä¸€ä¸ªæ‰¹æ¬¡ cost = model.train_on_batch(x_data, y_data) # æ¯500ä¸ªbatchæ‰“å°ä¸€æ¬¡costå€¼ if step % 500 == 0: print('cost:', cost) # æ‰“å°æƒå€¼å’Œåç½®å€¼ W, b = model. layers[0].get_weights() print('w:', W, 'b:', b) # x_dataè¾“å…¥ç½‘ç»œä¸­ï¼Œå¾—åˆ°é¢„æµ‹å€¼y_pred y_pred = model.predict(x_data) # æ˜¾ç¤ºéšæœºç‚¹ plt.scatter(x_data, y_data) # æ˜¾ç¤ºé¢„æµ‹ç»“æœ plt.plot(x_data, y_pred, 'r-', lw=3) # y_predçš„shapeæ˜¯(100, 1)ï¼Œä½†plot() å‡½æ•°å¯ä»¥è‡ªåŠ¨å¤„ç†è¿™ç§å½¢çŠ¶å·®å¼‚ plt.show() ","date":"2024-10-25","objectID":"/keras_first/:3:0","tags":["Keras"],"title":"Keras ç®€å•å°è¯•","uri":"/keras_first/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"éçº¿æ€§å›å½’ import keras import numpy as np import matplotlib matplotlib.use('Qt5Agg') import matplotlib.pyplot as plt # SequentialæŒ‰é¡ºåºæ„æˆçš„æ¨¡å‹ from keras.models import Sequential # Denseå…¨è¿æ¥å±‚ from keras.layers import Dense, Activation from keras.optimizers import SGD, Adam #ä½¿ç”¨numpyç”Ÿæˆ200ä¸ªéšæœºç‚¹ x_data = np.linspace(-0.5, 0.5, 200) noise = np.random.normal(0, 0.02, x_data.shape) y_data = np.square(x_data) + noise #åœ¨æ¨¡å‹ä¸­æ·»åŠ ä¸€ä¸ªå…¨è¿æ¥å±‚ # æ„å»ºæ¨¡å‹ - ä¿®æ­£ç‰ˆæœ¬ model = Sequential() # éšè—å±‚ä½¿ç”¨tanhæˆ–reluéƒ½å¯ä»¥ï¼Œä½†éœ€è¦åˆé€‚çš„åˆå§‹åŒ– model.add(Dense(units=64, input_dim=1, activation='relu', kernel_initializer='he_normal')) model.add(Dense(units=32, activation='relu', kernel_initializer='he_normal')) # é‡è¦ï¼šè¾“å‡ºå±‚ä¸è¦ä½¿ç”¨æ¿€æ´»å‡½æ•°ï¼ˆæˆ–ç”¨çº¿æ€§æ¿€æ´»ï¼‰ç”¨äºå›å½’é—®é¢˜ model.add(Dense(units=1)) # é»˜è®¤å°±æ˜¯çº¿æ€§æ¿€æ´» # ä½¿ç”¨æ›´ç¨³å®šçš„ä¼˜åŒ–å™¨ï¼Œå­¦ä¹ ç‡è°ƒå° optimizer = Adam(learning_rate=0.01) # æˆ–è€… SGD(learning_rate=0.01, momentum=0.9) model.compile(optimizer=optimizer, loss='mse') #è®­ç»ƒ3001ä¸ªæ‰¹æ¬¡ for step in range(3001): #æ¯æ¬¡è®­ç»ƒä¸€ä¸ªæ‰¹æ¬¡ cost = model.train_on_batch(x_data, y_data) #æ¯500ä¸ªbatchæ‰“å°ä¸€æ¬¡costå€¼ if step % 500==0: print('cost:', cost) #model.fit(x_data, y_data, epochs=300, batch_size=32, verbose=1) #x_dataè¾“å…¥ç½‘ç»œä¸­ï¼Œå¾—åˆ°é¢„æµ‹å€¼y_pred y_pred = model.predict(x_data) #æ˜¾ç¤ºéšæœºç‚¹ plt.scatter(x_data, y_data) #æ˜¾ç¤ºé¢„æµ‹ç»“æœ plt.plot(x_data, y_pred, 'r-', lw=3) plt.show() ","date":"2024-10-25","objectID":"/keras_first/:4:0","tags":["Keras"],"title":"Keras ç®€å•å°è¯•","uri":"/keras_first/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"ğŸ”§ å…¶ä»–æ”¹è¿›å»ºè®® å­¦ä¹ ç‡å¤ªé«˜ï¼šSGD(lr=0.3) å¯¹äºè¿™ç§å°è§„æ¨¡é—®é¢˜å¯èƒ½å¤ªå¤§ï¼Œå®¹æ˜“éœ‡è¡ã€‚å»ºè®®ç”¨ 0.01 æˆ–ä½¿ç”¨ Adam ä¼˜åŒ–å™¨ï¼ˆè‡ªé€‚åº”å­¦ä¹ ç‡ï¼‰ã€‚ å¢åŠ è®­ç»ƒè½®æ•°æˆ–ä½¿ç”¨ fit()ï¼štrain_on_batch è™½ç„¶çµæ´»ï¼Œä½†ä¸å¦‚ model.fit(x_data, y_data, epochs=3000, verbose=1) æ–¹ä¾¿ï¼Œä¸”é»˜è®¤ä¼šåšæ›´å¥½çš„å†…éƒ¨å¤„ç†ã€‚ éšè—å±‚æ¿€æ´»å‡½æ•°æ²¡é—®é¢˜ï¼šrelu åœ¨éšè—å±‚æ˜¯å¯ä»¥çš„ï¼Œä¹Ÿå¯ä»¥è¯•è¯• tanhï¼ˆå¯¹ç§°ï¼Œé€‚åˆæ‹Ÿåˆ xÂ² è¿™ç§å¯¹ç§°å‡½æ•°ï¼‰ã€‚ ","date":"2024-10-25","objectID":"/keras_first/:4:1","tags":["Keras"],"title":"Keras ç®€å•å°è¯•","uri":"/keras_first/"},{"categories":["æ·±åº¦å­¦ä¹ "],"content":"æ•°å­—è¯†åˆ« 6wå¼ å›¾ç‰‡çš„æ•°æ®é›† import os from keras.datasets import mnist from keras import utils from keras.optimizers import SGD from keras.models import Sequential from keras.layers import Dense import numpy as np os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2' # è½½å…¥æ•°æ® (x_train, y_train), (x_test, y_test) = mnist.load_data() # (60000,28,28) print('x_shape:', x_train.shape) # (60000) print('y_shape', y_train.shape) # (60000,28,28)-\u003e(60000,784) x_train = x_train.reshape(x_train.shape[0], -1)/255.0 x_test = x_test.reshape(x_test.shape[0], -1)/255.0 # æ¢one hotæ ¼å¼ y_train = utils.to_categorical(y_train, num_classes=10) y_test = utils.to_categorical(y_test, num_classes=10) # åˆ›å»ºæ¨¡å‹ï¼Œè¾“å…¥784ä¸ªç¥ç»å…ƒï¼Œè¾“å‡º10ä¸ªç¥ç»å…ƒ model = Sequential([ Dense(units=10, input_dim=784, bias_initializer='one', activation='softmax') ]) # å®šä¹‰ä¼˜åŒ–å™¨ sgd = SGD(learning_rate=0.2) # è®¾ç½®loss functionï¼Œè®­ç»ƒè¿‡ç¨‹ä¸­å‡†ç¡®ç‡ model.compile(optimizer = sgd, loss='mse', metrics=['accuracy']) # è®­ç»ƒæ¨¡å‹ï¼Œ6wå¼ å›¾æ¯æ¬¡æ‹¿32å¼ è®­ç»ƒ model.fit(x_train, y_train, batch_size=32, epochs=10) # è¯„ä¼°æ¨¡å‹ loss,accuracy = model.evaluate(x_test, y_test) print('\\ntest loss', loss) print('accuracy', accuracy) ","date":"2024-10-25","objectID":"/keras_first/:5:0","tags":["Keras"],"title":"Keras ç®€å•å°è¯•","uri":"/keras_first/"},{"categories":["Machine Learning"],"content":"æœ€å°äºŒä¹˜æ³• æ—©åœ¨19ä¸–çºª,å‹’è®©å¾·å°±è®¤ä¸ºè®©\"è¯¯å·®çš„å¹³æ–¹å’Œæœ€å°\"ä¼°è®¡å‡ºæ¥çš„æ¨¡å‹æ˜¯æœ€æ¥è¿‘çœŸå®æƒ…å½¢çš„ã€‚ æŒ‰ç…§å‹’è®©å¾·çš„æœ€ä½³åŸåˆ™,äºæ˜¯å°±æ˜¯æ±‚: $$ \\text{L} = \\sum_{i=1}^{n} \\left( y_i - f(x_i) \\right)^2 $$ è¿™ä¸ªç›®æ ‡å‡½æ•°å–å¾—æœ€å°å€¼æ—¶çš„å‡½æ•°å‚æ•°,è¿™å°±æ˜¯æœ€å°äºŒä¹˜æ³•çš„æ€æƒ³æƒ³,æ‰€è°“\"äºŒä¹˜\"å°±æ˜¯å¹³æ–¹çš„æ„æ€ã€‚ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°,æœ€å°äºŒä¹˜æ³•å…¶å® å°±æ˜¯ç”¨æ¥åšå‡½æ•°æ‹Ÿåˆçš„ä¸€ç§æ€æƒ³ã€‚ è‡³äºæ€ä¹ˆæ±‚å‡ºå…·ä½“çš„å‚æ•°é‚£å°±æ˜¯å¦å¤–ä¸€ä¸ªé—®é¢˜äº†,ç†è®ºä¸Šå¯ä»¥ç”¨å¯¼æ•°æ³•ã€å‡ ä½•æ³•,å·¥ç¨‹ä¸Šå¯ä»¥ç”¨æ¢¯åº¦ä¸‹é™æ³•ã€‚ä¸‹é¢ä»¥æœ€å¸¸ç”¨çš„çº¿æ€§å›å½’ä¸º ä¾‹è¿›è¡Œæ¨å¯¼å’Œç†è§£ã€‚ åœ¨æœºå™¨å­¦ä¹ ä¸­ç”¨äºå›å½’é—®é¢˜çš„æŸå¤±å‡½æ•°(Loss Function)æ˜¯å‡æ–¹è¯¯å·®(MSE)ï¼š $$ \\text{L} = \\frac{1}{2n} \\sum_{i=1}^{n} \\left( y_i - f(x_i) \\right)^2 $$ å…¶å®å°±æ˜¯å¤šäº†ä¸ª1/2nã€‚ ","date":"2024-10-08","objectID":"/least_square/:1:0","tags":[],"title":"æœ€å°äºŒä¹˜æ³•å’Œçº¿æ€§å›å½’","uri":"/least_square/"},{"categories":["Machine Learning"],"content":"çº¿æ€§å›å½’ çº¿æ€§å›å½’å› ä¸ºæ¯”è¾ƒç®€å•,å¯ä»¥ç›´æ¥æ¨å¯¼å‡ºè§£æè§£,è€Œä¸”è®¸å¤šéçº¿æ€§çš„é—®é¢˜ä¹Ÿå¯ä»¥è½¬åŒ–ä¸ºçº¿æ€§é—®é¢˜æ¥è§£å†³,æ‰€ä»¥å¾—åˆ°äº†å¹¿æ³›çš„åº”ç”¨ã€‚ç”šè‡³è®¸å¤šäººè®¤ä¸ºæœ€å°äºŒä¹˜æ³•æŒ‡çš„å°±æ˜¯çº¿æ€§å›å½’,å…¶å®å¹¶ä¸æ˜¯,æœ€å°äºŒä¹˜æ³•å°±æ˜¯ä¸€ç§æ€æƒ³,å®ƒå¯ä»¥æ‹Ÿåˆä»»æ„å‡½æ•°,çº¿æ€§å›å½’åªæ˜¯å…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒç®€å•è€Œä¸”ä¹Ÿå¾ˆå¸¸ç”¨çš„å‡½æ•°,æ‰€ä»¥è®²æœ€å°äºŒä¹˜æ³•åŸºæœ¬éƒ½ä¼šä»¥å®ƒä¸ºä¾‹ã€‚ ä¸‹é¢æˆ‘ä¼šå…ˆç”¨çŸ©é˜µæ³•è¿›è¡Œæ¨å¯¼,ç„¶åå†ç”¨å‡ ä½•æ³•æ¥å¸®åŠ©ä½ ç†è§£æœ€å°äºŒä¹˜æ³•çš„å‡ ä½•æ„ä¹‰ã€‚ è®¾è®¡çŸ©é˜µ X ï¼ˆç»´åº¦ä¸º$ n \\times \\left(p + 1\\right) $ï¼‰ï¼šåŒ…å«æ‰€æœ‰æ ·æœ¬çš„ç‰¹å¾ä¿¡æ¯ï¼Œç¬¬ä¸€åˆ—æ˜¯å…¨ä¸º 1 çš„å¸¸æ•°åˆ—ï¼Œä»£è¡¨æˆªè·é¡¹$ \\beta_{0} $ ï¼Œå…¶ä½™åˆ—ä¸ºå„ä¸ªç‰¹å¾çš„å€¼ã€‚ $$ \\boldsymbol{X}=\\left[\\begin{array}{ccccc} 1 \u0026 x_{11} \u0026 x_{12} \u0026 \\ldots \u0026 x_{1 p} \\newline 1 \u0026 x_{21} \u0026 x_{22} \u0026 \\ldots \u0026 x_{2 p} \\newline \\vdots \u0026 \\vdots \u0026 \\vdots \u0026 \\ddots \u0026 \\vdots \\newline 1 \u0026 x_{n 1} \u0026 x_{n 2} \u0026 \\ldots \u0026 x_{n p} \\end{array}\\right] $$ å›å½’ç³»æ•°å‘é‡ $ \\beta $ ï¼ˆç»´åº¦ä¸º$ \\left(p + 1\\right) \\times 1 $ï¼‰ï¼šåŒ…å«æ‰€æœ‰çš„å›å½’ç³»æ•°ï¼ˆåŒ…æ‹¬æˆªè·é¡¹ï¼‰ã€‚ $$ \\boldsymbol{\\beta} = \\begin{bmatrix} \\beta_0 \\newline \\beta_1 \\newline \\beta_2 \\newline \\vdots \\newline \\beta_p \\end{bmatrix} $$ è§‚æµ‹å€¼å‘é‡$ y $ï¼ˆç»´åº¦ä¸º$ n \\times 1 $ï¼‰ï¼šåŒ…å«æ‰€æœ‰æ ·æœ¬çš„ç›®æ ‡å€¼ã€‚ $$ \\boldsymbol{y} = \\begin{bmatrix} y_0 \\newline y_1 \\newline y_2 \\newline \\vdots \\newline y_p \\end{bmatrix} $$ çº¿æ€§å›å½’çš„æ¨¡å‹å¯ä»¥ç®€åŒ–ä¸ºï¼š $$ \\boldsymbol{y} = \\boldsymbol{X}\\boldsymbol{\\beta} + \\boldsymbol{\\epsilon} $$ å…¶ä¸­$\\boldsymbol{\\epsilon}$æ˜¯è¯¯å·®å‘é‡ã€‚ ä¸ºäº†ä¼°è®¡$\\beta$ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ æœ€å°äºŒä¹˜æ³• æ¥æœ€å°åŒ–æ®‹å·®å¹³æ–¹å’Œï¼Œå³ï¼š $$ \\min_{\\beta} || \\boldsymbol{y} - \\boldsymbol{X}\\boldsymbol{\\beta} ||^2 $$ è¿™é‡Œçš„$|\\cdot|$è¡¨ç¤ºFrobenius èŒƒæ•°æˆ–F-èŒƒæ•°ï¼Œæ˜¯ä¸€ç§çŸ©é˜µèŒƒæ•°ã€‚ çŸ©é˜µAçš„FrobeniusèŒƒæ•°å®šä¹‰ä¸ºçŸ©é˜µAå„é¡¹å…ƒç´ çš„ç»å¯¹å€¼å¹³æ–¹çš„æ€»å’Œï¼Œå³ ï¼š $$ ||A||F = \\sqrt{\\sum{i,j} |a_{ij}|^2} $$ è¿™é‡Œ$ a_{ij} $æ˜¯çŸ©é˜µ ä¸­ç¬¬iè¡Œï¼Œç¬¬jåˆ—çš„å…ƒç´ ã€‚ä¸‹æ ‡2å¯ä»¥çœç•¥ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å†™æˆ$ ||A|| $ã€‚ å› ä¸º$ \\boldsymbol{y} - \\boldsymbol{X}\\boldsymbol{\\beta} $å…¶å®æ˜¯ä¸€ä¸ªåˆ—å‘é‡ï¼Œæ‰€ä»¥å®ƒçš„F-èŒƒæ•°çš„å¹³æ–¹å°±æ˜¯è¡Œå‘é‡ä¹˜ä»¥åˆ—å‘é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼š $$ ||A||^2 = A^TA $$ æ‰€ä»¥è¯¯å·®å‡½æ•°å¯ä»¥è¡¨ç¤ºä¸º: $$ || y - X\\beta ||^2 = (y - X\\beta)^T (y - X\\beta) $$ å±•å¼€åå¾—åˆ°ï¼š $$ (y - X\\beta)^T (y - X\\beta) = y^T y - y^T X\\beta - (X\\beta)^T y + (X\\beta)^T X\\beta $$ ç„¶åå¾—åˆ°ï¼š $$ (y - X\\beta)^T (y - X\\beta) = y^T y - y^T X\\beta - \\beta^TX^T y + \\beta^T X^T X \\beta $$ è¿™é‡Œ$y^T X\\beta $å’Œ$ \\beta^TX^T y$ éƒ½æ˜¯$1 \\times 1$çš„æ ‡é‡ï¼Œå¯¹äºæ ‡é‡ï¼Œæœ‰$a^T = a$ï¼Œå› æ­¤$\\beta^TX^T y = (\\beta^TX^T y)^T = y^TX\\beta $ åˆå¹¶åŒç±»é¡¹ï¼š $$ (y - X\\beta)^T (y - X\\beta) = y^T y - 2\\beta^T X^Ty + \\beta^T X^T X \\beta $$ æˆ‘ä»¬æœ‰$Q$å‡½æ•° $$ Q(\\beta) = y^T y - 2\\beta^T X^Ty + \\beta^T X^T X \\beta $$ ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹å…¶æ±‚å¯¼æ¥æ‰¾åˆ°$min \\beta$ï¼Œè¿™é‡Œæ¶‰åŠåˆ°äº†çŸ©é˜µå¾®ç§¯åˆ† $$ \\frac{\\partial Q(\\boldsymbol{\\beta})}{\\partial \\boldsymbol{\\beta}}=2 \\boldsymbol{X}^{T} \\boldsymbol{X} \\boldsymbol{\\beta}-2 \\boldsymbol{X}^{T} \\boldsymbol{y} $$ ä»¤$\\frac{\\partial Q(\\boldsymbol{\\beta})}{\\partial \\boldsymbol{\\beta}}=0$å¯å¾—ï¼š $$ \\boldsymbol{X}^{T} \\boldsymbol{X} \\boldsymbol{\\beta}=\\boldsymbol{X}^{T} \\boldsymbol{y} $$ å‡è®¾$\\boldsymbol{X}^{T}X$æ˜¯æ»¡ç§©çš„ï¼Œå› ä¸º$(\\boldsymbol{X}^{T}X)^{-1}$å­˜åœ¨ï¼Œè§£å¾—ï¼š $$ \\boldsymbol{\\beta} = (\\boldsymbol{X}^{T}X)^{-1} \\boldsymbol{X}^{T}\\boldsymbol{y} $$ å‚è€ƒï¼š çŸ©é˜µèŒƒæ•° æœ€å°äºŒä¹˜æ³•çº¿æ€§å›å½’ï¼šçŸ©é˜µè§†è§’ ","date":"2024-10-08","objectID":"/least_square/:2:0","tags":[],"title":"æœ€å°äºŒä¹˜æ³•å’Œçº¿æ€§å›å½’","uri":"/least_square/"},{"categories":["Nodejs"],"content":"JavaScriptä¼šå°†å¼‚æ­¥ä»»åŠ¡åˆ’åˆ†ä¸ºå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ï¼Œå¾®ä»»åŠ¡ä¼šåœ¨å®ä»»åŠ¡ä¹‹å‰æ‰§è¡Œï¼ˆå› ä¸ºæ¯æ¬¡ä»ä¸»çº¿ç¨‹åˆ‡æ¢åˆ°ä»»åŠ¡é˜Ÿåˆ—æ—¶ï¼Œéƒ½ä¼šä¼˜å…ˆéå†å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œåéå†å®ä»»åŠ¡é˜Ÿåˆ—ï¼‰ã€‚ ","date":"2024-09-18","objectID":"/javascript_%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97_promise/:0:0","tags":["Promise","Nodejs"],"title":"JavaScriptä¸­çš„å¾®ä»»åŠ¡ã€å®ä»»åŠ¡å’ŒPromise","uri":"/javascript_%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97_promise/"},{"categories":["Nodejs"],"content":"ä¸€ä¸ªå°ä¾‹å­ // 1 setTimeout(() =\u003e { // å®ä»»åŠ¡ console.log(4) }, 0) // 2 new Promise(resolve =\u003e { resolve() console.log(1) // 3 }).then(data =\u003e { // å¾®ä»»åŠ¡ console.log(3) }) // 4 console.log(2) // åŒæ­¥ä»»åŠ¡ // æ‰§è¡Œç»“æœï¼š 1 2 3 4 ","date":"2024-09-18","objectID":"/javascript_%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97_promise/:1:0","tags":["Promise","Nodejs"],"title":"JavaScriptä¸­çš„å¾®ä»»åŠ¡ã€å®ä»»åŠ¡å’ŒPromise","uri":"/javascript_%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97_promise/"},{"categories":["Nodejs"],"content":"Promiseå®ç°åŸç† // åˆ¤æ–­å˜é‡å¦ä¸ºfunction const isFunction = variable =\u003e typeof variable === 'function' // å®šä¹‰Promiseçš„ä¸‰ç§çŠ¶æ€å¸¸é‡ const PENDING = 'PENDING' const FULFILLED = 'FULFILLED' const REJECTED = 'REJECTED' class MyPromise { constructor (handle) { if (!isFunction(handle)) { throw new Error('MyPromise must accept a function as a parameter') } // æ·»åŠ çŠ¶æ€ this._status = PENDING // æ·»åŠ çŠ¶æ€ this._value = undefined // æ·»åŠ æˆåŠŸå›è°ƒå‡½æ•°é˜Ÿåˆ— this._fulfilledQueues = [] // æ·»åŠ å¤±è´¥å›è°ƒå‡½æ•°é˜Ÿåˆ— this._rejectedQueues = [] // æ‰§è¡Œhandle try { handle(this._resolve.bind(this), this._reject.bind(this)) } catch (err) { this._reject(err) } } // æ·»åŠ resovleæ—¶æ‰§è¡Œçš„å‡½æ•° _resolve (val) { const run = () =\u003e { if (this._status !== PENDING) return // ä¾æ¬¡æ‰§è¡ŒæˆåŠŸé˜Ÿåˆ—ä¸­çš„å‡½æ•°ï¼Œå¹¶æ¸…ç©ºé˜Ÿåˆ— const runFulfilled = (value) =\u003e { let cb; while (cb = this._fulfilledQueues.shift()) { cb(value) } } // ä¾æ¬¡æ‰§è¡Œå¤±è´¥é˜Ÿåˆ—ä¸­çš„å‡½æ•°ï¼Œå¹¶æ¸…ç©ºé˜Ÿåˆ— const runRejected = (error) =\u003e { let cb; while (cb = this._rejectedQueues.shift()) { cb(error) } } /* å¦‚æœresolveçš„å‚æ•°ä¸ºPromiseå¯¹è±¡ï¼Œåˆ™å¿…é¡»ç­‰å¾…è¯¥Promiseå¯¹è±¡çŠ¶æ€æ”¹å˜å, å½“å‰Promsieçš„çŠ¶æ€æ‰ä¼šæ”¹å˜ï¼Œä¸”çŠ¶æ€å–å†³äºå‚æ•°Promsieå¯¹è±¡çš„çŠ¶æ€ */ if (val instanceof MyPromise) { val.then(value =\u003e { this._value = value this._status = FULFILLED runFulfilled(value) }, err =\u003e { this._value = err this._status = REJECTED runRejected(err) }) } else { this._value = val this._status = FULFILLED runFulfilled(val) } } // ä¸ºäº†æ”¯æŒåŒæ­¥çš„Promiseï¼Œè¿™é‡Œé‡‡ç”¨å¼‚æ­¥è°ƒç”¨ setTimeout(run, 0) } // æ·»åŠ rejectæ—¶æ‰§è¡Œçš„å‡½æ•° _reject (err) { if (this._status !== PENDING) return // ä¾æ¬¡æ‰§è¡Œå¤±è´¥é˜Ÿåˆ—ä¸­çš„å‡½æ•°ï¼Œå¹¶æ¸…ç©ºé˜Ÿåˆ— const run = () =\u003e { this._status = REJECTED this._value = err let cb; while (cb = this._rejectedQueues.shift()) { cb(err) } } // ä¸ºäº†æ”¯æŒåŒæ­¥çš„Promiseï¼Œè¿™é‡Œé‡‡ç”¨å¼‚æ­¥è°ƒç”¨ setTimeout(run, 0) } // æ·»åŠ thenæ–¹æ³• then (onFulfilled, onRejected) { const { _value, _status } = this // è¿”å›ä¸€ä¸ªæ–°çš„Promiseå¯¹è±¡ return new MyPromise((onFulfilledNext, onRejectedNext) =\u003e { // å°è£…ä¸€ä¸ªæˆåŠŸæ—¶æ‰§è¡Œçš„å‡½æ•° let fulfilled = value =\u003e { try { if (!isFunction(onFulfilled)) { onFulfilledNext(value) } else { let res = onFulfilled(value); if (res instanceof MyPromise) { // å¦‚æœå½“å‰å›è°ƒå‡½æ•°è¿”å›MyPromiseå¯¹è±¡ï¼Œå¿…é¡»ç­‰å¾…å…¶çŠ¶æ€æ”¹å˜ååœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªå›è°ƒ res.then(onFulfilledNext, onRejectedNext) } else { //å¦åˆ™ä¼šå°†è¿”å›ç»“æœç›´æ¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•°ï¼Œå¹¶ç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•° onFulfilledNext(res) } } } catch (err) { // å¦‚æœå‡½æ•°æ‰§è¡Œå‡ºé”™ï¼Œæ–°çš„Promiseå¯¹è±¡çš„çŠ¶æ€ä¸ºå¤±è´¥ onRejectedNext(err) } } // å°è£…ä¸€ä¸ªå¤±è´¥æ—¶æ‰§è¡Œçš„å‡½æ•° let rejected = error =\u003e { try { if (!isFunction(onRejected)) { onRejectedNext(error) } else { let res = onRejected(error); if (res instanceof MyPromise) { // å¦‚æœå½“å‰å›è°ƒå‡½æ•°è¿”å›MyPromiseå¯¹è±¡ï¼Œå¿…é¡»ç­‰å¾…å…¶çŠ¶æ€æ”¹å˜ååœ¨æ‰§è¡Œä¸‹ä¸€ä¸ªå›è°ƒ res.then(onFulfilledNext, onRejectedNext) } else { //å¦åˆ™ä¼šå°†è¿”å›ç»“æœç›´æ¥ä½œä¸ºå‚æ•°ï¼Œä¼ å…¥ä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•°ï¼Œå¹¶ç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ªthençš„å›è°ƒå‡½æ•° onFulfilledNext(res) } } } catch (err) { // å¦‚æœå‡½æ•°æ‰§è¡Œå‡ºé”™ï¼Œæ–°çš„Promiseå¯¹è±¡çš„çŠ¶æ€ä¸ºå¤±è´¥ onRejectedNext(err) } } switch (_status) { // å½“çŠ¶æ€ä¸ºpendingæ—¶ï¼Œå°†thenæ–¹æ³•å›è°ƒå‡½æ•°åŠ å…¥æ‰§è¡Œé˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œ case PENDING: this._fulfilledQueues.push(fulfilled) this._rejectedQueues.push(rejected) break // å½“çŠ¶æ€å·²ç»æ”¹å˜æ—¶ï¼Œç«‹å³æ‰§è¡Œå¯¹åº”çš„å›è°ƒå‡½æ•° case FULFILLED: fulfilled(_value) break case REJECTED: rejected(_value) break } }) } // æ·»åŠ catchæ–¹æ³• catch (onRejected) { return this.then(undefined, onRejected) } // æ·»åŠ é™æ€resolveæ–¹æ³• static resolve (value) { // å¦‚æœå‚æ•°æ˜¯MyPromiseå®ä¾‹ï¼Œç›´æ¥è¿”å›è¿™ä¸ªå®ä¾‹ if (value instanceof MyPromise) return value return new MyPromise(resolve =\u003e resolve(value)) } // æ·»åŠ é™æ€rejectæ–¹æ³• static reject (value) { return new MyPromise((resolve ,reject) =\u003e reject(value)) } // æ·»åŠ é™æ€allæ–¹æ³• static all (list) { return new MyPromise((resolve, reject) =\u003e { /** * è¿”å›å€¼çš„é›†åˆ */ let values = [] let count = 0 for (let [i, p] of list.entries()) { // æ•°ç»„å‚æ•°å¦‚æœä¸æ˜¯MyPromiseå®ä¾‹ï¼Œå…ˆè°ƒç”¨MyPromise.resolve this.resolve(p).then(res =\u003e { values[i] = res count++ // æ‰€æœ‰çŠ¶æ€éƒ½å˜æˆfulfilledæ—¶è¿”å›çš„MyPromiseçŠ¶æ€å°±å˜æˆfulfilled if (count === list.length) resolve(values) }, err =\u003e { // æœ‰ä¸€ä¸ªè¢«rejectedæ—¶è¿”å›çš„MyPromiseçŠ¶æ€å°±å˜æˆrejected reject(err) }) } }) } // æ·»åŠ é™æ€raceæ–¹æ³• static race (list) { return new MyPromise((resolve, reject) =\u003e { for (let p of list) { // åªè¦æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼Œæ–°çš„MyPromiseçš„çŠ¶æ€å°±è·Ÿç€æ”¹å˜ this.resolve(p).then(res =\u003e { resolve(res) }, err =\u003e { reject(err) }) } }) } finally (cb) { return this.then( value =\u003e MyPromise.resolve(cb()).then(() =\u003e value), reason =\u003e MyPromise.resolve(cb()).then(() =\u003e { throw reason }) ); } } let promise1 = new MyProm","date":"2024-09-18","objectID":"/javascript_%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97_promise/:2:0","tags":["Promise","Nodejs"],"title":"JavaScriptä¸­çš„å¾®ä»»åŠ¡ã€å®ä»»åŠ¡å’ŒPromise","uri":"/javascript_%E4%BB%BB%E5%8A%A1%E9%98%9F%E5%88%97_promise/"},{"categories":["cuda"],"content":"CUDA çš„å®‰è£…å‚è€ƒä¹‹å‰çš„æ–‡ç«  éœ€è¦å®‰è£… OptiX 8 è¿™æ˜¯Reference.pdf æ–°å»ºä¸€ä¸ª CMake é¡¹ç›®ï¼Œç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ optix_example/ â”œâ”€â”€ CMakeLists.txt â”œâ”€â”€ src â””â”€â”€ main.cpp â””â”€â”€ cmake â””â”€â”€ FindOptiX80.cmake CMakeLists.txtæ–‡ä»¶ï¼š cmake_minimum_required(VERSION 3.10) project(OptiXExample) set(CMAKE_CXX_STANDARD 17) # Find OptiX package list(APPEND CMAKE_MODULE_PATH \"${CMAKE_SOURCE_DIR}/cmake\") find_package(OptiX80) # Add CUDA find_package(CUDAToolkit 12.0 REQUIRED) # Include directories include_directories(${OPTIX80_INCLUDE_DIR} ${CUDAToolkit_INCLUDE_DIRS}) # Source files set(SOURCES src/main.cpp) # Executable add_executable(OptiXExample ${SOURCES}) # Link libraries target_link_libraries(OptiXExample CUDA::cudart) FindOptix80.cmakeæ–‡ä»¶ï¼š # Looks for the environment variable: # OPTIX80_PATH # Sets the variables : # OPTIX80_INCLUDE_DIR # OptiX80_FOUND set(OPTIX80_PATH $ENV{OPTIX80_PATH}) if(\"${OPTIX80_PATH}\" STREQUAL \"\") if(WIN32) # Try finding it inside the default installation directory under Windows first. set(OPTIX80_PATH \"C:/ProgramData/NVIDIA Corporation/OptiX SDK 8.0.0\") else() # Adjust this if the OptiX SDK 8.0.0 installation is in a different location. set(OPTIX80_PATH \"~/NVIDIA-OptiX-SDK-8.0.0-linux64\") endif() endif() find_path(OPTIX80_INCLUDE_DIR optix_host.h ${OPTIX80_PATH}/include) # message(\"OPTIX80_INCLUDE_DIR = \" \"${OPTIX80_INCLUDE_DIR}\") include(FindPackageHandleStandardArgs) find_package_handle_standard_args(OptiX80 DEFAULT_MSG OPTIX80_INCLUDE_DIR) mark_as_advanced(OPTIX80_INCLUDE_DIR) # message(\"OptiX80_FOUND = \" \"${OptiX80_FOUND}\") ä¸Šé¢çš„å†…å®¹æ˜¯å‚è€ƒ Github ä¸ŠOptiX_Appsï¼Œå®ƒè¯»å–äº†OPTIX80_PATH ç¯å¢ƒå˜é‡ï¼Œä»£è¡¨ Optix åœ¨ä½ æœºå™¨ä¸Šçš„ä½ç½®ï¼Œä¾‹å¦‚æˆ‘çš„æ˜¯/home/rabbit/NVIDIA-OptiX-SDK-8.0.0-linux64-x86_64ã€‚ main.cpp æ–‡ä»¶ï¼š #include \u003coptix.h\u003e #include \u003coptix_stubs.h\u003e #include \u003coptix_function_table_definition.h\u003e #include \u003ciostream\u003e #include \u003cstring.h\u003e #include \u003cvector\u003e #include \u003cstdexcept\u003e #include \u003ccuda.h\u003e #include \u003ccuda_runtime_api.h\u003e #define OPTIX_CHECK(call) \\ { \\ OptixResult res = call; \\ if (res != OPTIX_SUCCESS) \\ { \\ fprintf(stderr, \"Optix call (%s) failed with code %d (line %d)\\n\", #call, res, __LINE__); \\ exit(2); \\ } \\ } void initOptix() { // ------------------------------------------------------- // check for available optix7 capable devices // ------------------------------------------------------- cudaFree(0); int numDevices; cudaGetDeviceCount(\u0026numDevices); if (numDevices == 0) throw std::runtime_error(\"#osc: no CUDA capable devices found!\"); std::cout \u003c\u003c \"#osc: found \" \u003c\u003c numDevices \u003c\u003c \" CUDA devices\" \u003c\u003c std::endl; // ------------------------------------------------------- // initialize optix // ------------------------------------------------------- OPTIX_CHECK(optixInit()); } int main() { // Initialize CUDA cudaFree(0); try { std::cout \u003c\u003c \"#osc: initializing optix...\" \u003c\u003c std::endl; initOptix(); std::cout \u003c\u003c \"#osc: successfully initialized optix... yay!\" \u003c\u003c std::endl; // for this simple hello-world example, don't do anything else // ... std::cout \u003c\u003c \"#osc: done. clean exit.\" \u003c\u003c std::endl; } catch (std::runtime_error \u0026e) { std::cout \u003c\u003c \"FATAL ERROR: \" \u003c\u003c e.what() \u003c\u003c std::endl; exit(1); } return 0; } æœ€åç¼–è¯‘ï¼Œè¿è¡Œè¾“å‡º $ ./OptiXExample #osc: initializing optix... #osc: found 1 CUDA devices #osc: successfully initialized optix... yay! #osc: done. clean exit. ","date":"2024-07-05","objectID":"/ubuntu-optix-8%E7%AE%80%E5%8D%95%E5%B0%9D%E8%AF%95/:0:0","tags":["OptiX","Ubuntu","cuda"],"title":"Ubuntuä¸ŠOptiX8 ç®€å•å°è¯•","uri":"/ubuntu-optix-8%E7%AE%80%E5%8D%95%E5%B0%9D%E8%AF%95/"},{"categories":["wsl2"],"content":"ç®—æ³•ç®€ä»‹ æ’æ ·é—®é¢˜ï¼ˆNesting Problemï¼‰åˆç§°ä¸ºä¸‹æ–™é—®é¢˜(Cutting and stock problems)æˆ–å¡«å……é—®é¢˜(Packing Problem)ï¼Œå…¶ç›®æ ‡æ˜¯åœ¨ææ–™åˆ‡å‰²è¿‡ç¨‹ä¸­å¯»æ‰¾ä¸€ä¸ªè¾ƒé«˜çš„ææ–™åˆ©ç”¨ç‡ã€‚æ’æ ·é—®é¢˜å±äºç»å…¸çš„NP-Hardé—®é¢˜ï¼Œå…¶æ—¶é—´å¤æ‚åº¦éšç€é—®é¢˜è§„æ¨¡çš„å¢åŠ è¿…é€Ÿä¸Šå‡ï¼Œéš¾ä»¥åœ¨åˆç†æ—¶é—´å†…ç²¾ç¡®æ±‚è§£å¤§è§„æ¨¡å®ä¾‹ã€‚ç›¸è¾ƒäºçŸ©å½¢æ’æ ·é—®é¢˜ï¼Œå¼‚å½¢ä»¶æ’æ ·é—®é¢˜çš„çªå‡ºç‰¹ç‚¹æ˜¯è£ç‰‡çš„è¾¹ç•Œè½®å»“å¤æ‚ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­éœ€è¦å¤æ‚çš„å‡ ä½•è¿ç®—ï¼Œå…¶ç®—æ³•å¤æ‚åº¦å°†è¿›ä¸€æ­¥ä¸Šå‡ï¼Œæ˜¯å­¦æœ¯ç•Œå’Œå·¥ä¸šç•Œå…¬è®¤çš„éš¾ä»¥æ±‚è§£çš„é—®é¢˜ã€‚å› æ­¤åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸è§„åˆ™å½¢çŠ¶æ’æ ·ç®—æ³•ä¸»è¦æ˜¯ä»¥å¯å‘å¼ç®—æ³•å’Œæ™ºèƒ½æœç´¢ç®—æ³•ä¸ºä¸»ã€‚ ","date":"2024-02-15","objectID":"/irregular_packing_nesting_problem/:0:1","tags":["cuda","wsl2"],"title":"äºŒç»´å¼‚å½¢ä»¶æ’ç‰ˆç®—æ³•ï¼ˆæ‘˜æŠ„ï¼‰","uri":"/irregular_packing_nesting_problem/"},{"categories":["wsl2"],"content":"NFPæ±‚è§£ç®—æ³• äºŒç»´å¼‚å½¢ä»¶æ’æ ·ç®—æ³•çš„ä¸€ä¸ªç›¸å½“é‡è¦çš„æ–¹é¢æ˜¯è®¡ç®—å‡ ä½•ç®—æ³•ï¼Œå…¶ä¸»è¦å†…å®¹åœ¨äºè®¡ç®—å¼‚å½¢ä»¶ä¹‹é—´çš„é æ¥ä½ç½®ã€ç¡®å®šè£ç‰‡ä¸é¢æ–™ä¹‹é—´çš„åŒ…å«å…³ç³»ã€åˆ¤æ–­æ˜¯å¦é‡å ä»¥åŠå®ç°äºŒç»´åŒºåŸŸä¹‹é—´çš„äº¤ã€å¹¶ã€å·®ç­‰å¸ƒå°”è¿ç®—ã€‚ ä¸ºå¯»æ‰¾ä¸€ç§æ›´ç®€ä¾¿é«˜æ•ˆçš„é æ¥å’Œé‡å åˆ¤æ–­è®¡ç®—æ–¹æ³•ï¼Œç ”ç©¶äººå‘˜æä¾›äº†ä¸´ç•Œå¤šè¾¹å½¢ï¼ˆNo-Fit Polygonï¼ŒNFPï¼‰çš„æ¦‚å¿µ[1]ã€‚ä¸´ç•Œå¤šè¾¹å½¢NFPçš„ç®€è¦å®šä¹‰å¦‚ä¸‹ï¼šç»™å®šä¸¤ä¸ªå¤šè¾¹å½¢ï¼Œå…¶ä¸­ä¸€ä¸ªå›ºå®šï¼Œå¦ä¸€ä¸ªå¤šè¾¹å½¢å›´ç»•å›ºå®šçš„å¤šè¾¹å½¢ä½œä¸æ—‹è½¬çš„åˆšä½“è¿åŠ¨ï¼Œå¹¶å›´ç»•å›ºå®šå¤šè¾¹å½¢æ»‘åŠ¨ï¼Œç›´åˆ°å›åˆ°èµ·ç‚¹ä½ç½®ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­åœ¨è¿åŠ¨å¤šè¾¹å½¢ä¸Šé€‰å–ä¸€ç‚¹ä½œä¸ºå‚è€ƒç‚¹ï¼Œåˆ™å‚è€ƒç‚¹åœ¨ç¯ç»•è¿‡ç¨‹ä¸­å½¢æˆçš„è½¨è¿¹å°±ç§°ä¸ºä¸´ç•Œå¤šè¾¹å½¢ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š NFPæ±‚è§£è¿˜ä¼šé‡åˆ°ç‰¹æ®Šåœºæ™¯ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå›¾aç”±äºå¤šè¾¹å½¢Aå­˜åœ¨å‡¹æ§½ï¼Œå¤šè¾¹å½¢Bå¯ä»¥åœ¨å‡¹æ§½å†…éƒ¨ç§»åŠ¨ï¼Œæ­¤æ—¶å°†å½¢æˆç©ºè…”NFPï¼›å›¾bç”±äºå¤šè¾¹å½¢Bæ°å¥½å¯ä»¥æ²¿ç€å¤šè¾¹å½¢Aå‡¹æ§½ç§»åŠ¨ï¼Œæ­¤æ—¶NFPå°†é€€åŒ–æˆçº¿ï¼›å›¾cå¤šè¾¹å½¢Bæ°å¥½å¯ä»¥æ”¾åœ¨å¤šè¾¹å½¢Bå‡¹æ§½å†…ï¼Œæ­¤æ—¶NFPå°†é€€åŒ–æˆç‚¹ã€‚NFPæ±‚è§£ç®—æ³•åŒæ—¶è¦è€ƒè™‘è¿™äº›ç‰¹æ®Šæƒ…æ™¯ã€‚ ç”±äºä¸´ç•Œå¤šè¾¹å½¢çš„é‡è¦æ€§è´¨ï¼ŒNFPç›®å‰å·²æˆä¸ºäºŒç»´ä¸è§„åˆ™å½¢çŠ¶æ’æ ·ç®—æ³•çš„åŸºç¡€æ€§å‡ ä½•å·¥å…·ã€‚å¦‚ä½•å¿«é€Ÿå‡†ç¡®çš„è®¡ç®—å‡ºNFPæ˜¯å¼‚å½¢ä»¶æ’æ ·é—®é¢˜çš„å…³é”®æŠ€æœ¯ã€‚å­¦ç•Œç›®å‰çš„æ±‚è§£ç®—æ³•ä¸»è¦æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯å‡¸åŒ–åˆ†å‰²æ³•ã€ç§»åŠ¨ç¢°æ’æ³•[4]ã€æ˜ç§‘å¤«æ–¯åŸºçŸ¢é‡å’Œæ³•[5]ä»¥åŠè½¨è¿¹çº¿æ³•[2]ã€‚ æ‘˜æŠ„æ–‡ç« : äºŒç»´å¼‚å½¢ä»¶æ’ç‰ˆç®—æ³•ä»‹ç»ï¼ˆä¸€ï¼‰ ","date":"2024-02-15","objectID":"/irregular_packing_nesting_problem/:0:2","tags":["cuda","wsl2"],"title":"äºŒç»´å¼‚å½¢ä»¶æ’ç‰ˆç®—æ³•ï¼ˆæ‘˜æŠ„ï¼‰","uri":"/irregular_packing_nesting_problem/"},{"categories":["wsl2"],"content":"é©±åŠ¨ ç½‘ä¸Šæœ‰è®¸å¤šèµ„æ–™å†™é“éœ€è¦å®‰è£…é’ˆå¯¹WSLç‰¹åˆ«é©±åŠ¨ï¼Œä½†æ˜¯ç°åœ¨å·²ç»ä¸éœ€è¦è¿™ä¹ˆåšäº†ï¼Œåªéœ€è¦åˆ°NVIDIAå®˜ç½‘å°†é©±åŠ¨å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬å³å¯ã€‚æ ¹æ®å‚è€ƒèµ„æ–™æè¿°ï¼Œé©±åŠ¨ç±»å‹æœ€å¥½é€‰æ‹©Game Readyç‰ˆæœ¬è€Œä¸æ˜¯studioç‰ˆæœ¬ã€‚ æ³¨æ„ï¼Œè¯¥æ˜¯å®‰è£…Windowsé©±åŠ¨ï¼Œè€Œä¸æ˜¯å®‰è£…Linuxé©±åŠ¨ï¼Œåœ¨Windowsä¸‹å®‰è£…é©±åŠ¨åï¼Œä¼šè‡ªåŠ¨å°†é©±åŠ¨ä»¥_libcuda.so_çš„å½¢å¼é›†æˆè‡³WSL2ä¸­ï¼Œå› æ­¤åˆ‡å‹¿åœ¨WSL Linuxä¸­é‡å¤å®‰è£…é©±åŠ¨ã€‚ CUDA è¿™ä¸€æ­¥è¦å°å¿ƒï¼ŒWSL2ä¸­å®‰è£…CUDAå’Œåœ¨æ™®é€šLinuxä¸­å®‰è£…CUDAä¼šæœ‰æ‰€ä¸åŒï¼Œè¦é€‰æ‹©WSL-Ubuntuç±»å‹ ç„¶åæŒ‰å‘½ä»¤å®‰è£…CUDA wget https://developer.download.nvidia.com/compute/cuda/12.3.1/local_installers/cuda_12.3.1_545.23.08_linux.run sudo sh cuda_12.3.1_545.23.08_linux.run æœ€ånvccå‘½ä»¤è¿˜æ˜¯æ²¡æ‰¾åˆ°ï¼Œå¾—vim ~/.bashrcï¼ŒæŠŠcuda-toolkitçš„ä¸œè¥¿åŠ åˆ°ç¯å¢ƒå˜é‡é‡Œï¼ˆå®˜æ–¹è„šæœ¬æ²¡å†™å¥½å§^=^ï¼‰ export PATH=${PATH}:/usr/local/cuda/bin export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/cuda/lib64 æœ€åï¼Œçœ‹ä¸€ä¸‹nvccå‘½ä»¤ $ nvcc --version nvcc: NVIDIA (R) Cuda compiler driver Copyright (c) 2005-2023 NVIDIA Corporation Built on Fri_Nov__3_17:16:49_PDT_2023 Cuda compilation tools, release 12.3, V12.3.103 Build cuda_12.3.r12.3/compiler.33492891_0 ","date":"2023-12-10","objectID":"/wsl2-install-cuda/:0:0","tags":["cuda","wsl2"],"title":"wsl2 install CUDA","uri":"/wsl2-install-cuda/"},{"categories":["Hyper-V"],"content":"åˆ›å»º NAT è™šæ‹Ÿç½‘ç»œ è¦ç”¨åˆ°ä¸€äº›PowerShellå‘½ä»¤ New-VMSwitch -SwitchName \"new\" -SwitchType Internal New-NetIPAddress -IPAddress 192.168.0.1 -PrefixLength 24 -InterfaceAlias \"vEthernet (new)\" New-NetNat -Name MyNATnetwork -InternalIPInterfaceAddressPrefix 192.168.0.0/24 New-VMSwitch æ–°å»ºäº†ä¸€ä¸ªå†…éƒ¨çš„äº¤æ¢æœº New-NetIPAddress è®¾ç½®äº†ç½‘å¡çš„ip New-NetNat è®¾å®šäº†å­ç½‘ ","date":"2023-09-08","objectID":"/hyper-v%E5%81%9Aport-forwarding/:1:0","tags":["windows","Hyper-V"],"title":"Hyper-Våšport forwarding","uri":"/hyper-v%E5%81%9Aport-forwarding/"},{"categories":["Hyper-V"],"content":"ç«¯å£æ˜ å°„ æœ€ååˆ©ç”¨Add-NetNatStaticMappingå‘½ä»¤ï¼Œæ˜ å°„åˆ°å®¿ä¸»æœºç«¯å£ï¼š Add-NetNatStaticMapping -NatName MyNATnetwork -Protocol TCP -ExternalIPAddress 0.0.0.0/24 -ExternalPort 5400 -InternalIPAddress 192.168.0.3 -InternalPort 5400 å‚è€ƒï¼š https://learn.microsoft.com/zh-cn/virtualization/hyper-v-on-windows/user-guide/setup-nat-network ","date":"2023-09-08","objectID":"/hyper-v%E5%81%9Aport-forwarding/:2:0","tags":["windows","Hyper-V"],"title":"Hyper-Våšport forwarding","uri":"/hyper-v%E5%81%9Aport-forwarding/"},{"categories":["Blender"],"content":" æŸ¥çœ‹é¡¶ç‚¹/é¢æ³•å‘é‡ å·¦ä¸Šè§’ä¸‹æ‹‰æ¡†é€‰æ‹©ç¼–è¾‘æ¨¡å¼ï¼Œåœ¨å³è¾¹3ä¸ªTabä¸­é€‰æ‹©é¢æ¨¡å¼ ç„¶åç‚¹overlaysä¸‹æ‹‰ç®­å¤´ï¼Œå°±èƒ½çœ‹åˆ°normalçš„é€‰é¡¹äº† ç¬¬ä¸€ä¸ªTabå°±æ˜¯é¡¶ç‚¹æ³•å‘ï¼Œç¬¬ä¸‰ä¸ªTabå°±æ˜¯é¢æ³•å‘ã€‚ ","date":"2023-07-20","objectID":"/blender%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/:0:0","tags":["Blender"],"title":"Blenderå¸¸ç”¨æ“ä½œ","uri":"/blender%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C/"},{"categories":["OpenGL"],"content":"é¡¶ç‚¹ç€è‰²å™¨ vertex.glsl varying vec3 vPosition; void main() { vPosition = position; // MVP vec4 modelViewPosition = modelViewMatrix * vec4( position, 1.0 ); vec4 projectedPosition = projectionMatrix * modelViewPosition; gl_Position = projectedPosition; } ç‰‡æ®µç€è‰²å™¨ fragment.glsl varying vec3 vPosition; void main() { gl_FragColor = vec4(vPosition, 1); } æ•ˆæœ ç”¨äº†PlaneGeometry // meshes const geometry = new THREE.PlaneGeometry(2, 2) const material = new THREE.ShaderMaterial({ vertexShader: vertexShader, fragmentShader: fragmentShader, }) ","date":"2023-07-02","objectID":"/webgl-shader/:0:0","tags":["WebGL"],"title":"WebGL Shader","uri":"/webgl-shader/"},{"categories":["çŸ©é˜µ"],"content":"æ—‹è½¬çŸ©é˜µ é¦–å…ˆè¦è¯´æ˜çš„æ˜¯ï¼Œå·¦å³æ‰‹æ—‹è½¬çŸ©é˜µæ˜¯ä¸ä¸€æ ·çš„ï¼ŒDirectXä¸­æ˜¯å·¦æ‰‹åæ ‡ç³»ï¼Œè€ŒOpenGLç”¨çš„æ˜¯å³æ‰‹åæ ‡ç³»ï¼Œè¿™é‡Œç»™å‡ºçš„æ—‹è½¬çŸ©é˜µä¹Ÿæ˜¯åŸºäºå³æ‰‹åæ ‡ç³»çš„ ç»•xè½´æ—‹è½¬çš„çŸ©é˜µï¼š $$ \\begin{bmatrix} \\color{red}1 \u0026 \\color{red}0 \u0026 \\color{red}0 \\newline \\color{green}0 \u0026 \\color{green}{\\cos \\theta} \u0026 - \\color{green}{\\sin \\theta} \\newline \\color{blue}0 \u0026 \\color{blue}{\\sin \\theta} \u0026 \\color{blue}{\\cos \\theta} \\end{bmatrix} $$ æ²¿yè½´æ—‹è½¬çŸ©é˜µï¼š $$ \\begin{bmatrix} \\color{red}{\\cos \\theta} \u0026 \\color{red}0 \u0026 \\color{red}{\\sin \\theta} \\newline \\color{green}0 \u0026 \\color{green}1 \u0026 \\color{green}0 \\newline -\\color{blue}{\\sin \\theta} \u0026 \\color{blue}0 \u0026 \\color{blue}{\\cos \\theta} \\end{bmatrix} $$ æ²¿zè½´æ—‹è½¬çŸ©é˜µï¼š $$ \\begin{bmatrix} \\color{red}{\\cos \\theta} \u0026 - \\color{red}{\\sin \\theta} \u0026 \\color{red}0 \\newline \\color{green}{\\sin \\theta} \u0026 \\color{green}{\\cos \\theta} \u0026 \\color{green}0 \\newline \\color{blue}0 \u0026 \\color{blue}0 \u0026 \\color{blue}1 \\newline \\end{bmatrix} $$ å‚è€ƒï¼š å˜æ¢ ","date":"2023-03-21","objectID":"/opengl_matrix/:1:0","tags":["çŸ©é˜µ"],"title":"OpenGLä¸­æ—‹è½¬çŸ©é˜µ","uri":"/opengl_matrix/"},{"categories":["C++","wxWidgets"],"content":"æºç ç¼–è¯‘å®‰è£… å‰å¾€wxWidgetså®˜ç½‘ï¼Œä¸‹è½½wxWidgets æ‰“å¼€Developer Command Prompt for VS 2022å·¥å…·ï¼Œè¿›å…¥ build\\msw ç›®å½•ï¼Œç¼–è¯‘ nmake /f makefile.vc BUILD=debug SHARED=0 TARGET_CPU=X64 è¿™é‡Œæˆ‘ç¼–è¯‘äº†64ä½debugç‰ˆçš„é™æ€åº“ï¼Œè¿™é‡Œx64å’Œdebugä¸¤ä¸ªå…³é”®å­—å¾ˆé‡è¦ï¼Œä½ åœ¨VSä¸­å¼€å‘æ—¶ï¼Œä¹Ÿè¦é€‰æ‹©ç›¸åº”çš„é…ç½® tip åœ¨å±æ€§ç®¡ç†å™¨çª—å£æ·»åŠ wxWidgetsç›®å½•ä¸‹çš„wxwidgets.propsæ–‡ä»¶ tip è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦é¢å¤–æ³¨æ„ä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘ä»¬è·‘çš„æ˜¯GUIç¨‹åºï¼Œæ‰€ä»¥éœ€è¦åœ¨é¡¹ç›®çš„å±æ€§ä¸­ï¼ŒæŠŠé¡¹ç›®è®¾ç½®æˆçª—å£ è·‘ä¸ªç®€å•çš„ç¨‹åºï¼Œhello.cpp // wxWidgets \"Hello world\" Program // For compilers that support precompilation, includes \"wx/wx.h\". #include \u003cwx/wxprec.h\u003e #ifndef WX_PRECOMP #include \u003cwx/wx.h\u003e #endif class MyApp : public wxApp { public: virtual bool OnInit(); }; class MyFrame : public wxFrame { public: MyFrame(const wxString\u0026 title, const wxPoint\u0026 pos, const wxSize\u0026 size); private: void OnHello(wxCommandEvent\u0026 event); void OnExit(wxCommandEvent\u0026 event); void OnAbout(wxCommandEvent\u0026 event); wxDECLARE_EVENT_TABLE(); }; enum { ID_Hello = 1 }; wxBEGIN_EVENT_TABLE(MyFrame, wxFrame) EVT_MENU(ID_Hello, MyFrame::OnHello) EVT_MENU(wxID_EXIT, MyFrame::OnExit) EVT_MENU(wxID_ABOUT, MyFrame::OnAbout) wxEND_EVENT_TABLE() wxIMPLEMENT_APP(MyApp); bool MyApp::OnInit() { MyFrame* frame = new MyFrame(\"Hello World\", wxPoint(50, 50), wxSize(450, 340)); frame-\u003eShow(true); return true; } MyFrame::MyFrame(const wxString\u0026 title, const wxPoint\u0026 pos, const wxSize\u0026 size) : wxFrame(NULL, wxID_ANY, title, pos, size) { wxMenu* menuFile = new wxMenu; menuFile-\u003eAppend(ID_Hello, \"\u0026Hello...\\tCtrl-H\", \"Help string shown in status bar for this menu item\"); menuFile-\u003eAppendSeparator(); menuFile-\u003eAppend(wxID_EXIT); wxMenu* menuHelp = new wxMenu; menuHelp-\u003eAppend(wxID_ABOUT); wxMenuBar* menuBar = new wxMenuBar; menuBar-\u003eAppend(menuFile, \"\u0026File\"); menuBar-\u003eAppend(menuHelp, \"\u0026Help\"); SetMenuBar(menuBar); CreateStatusBar(); SetStatusText(\"Welcome to wxWidgets!\"); } void MyFrame::OnExit(wxCommandEvent\u0026 event) { Close(true); } void MyFrame::OnAbout(wxCommandEvent\u0026 event) { wxMessageBox(\"This is a wxWidgets' Hello world sample\", \"About Hello World\", wxOK | wxICON_INFORMATION); } void MyFrame::OnHello(wxCommandEvent\u0026 event) { wxLogMessage(\"Hello world from wxWidgets!\"); } ","date":"2022-08-15","objectID":"/wxwidgets%E4%BD%BF%E7%94%A8/:1:0","tags":["C++"],"title":"wxWidgetsä½¿ç”¨","uri":"/wxwidgets%E4%BD%BF%E7%94%A8/"},{"categories":["Matrix","css"],"content":"cssä¸­åº”ç”¨ å¯¹å…ƒç´ çš„transformå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥åº”ç”¨çŸ©é˜µ matrix(a,b,c,d,e,f) è¿™6å‚æ•°ï¼Œå¯¹åº”çš„çŸ©é˜µå°±æ˜¯ï¼š æ³¨æ„ä¹¦å†™æ–¹å‘æ˜¯ç«–ç€çš„ã€‚ e, få‚æ•°å…¶å®å°±æ˜¯xï¼Œyæ–¹å‘ä¸Šåç§»ã€‚ æˆ‘ä»¬çŸ¥é“å¹³é¢ä¸­æ—‹è½¬çš„çŸ©é˜µæ˜¯ é‚£æˆ‘ä»¬å¯ä»¥å†™ä¸ªdemoäº† \u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1\"\u003e \u003cstyle\u003e .square { height: 100px; width: 100px; background-color: red; transform: matrix(1, 0, 0, 1, 30, 30); } \u003c/style\u003e \u003c/head\u003e \u003cbody\u003e \u003ch2\u003eSquare CSS\u003c/h2\u003e \u003cdiv class=\"square\" id=\"square\"\u003e\u003c/div\u003e \u003c/body\u003e \u003cscript\u003e let angle = 0; // å¼§åº¦ let squareElement = document.getElementById(\"square\"); function getMatrix(angle) { return [Math.cos(angle), Math.sin(angle), -Math.sin(angle), Math.cos(angle), 0, 0]; } setInterval(() =\u003e { angle++; let items = getMatrix(angle).join(\",\"); squareElement.style.transform = `matrix(${items})`; }, 80); \u003c/script\u003e \u003c/html\u003e ä¸Šé¢å±•ç¤ºäº†ä¸€ä¸ªè‡ªåŠ¨åˆ©ç”¨çŸ©é˜µæ—‹è½¬çš„æ–¹å—ã€‚ å‚è€ƒï¼š ç†è§£CSS3 transformä¸­çš„Matrix(çŸ©é˜µ) å¦‚ä½•é€šä¿—åœ°è®²è§£ã€Œä»¿å°„å˜æ¢ã€è¿™ä¸ªæ¦‚å¿µï¼Ÿ ","date":"2022-07-10","objectID":"/matrix/:1:0","tags":[],"title":"å‡ ä½•ä¸­çŸ©é˜µ","uri":"/matrix/"},{"categories":["Docker"],"content":"å¹³å¸¸æˆ‘ä»¬ç”¨çš„éƒ½æ˜¯Linux Containerï¼Œè¿™äº›å®¹å™¨ç”¨çš„éƒ½æ˜¯Linuxçš„å†…æ ¸ï¼Œè€Œä»Šå¤©æˆ‘ä»¬è¦è®°å½•çš„æ˜¯Windows Containerï¼Œå°±æ˜¯è®²è¿™äº›å®¹å™¨ç”¨çš„æ˜¯Windowsçš„å†…æ ¸ï¼ŒWindowså†…æ ¸æ˜¯å•¥ï¼Ÿé‚£å°±æ˜¯Windows NTã€‚ æŸ¥çœ‹ä½ çš„Windowså†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥ç”¨ Get-ComputerInfo | Select WindowsProductName, WindowsVersion, WindowsInstallationType, OsServerLevel, OsVersion, OsHardwareAbstractionLayer ç±»ä¼¼è¾“å‡º WindowsProductName : Windows 10 Pro for Workstations WindowsVersion : 2009 WindowsInstallationType : Client OsServerLevel : OsVersion : 10.0.19044 OsHardwareAbstractionLayer : 10.0.19041.1566 ä¸Šé¢NTçš„ç‰ˆæœ¬æ˜¯10.0.19044ã€‚ ç¯å¢ƒ å®‰è£… .NET 6 SDK Windows Server 2022 Dockerï¼ˆé’ˆå¯¹Windows Serverçš„dockerï¼Œæ²¡æœ‰UIçš„ï¼‰ å®‰è£…ä¸€ä¸ªå–œæ¬¢çš„ä»£ç ç¼–è¾‘å™¨ï¼Œä¾‹å¦‚ Visual Studio(Code)ã€‚ ","date":"2022-05-11","objectID":"/asp-net-in-windows-container/:0:0","tags":["Docker","WIndows"],"title":"ASP.NET in Windows Container","uri":"/asp-net-in-windows-container/"},{"categories":["Docker"],"content":"Docker è‹¥è¦åœ¨ Windows Server ä¸Šå®‰è£… Dockerï¼Œå¯ä»¥ä½¿ç”¨ç”± Microsoft å‘å¸ƒçš„ OneGet æä¾›ç¨‹åº PowerShell æ¨¡å—ï¼ˆç§°ä¸º DockerMicrosoftProviderï¼‰ã€‚ æ­¤æä¾›ç¨‹åºå¯ç”¨ Windows ä¸­çš„å®¹å™¨åŠŸèƒ½ï¼Œå¹¶å®‰è£… Docker å¼•æ“å’Œå®¢æˆ·ç«¯ã€‚ ä»¥ä¸‹æ˜¯æ“ä½œæ–¹æ³•ï¼š æ‰“å¼€æå‡çš„ PowerShell ä¼šè¯ï¼Œä» PowerShell åº“å®‰è£… Docker-Microsoft PackageManagement æä¾›ç¨‹åºã€‚ Install-Module -Name DockerMsftProvider -Repository PSGallery -Force å¦‚æœç³»ç»Ÿæç¤ºå®‰è£… NuGet æä¾›ç¨‹åºï¼Œè¿˜è¯·é”®å…¥ Y è¿›è¡Œå®‰è£…ã€‚ å¦‚æœåœ¨æ‰“å¼€ PowerShell åº“æ—¶é‡åˆ°é”™è¯¯ï¼Œåˆ™å¯èƒ½éœ€è¦å°† PowerShell å®¢æˆ·ç«¯ä½¿ç”¨çš„ TLS ç‰ˆæœ¬è®¾ç½®ä¸º TLS 1.2ã€‚ ä¸ºæ­¤ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š # Set the TLS version used by the PowerShell client to TLS 1.2. [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]::Tls12; ä½¿ç”¨ PackageManagement PowerShell æ¨¡å—å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ Dockerã€‚ Install-Package -Name docker -ProviderName DockerMsftProvider PowerShell è¯¢é—®æ˜¯å¦ä¿¡ä»»åŒ…æºâ€œDockerDefaultâ€æ—¶ï¼Œé”®å…¥ A ä»¥ç»§ç»­è¿›è¡Œå®‰è£…ã€‚ åœ¨å®‰è£…å®Œæˆåï¼Œè¯·é‡å¯è®¡ç®—æœºã€‚ Restart-Computer -Force ","date":"2022-05-11","objectID":"/asp-net-in-windows-container/:1:0","tags":["Docker","WIndows"],"title":"ASP.NET in Windows Container","uri":"/asp-net-in-windows-container/"},{"categories":["Docker"],"content":"Windows Container æˆ‘ä»¬çŸ¥é“Linuxå®¹å™¨çš„Base Imageæ˜¯alpineæˆ–è€…scratchï¼Œ é‚£Windowså®¹å™¨çš„Base Imageæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®å¾®è½¯å®˜æ–¹ä¹Ÿæœ‰ä»‹ç»äº†ã€‚ å¥½äº†ï¼Œæˆ‘ä»¬è¿›å…¥æ­£é¢˜ã€‚ è¦ç¡®ä¿å½“å‰Dockeræ˜¯ä½¿ç”¨Windows Containerçš„ï¼Œæˆ‘ä»¬å¯ä»¥æ‹‰ä¸ªé•œåƒ docker pull mcr.microsoft.com/windows/nanoserver:ltsc2022-amd64 å¦‚æœçœ‹åˆ°é”™è¯¯æ¶ˆæ¯â€œno matching manifest for linux/amd64 in the manifest list entriesâ€ï¼Œé‚£è¯´æ˜ Docker ç”¨çš„æ˜¯Linux å®¹å™¨ã€‚ æ³¨æ„ï¼šmcr.microsoft.comä¸Šçš„é•œåƒåœ¨å›½å†…è®¿é—®æŒºæ…¢çš„ï¼Œä½ å¯ä»¥å…ˆæŠŠé•œåƒpullåˆ°é˜¿é‡Œäº‘ï¼Œç„¶åå†åœ¨ä½ ç”µè„‘ä¸Šæ‹‰å–ã€‚ æˆ‘ä»¬è·‘ä¸€ä¸ªç®€å•å®¹å™¨ï¼ˆæ‰§è¡Œcmdï¼‰ docker run -it mcr.microsoft.com/windows/nanoserver:ltsc2022-amd64 cmd.exe åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼š C:\\\u003edir Volume in drive C has no label. Volume Serial Number is F63B-D098 Directory of C:\\ 05/05/2022 10:35 AM 5,510 License.txt 05/05/2022 10:37 AM \u003cDIR\u003e Users 05/11/2022 03:37 PM \u003cDIR\u003e Windows 1 File(s) 5,510 bytes 2 Dir(s) 21,302,714,368 bytes free C:\\\u003ehostname fbb1d7595c03 C:\\\u003eipconfig/all Windows IP Configuration Host Name . . . . . . . . . . . . : fbb1d7595c03 Primary Dns Suffix . . . . . . . : Node Type . . . . . . . . . . . . : Hybrid IP Routing Enabled. . . . . . . . : No WINS Proxy Enabled. . . . . . . . : No DNS Suffix Search List. . . . . . : lan Ethernet adapter vEthernet (Ethernet): Connection-specific DNS Suffix . : lan Description . . . . . . . . . . . : Hyper-V Virtual Ethernet Container Adapter Physical Address. . . . . . . . . : 00-15-5D-E5-CC-89 DHCP Enabled. . . . . . . . . . . : No Autoconfiguration Enabled . . . . : Yes Link-local IPv6 Address . . . . . : fe80::a0c8:ad95:72dd:fe6f%17(Preferred) IPv4 Address. . . . . . . . . . . : 172.30.150.168(Preferred) Subnet Mask . . . . . . . . . . . : 255.255.240.0 Default Gateway . . . . . . . . . : 172.30.144.1 DNS Servers . . . . . . . . . . . : 172.30.144.1 10.0.2.3 NetBIOS over Tcpip. . . . . . . . : Disabled Connection-specific DNS Suffix Search List : lan å¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨ä¸­ç›®å½•è¿˜æœ‰hostnameï¼Œç½‘ç»œéƒ½æ˜¯éš”ç¦»çš„ã€‚ ","date":"2022-05-11","objectID":"/asp-net-in-windows-container/:2:0","tags":["Docker","WIndows"],"title":"ASP.NET in Windows Container","uri":"/asp-net-in-windows-container/"},{"categories":["Docker"],"content":"è¿è¡Œä¸€ä¸ªASP.NETç¨‹åº dotnet 6å·²ç»å¯ä»¥å¾ˆæ–¹ä¾¿çš„åˆ›å»ºaspç¨‹åºçš„éª¨æ¶äº†ï¼Œåˆ›å»ºæ–°ç›®å½•myweb, ç»ˆç«¯è¾“å…¥dotnet new webï¼Œç„¶åsdkå°±å¸®ä½ åˆ›å»ºäº†ä¸€ä¸ªhello worldç¨‹åºã€‚ çœ‹ä¸€ä¸‹Program.csçš„å†…å®¹ï¼š var builder = WebApplication.CreateBuilder(args); var app = builder.Build(); app.MapGet(\"/\", () =\u003e \"Hello World!\"); app.Run(); æ©ï¼Œè›®ç®€å•çš„ï¼Œæˆ‘ä»¬åœ¨å®¿ä¸»æœºä¸Šè¿è¡Œdotnet runï¼Œè¾“å‡º info: Microsoft.Hosting.Lifetime[14] Now listening on: https://localhost:7174 info: Microsoft.Hosting.Lifetime[14] Now listening on: http://localhost:5017 info: Microsoft.Hosting.Lifetime[0] Application started. Press Ctrl+C to shut down. info: Microsoft.Hosting.Lifetime[0] Hosting environment: Development info: Microsoft.Hosting.Lifetime[0] Content root path: /your_path/myweb/ curl http://localhost:5017è¿”å›äº†Hello World!ï¼Œé€Ÿåº¦é˜”ä»¥çš„ã€‚ ä¸ºäº†åœ¨Dockerä¸­è¿è¡Œç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªDockerfile FROM mcr.microsoft.com/dotnet/sdk:6.0 AS build-env WORKDIR /app # Copy everything COPY . ./ # Restore as distinct layers RUN dotnet restore # Build and publish a release RUN dotnet publish -c Release -o out # Build runtime image FROM mcr.microsoft.com/dotnet/aspnet:6.0 WORKDIR /app COPY --from=build-env /app/out . ENTRYPOINT [\"dotnet\", \"myweb.dll\"] å½“ç„¶ï¼Œä¸ºäº†docker buildèƒ½å¿«ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥æ·»åŠ ä¸€ä¸ª.dockerignoreæ–‡ä»¶ # Build results [Dd]ebug/ [Rr]elease/ x64/ [Bb]in/ [Oo]bj/ # build folder is nowadays used for build scripts and should not be ignored #build/ # NuGet Packages *.nupkg # The packages folder can be ignored because of Package Restore **/packages/* # except build/, which is used as an MSBuild target. !**/packages/build/ # Uncomment if necessary however generally it will be regenerated when needed #!**/packages/repositories.config # MSTest test Results [Tt]est[Rr]esult*/ [Bb]uild[Ll]og.* å¥½äº†ï¼Œç°åœ¨æ‰§è¡Œdocker build -t fuck_image .ï¼Œæ„å»ºé•œåƒæˆåŠŸåï¼Œå¯ä»¥çœ‹åˆ° PS C:\\Users\\Administrator\u003e docker images REPOSITORY TAG IMAGE ID CREATED SIZE fuck_image latest a8b482b53388 5 hours ago 392MB æˆ‘ä»¬è·‘ä¸ªå®¹å™¨docker run -d --name fuck_asp fuck_imageï¼ŒæŸ¥çœ‹å®¹å™¨æ—¥å¿—docker logs fuck_aspï¼Œå‘ç°å®ƒçš„httpç«¯å£æ˜¯80 info: Microsoft.Hosting.Lifetime[14] Now listening on: http://[::]:80 info: Microsoft.Hosting.Lifetime[0] Application started. Press Ctrl+C to shut down. info: Microsoft.Hosting.Lifetime[0] Hosting environment: Production info: Microsoft.Hosting.Lifetime[0] Content root path: C:\\app\\ è¿›å…¥å®¹å™¨æ‰§è¡Œcurl docker exec -it fuck_asp cmd.exe C:\\app\u003ecurl http://localhost Hello World! OKäº†ã€‚ æ³¨ï¼šä½ çš„Windows Serverå¦‚æœæ˜¯è·‘åœ¨è™šæ‹Ÿæœºä¸­çš„ï¼Œè·å–è™šæ‹Ÿæœºçš„ipæœ‰ä¸ªå‘½ä»¤ï¼šVBoxManage guestproperty get \"Win Server2022\" \"/VirtualBox/GuestInfo/Net/0/V4/IP\" å‚è€ƒï¼š å…¥é—¨ï¼šå‡†å¤‡é€‚ç”¨äºå®¹å™¨çš„ Windows Tutorial: Containerize a .NET app ","date":"2022-05-11","objectID":"/asp-net-in-windows-container/:3:0","tags":["Docker","WIndows"],"title":"ASP.NET in Windows Container","uri":"/asp-net-in-windows-container/"},{"categories":["OS"],"content":"Bochs Bochsæ˜¯ä¸€ä¸ªx86ç¡¬ä»¶å¹³å°çš„å¼€æºæ¨¡æ‹Ÿå™¨ã€‚ä½ å¯ä»¥å½“å®ƒæ˜¯ä¸€å°è™šæ‹Ÿçš„x86çš„è®¡ç®—æœºã€‚ æœ¬æ–‡ç¯å¢ƒï¼š OS: Ubuntu 20.04.4 LTS Bochsï¼š 2.6.9 ","date":"2022-04-17","objectID":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/:0:0","tags":["OS"],"title":"bochsä¸‹å¯åŠ¨è‡ªå·±çš„MBR","uri":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/"},{"categories":["OS"],"content":"å®‰è£…Bochs è¿™ä¸ªç½‘ä¸Šæ•™ç¨‹å¾ˆå¤šäº†ï¼Œå…ˆå»ä¸‹è½½ï¼Œç„¶åconfigureï¼š ./configure \\ --prefix=/your_path/bochs \\ --enable-debugger\\ --enable-disasm \\ --enable-iodebug \\ --enable-x86-debugger \\ --with-x \\ --with-x11 è¿™é‡Œä¼šå‡ºç‚¹é—®é¢˜ï¼Œä¸€èˆ¬æ˜¯ç¼ºå°‘åº“äº†ï¼š sudo apt-get install libx11-dev ................. for X11/Xlib.h sudo apt-get install mesa-common-dev........ for GL/glx.h sudo apt-get install libglu1-mesa-dev ..... for GL/glu.h sudo apt-get install libxrandr-dev ........... for X11/extensions/Xrandr.h sudo apt-get install libxi-dev ................... for X11/extensions/XInput.h configureé€šè¿‡å°±å¯ä»¥ç¼–è¯‘å®‰è£…äº†ï¼š make sudo make install ","date":"2022-04-17","objectID":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/:1:0","tags":["OS"],"title":"bochsä¸‹å¯åŠ¨è‡ªå·±çš„MBR","uri":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/"},{"categories":["OS"],"content":"é…ç½® å½“æˆ‘ä»¬åœ¨ç»ˆç«¯è¾“å…¥bochsåï¼Œ Bochsä¼šè‡ªå·±åœ¨å½“å‰ç›®å½•é¡ºåºå¯»æ‰¾ä»¥ä¸‹æ–‡ä»¶ä½œä¸ºé»˜è®¤é…ç½®æ–‡ä»¶ï¼š .bochsrc bochsrc bochsrc.txt bochsrc.bxrc(ä»…å¯¹Windowsæœ‰æ•ˆ) æˆ‘ä»¬å¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ªåä¸º.bochsrcçš„æ–‡ä»¶ï¼Œæ¥æŒ‡å®šBochsé…ç½®æˆ‘ä»¬æƒ³è¦çš„è™šæ‹Ÿæœºã€‚ [~/bochs_fun]$ cat bochsrc ################################################################# # Bochsçš„é…ç½®æ–‡ä»¶ # Configuration file for Bochs ################################################################# # how much memory the emulated machine will have megs: 32 # filenameof ROM images romimage:file=/usr/local/share/bochs/BIOS-bochs-latest vgaromimage:file=/usr/local/share/bochs/VGABIOS-lgpl-latest # which disk image will be used è¿™ä¸ªæ˜¯å¯åŠ¨è½¯ç›˜ floppya:1_44=a.img, status=inserted # choose the boot disk ç¡®å®šå¯åŠ¨æ–¹å¼ #boot: floppy boot: disk # where do we send log messages? log: bochsout.txt # disable the mouse mouse: enabled=0 # enable key mapping ,using US layout as default keyboard:keymap=/usr/local/share/bochs/keymaps/x11-pc-us.map # ç¡¬ç›˜è®¾ç½® ata0: enabled=1, ioaddr1=0x1f0, ioaddr2=0x3f0, irq=14 ","date":"2022-04-17","objectID":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/:2:0","tags":["OS"],"title":"bochsä¸‹å¯åŠ¨è‡ªå·±çš„MBR","uri":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/"},{"categories":["OS"],"content":"æµ‹è¯•å¼€æœº æŒ‰cç»§ç»­è¿è¡Œï¼Œå¼¹å‡ºæ–°çš„çª—å£ã€‚ ","date":"2022-04-17","objectID":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/:3:0","tags":["OS"],"title":"bochsä¸‹å¯åŠ¨è‡ªå·±çš„MBR","uri":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/"},{"categories":["OS"],"content":"MBR MBRï¼šMaster Boot Recordï¼Œä¸»åˆ†åŒºå¼•å¯¼è®°å½•ï¼Œå®ƒæ˜¯æ•´ä¸ªç¡¬ç›˜æœ€å¼€å§‹çš„æ‰‡åŒºï¼Œå³0æŸ±é¢0ç£å¤´1æ‰‡åŒºï¼ˆCHSè¡¨ç¤ºæ–¹æ³•ï¼Œå¦‚æœæ˜¯LBAçš„è¯ï¼Œé‚£å°±æ˜¯0æ‰‡åŒºï¼‰ã€‚ æ‰‡åŒºæ˜¯ä»€ä¹ˆï¼Ÿé‚£å°±æ¶‰åŠåˆ°ç¡¬ç›˜åŸºæœ¬çŸ¥è¯†äº†ï¼Œå¯¹äºæœºæ¢°ç¡¬ç›˜ï¼Œæœ‰ä»¥ä¸‹æ¦‚å¿µï¼š ç›˜ç‰‡ï¼ˆplatterï¼‰ ç£å¤´ï¼ˆheadï¼‰ ç£é“ï¼ˆtrackï¼‰ æ‰‡åŒºï¼ˆsectorï¼‰ æŸ±é¢ï¼ˆcylinderï¼‰ ç›˜ç‰‡ ç‰‡é¢ å’Œ ç£å¤´ï¼ˆHeadï¼‰ ç¡¬ç›˜ä¸­ä¸€èˆ¬ä¼šæœ‰å¤šä¸ªç›˜ç‰‡ç»„æˆï¼Œæ¯ä¸ªç›˜ç‰‡åŒ…å«ä¸¤ä¸ªé¢ï¼Œæ¯ä¸ªç›˜é¢éƒ½å¯¹åº”åœ°æœ‰ä¸€ä¸ªè¯»/å†™ç£å¤´ã€‚å—åˆ°ç¡¬ç›˜æ•´ä½“ä½“ç§¯å’Œç”Ÿäº§æˆæœ¬çš„é™åˆ¶ï¼Œç›˜ç‰‡æ•°é‡éƒ½å—åˆ°é™åˆ¶ï¼Œä¸€èˆ¬éƒ½åœ¨5ç‰‡ä»¥å†…ã€‚ç›˜ç‰‡çš„ç¼–å·è‡ªä¸‹å‘ä¸Šä»0å¼€å§‹ï¼Œå¦‚æœ€ä¸‹è¾¹çš„ç›˜ç‰‡æœ‰0é¢å’Œ1é¢ï¼Œå†ä¸Šä¸€ä¸ªç›˜ç‰‡å°±ç¼–å·ä¸º2é¢å’Œ3é¢ã€‚ æ‰‡åŒºï¼ˆSectorï¼‰å’Œ ç£é“ï¼ˆTrackï¼‰ ä¸‹å›¾æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªç›˜é¢ï¼Œç›˜é¢ä¸­ä¸€åœˆåœˆç°è‰²åŒå¿ƒåœ†ä¸ºä¸€æ¡æ¡ç£é“ï¼Œä»åœ†å¿ƒå‘å¤–ç”»ç›´çº¿ï¼Œå¯ä»¥å°†ç£é“åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªå¼§æ®µï¼Œæ¯ä¸ªç£é“ä¸Šä¸€ä¸ªå¼§æ®µè¢«ç§°ä¹‹ä¸ºä¸€ä¸ªæ‰‡åŒºï¼ˆå›¾è·µç»¿è‰²éƒ¨åˆ†ï¼‰ã€‚æ‰‡åŒºæ˜¯ç£ç›˜çš„æœ€å°ç»„æˆå•å…ƒï¼Œé€šå¸¸æ˜¯512å­—èŠ‚ã€‚ï¼ˆç”±äºä¸æ–­æé«˜ç£ç›˜çš„å¤§å°ï¼Œéƒ¨åˆ†å‚å•†è®¾å®šæ¯ä¸ªæ‰‡åŒºçš„å¤§å°æ˜¯4096å­—èŠ‚ï¼‰ ç£å¤´ï¼ˆHeadï¼‰å’Œ æŸ±é¢ï¼ˆCylinderï¼‰ ç¡¬ç›˜é€šå¸¸ç”±é‡å çš„ä¸€ç»„ç›˜ç‰‡æ„æˆï¼Œæ¯ä¸ªç›˜é¢éƒ½è¢«åˆ’åˆ†ä¸ºæ•°ç›®ç›¸ç­‰çš„ç£é“ï¼Œå¹¶ä»å¤–ç¼˜çš„â€œ0â€å¼€å§‹ç¼–å·ï¼Œå…·æœ‰ç›¸åŒç¼–å·çš„ç£é“å½¢æˆä¸€ä¸ªåœ†æŸ±ï¼Œç§°ä¹‹ä¸ºç£ç›˜çš„æŸ±é¢ã€‚ç£ç›˜çš„æŸ±é¢æ•°ä¸ä¸€ä¸ªç›˜é¢ä¸Šçš„ç£é“æ•°æ˜¯ç›¸ç­‰çš„ã€‚ç”±äºæ¯ä¸ªç›˜é¢éƒ½æœ‰è‡ªå·±çš„ç£å¤´ï¼Œå› æ­¤ï¼Œç›˜é¢æ•°ç­‰äºæ€»çš„ç£å¤´æ•°ã€‚ å¦‚ä¸‹å›¾ å›¾3 æ‰€è°“CHSå³æŸ±é¢ï¼ˆcylinderï¼‰ï¼Œç£å¤´ï¼ˆheaderï¼‰ï¼Œæ‰‡åŒºï¼ˆsectorï¼‰ï¼Œé€šè¿‡è¿™ä¸‰ä¸ªå˜é‡æè¿°ç£ç›˜åœ°å€ï¼ˆå…ˆå®šä½æŸ±é¢ï¼Œç„¶åé€‰å®šç£å¤´ï¼Œç„¶åç¡®å®šæ‰‡åŒºï¼‰ï¼Œéœ€è¦æ˜ç™½çš„æ˜¯ï¼Œè¿™é‡Œè¡¨ç¤ºçš„å·²ä¸æ˜¯ç‰©ç†åœ°å€è€Œæ˜¯é€»è¾‘åœ°å€äº†ã€‚è¿™ç§æ–¹æ³•ä¹Ÿç§°ä½œæ˜¯LARGEå¯»å€æ–¹å¼ã€‚è¯¥æ–¹æ³•ä¸‹ï¼š ç¡¬ç›˜å®¹é‡=ç£å¤´æ•°Ã—æŸ±é¢æ•°Ã—æ‰‡åŒºæ•°Ã—æ‰‡åŒºå¤§å°ï¼ˆä¸€èˆ¬ä¸º512byteï¼‰ã€‚ åæ¥ï¼Œäººä»¬é€šè¿‡ä¸ºæ¯ä¸ªæ‰‡åŒºåˆ†é…é€»è¾‘åœ°å€ï¼Œä»¥æ‰‡åŒºä¸ºå•ä½è¿›è¡Œå¯»å€ï¼Œä¹Ÿå°±æœ‰äº†LBAå¯»å€æ–¹å¼ã€‚ä½†æ˜¯ä¸ºäº†ä¿æŒä¸CHSæ¨¡å¼çš„å…¼å®¹ï¼Œé€šè¿‡é€»è¾‘å˜æ¢ç®—æ³•ï¼Œå¯ä»¥è½¬æ¢ä¸ºç£å¤´/æŸ±é¢/æ‰‡åŒºä¸‰ç§å‚æ•°æ¥è¡¨ç¤ºï¼Œå’Œ LARGEå¯»å€æ¨¡å¼ä¸€æ ·ï¼Œè¿™é‡Œçš„åœ°å€ä¹Ÿæ˜¯é€»è¾‘åœ°å€äº†ã€‚ï¼ˆå›ºæ€ç¡¬ç›˜çš„å­˜å‚¨åŸç†è™½ç„¶ä¸æœºæ¢°ç¡¬ç›˜ä¸åŒï¼Œé‡‡ç”¨çš„æ˜¯flashå­˜å‚¨ï¼Œä½†ä»ç„¶ä½¿ç”¨LBAè¿›è¡Œç®¡ç†ï¼Œæ­¤å¤„ä¸å†è¯¦è¿°ã€‚ï¼‰ å¥½äº†ï¼Œå†å›æ¥è¯´MBRï¼ŒMBR(Master Boot Record)æ˜¯ä¼ ç»Ÿçš„åˆ†åŒºæœºåˆ¶ï¼Œåº”ç”¨äºç»å¤§å¤šæ•°ä½¿ç”¨BIOSå¼•å¯¼çš„PCè®¾å¤‡ï¼ˆè‹¹æœä½¿ç”¨EFIçš„æ–¹å¼ï¼‰ï¼Œå¾ˆå¤šServeræœåŠ¡å™¨å³æ”¯æŒBIOSä¹Ÿæ”¯æŒEFIçš„å¼•å¯¼æ–¹å¼ã€‚å®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š MBRç»“æ„ï¼šå ç”¨ç¡¬ç›˜æœ€å¼€å¤´çš„512å­—èŠ‚ *Â å‰446å­—èŠ‚ä¸ºï¼šå¼•å¯¼ä»£ç ï¼ˆBootstrap Code Areaï¼‰ï¼ˆå¼•å¯¼ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼›ä¸åŒæ“ä½œç³»ç»Ÿï¼Œå¼•å¯¼ä»£ç æ˜¯ä¸ä¸€æ ·çš„ï¼‰Â æ¥ä¸‹æ¥çš„ä¸º4ä¸ª16å­—èŠ‚ï¼šåˆ†åˆ«å¯¹åº”4ä¸ªä¸»åˆ†åŒºè¡¨ä¿¡æ¯(Primary Partition Table) æœ€å2ä¸ªå­—èŠ‚ï¼šä¸ºå¯åŠ¨æ ‡ç¤ºï¼ˆBoot Signatureï¼‰ï¼Œæ°¸è¿œéƒ½æ˜¯55å’ŒAAï¼›55å’Œï¼¡ï¼¡æ˜¯ä¸ªæ°¸ä¹…æ€§çš„æ ‡ç¤ºï¼Œä»£è¡¨è¿™ä¸ªç¡¬ç›˜æ˜¯å¯å¯åŠ¨çš„ã€‚ ","date":"2022-04-17","objectID":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/:4:0","tags":["OS"],"title":"bochsä¸‹å¯åŠ¨è‡ªå·±çš„MBR","uri":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/"},{"categories":["OS"],"content":"ä¸»å¼•å¯¼ä»£ç  BIOSåœ¨å®Œæˆä¸€äº›ç®€å•çš„æ£€æµ‹å·¥ä½œæˆ–åˆå§‹åŒ–å·¥ä½œåï¼Œä¼šæŠŠå¤„ç†å™¨ä½¿ç”¨æƒäº¤å‡ºå»ï¼Œä¸‹ä¸€æ£’å°±æ˜¯MBRç¨‹åºã€‚BIOSä¼šæŠŠMBRåŠ è½½åˆ°0x7c00çš„ä½ç½®ï¼Œç„¶åæ‰§è¡Œé‡Œå¤´ä»£ç ï¼ˆjmp 0:0x7c00ï¼‰ã€‚ mbr.Sæ–‡ä»¶ï¼š ;ä¸»å¼•å¯¼ç¨‹åº ;------------------------------------------------------------ SECTION MBR vstart=0x7c00 mov ax,cs mov ds,ax mov es,ax mov ss,ax mov fs,ax mov sp,0x7c00 ; æ¸…å± åˆ©ç”¨0x06å·åŠŸèƒ½ï¼Œä¸Šå·å…¨éƒ¨è¡Œï¼Œåˆ™å¯æ¸…å±ã€‚ ; ----------------------------------------------------------- ;INT 0x10 åŠŸèƒ½å·:0x06 åŠŸèƒ½æè¿°:ä¸Šå·çª—å£ ;------------------------------------------------------ ;è¾“å…¥ï¼š ;AH åŠŸèƒ½å·= 0x06 ;AL = ä¸Šå·çš„è¡Œæ•°(å¦‚æœä¸º0,è¡¨ç¤ºå…¨éƒ¨) ;BH = ä¸Šå·è¡Œå±æ€§ ;(CL,CH) = çª—å£å·¦ä¸Šè§’çš„(X,Y)ä½ç½® ;(DL,DH) = çª—å£å³ä¸‹è§’çš„(X,Y)ä½ç½® ;æ— è¿”å›å€¼ï¼š mov ax, 0x600 mov bx, 0x700 mov cx, 0 ; å·¦ä¸Šè§’: (0, 0) mov dx, 0x184f ; å³ä¸‹è§’: (80,25), ; VGAæ–‡æœ¬æ¨¡å¼ä¸­,ä¸€è¡Œåªèƒ½å®¹çº³80ä¸ªå­—ç¬¦,å…±25è¡Œã€‚ ; ä¸‹æ ‡ä»0å¼€å§‹,æ‰€ä»¥0x18=24,0x4f=79 int 0x10 ; int 0x10 ;;;;;;;;; ä¸‹é¢è¿™ä¸‰è¡Œä»£ç æ˜¯è·å–å…‰æ ‡ä½ç½® ;;;;;;;;; ;.get_cursorè·å–å½“å‰å…‰æ ‡ä½ç½®,åœ¨å…‰æ ‡ä½ç½®å¤„æ‰“å°å­—ç¬¦. mov ah, 3 ; è¾“å…¥: 3å·å­åŠŸèƒ½æ˜¯è·å–å…‰æ ‡ä½ç½®,éœ€è¦å­˜å…¥ahå¯„å­˜å™¨ mov bh, 0 ; bhå¯„å­˜å™¨å­˜å‚¨çš„æ˜¯å¾…è·å–å…‰æ ‡çš„é¡µå· int 0x10 ; è¾“å‡º: ch=å…‰æ ‡å¼€å§‹è¡Œ,cl=å…‰æ ‡ç»“æŸè¡Œ ; dh=å…‰æ ‡æ‰€åœ¨è¡Œå·,dl=å…‰æ ‡æ‰€åœ¨åˆ—å· ;;;;;;;;; è·å–å…‰æ ‡ä½ç½®ç»“æŸ ;;;;;;;;;;;;;;;; ;;;;;;;;; æ‰“å°å­—ç¬¦ä¸² ;;;;;;;;;;; ;è¿˜æ˜¯ç”¨10hä¸­æ–­,ä¸è¿‡è¿™æ¬¡æ˜¯è°ƒç”¨13å·å­åŠŸèƒ½æ‰“å°å­—ç¬¦ä¸² mov ax, message mov bp, ax ; es:bp ä¸ºä¸²é¦–åœ°å€, esæ­¤æ—¶åŒcsä¸€è‡´ï¼Œ ; å¼€å¤´æ—¶å·²ç»ä¸ºsregåˆå§‹åŒ– ; å…‰æ ‡ä½ç½®è¦ç”¨åˆ°dxå¯„å­˜å™¨ä¸­å†…å®¹,cxä¸­çš„å…‰æ ‡ä½ç½®å¯å¿½ç•¥ mov cx, 0xb ; cx ä¸ºä¸²é•¿åº¦,ä¸åŒ…æ‹¬ç»“æŸç¬¦0çš„å­—ç¬¦ä¸ªæ•° mov ax, 0x1301 ; å­åŠŸèƒ½å·13æ˜¯æ˜¾ç¤ºå­—ç¬¦åŠå±æ€§,è¦å­˜å…¥ahå¯„å­˜å™¨, ; alè®¾ç½®å†™å­—ç¬¦æ–¹å¼ ah=01: æ˜¾ç¤ºå­—ç¬¦ä¸²,å…‰æ ‡è·Ÿéšç§»åŠ¨ mov bx, 0x2 ; bhå­˜å‚¨è¦æ˜¾ç¤ºçš„é¡µå·,æ­¤å¤„æ˜¯ç¬¬0é¡µ, ; blä¸­æ˜¯å­—ç¬¦å±æ€§, å±æ€§é»‘åº•ç»¿å­—(bl = 02h) int 0x10 ; æ‰§è¡ŒBIOS 0x10 å·ä¸­æ–­ ;;;;;;;;; æ‰“å­—å­—ç¬¦ä¸²ç»“æŸ ;;;;;;;;;;;;;;; jmp $ ; ä½¿ç¨‹åºæ‚¬åœåœ¨æ­¤ message db \"love rabbit\" times 510-($-$$) db 0 db 0x55,0xaa ç”¨nasmç¼–è¯‘æˆçº¯äºŒè¿›åˆ¶æ–‡ä»¶nasm -o mbr.bin mbr.Sï¼Œå¯ä»¥æŸ¥çœ‹mbr.binæ–‡ä»¶å¤§å°ï¼Œæ­£å¥½512ä¸ªå­—èŠ‚ã€‚ ç„¶ååˆ©ç”¨ddå‘½ä»¤æŠŠbinæ–‡ä»¶å†™è¿›ç£ç›˜çš„0æŸ±é¢0ç£å¤´1æ‰‡åŒºï¼š dd if=/your_path/bochs_fun/mbr.bin of=/your_path/bochs_fun/hd60M.img bs=512 count=1 conv=notrunc ","date":"2022-04-17","objectID":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/:5:0","tags":["OS"],"title":"bochsä¸‹å¯åŠ¨è‡ªå·±çš„MBR","uri":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/"},{"categories":["OS"],"content":"å¢åŠ ç£ç›˜è¯»å†™ mbr.S ;ä¸»å¼•å¯¼ç¨‹åº ;------------------------------------------------------------ %include \"boot.inc\" SECTION MBR vstart=0x7c00 mov ax,cs mov ds,ax mov es,ax mov ss,ax mov fs,ax mov sp,0x7c00 mov ax,0xb800 mov gs,ax ; æ¸…å± ;åˆ©ç”¨0x06å·åŠŸèƒ½ï¼Œä¸Šå·å…¨éƒ¨è¡Œï¼Œåˆ™å¯æ¸…å±ã€‚ ; ----------------------------------------------------------- ;INT 0x10 åŠŸèƒ½å·:0x06 åŠŸèƒ½æè¿°:ä¸Šå·çª—å£ ;------------------------------------------------------ ;è¾“å…¥ï¼š ;AH åŠŸèƒ½å·= 0x06 ;AL = ä¸Šå·çš„è¡Œæ•°(å¦‚æœä¸º0,è¡¨ç¤ºå…¨éƒ¨) ;BH = ä¸Šå·è¡Œå±æ€§ ;(CL,CH) = çª—å£å·¦ä¸Šè§’çš„(X,Y)ä½ç½® ;(DL,DH) = çª—å£å³ä¸‹è§’çš„(X,Y)ä½ç½® ;æ— è¿”å›å€¼ï¼š mov ax, 0600h mov bx, 0700h mov cx, 0 ; å·¦ä¸Šè§’: (0, 0) mov dx, 184fh ; å³ä¸‹è§’: (80,25), ; å› ä¸ºVGAæ–‡æœ¬æ¨¡å¼ä¸­ï¼Œä¸€è¡Œåªèƒ½å®¹çº³80ä¸ªå­—ç¬¦,å…±25è¡Œã€‚ ; ä¸‹æ ‡ä»0å¼€å§‹ï¼Œæ‰€ä»¥0x18=24,0x4f=79 int 10h ; int 10h ; è¾“å‡ºå­—ç¬¦ä¸²:MBR mov byte [gs:0x00],'1' mov byte [gs:0x01],0xA4 mov byte [gs:0x02],' ' mov byte [gs:0x03],0xA4 mov byte [gs:0x04],'M' mov byte [gs:0x05],0xA4 ;Aè¡¨ç¤ºç»¿è‰²èƒŒæ™¯é—ªçƒï¼Œ4è¡¨ç¤ºå‰æ™¯è‰²ä¸ºçº¢è‰² mov byte [gs:0x06],'B' mov byte [gs:0x07],0xA4 mov byte [gs:0x08],'R' mov byte [gs:0x09],0xA4 mov eax,LOADER_START_SECTOR ; èµ·å§‹æ‰‡åŒºlbaåœ°å€ mov bx,LOADER_BASE_ADDR ; å†™å…¥çš„åœ°å€ mov cx,1 ; å¾…è¯»å…¥çš„æ‰‡åŒºæ•° call rd_disk_m_16 ; ä»¥ä¸‹è¯»å–ç¨‹åºçš„èµ·å§‹éƒ¨åˆ†ï¼ˆä¸€ä¸ªæ‰‡åŒºï¼‰ jmp LOADER_BASE_ADDR ;------------------------------------------------------------------------------- ;åŠŸèƒ½:è¯»å–ç¡¬ç›˜nä¸ªæ‰‡åŒº rd_disk_m_16: ;------------------------------------------------------------------------------- ; eax=LBAæ‰‡åŒºå· ; ebx=å°†æ•°æ®å†™å…¥çš„å†…å­˜åœ°å€ ; ecx=è¯»å…¥çš„æ‰‡åŒºæ•° mov esi,eax ;å¤‡ä»½eax mov di,cx ;å¤‡ä»½cx ;è¯»å†™ç¡¬ç›˜: ;ç¬¬1æ­¥ï¼šè®¾ç½®è¦è¯»å–çš„æ‰‡åŒºæ•° mov dx,0x1f2 mov al,cl out dx,al ;è¯»å–çš„æ‰‡åŒºæ•° mov eax,esi ;æ¢å¤ax ;ç¬¬2æ­¥ï¼šå°†LBAåœ°å€å­˜å…¥0x1f3 ~ 0x1f6 ;LBAåœ°å€7~0ä½å†™å…¥ç«¯å£0x1f3 mov dx,0x1f3 out dx,al ;LBAåœ°å€15~8ä½å†™å…¥ç«¯å£0x1f4 mov cl,8 shr eax,cl mov dx,0x1f4 out dx,al ;LBAåœ°å€23~16ä½å†™å…¥ç«¯å£0x1f5 shr eax,cl mov dx,0x1f5 out dx,al shr eax,cl and al,0x0f ;lbaç¬¬24~27ä½ or al,0xe0 ; è®¾ç½®7ï½4ä½ä¸º1110,è¡¨ç¤ºlbaæ¨¡å¼ mov dx,0x1f6 out dx,al ;ç¬¬3æ­¥ï¼šå‘0x1f7ç«¯å£å†™å…¥è¯»å‘½ä»¤ï¼Œ0x20 mov dx,0x1f7 mov al,0x20 out dx,al ;ç¬¬4æ­¥ï¼šæ£€æµ‹ç¡¬ç›˜çŠ¶æ€ .not_ready: ;åŒä¸€ç«¯å£ï¼Œå†™æ—¶è¡¨ç¤ºå†™å…¥å‘½ä»¤å­—ï¼Œè¯»æ—¶è¡¨ç¤ºè¯»å…¥ç¡¬ç›˜çŠ¶æ€ nop in al,dx and al,0x88 ;ç¬¬4ä½ä¸º1è¡¨ç¤ºç¡¬ç›˜æ§åˆ¶å™¨å·²å‡†å¤‡å¥½æ•°æ®ä¼ è¾“ï¼Œç¬¬7ä½ä¸º1è¡¨ç¤ºç¡¬ç›˜å¿™ cmp al,0x08 jnz .not_ready ;è‹¥æœªå‡†å¤‡å¥½ï¼Œç»§ç»­ç­‰ã€‚ ;ç¬¬5æ­¥ï¼šä»0x1f0ç«¯å£è¯»æ•°æ® mov ax, di mov dx, 256 mul dx mov cx, ax ; diä¸ºè¦è¯»å–çš„æ‰‡åŒºæ•°ï¼Œä¸€ä¸ªæ‰‡åŒºæœ‰512å­—èŠ‚ï¼Œæ¯æ¬¡è¯»å…¥ä¸€ä¸ªå­—ï¼Œ ; å…±éœ€di*512/2æ¬¡ï¼Œæ‰€ä»¥di*256 mov dx, 0x1f0 .go_on_read: in ax,dx mov [bx],ax add bx,2 loop .go_on_read ret times 510-($-$$) db 0 db 0x55,0xaa boot.incæ–‡ä»¶ ;------------- loaderå’Œkernel ---------- LOADER_BASE_ADDR equ 0x900 LOADER_START_SECTOR equ 0x2 æœ€åCPUä¼šè°ƒåˆ°0x900çš„åœ°å€ï¼Œè¿˜å¾—æœ‰ä¸ªloader %include \"boot.inc\" section loader vstart=LOADER_BASE_ADDR ; è¾“å‡ºèƒŒæ™¯è‰²ç»¿è‰²ï¼Œå‰æ™¯è‰²çº¢è‰²ï¼Œå¹¶ä¸”è·³åŠ¨çš„å­—ç¬¦ä¸²\"1 MBR\" mov byte [gs:0x20],'2' mov byte [gs:0x21],0xA4 ; Aè¡¨ç¤ºç»¿è‰²èƒŒæ™¯é—ªçƒï¼Œ4è¡¨ç¤ºå‰æ™¯è‰²ä¸ºçº¢è‰² mov byte [gs:0x22],' ' mov byte [gs:0x23],0xA4 mov byte [gs:0x24],'L' mov byte [gs:0x25],0xA4 mov byte [gs:0x26],'O' mov byte [gs:0x27],0xA4 mov byte [gs:0x28],'A' mov byte [gs:0x29],0xA4 mov byte [gs:0x2a],'D' mov byte [gs:0x2b],0xA4 mov byte [gs:0x2c],'E' mov byte [gs:0x2d],0xA4 mov byte [gs:0x2e],'R' mov byte [gs:0x2f],0xA4 jmp $ ; é€šè¿‡æ­»å¾ªç¯ä½¿ç¨‹åºæ‚¬åœåœ¨æ­¤ å‚è€ƒï¼š OSç¯‡-Bochsåœ¨Ubuntuä¸‹çš„å®‰è£…æ•™ç¨‹ Ubuntu20.04/18.04å®‰è£…Bochs2.6.9ç¼–è¯‘è¿è¡ŒGeekOS æŸ±é¢-ç£å¤´-æ‰‡åŒºå¯»å€çš„ä¸€äº›æ—§äº‹ MBRä¸GPT ","date":"2022-04-17","objectID":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/:6:0","tags":["OS"],"title":"bochsä¸‹å¯åŠ¨è‡ªå·±çš„MBR","uri":"/bochs%E4%B8%8B%E5%90%AF%E5%8A%A8/"},{"categories":null,"content":"x86æ±‡ç¼– 8086çš„æŒ‡ä»¤åœ¨32/64ä½çš„x86 CPUä¸Šéƒ½æ˜¯èƒ½ç”¨çš„ï¼Œæ‰€ä»¥æ±‡ç¼–ä»£ç æ˜¯ç±»ä¼¼çš„ï¼Œ80836ä¹‹åçš„CPU ä¿æŠ¤æ¨¡å¼ä¸‹æ®µå¯„å­˜å™¨å°±ä¸é‡è¦äº†ï¼Œå¹³å¸¸ç”¨çš„å¤šçš„å°±æ˜¯é‚£8ä¸ªé€šç”¨å¯„å­˜å™¨ï¼ˆä¸ºå•¥ç”¨ä¸åˆ°CS, DS, ESç­‰å¯„å­˜å™¨äº†ï¼Œè¯·çœ‹è¿™é‡Œï¼‰ï¼š é€šç”¨å¯„å­˜å™¨ å«ä¹‰ ä½8ä½ åŠŸèƒ½ EAX ç´¯åŠ (Accumulator)å¯„å­˜å™¨ AX(AHã€AL) å¸¸ç”¨äºä¹˜ã€é™¤æ³•å’Œå‡½æ•°è¿”å›å€¼ EBX åŸºå€(Base)å¯„å­˜å™¨ BX(BHã€BL) å¸¸åšå†…å­˜æ•°æ®çš„æŒ‡é’ˆ, æˆ–è€…è¯´å¸¸ä»¥å®ƒä¸ºåŸºå€æ¥è®¿é—®å†…å­˜. ECX è®¡æ•°å™¨(Counter)å¯„å­˜å™¨ CX(CHã€CL) å¸¸åšå­—ç¬¦ä¸²å’Œå¾ªç¯æ“ä½œä¸­çš„è®¡æ•°å™¨ EDX æ•°æ®(Data)å¯„å­˜å™¨ DX(DHã€DL) å¸¸ç”¨äºä¹˜ã€é™¤æ³•å’Œ I/O æŒ‡é’ˆ ESI æ¥æºç´¢å¼•(Source Index)å¯„å­˜å™¨ SI å¸¸åšå†…å­˜æ•°æ®æŒ‡é’ˆå’Œæºå­—ç¬¦ä¸²æŒ‡é’ˆ EDI ç›®çš„ç´¢å¼•(Destination Index)å¯„å­˜å™¨ DI å¸¸åšå†…å­˜æ•°æ®æŒ‡é’ˆå’Œç›®çš„å­—ç¬¦ä¸²æŒ‡é’ˆ ESP å †æ ˆæŒ‡é’ˆ(Stack Point)å¯„å­˜å™¨ SP åªåšå †æ ˆçš„æ ˆé¡¶æŒ‡é’ˆ; ä¸èƒ½ç”¨äºç®—æœ¯è¿ç®—ä¸æ•°æ®ä¼ é€ EBP åŸºå€æŒ‡é’ˆ(Base Point)å¯„å­˜å™¨ BP åªåšå †æ ˆæŒ‡é’ˆ, å¯ä»¥è®¿é—®å †æ ˆå†…ä»»æ„åœ°å€, ç»å¸¸ç”¨äºä¸­è½¬ ESP ä¸­çš„æ•°æ®, ä¹Ÿå¸¸ä»¥å®ƒä¸ºåŸºå€æ¥è®¿é—®å †æ ˆ; ä¸èƒ½ç”¨äºç®—æœ¯è¿ç®—ä¸æ•°æ®ä¼ é€ 64ä½CPUå…¼å®¹32ä½çš„ç¨‹åºï¼Œæ‰€æœ‰ä¸‹é¢çš„ç¨‹åºéƒ½æ˜¯32ä½çš„ï¼Œæ±‡ç¼–å™¨ç”¨çš„æ˜¯NASMã€‚ ","date":"2022-04-08","objectID":"/win32_assembly/:1:0","tags":null,"title":"x86æ±‡ç¼–","uri":"/win32_assembly/"},{"categories":null,"content":"è°ƒç”¨MessageBox ; Message Box, 32 bit. V1.01 NULL EQU 0 ; Constants MB_DEFBUTTON1 EQU 0 MB_DEFBUTTON2 EQU 100h IDNO EQU 7 MB_YESNO EQU 4 extern _MessageBoxA@16 ; Import external symbolsï¼Œåœ¨â€œ@â€ä¹‹åçš„æ•°å­—è¡¨ç¤ºäº†è¯¥å‡½æ•°æ‰€æœ‰å‚æ•°çš„å°ºå¯¸ï¼ˆå­—èŠ‚ä¸ºå•ä½ï¼‰ extern _ExitProcess@4 ; Windows API functions, decorated global Start ; Export symbols. The entry point section .data ; Initialized data segment MessageBoxText db \"Do you want to exit?\", 0 MessageBoxCaption db \"MessageBox 32\", 0 section .text ; Code segment Start: push MB_YESNO | MB_DEFBUTTON2 ; 4th parameter. 2 constants ORed together push MessageBoxCaption ; 3rd parameter push MessageBoxText ; 2nd parameter push NULL ; 1st parameter call _MessageBoxA@16 cmp EAX, IDNO ; Check the return value for \"No\" je Start push NULL call _ExitProcess@4 ç”¨nasmç¼–è¯‘nasm -f win32 fun.asm -o fun.obj ç”¨golinké“¾æ¥golink /entry:Start kernel32.dll user32.dll fun.obj å‚è€ƒï¼š nasm-messagebox32 ","date":"2022-04-08","objectID":"/win32_assembly/:2:0","tags":null,"title":"x86æ±‡ç¼–","uri":"/win32_assembly/"},{"categories":[],"content":" INTè¡¨ç¤ºinterruptï¼ˆä¸­æ–­ï¼‰ï¼Œ INTæŒ‡ä»¤æ˜¯X86æ±‡ç¼–è¯­è¨€ä¸­æœ€é‡è¦çš„æŒ‡ä»¤ä¹‹ä¸€ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¼•å‘ä¸­æ–­ï¼Œè°ƒç”¨â€œä¸­æ–­ä¾‹ç¨‹â€ï¼ˆinterrupt routineï¼‰ã€‚ ä¸­æ–­æ˜¯ç”±äºè½¯ä»¶æˆ–ç¡¬ä»¶çš„ä¿¡å·ï¼Œä½¿CPUæš‚åœæ‰§è¡Œå½“å‰çš„ä»»åŠ¡ï¼Œè½¬è€Œå»æ‰§è¡Œå¦ä¸€æ®µå­ç¨‹åºã€‚ ç¡¬ä¸­æ–­ï¼ˆå¤–ä¸­æ–­ï¼‰ï¼šç”±å¤–éƒ¨è®¾å¤‡ï¼Œå¦‚ç½‘å¡ã€ç¡¬ç›˜éšæœºå¼•å‘çš„ï¼Œæ¯”å¦‚ç½‘å¡æ”¶åˆ°æ•°æ®åŒ…çš„æ—¶å€™ï¼Œå°±ä¼šå‘å‡ºä¸€ä¸ªä¸­æ–­ã€‚ è½¯ä¸­æ–­ï¼ˆå†…ä¸­æ–­ï¼‰ï¼šç”±æ‰§è¡Œä¸­çš„æŒ‡ä»¤äº§ç”Ÿçš„ï¼Œå¯ä»¥é€šè¿‡ç¨‹åºæ§åˆ¶è§¦å‘ã€‚ å¯ä»¥é€šè¿‡ â€œ INT ä¸­æ–­ç  â€ å®ç°ä¸­æ–­ï¼Œå†…å­˜ä¸­æœ‰ä¸€å¼ ä¸­æ–­å‘é‡è¡¨ï¼Œç”¨æ¥å­˜æ”¾ä¸­æ–­ç å¤„ç†ä¸­æ–­ç¨‹åºçš„å…¥å£åœ°å€ã€‚CPUåœ¨æ¥å—åˆ°ä¸­æ–­ä¿¡å·åï¼Œæš‚åœå½“å‰æ­£åœ¨æ‰§è¡Œçš„ç¨‹åºï¼Œè·³è½¬åˆ°ä¸­æ–­ç å¯¹åº”çš„å‘é‡è¡¨åœ°å€å¤„å»æ‰§è¡Œä¸­æ–­ã€‚ æˆ‘ä»¬ç†è§£ä¸Šå¯ä»¥å½“INTå°±æ˜¯è°ƒç”¨ç³»ç»Ÿå†…ç½®çš„ä¸€äº›åŠŸèƒ½ã€‚ å¸¸ç”¨çš„ä¸­æ–­ï¼š INT 21Hï¼šDOSç³»ç»ŸåŠŸèƒ½è°ƒç”¨ INT 10Hï¼šBIOSç»ˆç«¯è°ƒç”¨ INT 3Hï¼šæ–­ç‚¹ä¸­æ–­ï¼Œç”¨äºè°ƒè¯•ç¨‹åº è¿™ç¯‡æ–‡ç« é‡ç‚¹è®°å½•ä¸‹DOSçš„ç³»ç»ŸåŠŸèƒ½è°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯INT 21Hã€‚ æœ¬æ–‡ç¯å¢ƒï¼š æ“ä½œç³»ç»Ÿï¼šè™šæ‹Ÿæœºä¸­çš„Windows 10 Visual Studio Code VSCode æ’ä»¶ï¼šMASM/TASM è¿™ä¸ªæ’ä»¶è¿˜è›®æ–¹ä¾¿çš„ï¼Œçœå»äº†è‡ªå·±é…ç¯å¢ƒçš„éº»çƒ¦ï¼Œå³é”®å•å‡»æ–‡ä»¶é€‰æ‹©Run ASM codeå°±å¯ä»¥æ‰§è¡Œä»£ç ï¼š DOSç³»ç»ŸåŠŸèƒ½è°ƒç”¨æ ¼å¼éƒ½æ˜¯ä¸€è‡´çš„ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š åœ¨AHå¯„å­˜å™¨ä¸­è®¾ç½®ç³»ç»ŸåŠŸèƒ½è°ƒç”¨å·ã€‚ åœ¨æŒ‡å®šçš„å¯„å­˜å™¨ä¸­è®¾ç½®å…¥å£å‚æ•°ã€‚ ç”¨INT 21HæŒ‡ä»¤æ‰§è¡ŒåŠŸèƒ½è°ƒç”¨ã€‚ æ ¹æ®å‡ºå£å‚æ•°åˆ†æåŠŸèƒ½è°ƒç”¨æ‰§è¡Œæƒ…å†µã€‚ ","date":"2022-03-05","objectID":"/assembly_int21h/:0:0","tags":["Assembly"],"title":"DOS ç³»ç»ŸåŠŸèƒ½è°ƒç”¨ï¼ˆINT 21Hï¼‰","uri":"/assembly_int21h/"},{"categories":[],"content":"å¸¸è§åŠŸèƒ½ DOS ç³»ç»ŸåŠŸèƒ½è°ƒç”¨ INT 21Hï¼Œæœ‰æ•°ç™¾ç§åŠŸèƒ½ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚ä¸‹é¢ä»‹ç»å‡ ä¸ªå¸¸ç”¨çš„ DOS ç³»ç»ŸåŠŸèƒ½è°ƒç”¨ï¼Œç®€è¦æè¿°å¦‚è¡¨æ‰€ç¤ºã€‚ 4Cè‚¯å®šå¤©å¤©ç”¨ï¼Œæ¯•ç«Ÿç”¨æ¥è¿”å›DOSçš„ï¼Œè¿™é‡Œå†™ç‚¹å…¶ä»–åŠŸèƒ½çš„ä¾‹å­ã€‚ ","date":"2022-03-05","objectID":"/assembly_int21h/:1:0","tags":["Assembly"],"title":"DOS ç³»ç»ŸåŠŸèƒ½è°ƒç”¨ï¼ˆINT 21Hï¼‰","uri":"/assembly_int21h/"},{"categories":[],"content":"ä¸€äº›ä¾‹å­ æ±‡ç¼–ä»£ç ä¸­ï¼ŒæŒ‡ä»¤å’Œå¯„å­˜å™¨åå¤§å†™å’Œå°å†™æ²¡å…³ç³»ï¼Œæ‰€ä»¥è¿™é‡Œahå’ŒAHï¼Œdxå’ŒDXä¹Ÿæ²¡é—®é¢˜ã€‚ä½†æ˜¯4Hå’Œ4è¿˜æ˜¯æœ‰ç‚¹ä¸ä¸€æ ·çš„ï¼Œ4Hæ˜¯16è¿›åˆ¶ï¼Œä¸å¸¦hè¡¨ç¤º10è¿›åˆ¶ã€‚ æ˜¾ç¤ºä¸€ä¸ªå­—ç¬¦ assume cs:code, ds:data ; æ•°æ®æ®µ data segment message db 'hello' data ends ; ä»£ç æ®µ code segment start: mov ax, data mov ds, ax mov dl, ds:[1h] ;è°ƒç”¨DOSç³»ç»ŸåŠŸèƒ½ï¼Œ2è¡¨ç¤ºè¾“å‡ºDLå¯„å­˜å™¨çš„å­—ç¬¦åˆ°æ˜¾ç¤ºå™¨ mov ah, 2h int 21h ;è¿”å›DOS mov ah, 4ch int 21h code ends end start è¿™ä¸ªç¨‹åºä¼šè¾“å‡ºä¸€ä¸ªeçš„å­—ç¬¦ã€‚ æ‰“å°hello world ä»£ç æ˜¯ç”¨åˆ«äººçš„ï¼Œä»–çš„æ³¨é‡Šå†™çš„è›®å¥½çš„ï¼š ; æ³¨ï¼šè¿™é‡Œçš„å…³è”å¹¶æ²¡æœ‰ä»»ä½•å®é™…æ“ä½œï¼Œç›¸å½“äºç»™æˆ‘ä»¬è‡ªå·±çš„æ³¨é‡Šè€Œå·² ; ç›¸å½“äºå³ä½¿ä¸å†™è¿™ä¸€è¡Œä¹Ÿæ²¡æœ‰å…³ç³» assume cs:code, ds:data ; æ•°æ®æ®µ data segment ; åˆ›å»ºå­—ç¬¦ä¸² ; æ±‡ç¼–æ‰“å°å­—ç¬¦ä¸²è¦åœ¨å°¾éƒ¨ç”¨ $ æ ‡è®°å­—ç¬¦ä¸²çš„ç»“æŸä½ç½® ; å°†å­—ç¬¦ä¸²ç”¨helloåšä¸€ä¸ªæ ‡è®°ï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨å®ƒ hello db 'Hello World!$' data ends ; ä»£ç æ®µ code segment ; æŒ‡ä»¤æ‰§è¡Œçš„èµ·å§‹ï¼Œç±»ä¼¼äºCè¯­è¨€çš„mainå‡½æ•°å…¥å£ start: ; æ±‡ç¼–è¯­è¨€ä¸ä¼šè‡ªåŠ¨æŠŠæ•°æ®æ®µå¯„å­˜å™¨æŒ‡å‘æˆ‘ä»¬ç¨‹åºçš„æ•°æ®æ®µ ; å°†æ•°æ®æ®µå¯„å­˜å™¨æŒ‡å‘æˆ‘ä»¬è‡ªå·±ç¨‹åºçš„æ•°æ®æ®µ mov ax, data mov ds, ax ; æ‰“å°å­—ç¬¦ä¸²çš„å‚æ•° ; DS:DX=ä¸²åœ°å€ï¼Œå°†å­—ç¬¦ä¸²çš„åç§»åœ°å€ä¼ å…¥dxå¯„å­˜å™¨ ; å­—ç¬¦ä¸²æ˜¯åœ¨æ•°æ®æ®µèµ·å§‹åˆ›å»ºçš„ï¼Œå®ƒçš„åç§»åœ°å€æ˜¯0H ; offset hello å³æ‰¾åˆ°æ ‡è®°ä¸ºhelloçš„æ•°æ®æ®µå­—ç¬¦ä¸²çš„ç¼–è¯‘åœ°å€ ; è¿˜å¯ä»¥å†™æˆ mov dx, 0H mov dx, offset hello ; æ‰“å°å­—ç¬¦ä¸²ï¼Œah=9Hä»£è¡¨æ‰“å° mov ah, 9h int 21h ; æ­£å¸¸é€€å‡ºç¨‹åºï¼Œç›¸å½“äºé«˜çº§è¯­è¨€çš„ return 0 mov ah, 4ch int 21h code ends end start è¯»å–é”®ç›˜è¾“å…¥ä¸¤ä¸ªæ•°æ±‚å’Œ è¿™ä¸ªä¾‹å­å¤æ‚äº†ç‚¹ assume cs:code, ds:data, ss:stack stack segment dw 30h dup(0) stack ends ; æ•°æ®æ®µ data segment buf db 20h, 0, 20h dup (0) message db 'input a number:$' num dw ? data ends code segment start: mov ax, data mov ds, ax call printMsg call readInput call atoi push num ; again call printMsg call readInput call atoi push num ; cal summ call sum call printAx mov ah, 4ch int 21h printMsg: mov dx, offset message mov ah, 9h int 21h ret readInput: ; first byte to tell dos maximum characters buffer can hold mov dx, 0h mov ah, 0Ah int 21h ; print \\n mov dl, 0Ah mov ah, 02h int 21h ret atoi proc mov dx,0 mov bx,10 mov si,2 mov num,0 mov ax,0 lop: mov al,buf[si] cmp al,0Dh je final sub al,30h cmp num,0 je do_delta push ax mov ax,num mul bx mov num,ax pop ax do_delta: add num,ax mov ax,0 inc si jmp lop final: ret atoi endp ; å†…å¹³è¡¡ sum: mov bp, sp mov ax, ss:[bp+2] add ax, ss:[bp+4] ret 4 printAx proc ;initialize count mov cx,0 mov dx,0 label1: ; if ax is zero cmp ax,0 je print1 mov bx,10 div bx ;push it in the stack push dx ;increment the count inc cx ;set dx to 0 xor dx,dx jmp label1 print1: ;check if count ;is greater than zero cmp cx,0 je exit ;pop the top of stack pop dx ;add 48 so that it ;represents the ASCII ;value of digits add dx,48 ; print character mov ah,02h int 21h ;decrease the count dec cx jmp print1 exit: ret printAx endp code ends end start ","date":"2022-03-05","objectID":"/assembly_int21h/:2:0","tags":["Assembly"],"title":"DOS ç³»ç»ŸåŠŸèƒ½è°ƒç”¨ï¼ˆINT 21Hï¼‰","uri":"/assembly_int21h/"},{"categories":[],"content":"è°ƒè¯•å·¥å…·DEBUGå¸¸ç”¨å‘½ä»¤ R â€”â€”æŸ¥çœ‹å’Œä¿®æ”¹å¯„å­˜å™¨ D â€”â€”æŸ¥çœ‹å†…å­˜å•å…ƒ å†…å­˜æ¯16ä¸ªå­—èŠ‚å•å…ƒä¸ºä¸€å°æ®µï¼Œé€»è¾‘æ®µå¿…é¡»ä»å°æ®µçš„é¦–å€å¼€å§‹ã€‚ç”¨Då‘½ä»¤å¯ä»¥æŸ¥çœ‹å­˜å‚¨å•å…ƒçš„åœ°å€å’Œå†…å®¹ã€‚ Då‘½ä»¤æ ¼å¼ä¸ºï¼š D æ®µåœ°å€:èµ·å§‹åç§»åœ°å€ [ç»“å°¾åç§»åœ°å€] [LèŒƒå›´] ä¾‹å¦‚ï¼š D DS:0 æŸ¥çœ‹æ•°æ®æ®µï¼Œä»0å·å•å…ƒå¼€å§‹ D ES:0 æŸ¥çœ‹é™„åŠ æ®µï¼Œä»0å·å•å…ƒå¼€å§‹ D DS:100 æŸ¥çœ‹æ•°æ®æ®µï¼Œä»100Hå·å•å…ƒå¼€å§‹ D 0200:5 15 æŸ¥çœ‹0200Hæ®µçš„5å·å•å…ƒåˆ°15Hå·å•å…ƒï¼ˆåœ¨è™šæ‹Ÿæœºä¸Šè¯¥å‘½ä»¤ä¸èƒ½æ‰§è¡Œï¼‰ D 0200:5 L 11 ç”¨Lé€‰æ‹©èŒƒå›´ã€‚æŸ¥çœ‹0200Hæ®µçš„5å·å•å…ƒåˆ°15Hå·å•å…ƒå…±10ä¸ªå•å…ƒ T /Pâ€”â€”å•æ­¥æ‰§è¡Œ På¯ä»¥è·³è¿‡å­ç¨‹åºæˆ–ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶ä»–æ–¹é¢Tå’ŒPæ˜¯ç±»å‹çš„ã€‚ å‚è€ƒï¼š ä»é›¶å…¥é—¨8086æ±‡ç¼– è°ƒè¯•å·¥å…·DEBUG ","date":"2022-03-05","objectID":"/assembly_int21h/:3:0","tags":["Assembly"],"title":"DOS ç³»ç»ŸåŠŸèƒ½è°ƒç”¨ï¼ˆINT 21Hï¼‰","uri":"/assembly_int21h/"},{"categories":["nodejs"],"content":"åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£ä¸‹ä»€ä¹ˆæ˜¯ Core å’Œ Core Dumpã€‚ ä»€ä¹ˆæ˜¯ Core? åœ¨ä½¿ç”¨åŠå¯¼ä½“ä½œä¸ºå†…å­˜ææ–™å‰ï¼Œäººç±»æ˜¯åˆ©ç”¨çº¿åœˆå½“ä½œå†…å­˜çš„ææ–™ï¼Œçº¿åœˆå°±å«ä½œ core ï¼Œç”¨çº¿åœˆåšçš„å†…å­˜å°±å«ä½œ core memoryã€‚å¦‚ä»Š ï¼ŒåŠå¯¼ä½“å·¥ä¸šæ¾å‹ƒå‘å±•ï¼Œå·²ç»æ²¡æœ‰äººç”¨ core memory äº†ï¼Œä¸è¿‡åœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œ äººä»¬è¿˜æ˜¯æŠŠè®°å¿†ä½“å«ä½œ core ã€‚ ä»€ä¹ˆæ˜¯ Core Dump? å½“ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­å¼‚å¸¸ç»ˆæ­¢æˆ–å´©æºƒï¼Œæ“ä½œç³»ç»Ÿä¼šå°†ç¨‹åºå½“æ—¶çš„å†…å­˜çŠ¶æ€è®°å½•ä¸‹æ¥ï¼Œä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè¿™ç§è¡Œä¸ºå°±å«åš Core Dumpï¼ˆä¸­æ–‡æœ‰çš„ç¿»è¯‘æˆ â€œæ ¸å¿ƒè½¬å‚¨â€)ã€‚æˆ‘ä»¬å¯ä»¥è®¤ä¸º Core Dump æ˜¯ â€œå†…å­˜å¿«ç…§â€ï¼Œä½†å®é™…ä¸Šï¼Œé™¤äº†å†…å­˜ä¿¡æ¯ä¹‹å¤–ï¼Œè¿˜æœ‰äº›å…³é”®çš„ç¨‹åºè¿è¡ŒçŠ¶æ€ä¹Ÿä¼šåŒæ—¶ dump ä¸‹æ¥ï¼Œä¾‹å¦‚å¯„å­˜å™¨ä¿¡æ¯ï¼ˆåŒ…æ‹¬ç¨‹åºæŒ‡é’ˆã€æ ˆæŒ‡é’ˆç­‰ï¼‰ã€å†…å­˜ç®¡ç†ä¿¡æ¯ã€å…¶ä»–å¤„ç†å™¨å’Œæ“ä½œç³»ç»ŸçŠ¶æ€å’Œä¿¡æ¯ã€‚Core Dump å¯¹äºç¼–ç¨‹äººå‘˜è¯Šæ–­å’Œè°ƒè¯•ç¨‹åºæ˜¯éå¸¸æœ‰å¸®åŠ©çš„ï¼Œå› ä¸ºå¯¹äºæœ‰äº›ç¨‹åºé”™è¯¯æ˜¯å¾ˆéš¾é‡ç°çš„ï¼Œä¾‹å¦‚æŒ‡é’ˆå¼‚å¸¸ï¼Œè€Œ Core Dump æ–‡ä»¶å¯ä»¥å†ç°ç¨‹åºå‡ºé”™æ—¶çš„æƒ…æ™¯ã€‚ åœ¨Nodeç”Ÿæˆcore dumpæ–‡ä»¶æœ‰ä¸¤æ­¥ å…ˆå¼€å¯core dump ulimit -c unlimited ulimit -cè®¾ç½®å…è®¸ Core Dump ç”Ÿæˆçš„æ–‡ä»¶çš„å¤§å°ï¼Œå¦‚æœæ˜¯ 0 åˆ™è¡¨ç¤ºå…³é—­äº† Core Dumpã€‚unlimitedè¡¨ç¤ºæ— é™åˆ¶ã€‚ gcore ç¬¬äºŒæ­¥æˆ‘ä»¬å¯ä»¥ç”¨gcoreå‘½ä»¤ï¼ˆéœ€è¦è£…gdbï¼‰ä¸é‡å¯ç¨‹åºç”Ÿæˆcore dumpæ–‡ä»¶ï¼š gcore [-o filename] pid ä½†åœ¨å®¹å™¨ä¸­ï¼Œgcoreå‘½ä»¤ä¼šæŠ¥é”™ã€‚ å‚è€ƒï¼š Node.js è°ƒè¯•æŒ‡å— ","date":"2021-07-27","objectID":"/core_dump_in_docker/:0:0","tags":["nodejs"],"title":"Node.jsï¼šå®¹å™¨ä¸­Core Dump","uri":"/core_dump_in_docker/"},{"categories":["Javascript"],"content":"å®‰è£… å®‰è£…TypeScriptè¿˜æ˜¯å¾ˆç®€å•çš„ï¼š npm install -g typescript å†™ä¸ªhello.ts function sayHello(person: string) { return 'Hello, ' + person; } let user = 'Tom'; console.log(sayHello(user)); ç„¶åæ‰§è¡Œ tsc hello.ts è¿™æ—¶å€™ä¼šç”Ÿæˆä¸€ä¸ªç¼–è¯‘å¥½çš„æ–‡ä»¶ hello.jsï¼š function sayHello(person) { return 'Hello, ' + person; } var user = 'Tom'; console.log(sayHello(user)); å¯ä»¥çœ‹åˆ°ï¼Œç¼–è¯‘å¥½åçš„å°±æ˜¯å¹³å¸¸çš„jsä»£ç ï¼ŒTSçš„ä¸€ä¸ªä¼˜ç‚¹åœ¨äºç±»å‹çš„å£°æ˜ï¼Œè¿™æ ·åœ¨ç¼–è¯‘æœŸbugå°±èƒ½åŠæ—©å‘ç°ï¼ˆå½“ç„¶è¿˜æœ‰å…¶ä»–å¥½å¤„ï¼Œä¾‹å¦‚æ³›å‹ï¼ŒEnumï¼Œè£…é¥°å™¨ï¼‰ã€‚ æ³¨æ„ï¼š TypeScript åªä¼šåœ¨ç¼–è¯‘æ—¶å¯¹ç±»å‹è¿›è¡Œé™æ€æ£€æŸ¥ï¼Œå¦‚æœå‘ç°æœ‰é”™è¯¯ï¼Œç¼–è¯‘çš„æ—¶å€™å°±ä¼šæŠ¥é”™ã€‚è€Œåœ¨è¿è¡Œæ—¶ï¼Œä¸æ™®é€šçš„ JavaScript æ–‡ä»¶ä¸€æ ·ï¼Œä¸ä¼šå¯¹ç±»å‹è¿›è¡Œæ£€æŸ¥ã€‚ ","date":"2021-06-05","objectID":"/typescript_learn/:1:0","tags":["Typescript"],"title":"Typescriptå­¦ä¹ ","uri":"/typescript_learn/"},{"categories":["Javascript"],"content":"å¤æ‚ç‚¹ æ„å»ºä¸€ä¸ªTypeScriptçš„é¡¹ç›®å°±éœ€è¦tsconfig.jsonæ–‡ä»¶äº†ã€‚å¦‚æœä¸€ä¸ªç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªtsconfig.jsonæ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒæ„å‘³ç€è¿™ä¸ªç›®å½•æ˜¯TypeScripté¡¹ç›®çš„æ ¹ç›®å½•ã€‚ åˆ›å»ºä¸€ä¸ªç®€å•çš„é¡¹ç›®ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹ï¼š MyProj â”œâ”€â”€ src â”‚ â”œâ”€â”€ index.ts â”‚ â”œâ”€â”€ person.ts â”‚ â”œâ”€â”€ animal.js â”œâ”€â”€ package.json â”œâ”€â”€ tsconfig.json â”œâ”€â”€ .eslintrc.js tsconfig.jsonæ–‡ä»¶ { \"compilerOptions\": { \"target\": \"ES2018\", // æŒ‡å®šECMAScriptç›®æ ‡ç‰ˆæœ¬ \"module\": \"commonjs\", \"moduleResolution\": \"node\", \"experimentalDecorators\": true, // å¼€å¯è£…é¥°å™¨ \"strict\": true, // å¯ç”¨æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€‰é¡¹ \"noImplicitAny\": false, \"removeComments\": true, // ç§»é™¤æ³¨é‡Š \"sourceMap\": false, \"rootDir\": \"src\", // Default: The longest common path of all non-declaration input files. \"outDir\": \"dist\", // ç¼–è¯‘è¾“å‡ºç›®å½• \"allowJs\": true // å…è®¸JSæ–‡ä»¶æ··åˆ }, \"include\": [\"src/**/*\"], // æŒ‡å®šè¦ç¼–è¯‘æ–‡ä»¶ \"exclude\": [\"node_modules\"] // æŒ‡å®šè¦æ’é™¤çš„ç¼–è¯‘æ–‡ä»¶ } person.ts export class Person { private name: string; private age: number; constructor(name: string, age: number) { this.name = name; this.age = age; } getName() { return this.name; } } export interface Payload { title: string; description: string; } index.ts import { Person, Payload } from './person'; import { Animal } from './animal'; const p = new Person('sala', 12); const data: Payload = { title: 'One', description: 'happy...' }; type StringOrNumber = string | number; function getString(n: StringOrNumber): string { if (typeof n === 'string') { return n; } else { return n.toString(); } } const animal = new Animal('Kitty'); animal.js export class Animal { constructor(name) { this.name = name; } sayHi() { return 'hello!'; } } package.json { \"name\": \"ts_learn_project\", \"version\": \"1.0.0\", \"description\": \"\", \"main\": \"index.js\", \"dependencies\": {}, \"devDependencies\": { \"@typescript-eslint/eslint-plugin\": \"^4.22.0\", \"@typescript-eslint/parser\": \"^4.22.0\", \"eslint\": \"^7.24.0\", \"typescript\": \"^4.2.4\", \"mwts\": \"^1.0.5\" }, \"scripts\": { \"test\": \"echo \\\"Error: no test specified\\\" \u0026\u0026 exit 1\", \"eslint\": \"eslint src --ext .ts\", \"build\": \"tsc\" }, \"keywords\": [ \"typescript\" ], \"author\": \"salamander\", \"license\": \"ISC\" } .eslintrc.js module.exports = { parser: \"@typescript-eslint/parser\", plugins: [\"@typescript-eslint\"], rules: { // ç¦æ­¢ä½¿ç”¨ var \"no-var\": \"error\", // ä¼˜å…ˆä½¿ç”¨ interface è€Œä¸æ˜¯ type \"@typescript-eslint/consistent-type-definitions\": [\"error\", \"interface\"], }, }; 2019 å¹´ 1 æœˆï¼ŒTypeScirpt å®˜æ–¹å†³å®šå…¨é¢é‡‡ç”¨ ESLint ä½œä¸ºä»£ç æ£€æŸ¥çš„å·¥å…·ï¼Œå¹¶åˆ›å»ºäº†ä¸€ä¸ªæ–°é¡¹ç›® typescript-eslintï¼Œæä¾›äº† TypeScript æ–‡ä»¶çš„è§£æå™¨ @typescript-eslint/parser å’Œç›¸å…³çš„é…ç½®é€‰é¡¹ @typescript-eslint/eslint-plugin ç­‰ã€‚ å‚è€ƒï¼š TypeScript ä¸­æ–‡æ‰‹å†Œ tsconfig ","date":"2021-06-05","objectID":"/typescript_learn/:2:0","tags":["Typescript"],"title":"Typescriptå­¦ä¹ ","uri":"/typescript_learn/"},{"categories":["RabbitMQ"],"content":"ä¸šåŠ¡éœ€æ±‚ æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æŸäº›ä»»åŠ¡å®šæ—¶æ‰§è¡Œï¼Œè­¬å¦‚å–æ¶ˆè®¢å•ï¼Œ5åˆ†é’Ÿæ²¡æ”¯ä»˜ï¼Œè¿™ä¸ªè®¢å•å°±è¢«å–æ¶ˆã€‚ç®€å•å®ç°çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Redisæˆ–Linuxçš„crontabæ¥å®ç°ï¼Œè€Œå¯¹äºRabbitMQï¼Œæˆ‘ä»¬åˆ™å¯ä»¥ç”¨å®ƒçš„æ­»ä¿¡é˜Ÿåˆ—æ¥å®ç°å®šæ—¶ä»»åŠ¡ã€‚ ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:1:0","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"DLX RabbitMQ ä¸­æœ‰ä¸€ç§äº¤æ¢å™¨å« DLXï¼Œå…¨ç§°ä¸º Dead-Letter-Exchangeï¼Œå¯ä»¥ç§°ä¹‹ä¸ºæ­»ä¿¡äº¤æ¢å™¨ã€‚å½“æ¶ˆæ¯åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­å˜æˆæ­»ä¿¡ï¼ˆdead messageï¼‰ä¹‹åï¼Œå®ƒä¼šè¢«é‡æ–°å‘é€åˆ°å¦å¤–ä¸€ä¸ªäº¤æ¢å™¨ä¸­ï¼Œè¿™ä¸ªäº¤æ¢å™¨å°±æ˜¯ DLXï¼Œç»‘å®šåœ¨ DLX ä¸Šçš„é˜Ÿåˆ—å°±ç§°ä¹‹ä¸ºæ­»ä¿¡é˜Ÿåˆ—ã€‚ æ¶ˆæ¯å˜æˆæ­»ä¿¡ä¸€èˆ¬æ˜¯ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š æ¶ˆæ¯è¢«æ‹’ç»ï¼Œå¹¶ä¸”è®¾ç½® requeue å‚æ•°ä¸º false æ¶ˆæ¯è¿‡æœŸ é˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦ DLXå…¶å®å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„äº¤æ¢å™¨ï¼Œè¦ä½¿ç”¨å®ƒä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨å£°æ˜æŸä¸ªé˜Ÿåˆ—çš„æ—¶å€™è®¾ç½®å…¶ deadLetterExchange å’Œ deadLetterRoutingKey å‚æ•°ï¼ŒdeadLetterRoutingKey å‚æ•°å¯é€‰ï¼Œè¡¨ç¤ºä¸º DLX æŒ‡å®šçš„è·¯ç”±é”®ï¼Œå¦‚æœæ²¡æœ‰ç‰¹æ®ŠæŒ‡å®šï¼Œåˆ™ä½¿ç”¨åŸé˜Ÿåˆ—çš„è·¯ç”±é”®ã€‚è¿™æ ·è®¾ç½®åï¼Œè¿™ä¸ªé˜Ÿåˆ—çš„æ¶ˆæ¯ä¸€è¿‡æœŸï¼ŒRabbitMQ å°±ä¼šè‡ªåŠ¨åœ°å°†è¿™ä¸ªæ¶ˆæ¯é‡æ–°å‘å¸ƒåˆ°è®¾ç½®çš„ DLX ä¸Šå»ï¼Œè¿›è€Œè¢«è·¯ç”±åˆ°å¦ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå³æ­»ä¿¡é˜Ÿåˆ—ã€‚ ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:2:0","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"ç®€å•ä¾‹å­ ç”¨ä¹‹å‰æ–‡ç« RabbitMQäºŒä¸‰äº‹å¿«é€Ÿå¯åŠ¨RabbitMQçš„æœåŠ¡ï¼Œå†æŠŠRabbitMQä¸‰å››äº‹çš„ä»£ç æ”¹é€ ä¸‹ã€‚ producer.js const config = require(\"./config\"); const amqp = require('amqplib'); async function getMQConnection() { return await amqp.connect({ protocol: 'amqp', hostname: config.host, port: config.port, username: config.user, password: config.pass, locale: 'en_US', frameMax: 0, heartbeat: 5, // å¿ƒè·³ vhost: config.vhost, }) } async function run(rmqConn, msgObj) { const noramlQueue = 'noramlQu'; const noramlExchange = 'noramlEx'; const exchangeDLX = 'testExDLX'; const queueDLX = 'testQueueDLX'; const routingKeyDLX = 'testRoutingKeyDLX'; try { const channel = await rmqConn.createChannel(); // å£°æ˜æ­»ä¿¡äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå°±è·Ÿæ™®é€šçš„ä¸€æ · await channel.assertExchange(exchangeDLX, 'direct', { durable: true, autoDelete: false }); await channel.assertQueue(queueDLX, {durable: true, autoDelete: false, }); await channel.bindQueue(queueDLX, exchangeDLX, routingKeyDLX); // æ™®é€šäº¤æ¢å™¨å’Œé˜Ÿåˆ— await channel.assertExchange(noramlExchange, 'direct', { durable: true, autoDelete: false }) await channel.assertQueue(noramlQueue, {durable: true, autoDelete: false, deadLetterExchange: exchangeDLX, deadLetterRoutingKey: routingKeyDLX, }); // é˜Ÿåˆ—è®¾ç½®DLX await channel.bindQueue(noramlQueue, noramlExchange, noramlQueue); // å‘é€æ¶ˆæ¯ await channel.publish(noramlExchange, noramlQueue, Buffer.from(msgObj.content), { expiration: msgObj.expiration, // è¿‡æœŸæ—¶é—´ï¼Œms persistent: true, mandatory: true, }); console.log('send message successfully.') await channel.close(); } catch(err) { console.log('send message failed:' + err.message) } } async function testSend() { const conn = await getMQConnection() await run(conn, { content: (new Date()).toLocaleString(), expiration: '3000', }) await conn.close() } testSend(); consumer.js const config = require(\"./config\"); const amqp = require('amqplib'); async function getMQConnection() { return await amqp.connect({ protocol: 'amqp', hostname: config.host, port: config.port, username: config.user, password: config.pass, locale: 'en_US', frameMax: 0, heartbeat: 5, // å¿ƒè·³ vhost: config.vhost, }) } async function run(rmqConn) { const noramlQueue = 'noramlQu'; const noramlExchange = 'noramlEx'; const exchangeDLX = 'testExDLX'; const queueDLX = 'testQueueDLX'; const routingKeyDLX = 'testRoutingKeyDLX'; try { const channel = await rmqConn.createChannel(); // å£°æ˜æ­»ä¿¡äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå°±è·Ÿæ™®é€šçš„ä¸€æ · await channel.assertExchange(exchangeDLX, 'direct', { durable: true, autoDelete: false }); await channel.assertQueue(queueDLX, {durable: true, autoDelete: false, }); await channel.bindQueue(queueDLX, exchangeDLX, routingKeyDLX); // å¤„ç†æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯ await channel.consume(queueDLX, msg =\u003e { console.log(`[${(new Date()).toLocaleString()}] consumer msgï¼š`, msg.content.toString()); }, { noAck: true }); } catch(err) { console.log('consume message failed:' + err.message) } } async function testConsume() { const conn = await getMQConnection(); console.log('begin consuming messages...'); await run(conn); process.on('SIGINT', () =\u003e { console.log('stop consumer.') conn.close(); }); } testConsume(); config.js module.exports = { host: '127.0.0.1', port: 5672, user: 'test', pass: '************', vhost: '/' } ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬è®©æ¶ˆæ¯3såè¿‡æœŸï¼Œå…ˆå¯åŠ¨æ¶ˆè´¹è€…ï¼Œå†å¯åŠ¨ç”Ÿäº§è€…ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¶ˆæ¯3såè¿‡æœŸ: $ node consumer.js begin consuming messages... [2021/3/20 ä¸‹åˆ3:22:29] consumer msgï¼š 2021/3/20 ä¸‹åˆ3:22:26 ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:3:0","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"æ­»ä¿¡é˜Ÿåˆ—é—®é¢˜ RabbitMQä¸­ï¼Œæ¯ä¸ªæ¶ˆæ¯çš„è¿‡æœŸä¸æ˜¯ç‹¬ç«‹çš„ï¼Œä¸€ä¸ªé˜Ÿåˆ—é‡Œçš„æŸä¸ªæ¶ˆæ¯å³ä½¿æ¯”åŒé˜Ÿåˆ—ä¸­çš„å…¶å®ƒæ¶ˆæ¯æå‰è¿‡æœŸï¼Œä¹Ÿä¸ä¼šä¼˜å…ˆè¿›å…¥åˆ°æ­»ä¿¡é˜Ÿåˆ—ï¼Œåªæœ‰å½“è¿‡æœŸçš„æ¶ˆæ¯åˆ°äº†é˜Ÿåˆ—çš„é¡¶ç«¯ï¼Œæ‰ä¼šè¢«çœŸæ­£çš„ä¸¢å¼ƒæˆ–è€…è¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ã€‚ æˆ‘ä»¬æŠŠç”Ÿäº§è€…çš„ä»£ç è°ƒæ•´ä¸‹ï¼Œå…ˆå‘ä¸€ä¸ª20sè¿‡æœŸçš„æ¶ˆæ¯ï¼Œå†å‘ä¸€ä¸ª3sè¿‡æœŸçš„æ¶ˆæ¯ .... async function testSend() { const conn = await getMQConnection() await run(conn, { content: (new Date()).toLocaleString() + ' 20sè¿‡æœŸ ', expiration: '20000', }) await run(conn, { content: (new Date()).toLocaleString() + ' 3sè¿‡æœŸ ', expiration: '3000', }) await conn.close() } è§‚å¯Ÿæ¶ˆè´¹è€…è¾“å‡ºï¼š $ node consumer.js begin consuming messages... [2021/3/21 ä¸‹åˆ6:10:21] consumer msgï¼š 2021/3/21 ä¸‹åˆ6:10:01 20sè¿‡æœŸ [2021/3/21 ä¸‹åˆ6:10:21] consumer msgï¼š 2021/3/21 ä¸‹åˆ6:10:01 3sè¿‡æœŸ å¯ä»¥å‘ç°ï¼Œ3sè¿‡æœŸçš„æ¶ˆæ¯å¹¶æ²¡æœ‰å…ˆè¢«æ¶ˆè´¹ï¼Œè€Œæ˜¯åªèƒ½å‰é¢çš„20sè¿‡æœŸçš„æ¶ˆæ¯å…ˆè¿‡æœŸï¼Œå®ƒæ‰ä¼šè¢«æ£€æŸ¥æ˜¯å¦è¿‡æœŸã€‚ ç©¶å…¶æœ¬è´¨çš„è¯ï¼ŒRabbitMQ çš„é˜Ÿåˆ—æ˜¯ä¸€ä¸ª FIFO çš„æœ‰åºé˜Ÿåˆ—ï¼ŒæŠ•å…¥çš„æ¶ˆæ¯éƒ½é¡ºåºçš„å‹è¿› MQ ä¸­ã€‚è€Œ RabbitMQ ä¹Ÿåªä¼šå¯¹é˜Ÿåˆ—é¡¶ç«¯çš„æ¶ˆæ¯è¿›è¡Œè¶…æ—¶åˆ¤å®šï¼Œæ‰€ä»¥å°±å‡ºç°äº†ä¸Šè¿°çš„æƒ…å†µã€‚ æ‰€ä»¥å¯¹äºå›ºå®šæ—¶é—´çš„å»¶æ—¶ä»»åŠ¡çš„è¯ï¼Œä¾‹å¦‚ä¸‹å•ååŠå°æ—¶æœªæ”¯ä»˜åˆ™å…³é—­è®¢å•è¿™ç§åœºæ™¯ï¼ŒRabbitMQæ— ç–‘å¯ä»¥å¾ˆå¥½çš„æ‰¿æ‹…èµ·è¿™ä¸ªéœ€æ±‚ï¼Œä½†å¯¹äºéœ€è¦æ¯æ¡æ¶ˆæ¯çš„æ­»äº¡ç›¸äº’ç‹¬ç«‹è¿™ç§åœºæ™¯ï¼ŒRabbitMQè¿˜æ˜¯æ— æ³•æ»¡è¶³çš„ã€‚ ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:4:0","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"è§£å†³é˜Ÿåˆ—æ¶ˆæ¯éå¼‚æ­¥ RabbitMQ æœ¬èº«æ²¡æœ‰è¿™ç§åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒæœ‰ä¸ªæ’ä»¶å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼šrabbitmq_delayed_message_exchangeï¼Œåœ°å€ ã€‚ è¿™ä¸ªæ’ä»¶çš„ä»‹ç»å¦‚ä¸‹ï¼š A user can declare an exchange with the type x-delayed-message and then publish messages with the custom header x-delay expressing in milliseconds a delay time for the message. The message will be delivered to the respective queues after x-delay milliseconds. è¿™ä¸ªæ’ä»¶å¢åŠ äº†ä¸€ç§æ–°ç±»å‹çš„exchangeï¼šx-delayed-messageï¼Œç„¶ååªè¦å‘é€æ¶ˆæ¯æ—¶æŒ‡å®šçš„æ˜¯è¿™ä¸ªäº¤æ¢æœºï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨æ¶ˆæ¯ header ä¸­æŒ‡å®šå‚æ•° x-delay [:æ¯«ç§’å€¼] å°±èƒ½å¤Ÿå®ç°æ¯æ¡æ¶ˆæ¯çš„å¼‚æ­¥å»¶æ—¶ã€‚ ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:5:0","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"æ·»åŠ æ’ä»¶ ç”¨äº†Dockerä¹‹åï¼Œæ·»åŠ è¿™ä¸ªæ’ä»¶éå¸¸ç®€å•ï¼Œæ·»åŠ Dockerfileï¼š FROM rabbitmq:3.8.12-management COPY ./rabbitmq_delayed_message_exchange-3.8.9-0199d11c.ez /plugins RUN rabbitmq-plugins enable rabbitmq_delayed_message_exchange æ’ä»¶å¯ä»¥åœ¨Releaseé¡µä¸‹è½½ã€‚ docker-compose.ymlæ”¹ä¸‹ï¼š version: \"2\" services: mq: build: . restart: always mem_limit: 2g hostname: mq1 volumes: - ./mnesia:/var/lib/rabbitmq/mnesia - ./log:/var/log/rabbitmq - ./rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf ports: - \"55672:15672\" - \"5672:5672\" environment: - CONTAINER_NAME=rabbitMQ - RABBITMQ_ERLANG_COOKIE=3t182q3wtj1p9z0kd3tb è¿™æ ·æ’ä»¶å°±å®‰è£…æˆåŠŸäº†ã€‚ ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:5:1","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"ä¿®æ”¹ä»£ç  producer.js const config = require(\"./config\"); const amqp = require('amqplib'); async function getMQConnection() { return await amqp.connect({ protocol: 'amqp', hostname: config.host, port: config.port, username: config.user, password: config.pass, locale: 'en_US', frameMax: 0, heartbeat: 5, // å¿ƒè·³ vhost: config.vhost, }) } async function run(rmqConn, msgObj) { const exchangeDelay = 'testExNewDelay'; const queueDLX = 'testQueueDLX'; const routingKeyDLX = 'testRoutingKeyDLX'; try { const channel = await rmqConn.createChannel(); // x-delayed-messageç±»å‹çš„exchange await channel.assertExchange(exchangeDelay, 'x-delayed-message', { durable: true, autoDelete: false, arguments: {'x-delayed-type': \"direct\"} }); await channel.assertQueue(queueDLX, {durable: true, autoDelete: false, }); await channel.bindQueue(queueDLX, exchangeDelay, routingKeyDLX); // å‘é€æ¶ˆæ¯ await channel.publish(exchangeDelay, routingKeyDLX, Buffer.from(msgObj.content), { headers: {\"x-delay\": msgObj.expiration}, // ms persistent: true, mandatory: true, }); console.log('send message successfully.') await channel.close(); } catch(err) { console.log('send message failed:' + err.message) } } async function testSend() { const conn = await getMQConnection() await run(conn, { content: (new Date()).toLocaleString() + ' 20sè¿‡æœŸ ', expiration: '20000', }) await run(conn, { content: (new Date()).toLocaleString() + ' 3sè¿‡æœŸ ', expiration: '3000', }) await conn.close() } testSend(); x-delayed-typeå‘Šè¯‰æ’ä»¶åœ¨ç»™å®šçš„å»¶è¿Ÿæ—¶é—´è¿‡å»ä¹‹åï¼Œexchangeåº”è¯¥è·Ÿdirectï¼Œfanoutï¼Œtopicä¸­çš„exchangeè·¯ç”±åŠŸèƒ½ä¸€æ ·ã€‚ consumer.js const config = require(\"./config\"); const amqp = require('amqplib'); async function getMQConnection() { return await amqp.connect({ protocol: 'amqp', hostname: config.host, port: config.port, username: config.user, password: config.pass, locale: 'en_US', frameMax: 0, heartbeat: 5, // å¿ƒè·³ vhost: config.vhost, }) } async function run(rmqConn) { const exchangeDelay = 'testExNewDelay'; const queueDLX = 'testQueueDLX'; const routingKeyDLX = 'testRoutingKeyDLX'; try { const channel = await rmqConn.createChannel(); // x-delayed-messageç±»å‹çš„exchange await channel.assertExchange(exchangeDelay, 'x-delayed-message', { durable: true, autoDelete: false, arguments: {'x-delayed-type': \"direct\"} }); await channel.assertQueue(queueDLX, {durable: true, autoDelete: false, }); await channel.bindQueue(queueDLX, exchangeDelay, routingKeyDLX); // å¤„ç†æ­»ä¿¡é˜Ÿåˆ—æ¶ˆæ¯ await channel.consume(queueDLX, msg =\u003e { console.log(`[${(new Date()).toLocaleString()}] consumer msgï¼š`, msg.content.toString()); }, { noAck: true }); } catch(err) { console.log('consume message failed:' + err.message) } } async function testConsume() { const conn = await getMQConnection(); console.log('begin consuming messages...'); await run(conn); process.on('SIGINT', () =\u003e { console.log('stop consumer.') conn.close(); }); } testConsume(); ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:5:2","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"æµ‹è¯•æ•ˆæœ æ‰§è¡Œç”Ÿäº§è€…ä»£ç ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¶ˆè´¹è€…è¾“å‡ºï¼š $ node consumer.js begin consuming messages... [2021/3/22 ä¸‹åˆ2:16:37] consumer msgï¼š 2021/3/22 ä¸‹åˆ2:16:34 3sè¿‡æœŸ [2021/3/22 ä¸‹åˆ2:16:54] consumer msgï¼š 2021/3/22 ä¸‹åˆ2:16:34 20sè¿‡æœŸ å¯ä»¥å‘ç°ï¼Œæ¶ˆæ¯å·²ç»ç‹¬ç«‹çš„è¿‡æœŸäº†ã€‚ ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:5:3","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":["RabbitMQ"],"content":"å±€é™æ€§ æ²¡æœ‰ä»€ä¹ˆä¸œè¥¿æ˜¯å®Œç¾çš„ï¼Œè¿™ä¸ªæ’ä»¶ä¹Ÿä¸ä¾‹å¤–ã€‚çœ‹ä¸‹è¿™ä¸ªæ’ä»¶çš„Performance Impactéƒ¨åˆ†ï¼š For each message that crosses an \"x-delayed-message\" exchange, the plugin will try to determine if the message has to be expired by making sure the delay is within range, ie: Delay \u003e 0, Delay =\u003c ?ERL_MAX_T (In Erlang a timer can be set up to (2^32)-1 milliseconds in the future). å»¶è¿Ÿæ—¶é—´æœ€å¤§ä¸º (2^32)-1 æ¯«ç§’ï¼Œå¤§çº¦ 49 å¤©ã€‚å¦å¤–è¿™ä¸ªæ’ä»¶ä¹Ÿä¸é€‚åˆå¤§é‡å»¶è¿Ÿæ¶ˆæ¯ï¼ˆä¾‹å¦‚æ•°åä¸‡æˆ–æ•°ç™¾ä¸‡ï¼‰çš„åœºæ™¯ï¼ŒLimitationsä¹Ÿå†™äº†ï¼š Current design of this plugin doesn't really fit scenarios with a high number of delayed messages (e.g. 100s of thousands or millions). See #72 for details. å‚è€ƒï¼š RabbitMQ æ­»ä¿¡æœºåˆ¶çœŸçš„å¯ä»¥ä½œä¸ºå»¶æ—¶ä»»åŠ¡è¿™ä¸ªåœºæ™¯çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ RabbitMQ å»¶è¿Ÿé˜Ÿåˆ—æ’ä»¶ x-delay Bug ","date":"2021-03-20","objectID":"/rabbitmq_dlx/:5:4","tags":["RabbitMQ"],"title":"RabbitMQå››äº”äº‹ä¹‹æ­»ä¿¡é˜Ÿåˆ—","uri":"/rabbitmq_dlx/"},{"categories":[],"content":" è¿™ç¯‡æ–‡ç« å¾ˆç®€å•å‘¢ï¼Œå°±æ˜¯è®°å½•ä¸€ä¸‹ç”¨Puppeteerçš„ä¸€äº›snippetã€‚ ","date":"2021-03-05","objectID":"/puppeteer%E4%BD%BF%E7%94%A8%E4%BE%8B%E5%AD%90/:0:0","tags":["puppeteer","Nodejs"],"title":"Puppeteerä½¿ç”¨ä¾‹å­","uri":"/puppeteer%E4%BD%BF%E7%94%A8%E4%BE%8B%E5%AD%90/"},{"categories":[],"content":"è®¿é—®ç½‘ç«™åæˆªå›¾ const puppeteer = require('puppeteer'); const url = 'https://segmentfault.com'; (async() =\u003e { const browser = await puppeteer.launch({ headless: true, args: [\"--no-sandbox\", \"--single-process\"], }); const page = await browser.newPage(); await page.setViewport({ width: 1920, height: 1080 }); // â€˜networkidle2â€™ means that there are no more than 2 active requests open. // This is a good setting because for some websites (e.g. websites using websockets) there will always be connections open await page.goto(url, { waitUntil: 'networkidle2', timeout: 1000 * 60 * 5, // æ¯«ç§’ è¶…æ—¶å‚æ•°éœ€è¦åŠ ä¸Šï¼Œæœ‰æ—¶å€™ç½‘ç»œä¸å¥½ï¼Œä¼šå¯¼è‡´ç­‰ç€ }); await page.screenshot({path: './data/website.png', type: 'png'}); page.close(); browser.close(); })(); ","date":"2021-03-05","objectID":"/puppeteer%E4%BD%BF%E7%94%A8%E4%BE%8B%E5%AD%90/:1:0","tags":["puppeteer","Nodejs"],"title":"Puppeteerä½¿ç”¨ä¾‹å­","uri":"/puppeteer%E4%BD%BF%E7%94%A8%E4%BE%8B%E5%AD%90/"},{"categories":["JavaScript"],"content":"ES6 ECMAScript 2015æˆ–ES2015æ˜¯å¯¹JavaScriptç¼–ç¨‹è¯­è¨€çš„é‡å¤§æ›´æ–°ã€‚è¿™æ˜¯è‡ª2009å¹´å¯¹ES5è¿›è¡Œæ ‡å‡†åŒ–ä»¥æ¥å¯¹è¯­è¨€çš„é¦–æ¬¡é‡å¤§æ›´æ–°ï¼ŒES6åŠ å…¥å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ã€‚å› æ­¤ï¼ŒES2015é€šå¸¸è¢«ç§°ä¸ºES6ã€‚ æœ¬æ–‡ç¯å¢ƒï¼š NodeJsç‰ˆæœ¬ï¼šv12.13.0 OSï¼šUbuntu 18.04.4 LTS ","date":"2020-08-29","objectID":"/es6_class/:1:0","tags":["JavaScript","class"],"title":"ES6ä¸­çš„class","uri":"/es6_class/"},{"categories":["JavaScript"],"content":"classè¯­æ³•ç³– é¦–å…ˆæˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹å…³äº ES6 ä¸­çš„ç±» class Persion { say() { console.log('hello~') } } ä¸Šé¢è¿™æ®µä»£ç æ˜¯ ES6 ä¸­å®šä¹‰ä¸€ä¸ªç±»çš„å†™æ³•ï¼Œå…¶å®åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œè€Œå®é™…ä¸Šå½“æˆ‘ä»¬ç»™ä¸€ä¸ªç±»æ·»åŠ ä¸€ä¸ªå±æ€§çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨åˆ° Object.defineProperty è¿™ä¸ªæ–¹æ³•ï¼Œå®ƒä¼šæ¥å—ä¸‰ä¸ªå‚æ•°ï¼štarget ã€name å’Œ descriptor ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç å®é™…ä¸Šåœ¨æ‰§è¡Œæ—¶æ˜¯è¿™æ ·çš„ï¼š function Persion() {} Object.defineProperty(Persion.prototype, \"say\", { value: function() { console.log(\"hello ~\"); }, enumerable: false, configurable: true, writable: true }); ","date":"2020-08-29","objectID":"/es6_class/:2:0","tags":["JavaScript","class"],"title":"ES6ä¸­çš„class","uri":"/es6_class/"},{"categories":["JavaScript"],"content":"ES6ä¸­extends ES6ä¸­å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ç”¨extendsçš„å®ç°ç»§æ‰¿ï¼š class Shape { constructor(x, y) { this.x = x; this.y = y; } move(x, y) { this.x += x; this.y += y; console.info('Shape moved.'); } } class Rectangle extends Shape { constructor() { super(); // ES6 è¦æ±‚ï¼Œå­ç±»çš„æ„é€ å‡½æ•°å¿…é¡»æ‰§è¡Œä¸€æ¬¡ super å‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚ } } è¦ç”¨ES5å®ç°ç»§æ‰¿ï¼Œå°±æ˜¯ç”¨åˆ©ç”¨åŸå‹é“¾ã€‚ // Shape - çˆ¶ç±»(superclass) function Shape() { this.x = 0; this.y = 0; } // çˆ¶ç±»çš„æ–¹æ³• Shape.prototype.move = function(x, y) { this.x += x; this.y += y; console.info('Shape moved.'); }; // Rectangle - å­ç±»(subclass) function Rectangle() { Shape.call(this); // call super constructor. } // å­ç±»ç»­æ‰¿çˆ¶ç±» Rectangle.prototype = Object.create(Shape.prototype); Rectangle.prototype.constructor = Rectangle; var rect = new Rectangle(); console.log('Is rect an instance of Rectangle?', rect instanceof Rectangle); // true console.log('Is rect an instance of Shape?', rect instanceof Shape); // true rect.move(1, 1); // Outputs, 'Shape moved.' å‚è€ƒï¼š MDN Object create ","date":"2020-08-29","objectID":"/es6_class/:3:0","tags":["JavaScript","class"],"title":"ES6ä¸­çš„class","uri":"/es6_class/"},{"categories":["PHP"],"content":"ç¼˜ç”± æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³çœ‹çœ‹ä¸€ä¸ªå˜é‡åº•å±‚å¯¹åº”åº•å±‚çš„æ•°æ®ç»“æ„æˆ–è€…PHPè„šæœ¬æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Œgdbå°±æ˜¯è¿™æ ·ä¸€ä¸ªå¥½å·¥å…·ï¼Œä¹‹å‰æœ‰ç¯‡æ–‡ç« å†™è¿‡å¦‚ä½•ç®€å•ä½¿ç”¨gdbã€‚ æœ¬æ–‡ç¯å¢ƒï¼š PHPç‰ˆæœ¬ï¼šPHP 7.1.16 (cli) (built: Apr 8 2020 11:56:59) ( ZTS ) OSï¼šUbuntu 18.04.4 LTS gdb: GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git ","date":"2020-07-03","objectID":"/debug_php_source_code/:1:0","tags":["PHP","Linux"],"title":"è°ƒè¯•PHPæºç ","uri":"/debug_php_source_code/"},{"categories":["PHP"],"content":"ç¼–è¯‘ ä½ å¯ä»¥ä»PHPå®˜ç½‘ä¸‹è½½PHPæºç çš„å‹ç¼©åŒ…ï¼Œè€…æ˜¯ä»git.php.netï¼ˆæˆ–è€…æ˜¯githubçš„é•œåƒï¼‰çš„gitåº“cloneæœ€æ–°çš„ä»£ç åº“ï¼Œç„¶ååˆ‡æ¢åˆ°å¯¹åº”çš„PHPç‰ˆæœ¬çš„åˆ†æ”¯ï¼Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯PHP7.1ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å®Œæˆè¿™äº›å·¥ä½œï¼š git clone http://git.php.net/repository/php-src.git cd php-src git checkout PHP-7.1 å¦‚æœä½ æ˜¯ä»gitåº“ä¸­cloneçš„ä»£ç ï¼Œé‚£ä¹ˆä½ å…ˆè¦è¿è¡Œä¸‹buildconfå‘½ä»¤ï¼š ~/php-src\u003e ./buildconf è¿™ä¸ªå‘½ä»¤ä¼šç”Ÿæˆconfigureè„šæœ¬ï¼Œä»å®˜ç½‘ä¸‹è½½çš„æºç åŒ…ä¸­ä¼šç›´æ¥åŒ…å«è¿™ä¸ªè„šæœ¬ï¼Œå¦‚æœä½ æ‰§è¡Œbuildconfå‡ºé”™ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½æ˜¯å› ä¸ºä½ çš„ç³»ç»Ÿä¸­æ²¡æœ‰autoconfè¿™ä¸ªå·¥å…·ï¼Œä½ å¯ä»¥ä½¿ç”¨åŒ…å®‰è£…å·¥å…·è¿›è¡Œå®‰è£…ã€‚ å¦‚æœä½ å·²ç»æˆåŠŸç”Ÿæˆäº†configureè„šæœ¬æ–‡ä»¶ï¼ˆæˆ–è€…æ˜¯ä½¿ç”¨å·²åŒ…å«è¿™ä¸ªè„šæœ¬æ–‡ä»¶çš„æºç åŒ…ï¼‰ï¼Œé‚£å°±å¯ä»¥å¼€å§‹ç¼–è¯‘äº†ã€‚ä¸ºäº†è°ƒå¼PHPæºç ï¼Œæˆ‘ä»¬çš„ç¼–è¯‘ä¼šdisableæ‰€æœ‰çš„æ‰©å±•ï¼ˆé™¤äº†ä¸€äº›å¿…é¡»åŒ…å«çš„å¤–ï¼Œè¿™äº›PHPçš„ç¼–è¯‘è„šæœ¬ä¼šè‡ªè¡Œå¤„ç†ï¼‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥å®Œæˆç¼–è¯‘å®‰è£…çš„å·¥ä½œï¼Œå‡è®¾å®‰è£…çš„è·¯å¾„ä¸º$HOME/myphpï¼š ~/php-src\u003e ./configure --disable-all --enable-debug --prefix=$HOME/myphp ~/php-src\u003e make -jN ~/php-src\u003e make install æ³¨æ„è¿™é‡Œçš„prefixçš„å‚æ•°å¿…é¡»ä¸ºç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥ä½ ä¸èƒ½å†™æˆ~/myphpï¼Œå¦å¤–æˆ‘ä»¬è¿™æ¬¡ç¼–è¯‘åªæ˜¯ä¸ºäº†è°ƒå¼ï¼Œæ‰€ä»¥å»ºè®®ä¸€å®šè¦è®¾ç½®prefixå‚æ•°ï¼Œè¦ä¸ç„¶PHPä¼šè¢«å®‰è£…åˆ°é»˜è®¤è·¯å¾„ä¸­ï¼Œå¤§å¤šæ•°æ—¶å€™æ˜¯/usr/local/phpä¸­ï¼Œè¿™å¯èƒ½ä¼šé€ æˆä¸€äº›æ²¡å¿…è¦çš„æ±¡æŸ“ã€‚å¦å¤–æˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ä¸ªé€‰é¡¹ï¼Œä¸€ä¸ªæ˜¯â€“disable-allï¼Œè¿™ä¸ªè¡¨ç¤ºç¦æ­¢å®‰è£…æ‰€æœ‰æ‰©å±•ï¼ˆé™¤äº†ä¸€ä¸ªå¿…é¡»å®‰è£…çš„ï¼‰ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯â€“enable-debugï¼Œè¿™ä¸ªé€‰é¡¹è¡¨ç¤ºä»¥debugæ¨¡å¼ç¼–è¯‘PHPæºç ï¼Œç›¸å½“äºgccçš„-gé€‰é¡¹ï¼Œå®ƒä¼šæŠŠè°ƒè¯•ä¿¡æ¯ç¼–è¯‘è¿›æœ€ç»ˆçš„äºŒè¿›åˆ¶ç¨‹åºä¸­ã€‚ ä¸Šé¢çš„å‘½ä»¤make -jNï¼ŒNè¡¨ç¤ºä½ çš„CPUæ•°é‡ï¼ˆæˆ–è€…æ˜¯CPUæ ¸å¿ƒçš„æ•°é‡ï¼‰ï¼Œè®¾ç½®äº†è¿™ä¸ªå‚æ•°åå°±å¯ä»¥ä½¿ç”¨å¤šä¸ªCPUè¿›è¡Œå¹¶è¡Œç¼–è¯‘ï¼Œè¿™å¯ä»¥æé«˜ç¼–è¯‘æ•ˆç‡ã€‚ ","date":"2020-07-03","objectID":"/debug_php_source_code/:2:0","tags":["PHP","Linux"],"title":"è°ƒè¯•PHPæºç ","uri":"/debug_php_source_code/"},{"categories":["PHP"],"content":"è°ƒè¯•PHP æˆ‘ä»¬è°ƒè¯•ä¸€æ®µç®€å•çš„PHPä»£ç ï¼š \u003c?php $a = 10; $b = 42; echo $b; æˆ‘ä»¬æƒ³çœ‹ä¸‹$aå¯¹åº”çš„åº•å±‚å˜é‡ç»“æ„ï¼Œé‚£æˆ‘ä»¬åº”è¯¥åœ¨å“ªä¸ªå‡½æ•°ä¸Šå«æ–­ç‚¹å‘¢ï¼Ÿé€šè¿‡æŸ¥é˜…èµ„æ–™ï¼ˆå¦‚ã€ŠPHP7å†…æ ¸åˆ†æã€‹ï¼‰æˆ‘ä»¬å‘ç°ï¼ŒZendVMçš„æ‰§è¡Œå™¨å°±æ˜¯ä¸€ä¸ªwhiteå¾ªç¯ï¼Œåœ¨è¿™ä¸ªå¾ªç¯ä¸­ä¾æ¬¡è°ƒç”¨oplineæŒ‡ä»¤çš„handlerï¼Œç„¶åæ ¹æ®handlerçš„è¿”å›å†³å®šä¸‹ä¸€æ­¥çš„åŠ¨ä½œã€‚æ‰§è¡Œè°ƒåº¦å™¨ä¸ºzend_execute_exï¼Œè¿™æ˜¯å‡½æ•°æŒ‡é’ˆï¼Œé»˜è®¤ä¸ºexecute_exï¼Œæˆ‘ä»¬çœ‹ä¸‹è¿™ä¸ªå‡½æ•°çš„ä»£ç ï¼š //åˆ é™¤äº†é¢„å¤„ç†è¯­å¥ ZEND_API void execute_ex(zend_execute_data *ex) { DCL_OPLINE const zend_op *orig_opline = opline; zend_execute_data *orig_execute_data = execute_data; /* execute_dataæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ */ execute_data = ex; LOAD_OPLINE(); while (1) { ((opcode_handler_t)OPLINE-\u003ehandler)(ZEND_OPCODE_HANDLER_ARGS_PASSTHRU); //æ‰§è¡ŒOPCodeå¯¹åº”çš„Cå‡½æ•°ï¼ŒOPLINEæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ if (UNEXPECTED(!OPLINE)) { //å½“å‰OPArrayæ‰§è¡Œå®Œ execute_data = orig_execute_data; opline = orig_opline; return; } } zend_error_noreturn(E_CORE_ERROR, \"Arrived at end of main loop which shouldn't happen\"); } æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ç»™execute_exå‡½æ•°æ‰“æ–­ç‚¹ã€‚ gdb ~/myphp/bin/php (gdb) r index.php Starting program: /home/salamander/myphp/bin/php index.php Breakpoint 1, execute_ex (ex=0x7ffff7014030) at /home/salamander/php-7.1.16/Zend/zend_vm_execute.h:411 411 const zend_op *orig_opline = opline; (gdb) n 414 zend_execute_data *orig_execute_data = execute_data; (gdb) n 415 execute_data = ex; (gdb) n 421 LOAD_OPLINE(); (gdb) n 422 ZEND_VM_LOOP_INTERRUPT_CHECK(); (gdb) n 429 ((opcode_handler_t)OPLINE-\u003ehandler)(ZEND_OPCODE_HANDLER_ARGS_PASSTHRU); ç°åœ¨å°±è¦è°ƒç”¨oplineæŒ‡ä»¤çš„handlerï¼Œæˆ‘ä»¬åº”è¯¥é”®å…¥sï¼Œè·³åˆ°å¯¹åº”å‡½æ•°å†…éƒ¨å»ï¼š (gdb) s ZEND_ASSIGN_SPEC_CV_CONST_RETVAL_UNUSED_HANDLER () at /home/salamander/php-7.1.16/Zend/zend_vm_execute.h:39506 39506 SAVE_OPLINE(); (gdb) n 39507 value = EX_CONSTANT(opline-\u003eop2); (gdb) n 39508 variable_ptr = _get_zval_ptr_cv_undef_BP_VAR_W(execute_data, opline-\u003eop1.var); (gdb) n 39516 value = zend_assign_to_variable(variable_ptr, value, IS_CONST); (gdb) p value $1 = (zval *) 0x7ffff707b460 (gdb) p *$1 $3 = {value = {lval = 10, dval = 4.9406564584124654e-323, counted = 0xa, str = 0xa, arr = 0xa, obj = 0xa, res = 0xa, ref = 0xa, ast = 0xa, zv = 0xa, ptr = 0xa, ce = 0xa, func = 0xa, ww = {w1 = 10, w2 = 0}}, u1 = {v = {type = 4 '\\004', type_flags = 0 '\\000', const_flags = 0 '\\000', reserved = 0 '\\000'}, type_info = 4}, u2 = {next = 4294967295, cache_slot = 4294967295, lineno = 4294967295, num_args = 4294967295, fe_pos = 4294967295, fe_iter_idx = 4294967295, access_flags = 4294967295, property_guard = 4294967295, extra = 4294967295}} æˆ‘ä»¬ç¬¬ä¸€è¡ŒPHPä»£ç æ˜¯$a = 10;ï¼Œè¿™æ˜¯ä¸€æ¡èµ‹å€¼è¯­å¥,ZEND_ASSIGN_SPEC_CV_CONST_RETVAL_UNUSED_HANDLERæ˜¯æŠŠä¸€ä¸ªå¸¸é‡èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼ŒEX_CONSTANT(opline-\u003eop2)æ˜¯è·å–å¸¸é‡çš„å€¼ï¼Œ$aä¸ºCVå˜é‡ï¼Œåˆ†é…åœ¨zend_execute_dataåŠ¨æ€å˜é‡åŒºï¼Œé€šè¿‡_get_zval_ptr_cv_undef_BP_VAR_Wå–åˆ°è¿™ä¸ªå˜é‡çš„åœ°å€ï¼Œå‰©ä¸‹çš„å¥½ç†è§£äº†ï¼Œå°±æ˜¯æŠŠå˜é‡å€¼èµ‹å€¼ç»™CVå˜é‡ã€‚ valueå°±æ˜¯æˆ‘ä»¬çš„å˜é‡å€¼ï¼Œ$aå¯¹åº”çš„åº•å±‚å˜é‡å°±æ˜¯å®ƒã€‚ å›å¿†ä¸€ä¸‹PHP7å˜é‡çš„æ•°æ®ç»“æ„ï¼Œæ˜¯ä¸€ä¸ªå«zvalçš„ç»“æ„ä½“ï¼Œzend_valueä¿å­˜å…·ä½“çš„å˜é‡å€¼ï¼š typedef union _zend_value { zend_long lval; /* long value */ double dval; /* double value */ zend_refcounted *counted; zend_string *str; zend_array *arr; zend_object *obj; zend_resource *res; zend_reference *ref; zend_ast_ref *ast; zval *zv; void *ptr; zend_class_entry *ce; zend_function *func; struct { uint32_t w1; uint32_t w2; } ww; } zend_value; struct _zval_struct { zend_value value; /* value */ union { struct { ZEND_ENDIAN_LOHI_4( zend_uchar type, /* å˜é‡ç±»å‹ */ zend_uchar type_flags, zend_uchar const_flags, zend_uchar reserved) /* call info for EX(This) */ } v; uint32_t type_info; } u1; union { uint32_t next; /* hash collision chain */ uint32_t cache_slot; /* literal cache slot */ uint32_t lineno; /* line number (for ast nodes) */ uint32_t num_args; /* arguments number for EX(This) */ uint32_t fe_pos; /* foreach position */ uint32_t fe_iter_idx; /* foreach iterator index */ uint32_t access_flags; /* class constant access flags */ uint32_t property_guard; /* single property guard */ uint32_t extra; /* not further specified */ } u2; }; #define IS_UNDEF 0 #define IS_NULL 1 #define IS_FALSE 2 #define IS_TRUE 3 #define IS_LONG 4 #define IS_DOUBLE 5 #define IS_STRING 6 #define IS_ARRAY 7 #define IS_OBJECT 8 #define IS_RESOURCE 9 #define IS_REFERENCE 10 /* constant expressions */ #define IS_CONSTANT 11 #define IS_CONSTANT_AST 12 æˆ‘ä»¬æ‰“å°å‡ºæ¥çš„åº•å±‚å˜é‡ï¼Œlvalæ˜¯10ï¼Œu1é‡Œçš„typeæ˜¯4ï¼Œä¹Ÿæ­£å¥½æ˜¯IS_LONGï¼Œåˆ«çš„å­—æ®µçš„å€¼å¤§å®¶ä¹Ÿå¯ä»¥åˆ†æçœ‹çœ‹ã€‚ å‚è€ƒï¼š PH","date":"2020-07-03","objectID":"/debug_php_source_code/:3:0","tags":["PHP","Linux"],"title":"è°ƒè¯•PHPæºç ","uri":"/debug_php_source_code/"},{"categories":["Linux"],"content":"gdb gdb æ˜¯ UNIX åŠ UNIX-like ä¸‹çš„è°ƒè¯•å·¥å…·ï¼Œåœ¨ Linux ä¸‹ä¸€èˆ¬éƒ½ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ç”¨ gdb æ¥è°ƒè¯•ç¨‹åºï¼Œç›¸æ¯” Windows ä¸Šçš„é›†æˆå¼€å‘ç¯å¢ƒ IDE æä¾›çš„å›¾å½¢ç•Œé¢è°ƒè¯•ï¼Œä¸€å¼€å§‹ä½¿ç”¨ gdb è°ƒè¯•å¯èƒ½ä¼šè®©ä½ æ„Ÿè§‰å¾ˆéš¾é€‚åº”ï¼Œä½†æ˜¯åªè¦ç†Ÿæ‚‰äº† gdb è°ƒè¯•çš„å¸¸ç”¨å‘½ä»¤ï¼Œè°ƒè¯•å‡ºç¨‹åºä¼šå¾ˆæœ‰æˆå°±æ„Ÿï¼Œä¸€æ–¹é¢å› ä¸ºè¿™äº›å‘½ä»¤å°±ç±»ä¼¼å›¾å½¢ç•Œé¢è°ƒè¯•æŒ‰é’®èƒŒåçš„é€»è¾‘ï¼Œå¦ä¸€æ–¹é¢ç”¨å‘½ä»¤è¡Œæ¥è°ƒè¯•ç¨‹åºï¼Œé€¼æ ¼ç¬é—´å°±ä¸Šäº†ä¸€ä¸ªæ¡£æ¬¡ï¼Œè¿™æ¬¡å°±è·Ÿå¤§å®¶åˆ†äº« gdb è°ƒè¯•çš„åŸºæœ¬æŠ€æœ¯å’Œ 15 ä¸ªå¸¸ç”¨è°ƒè¯•å‘½ä»¤ã€‚ ","date":"2020-07-02","objectID":"/gdb_use/:1:0","tags":["gdb","Linux"],"title":"gdbè°ƒè¯•ç®€å•ä½¿ç”¨","uri":"/gdb_use/"},{"categories":["Linux"],"content":"ä½¿ç”¨ ","date":"2020-07-02","objectID":"/gdb_use/:2:0","tags":["gdb","Linux"],"title":"gdbè°ƒè¯•ç®€å•ä½¿ç”¨","uri":"/gdb_use/"},{"categories":["Linux"],"content":"gdbå¿«æ·é”®è¯´æ˜ ä¸€äº›å¿«æ·å‘½ä»¤ l â€“ list p â€“ print print {variable} //æ‰“å°å˜é‡ c â€“ continue //ç»§ç»­æ‰§è¡Œ s â€“ step b - break break line_number/break [file_name]:line_number/break [file_name]:func_name //è®¾ç½®æ–­ç‚¹ r - run //æ‰§è¡Œæ–‡ä»¶ ","date":"2020-07-02","objectID":"/gdb_use/:2:1","tags":["gdb","Linux"],"title":"gdbè°ƒè¯•ç®€å•ä½¿ç”¨","uri":"/gdb_use/"},{"categories":["Linux"],"content":"ä½¿ç”¨ ç¼–è¯‘å¯ä»¥è°ƒè¯•çš„ç¨‹åº è¿™æ˜¯æœ¬æ¬¡è¦è°ƒè¯•çš„ hello.c ç¨‹åºï¼Œéå¸¸ç®€å•ï¼š #include \u003cstdio.h\u003e int add(int x, int y) { return x + y; } int main() { int a = 1; int b = 2; printf(\"a = %d\\n\", a); printf(\"b = %d\\n\", b); int c = add(a, b); printf(\"%d + %d = %d\\n\", a, b, c); return 0; } æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨ gcc ç¼–è¯‘çš„ç¨‹åºå¦‚æœä¸åŠ  [-g] é€‰é¡¹ï¼š gcc hello.c -o hello gdb ä¼šæç¤ºè¯¥å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰è°ƒè¯•ç¬¦å·ï¼Œä¸èƒ½è°ƒè¯•ï¼š gdb hello ... Reading symbols from hello...(no debugging symbols found)...done. ... å¦‚æœéœ€è¦è®©ç¨‹åºå¯ä»¥è°ƒè¯•ï¼Œå°±**å¿…é¡»åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š ** [-g] å‚æ•° è½½å…¥è¦è°ƒè¯•çš„ç¨‹åº ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥è½½å…¥å¯æ‰§è¡Œæ–‡ä»¶ hello åˆ° gdb ä¸­ï¼š gdb hello è½½å…¥æˆåŠŸï¼Œgdb ä¼šæ‰“å°ä¸€æ®µæç¤ºä¿¡æ¯ï¼Œå¹¶ä¸”å‘½ä»¤è¡Œå‰ç¼€å˜ä¸º (gdb)ï¼Œä¸‹é¢æ˜¯æˆ‘çš„ Ubuntu è¾“å‡ºçš„ä¿¡æ¯ï¼š GNU gdb (Ubuntu 8.1-0ubuntu3.2) 8.1.0.20180409-git Copyright (C) 2018 Free Software Foundation, Inc. License GPLv3+: GNU GPL version 3 or later \u003chttp://gnu.org/licenses/gpl.html\u003e This is free software: you are free to change and redistribute it. There is NO WARRANTY, to the extent permitted by law. Type \"show copying\" and \"show warranty\" for details. This GDB was configured as \"x86_64-linux-gnu\". Type \"show configuration\" for configuration details. For bug reporting instructions, please see: \u003chttp://www.gnu.org/software/gdb/bugs/\u003e. Find the GDB manual and other documentation resources online at: \u003chttp://www.gnu.org/software/gdb/documentation/\u003e. For help, type \"help\". Type \"apropos word\" to search for commands related to \"word\"... Reading symbols from hello...done. (gdb) æ³¨ï¼ŒæŒ‰ q é€€å‡º gdb æ–¹æ³•äºŒ - ä½¿ç”¨ gdb æä¾›çš„ file å‘½ä»¤ ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨ gdb ç¯å¢ƒä¸­ä½¿ç”¨ file å‘½ä»¤ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè¿›å…¥ gdb ç¯å¢ƒä¸‹ï¼š gdb ä½¿ç”¨ file hello è½½å…¥å¾…è°ƒè¯•ç¨‹åºï¼š ... (gdb) file hello Reading symbols from hello...done. (gdb) q æŸ¥çœ‹è°ƒè¯•ç¨‹åº åœ¨ gdb ä¸‹æŸ¥çœ‹è°ƒè¯•ç¨‹åºä½¿ç”¨å‘½ä»¤ list æˆ–ç®€å†™ lï¼Œã€Œå›è½¦ã€åˆ—å‡ºåé¢ç¨‹åºï¼š (gdb) list 1 #include \u003cstdio.h\u003e 2 3 int add(int x, int y) { 4 return x + y; 5 } 6 7 int main() { 8 int a = 1; 9 int b = 2; 10 printf(\"a = %d\\n\", a); (gdb) æ·»åŠ æ–­ç‚¹ åœ¨ gdb ä¸‹æ·»åŠ æ–­ç‚¹ä½¿ç”¨å‘½ä»¤ break æˆ–ç®€å†™ bï¼Œæœ‰ä¸‹é¢å‡ ä¸ªå¸¸è§ç”¨æ³•ï¼ˆè¿™é‡Œç»Ÿä¸€ç”¨ bï¼‰ï¼š b function_name b row_num b file_name:row_num b row_num if condition æ¯”å¦‚æˆ‘ä»¬ä»¥ç¬¬ä¸€ä¸ªä¸ºä¾‹ï¼Œåœ¨ main å‡½æ•°ä¸Šæ·»åŠ æ–­ç‚¹ï¼š (gdb) b main Breakpoint 1 at 0x666: file hello.c, line 8. æ‰“å°çš„ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬åœ¨ hello.c æ–‡ä»¶çš„ç¬¬ 8 è¡Œï¼Œåœ°å€ 0x666 å¤„æ·»åŠ äº†ä¸€ä¸ªæ–­ç‚¹ï¼Œé‚£å¦‚ä½•æŸ¥çœ‹æ–­ç‚¹å‘¢ï¼Ÿ æŸ¥çœ‹æ–­ç‚¹ åœ¨ gdb ä¸‹æŸ¥çœ‹æ–­ç‚¹ä½¿ç”¨å‘½ä»¤ info break æˆ–ç®€å†™ i bï¼Œæ¯”å¦‚æŸ¥çœ‹åˆšæ‰æ‰“çš„æ–­ç‚¹ï¼š (gdb) i b Num Type Disp Enb Address What 1 breakpoint keep y 0x0000000000000666 in main at hello.c:8 åˆ é™¤æ–­ç‚¹ åœ¨ gdb ä¸‹åˆ é™¤æ–­ç‚¹ä½¿ç”¨å‘½ä»¤ delete æ–­ç‚¹ Num æˆ–ç®€å†™ d Numï¼Œæ¯”å¦‚åˆ é™¤åˆšæ‰çš„ Num = 1 çš„æ–­ç‚¹ï¼š (gdb) d 1 (gdb) i b No breakpoints or watchpoints. åˆ é™¤åå†æ¬¡æŸ¥çœ‹æ–­ç‚¹ï¼Œæç¤ºå½“å‰æ²¡æœ‰æ–­ç‚¹ï¼Œè¯´æ˜åˆ é™¤æˆåŠŸå•¦ï¼Œä¸‹é¢æ¥è¿è¡Œç¨‹åºè¯•è¯•ã€‚ è¿è¡Œç¨‹åº åœ¨ gdb ä¸‹ä½¿ç”¨å‘½ä»¤ run æˆ–ç®€å†™ r æ¥è¿è¡Œå½“å‰è½½å…¥çš„ç¨‹åºï¼š (gdb) r Starting program: /home/salamander/æ–‡æ¡£/test/hello a = 1 b = 2 1 + 2 = 3 [Inferior 1 (process 16249) exited normally] æˆ‘è¿™æ¬¡æ²¡æœ‰æ·»åŠ æ–­ç‚¹ï¼Œç¨‹åºå…¨é€Ÿè¿è¡Œï¼Œç„¶åæ­£å¸¸é€€å‡ºäº†ã€‚ å•æ­¥æ‰§è¡Œä¸‹ä¸€æ­¥ åœ¨ gdb ä¸‹ä½¿ç”¨å‘½ä»¤ next æˆ–ç®€å†™ n æ¥å•æ­¥æ‰§è¡Œä¸‹ä¸€æ­¥ï¼Œå‡è®¾æˆ‘ä»¬åœ¨ main æ‰“äº†æ–­ç‚¹ï¼š (gdb) b main Breakpoint 1 at 0x555555554666: file hello.c, line 8. (gdb) r Starting program: /home/salamander/æ–‡æ¡£/test/hello Breakpoint 1, main () at hello.c:8 8 int a = 1; (gdb) n 9 int b = 2; å¯ä»¥çœ‹åˆ°å½“å‰åœåœ¨ int a = 1; è¿™ä¸€è¡Œï¼ŒæŒ‰ n æ‰§è¡Œäº†ä¸‹ä¸€å¥ä»£ç  int b = 2; æ‰“å°å˜é‡ åœ¨ gdb ä¸­ä½¿ç”¨å‘½ä»¤ print var æˆ–ç®€å†™ p var æ¥æ‰“å°ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°çš„è¿”å›å€¼ï¼Œåœ¨ä¸Šè¿°gdbä¸­æ‰“å° a çš„å€¼ï¼š (gdb) b main Breakpoint 1 at 0x555555554666: file hello.c, line 8. (gdb) r Starting program: /home/salamander/æ–‡æ¡£/test/hello Breakpoint 1, main () at hello.c:8 8 int a = 1; (gdb) n 9 int b = 2; (gdb) n 10 printf(\"a = %d\\n\", a); (gdb) p a $1 = 1 å‚è€ƒï¼š Linux é«˜çº§ç¼–ç¨‹ - 15 ä¸ª gdb è°ƒè¯•åŸºç¡€å‘½ä»¤ ","date":"2020-07-02","objectID":"/gdb_use/:2:2","tags":["gdb","Linux"],"title":"gdbè°ƒè¯•ç®€å•ä½¿ç”¨","uri":"/gdb_use/"},{"categories":["Go"],"content":"éœ€æ±‚ æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå¼€å¯å¾ˆå¤šçº¿ç¨‹ï¼ˆgoä¸­æ˜¯åç¨‹ï¼‰å»åšä¸€ä»¶äº‹ä»¶ï¼Œç„¶åå¸Œæœ›ä¸»çº¿ç¨‹ç­‰å¾…è¿™äº›çº¿ç¨‹éƒ½å®Œæˆåæ‰ç»“æŸï¼Œä¸€ä¸ªç®€å•çš„æƒ³æ³•æ˜¯ï¼Œæˆ‘åœ¨ä¸»çº¿ç¨‹sleepä¸€æ®µæ—¶é—´ï¼Œè­¬å¦‚3sé’Ÿï¼Œä½†æ˜¯æ˜æ˜¾è¿™æ ·çš„åšæ³•ä¸ç§‘å­¦ï¼Œå› ä¸ºè¿™äº›ä»»åŠ¡å¾ˆæœ‰å¯èƒ½åœ¨200mså†…å°±éƒ½å®Œæˆäº†ã€‚å¦‚æœä½ ç”¨è¿‡Javaçš„è¯ï¼Œé‚£ä½ å¾ˆå¿«å°±ä¼šæƒ³åˆ°CountDownLatchç±»ï¼Œåœ¨Goä¸­ï¼Œä¹Ÿæœ‰ç±»ä¼¼çš„ç»“æ„ï¼Œå°±æ˜¯æœ¬æ–‡è¦è®¨è®ºçš„WaitGroupã€‚ ","date":"2020-06-15","objectID":"/go_sync_waitgroup/:1:0","tags":["Go"],"title":"goå¹¶å‘ä¹‹WaitGroupä½¿ç”¨","uri":"/go_sync_waitgroup/"},{"categories":["Go"],"content":"ä½¿ç”¨ ç¤ºä¾‹ä»£ç  package main import ( \"fmt\" \"sync\" \"time\" ) func main() { learnWaitGroup() } func learnWaitGroup() { num := 10 wg := sync.WaitGroup{} wg.Add(num) for i := 0; i \u003c num; i++ { go func(idx int) { fmt.Printf(\"%d Doing something...\\n\", idx) time.Sleep(time.Second) wg.Done() }(i) } wg.Wait() fmt.Println(\"All is done...\") } WaitGroup å¯¹è±¡å†…éƒ¨æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæœ€åˆä»0å¼€å§‹ï¼Œå®ƒæœ‰ä¸‰ä¸ªæ–¹æ³•ï¼šAdd(), Done(), Wait() ç”¨æ¥æ§åˆ¶è®¡æ•°å™¨çš„æ•°é‡ã€‚Add(n) æŠŠè®¡æ•°å™¨è®¾ç½®ä¸ºn ï¼ŒDone() æ¯æ¬¡æŠŠè®¡æ•°å™¨-1 ï¼ŒWait() ä¼šé˜»å¡ä»£ç çš„è¿è¡Œï¼Œç›´åˆ°è®¡æ•°å™¨åœ°å€¼å‡ä¸º0ã€‚ ","date":"2020-06-15","objectID":"/go_sync_waitgroup/:2:0","tags":["Go"],"title":"goå¹¶å‘ä¹‹WaitGroupä½¿ç”¨","uri":"/go_sync_waitgroup/"},{"categories":["Go"],"content":"æ³¨æ„é—®é¢˜ WaitGroupå¯¹è±¡ä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œæ‰€ä»¥åœ¨ä½œä¸ºå‚æ•°çš„æ—¶å€™ï¼Œä½ åº”è¯¥è¦ä½¿ç”¨æŒ‡é’ˆã€‚åœ¨ä¸Šé¢çš„ç¤ºä¾‹æå–ä¸€ä¸ªä»»åŠ¡å‡½æ•° package main import ( \"fmt\" \"sync\" \"time\" ) func main() { learnWaitGroup() } func learnWaitGroup() { num := 10 wg := sync.WaitGroup{} wg.Add(num) for i := 0; i \u003c num; i++ { go runTask(i, \u0026wg) } wg.Wait() fmt.Println(\"All is done...\") } func runTask(idx int, wg *sync.WaitGroup) { fmt.Printf(\"%d Doing something...\\n\", idx) time.Sleep(time.Second) wg.Done() } ","date":"2020-06-15","objectID":"/go_sync_waitgroup/:3:0","tags":["Go"],"title":"goå¹¶å‘ä¹‹WaitGroupä½¿ç”¨","uri":"/go_sync_waitgroup/"},{"categories":["Go"],"content":"Javaç±»æ¯” Javaä¸­å¯ä»¥ä½¿ç”¨CountDownLatchç±»å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå®ƒæš´éœ²å‡ºä¸‰ä¸ªæ–¹æ³•ï¼š // è°ƒç”¨æ­¤æ–¹æ³•çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ° CountDownLatch çš„ count ä¸º 0 public void await() throws InterruptedException // ä¼šå°† count å‡ 1ï¼Œç›´è‡³ä¸º 0 public void countDown() countDown() è·ŸWaitGroupçš„Done()å‡½æ•°ç±»ä¼¼ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾ˆå®¹æ˜“å®ç°çš„ public class Main { public static void main(String[] args) { try { testCountDownLatch(); } catch (Exception ex) { ex.printStackTrace(); } } static class TaskThread extends Thread { CountDownLatch latch; public TaskThread(CountDownLatch latch) { this.latch = latch; } @Override public void run() { try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } finally { System.out.println(getName() + \" Task is Done\"); latch.countDown(); } } } public static void testCountDownLatch() throws InterruptedException { final int threadNum = 10; CountDownLatch latch = new CountDownLatch(threadNum); for(int i = 0; i \u003c threadNum; i++) { TaskThread task = new TaskThread(latch); task.start(); } System.out.println(\"Task Start!\"); latch.await(); System.out.println(\"All Task is Done!\"); } } ","date":"2020-06-15","objectID":"/go_sync_waitgroup/:4:0","tags":["Go"],"title":"goå¹¶å‘ä¹‹WaitGroupä½¿ç”¨","uri":"/go_sync_waitgroup/"},{"categories":["Go","gRPC"],"content":"gRPCæ˜¯ä»€ä¹ˆ å®˜ç½‘å¦‚æ­¤å†™åˆ° A high-performance, open source universal RPC framework å…¶å®ï¼ŒgRPCæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ï¼Œé€šç”¨çš„ï¼Œé¢å‘æœåŠ¡ç«¯å’Œç§»åŠ¨ç«¯ï¼ŒåŸºäº HTTP/2 è®¾è®¡çš„RPCæ¡†æ¶ã€‚ ","date":"2020-06-02","objectID":"/grpc_learn/:1:0","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"RPCæ¡†æ¶æ˜¯ä»€ä¹ˆï¼Ÿ RPC æ¡†æ¶è¯´ç™½äº†å°±æ˜¯è®©ä½ å¯ä»¥åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·è°ƒç”¨è¿œç¨‹æœåŠ¡æä¾›çš„æ–¹æ³•ï¼Œè€Œä¸éœ€è¦å…³å¿ƒåº•å±‚çš„é€šä¿¡ç»†èŠ‚ã€‚ç®€å•åœ°è¯´å°±è®©è¿œç¨‹æœåŠ¡è°ƒç”¨æ›´åŠ ç®€å•ã€é€æ˜ã€‚ RPCæ¡†æ¶åŒ…å«äº†å®¢æˆ·ç«¯ï¼ˆClientï¼‰å’ŒæœåŠ¡ç«¯ï¼ˆServerï¼‰ å¸¸è§çš„RPCæ¡†æ¶æœ‰ gRPCã€‚è°·æ­Œå‡ºå“ Thriftã€‚Apacheå‡ºå“ Dubboã€‚é˜¿é‡Œå‡ºå“ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¡†æ¶ ","date":"2020-06-02","objectID":"/grpc_learn/:2:0","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"gRPCçš„ç‰¹æ€§ çœ‹å®˜æ–¹æ–‡æ¡£çš„ä»‹ç»ï¼Œæœ‰ä»¥ä¸‹4ç‚¹ç‰¹æ€§ï¼š ä½¿ç”¨Protocal Buffersè¿™ä¸ªå¼ºå¤§çš„ç»“æ„æ•°æ®åºåˆ—åŒ–å·¥å…· gRPCå¯ä»¥è·¨è¯­è¨€ä½¿ç”¨ å®‰è£…ç®€å•ï¼Œæ‰©å±•æ–¹ä¾¿ï¼ˆç”¨è¯¥æ¡†æ¶æ¯ç§’å¯è¾¾åˆ°ç™¾ä¸‡ä¸ªRPCï¼‰ åŸºäºHTTP2åè®® ","date":"2020-06-02","objectID":"/grpc_learn/:3:0","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"gRPCä½¿ç”¨æµç¨‹ å®šä¹‰æ ‡å‡†çš„protoæ–‡ä»¶ ç”Ÿæˆæ ‡å‡†ä»£ç ï¼ˆç”¨protocå·¥å…·ï¼‰ æœåŠ¡ç«¯ä½¿ç”¨ç”Ÿæˆçš„ä»£ç æä¾›æœåŠ¡ å®¢æˆ·ç«¯ä½¿ç”¨ç”Ÿæˆçš„ä»£ç è°ƒç”¨æœåŠ¡ ","date":"2020-06-02","objectID":"/grpc_learn/:4:0","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"Golangå®è·µ ","date":"2020-06-02","objectID":"/grpc_learn/:5:0","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"å®‰è£…protoc é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…protocï¼Œè¿™ä¸ªå·¥å…·æ˜¯Protocol Bufferçš„ç¼–è¯‘å™¨ï¼ŒæŠŠprotoæ–‡ä»¶ç¿»è¯‘æˆä¸åŒè¯­è¨€ï¼ˆJavaï¼ŒGoç­‰ï¼‰ã€‚ åœ°å€ï¼šprotobuf/releases è§£å‹æŠŠbinç›®å½•ä¸‹protocæ–‡ä»¶æ”¾åˆ°/usr/local/binç›®å½•ä¸‹å³å¯ã€‚ ","date":"2020-06-02","objectID":"/grpc_learn/:5:1","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"å®‰è£… protoc-gen-go protoc-gen-goæ˜¯Goçš„protocç¼–è¯‘æ’ä»¶ï¼Œprotobufå†…ç½®äº†è®¸å¤šé«˜çº§è¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œä½†æ²¡æœ‰Goçš„ã€‚ $ protoc -h ... --cpp_out=OUT_DIR Generate C++ header and source. --csharp_out=OUT_DIR Generate C# source file. --java_out=OUT_DIR Generate Java source file. --js_out=OUT_DIR Generate JavaScript source. --objc_out=OUT_DIR Generate Objective C header and source. --php_out=OUT_DIR Generate PHP source file. --python_out=OUT_DIR Generate Python source file. --ruby_out=OUT_DIR Generate Ruby source file. ... æˆ‘ä»¬å€ŸåŠ©Go Modulesæ¥å®‰è£…ï¼Œæ–°å»ºä¸€ä¸ªç›®å½•grpc-testï¼Œåœ¨ç›®å½•ä¸‹æ‰§è¡Œgo mod init grpc-teståˆ›å»ºä¸€ä¸ªModule å› ä¸ºå¢™çš„åŸå› ï¼Œæˆ‘ä»¬åœ¨go getä¹‹å‰è¦è®¾ç½®proxyï¼ˆæˆ–è€…æŠŠGOPROXYè®¾ç½®åˆ°.bashrcæ–‡ä»¶ä¸­ï¼‰ $ export GOPROXY=https://goproxy.cn ç„¶åæ‰§è¡Œ go get -u github.com/golang/protobuf/protoc-gen-go æ‰§è¡Œå®Œå°±å¯ä»¥åœ¨$GOPATHçš„binç›®å½•ä¸‹çœ‹åˆ°protoc-gen-goæ–‡ä»¶ã€‚ ","date":"2020-06-02","objectID":"/grpc_learn/:5:2","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"å®šä¹‰æœåŠ¡ åœ¨grpc-testç›®å½•ä¸‹æ–°å»ºä¸€ä¸ªprotosçš„ç›®å½•ï¼Œå†™å…¥hello.protoæ–‡ä»¶ syntax = \"proto3\"; package hello; option go_package = \"hellopb\"; message helloRequest { string name = 1; int64 age = 2; } message helloResponse { string greeting = 1; } service helloService { rpc Hello(helloRequest) returns (helloResponse) {}; } helloServiceå°±æ˜¯ç»™å¤–éƒ¨è°ƒç”¨çš„æœåŠ¡ ç„¶åæˆ‘ä»¬åˆ©ç”¨protocå·¥å…·æŠŠ .proto æ–‡ä»¶ç¿»è¯‘æˆéœ€è¦è¯­è¨€çš„ä»£ç ï¼ˆè¿™é‡Œæ˜¯goï¼‰ gen.shæ–‡ä»¶ï¼š #!/bin/bash protoDir=\"./protos\" outDir=\"./grpc\" protoc -I ${protoDir}/ ${protoDir}/*proto --go_out=plugins=grpc:${outDir} -Iï¼š æŒ‡å®šimportè·¯å¾„ï¼Œå¯ä»¥æŒ‡å®šå¤šä¸ª-Iå‚æ•°ï¼Œç¼–è¯‘æ—¶æŒ‰é¡ºåºæŸ¥æ‰¾ï¼Œä¸æŒ‡å®šé»˜è®¤å½“å‰ç›®å½• â€“go_outï¼šæŒ‡å®šgoè¯­è¨€çš„è®¿é—®ç±» pluginsï¼šæŒ‡å®šä¾èµ–çš„æ’ä»¶ è¿™ä¸ªbashä¼šæŠŠç”Ÿæˆçš„goä»£ç å†™åˆ°hellopbç›®å½•ä¸‹ã€‚ ","date":"2020-06-02","objectID":"/grpc_learn/:5:3","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"å®šä¹‰æœåŠ¡ç«¯ æˆ‘ä»¬éœ€è¦å»å®ç°hello.protoä¸­çš„helloService package main import ( \"context\" \"fmt\" \"google.golang.org/grpc\" \"grpc-test/hellopb\" \"log\" \"net\" ) type server struct { } func (*server) Hello(ctx context.Context, request *hellopb.HelloRequest) (*hellopb.HelloResponse, error) { name := request.Name response := \u0026hellopb.HelloResponse{ Greeting: \"Hello \" + name, } return response, nil } func main() { address := \"0.0.0.0:50051\" lis, err := net.Listen(\"tcp\", address) if err != nil { log.Fatalf(\"Error %v\", err) } fmt.Printf(\"Server is listening on %v ...\", address) s := grpc.NewServer() hellopb.RegisterHelloServiceServer(s, \u0026server{}) s.Serve(lis) } ","date":"2020-06-02","objectID":"/grpc_learn/:5:4","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["Go","gRPC"],"content":"å®šä¹‰å®¢æˆ·ç«¯ package main import ( \"context\" \"fmt\" \"grpc-test/hellopb\" \"google.golang.org/grpc\" \"log\" ) func main() { fmt.Println(\"Hello client ...\") opts := grpc.WithInsecure() cc, err := grpc.Dial(\"localhost:50051\", opts) if err != nil { log.Fatal(err) } defer cc.Close() client := hellopb.NewHelloServiceClient(cc) request := \u0026hellopb.HelloRequest{Name: \"Jeremy\", Age: 18} resp, _ := client.Hello(context.Background(), request) fmt.Printf(\"Receive response =\u003e [%v]\", resp.Greeting) } å‚è€ƒï¼š gRPCè¯¦ç»†å…¥é—¨æ•™ç¨‹ï¼ŒGolang/Python/PHPå¤šè¯­è¨€è®²è§£ ","date":"2020-06-02","objectID":"/grpc_learn/:5:5","tags":["rpc","go"],"title":"gRPCå…¥é—¨ä½¿ç”¨","uri":"/grpc_learn/"},{"categories":["c"],"content":"FTPåè®® ç›¸æ¯”å…¶ä»–åè®®ï¼Œå¦‚ HTTP åè®®ï¼ŒFTP åè®®è¦å¤æ‚ä¸€äº›ã€‚ä¸ä¸€èˆ¬çš„ C/S åº”ç”¨ä¸åŒç‚¹åœ¨äºä¸€èˆ¬çš„C/S åº”ç”¨ç¨‹åºä¸€èˆ¬åªä¼šå»ºç«‹ä¸€ä¸ª Socket è¿æ¥ï¼Œè¿™ä¸ªè¿æ¥åŒæ—¶å¤„ç†æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„è¿æ¥å‘½ä»¤å’Œæ•°æ®ä¼ è¾“ã€‚è€ŒFTPåè®®ä¸­å°†å‘½ä»¤ä¸æ•°æ®åˆ†å¼€ä¼ é€çš„æ–¹æ³•æé«˜äº†æ•ˆç‡ã€‚ æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.4 LTS è¿˜æœ‰ Windows 10ä¸“ä¸šç‰ˆ ftplibï¼šV4.0-1 gccï¼š 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04) ","date":"2020-05-13","objectID":"/ftplib_source/:1:0","tags":["c"],"title":"ftplibæºç åˆ†æ","uri":"/ftplib_source/"},{"categories":["c"],"content":"å‘½ä»¤ç»“æ„ FTP æ¯ä¸ªå‘½ä»¤éƒ½æœ‰ 3 åˆ° 4 ä¸ªå¤§å†™å­—æ¯ç»„æˆï¼Œå‘½ä»¤åé¢è·Ÿå‚æ•°ï¼Œç”¨ç©ºæ ¼åˆ†å¼€ã€‚æ¯ä¸ªå‘½ä»¤éƒ½ä»¥ â€œ\\r\\n\"ç»“æŸï¼ˆåº”ç­”ä¹Ÿæ˜¯ç”¨â€\\r\\n\"ç»“æŸï¼‰ï¼Œä¾‹å¦‚å‘é€ä¸€ä¸ªCWDå‘½ä»¤ï¼Œé‚£è¦è¦å‘é€æ•°æ®å°±æ˜¯ï¼šCWD dirname\\r\\nã€‚ å¸¸è§çš„FTPå‘½ä»¤æœ‰ï¼š ","date":"2020-05-13","objectID":"/ftplib_source/:1:1","tags":["c"],"title":"ftplibæºç åˆ†æ","uri":"/ftplib_source/"},{"categories":["c"],"content":"å“åº”ç»“æ„ FTPå“åº”è·Ÿå‘½ä»¤ç»“æ„æ˜¯ç±»ä¼¼çš„ã€‚ FTPå“åº”é€šå¸¸æ˜¯å•è¡Œçš„ï¼Œæ ¼å¼ä¸º\"å“åº”ç +ç©ºæ ¼+æç¤ºä¿¡æ¯+\\r\\n\"ã€‚å¦‚æœéœ€è¦äº§ç”Ÿä¸€æ¡å¤šè¡Œåº”ç­”ï¼Œç¬¬1è¡Œåœ¨ç¬¬3ä½æ•°å­—åº”ç­”ç ä¹‹ååŒ…å«ä¸€ä¸ªè¿å­—ç¬¦\"-\"ï¼Œè€Œä¸æ˜¯ç©ºæ ¼ï¼Œæœ€åä¸€è¡ŒåŒ…å«ç›¸åŒçš„3ä½æ•°å­—åº”ç­”ç ï¼Œåè·Ÿä¸€ä¸ªç©ºæ ¼å­—ç¬¦ã€‚ ","date":"2020-05-13","objectID":"/ftplib_source/:1:2","tags":["c"],"title":"ftplibæºç åˆ†æ","uri":"/ftplib_source/"},{"categories":["c"],"content":"FTPå“åº”ç  å®¢æˆ·ç«¯å‘é€ FTP å‘½ä»¤åï¼ŒæœåŠ¡å™¨è¿”å›å“åº”ç ã€‚ å“åº”ç ç”¨ä¸‰ä½æ•°å­—ç¼–ç è¡¨ç¤ºï¼š ç¬¬ä¸€ä¸ªæ•°å­—ç»™å‡ºäº†å‘½ä»¤çŠ¶æ€çš„ä¸€èˆ¬æ€§æŒ‡ç¤ºï¼Œæ¯”å¦‚å“åº”æˆåŠŸã€å¤±è´¥æˆ–ä¸å®Œæ•´ã€‚ ç¬¬äºŒä¸ªæ•°å­—æ˜¯å“åº”ç±»å‹çš„åˆ†ç±»ï¼Œå¦‚ 2 ä»£è¡¨è·Ÿè¿æ¥æœ‰å…³çš„å“åº”ï¼Œ3 ä»£è¡¨ç”¨æˆ·è®¤è¯ã€‚ ç¬¬ä¸‰ä¸ªæ•°å­—æä¾›äº†æ›´åŠ è¯¦ç»†çš„ä¿¡æ¯ã€‚ ç¬¬ä¸€ä¸ªæ•°å­—çš„å«ä¹‰å¦‚ä¸‹ï¼š 1 è¡¨ç¤ºæœåŠ¡å™¨æ­£ç¡®æ¥æ”¶ä¿¡æ¯ï¼Œè¿˜æœªå¤„ç†ã€‚ 2 è¡¨ç¤ºæœåŠ¡å™¨å·²ç»æ­£ç¡®å¤„ç†ä¿¡æ¯ã€‚ 3 è¡¨ç¤ºæœåŠ¡å™¨æ­£ç¡®æ¥æ”¶ä¿¡æ¯ï¼Œæ­£åœ¨å¤„ç†ã€‚ 4 è¡¨ç¤ºä¿¡æ¯æš‚æ—¶é”™è¯¯ã€‚ 5 è¡¨ç¤ºä¿¡æ¯æ°¸ä¹…é”™è¯¯ã€‚ ç¬¬äºŒä¸ªæ•°å­—çš„å«ä¹‰å¦‚ä¸‹ï¼š 0 è¡¨ç¤ºè¯­æ³•ã€‚ 1 è¡¨ç¤ºç³»ç»ŸçŠ¶æ€å’Œä¿¡æ¯ã€‚ 2 è¡¨ç¤ºè¿æ¥çŠ¶æ€ã€‚ 3 è¡¨ç¤ºä¸ç”¨æˆ·è®¤è¯æœ‰å…³çš„ä¿¡æ¯ã€‚ 4 è¡¨ç¤ºæœªå®šä¹‰ã€‚ 5 è¡¨ç¤ºä¸æ–‡ä»¶ç³»ç»Ÿæœ‰å…³çš„ä¿¡æ¯ã€‚ ","date":"2020-05-13","objectID":"/ftplib_source/:1:3","tags":["c"],"title":"ftplibæºç åˆ†æ","uri":"/ftplib_source/"},{"categories":["c"],"content":"ä¾‹å­ ç”¨å®¢æˆ·ç«¯ç™»å½• FTP æœåŠ¡å™¨ä¸ºä¾‹å­ å¤§è‡´è°ƒç”¨å‡½æ•°è¿‡ç§°ä¸ºï¼š /* å‘½ä»¤ â€USER username\\r\\nâ€ */ sprintf(send_buf,\"USER %s\\r\\n\",username); /*å®¢æˆ·ç«¯å‘é€ç”¨æˆ·ååˆ°æœåŠ¡å™¨ç«¯ */ write(control_sock, send_buf, strlen(send_buf)); /* å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡å™¨çš„å“åº”ç å’Œä¿¡æ¯ï¼Œæ­£å¸¸ä¸º â€331 User name okay, need password.â€ */ read(control_sock, read_buf, read_len); /* å‘½ä»¤ â€PASS password\\r\\nâ€ */ sprintf(send_buf,\"PASS %s\\r\\n\",password); /* å®¢æˆ·ç«¯å‘é€å¯†ç åˆ°æœåŠ¡å™¨ç«¯ */ write(control_sock, send_buf, strlen(send_buf)); /* å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡å™¨çš„å“åº”ç å’Œä¿¡æ¯ï¼Œæ­£å¸¸ä¸º â€230 User logged in, proceed.â€ */ read(control_sock, read_buf, read_len); ","date":"2020-05-13","objectID":"/ftplib_source/:1:4","tags":["c"],"title":"ftplibæºç åˆ†æ","uri":"/ftplib_source/"},{"categories":["c"],"content":"æºç åˆ†æ ftplibåœ¨è¿™é‡Œä¸‹è½½ã€‚ ç™»å½•äº†FTPæœåŠ¡å™¨åï¼Œè‚¯å®šéœ€è¦ä¸€ä¸ªå¥æŸ„çš„é‡ï¼Œåœ¨è¿™ä¸ªftplibä¸­æ˜¯netbufï¼š typedef struct NetBuf netbuf; struct NetBuf { char *cput,*cget; int handle; int cavail,cleft; char *buf; int dir; netbuf *ctrl; netbuf *data; int cmode; struct timeval idletime; FtpCallback idlecb; void *idlearg; unsigned long int xfered; unsigned long int cbbytes; unsigned long int xfered1; char response[RESPONSE_BUFSIZ]; }; handleå­—æ®µå…¶å®å°±å­˜äº†tcpæ¡æ‰‹æˆåŠŸåçš„socketã€‚ ","date":"2020-05-13","objectID":"/ftplib_source/:2:0","tags":["c"],"title":"ftplibæºç åˆ†æ","uri":"/ftplib_source/"},{"categories":["c"],"content":"FtpSendCmdå‡½æ•° é¦–å…ˆæ¥çœ‹FtpSendCmdå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ç”¨æ¥å‘é€FTPå‘½ä»¤ï¼Œä½ åœ¨FtpPwdã€FtpNlstã€FtpDirã€FtpGetç­‰å‡½æ•°ä¸­éƒ½å¯ä»¥çœ‹åˆ°å®ƒï¼š static int FtpSendCmd(const char *cmd, char expresp, netbuf *nControl) { char buf[TMP_BUFSIZ]; if (nControl-\u003edir != FTPLIB_CONTROL) return 0; if (ftplib_debug \u003e 2) fprintf(stderr,\"%s\\n\",cmd); if ((strlen(cmd) + 3) \u003e sizeof(buf)) return 0; sprintf(buf,\"%s\\r\\n\",cmd); if (net_write(nControl-\u003ehandle, buf, strlen(buf)) \u003c= 0) { if (ftplib_debug) perror(\"write\"); return 0; } return readresp(expresp, nControl); } è¿™ä¸ªå‡½æ•°çš„è¿‡ç¨‹ï¼š ç”¨net_writeå‡½æ•°æ“ä½œsocketå‘é€æ•°æ® readrespå‡½æ•°è¯»å–æœåŠ¡å™¨å“åº” net_writeå‡½æ•° æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹net_writeï¼Œå…¶å®å®ƒå°±æ˜¯å°è£…äº†ä¸€ä¸‹writeå‡½æ•°ï¼Œå› ä¸ºTCPé€šä¿¡å¯¹äºåº”ç”¨ç¨‹åºæ¥è¯´æ˜¯å®Œå…¨å¼‚æ­¥ï¼Œä½ è°ƒç”¨writeå†™å…¥5ä¸ªå­—èŠ‚ï¼Œè¿”å›ä¸ä¸€å®šæ˜¯5ä¸ªå­—èŠ‚ï¼Œå¯èƒ½æ˜¯3ä¸ªï¼Œ4ä¸ªï¼Œæ‰€ä»¥net_writeå¤šæ¬¡è°ƒç”¨äº†writeï¼ˆåœ¨ã€ŠUNIXç½‘ç»œç¼–ç¨‹ å·1ã€‹ä¸­ï¼Œä½œè€…ä¹Ÿæœ‰ç±»ä¼¼çš„å°è£…ï¼‰ã€‚å¦å¤–ï¼Œwriteè¿”å›æˆåŠŸäº†ä¹Ÿåªä»£è¡¨bufä¸­çš„æ•°æ®è¢«å¤åˆ¶åˆ°äº†kernelä¸­çš„TCPå‘é€ç¼“å†²åŒºï¼Œè‡³äºæ•°æ®ä»€ä¹ˆæ—¶å€™è¢«å‘å¾€ç½‘ç»œï¼Œä»€ä¹ˆæ—¶å€™è¢«å¯¹æ–¹ä¸»æœºæ¥æ”¶ï¼Œä»€ä¹ˆæ—¶å€™è¢«å¯¹æ–¹è¿›ç¨‹è¯»å–ï¼Œç³»ç»Ÿè°ƒç”¨å±‚é¢ä¸ä¼šç»™äºˆä»»ä½•ä¿è¯å’Œé€šçŸ¥ã€‚ int net_write(int fd, const char *buf, size_t len) { int done = 0; while ( len \u003e 0 ) { int c = write( fd, buf, len ); if ( c == -1 ) { if ( errno != EINTR \u0026\u0026 errno != EAGAIN ) return -1; } else if ( c == 0 ) { return done; } else { buf += c; done += c; len -= c; } } return done; } readrespå‡½æ•° å‘é€äº†FTPçš„å‘½ä»¤æ•°æ®åï¼Œå°±éœ€è¦ç”¨socketæ¥å—å“åº”æ•°æ®äº†ï¼Œåˆ‡è®°TCPæ˜¯æµå¼ä¼ è¾“çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦è‡ªå·±åšåº”ç”¨å±‚çš„è§£æã€‚ FTPçš„æ¶ˆæ¯å—çš„åˆ†å‰²ç¬¦æ˜¯\\r\\nï¼Œçœ‹readlineå‡½æ•°ååº”è¯¥æ˜¯è¯»å–ä¸€è¡Œæ•°æ® static int readresp(char c, netbuf *nControl) { char match[5]; if (readline(nControl-\u003eresponse, RESPONSE_BUFSIZ, nControl) == -1) { if (ftplib_debug) perror(\"Control socket read failed\"); return 0; } if (ftplib_debug \u003e 1) fprintf(stderr,\"%s\",nControl-\u003eresponse); if (nControl-\u003eresponse[3] == '-') { strncpy(match,nControl-\u003eresponse,3); match[3] = ' '; match[4] = '\\0'; do { if (readline(nControl-\u003eresponse, RESPONSE_BUFSIZ, nControl) == -1) { if (ftplib_debug) perror(\"Control socket read failed\"); return 0; } if (ftplib_debug \u003e 1) fprintf(stderr,\"%s\",nControl-\u003eresponse); } while (strncmp(nControl-\u003eresponse, match, 4)); } if (nControl-\u003eresponse[0] == c) return 1; return 0; } readlineå‡½æ•° static int readline(char *buf, int max, netbuf *ctl) { int x, retval = 0; char *end,*bp=buf; int eof = 0; if ((ctl-\u003edir != FTPLIB_CONTROL) \u0026\u0026 (ctl-\u003edir != FTPLIB_READ)) return -1; if (max == 0) return 0; do { if (ctl-\u003ecavail \u003e 0) { x = (max \u003e= ctl-\u003ecavail) ? ctl-\u003ecavail : max-1; end = memccpy(bp, ctl-\u003ecget, '\\n',x); if (end != NULL) x = end - bp; retval += x; bp += x; *bp = '\\0'; max -= x; ctl-\u003ecget += x; ctl-\u003ecavail -= x; if (end != NULL) { bp -= 2; if (strcmp(bp,\"\\r\\n\") == 0) { *bp++ = '\\n'; *bp++ = '\\0'; --retval; } break; } } if (max == 1) { *buf = '\\0'; break; } if (ctl-\u003ecput == ctl-\u003ecget) { ctl-\u003ecput = ctl-\u003ecget = ctl-\u003ebuf; ctl-\u003ecavail = 0; ctl-\u003ecleft = FTPLIB_BUFSIZ; } if (eof) { if (retval == 0) retval = -1; break; } if (!socket_wait(ctl)) return retval; if ((x = net_read(ctl-\u003ehandle, ctl-\u003ecput, ctl-\u003ecleft)) == -1) { if (ftplib_debug) perror(\"read\"); retval = -1; break; } if (x == 0) eof = 1; ctl-\u003ecleft -= x; ctl-\u003ecavail += x; ctl-\u003ecput += x; } while (1); return retval; } socket_wait()å‡½æ•° è¿™ä¸ªå‡½æ•°ç”¨äº†selectç³»ç»Ÿå‡½æ•°ï¼Œç”¨æ¥æ£€æµ‹ctl-\u003ehandleæ˜¯å¦å¯è¯»ï¼ˆè¿™é‡Œå¯è¯»çš„æ—¶å€™å°±æ˜¯æœåŠ¡ç«¯å‘è¿‡æ¥å“åº”æ•°æ®äº†ï¼‰ã€‚selectå‡½æ•°çš„è¿”å›å€¼ï¼šè¿”å›-1è¡¨ç¤ºè°ƒç”¨selectå‡½æ•°æ—¶æœ‰é”™è¯¯å‘ç”Ÿï¼Œå…·ä½“çš„é”™è¯¯åœ¨Linuxå¯é€šè¿‡errnoè¾“å‡ºæ¥æŸ¥çœ‹ï¼›è¿”å›0ï¼Œè¡¨ç¤ºselectå‡½æ•°è¶…æ—¶ï¼›è¿”å›æ­£æ•°å³è°ƒç”¨selectå‡½æ•°æˆåŠŸï¼Œè¡¨ç¤ºé›†åˆä¸­æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ï¼Œé›†åˆä¹Ÿä¼šè¢«ä¿®æ”¹ä»¥æ˜¾ç¤ºå“ªä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å·²å‡†å¤‡å°±ç»ªã€‚ ä¸è¿‡åœ¨ç”¨æ¥å‘é€å‘½ä»¤çš„socketä¸Šï¼ˆä¹Ÿå°±æ˜¯è°ƒç”¨FtpConnectå‡½æ•°å¾—åˆ°çš„é‚£ä¸ªsocketï¼‰ï¼Œå› ä¸ºctl-\u003ediræ˜¯FTPLIB_CONTROLï¼ˆctl-\u003eidlecbä¹Ÿæ˜¯NULLï¼‰ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›äº†1ã€‚ /* * socket_wait - wait for socket to receive or flush data * * return 1 if no user callback, otherwise, return value returned by * user callback */ static int socket_wait(netbuf *ctl) { fd_set fd,*rfd = NULL,*wfd = NULL; struct timeval tv; int rv = 0; if ((ctl-\u003edir == FTPLIB_CONTROL) || (ctl-\u003eidlecb == NULL)) return 1; if (ctl-\u003edir == FTPLIB_WRITE) wfd = \u0026fd; else rfd = \u0026fd; FD_ZERO(\u0026fd); do { FD_SET(ctl-\u003ehandle,\u0026fd); tv = ctl-\u003eidletime; rv = select(ctl-\u003ehandle+1, rfd, wfd, NULL, \u0026tv); if (rv == -1) { rv = 0; strncpy(ctl-\u003ectrl-\u003eresponse, strerror(errno), sizeof(ctl-\u003ectrl-\u003eresponse)); break; } else if (rv \u003e 0) { rv = 1; break; } } while ((rv = ctl-\u003eidlecb(ctl, ctl-\u003exfered, ctl-\u003eidlearg))); return rv; } net_readå‡½æ•° è¿™ä¸ªå‡½æ•°ç®€å•ï¼Œç”¨äº†readå‡½æ•°è¯»åˆ°äº†æ•°æ®ï¼Œå°±ç«‹é©¬è¿”å›ï¼Œä½†ä¹Ÿè¦æ³¨æ„ï¼Œä½ è¯»10ä¸ªå­—èŠ‚ï¼Œä¹Ÿä¸ä¸€å®šèƒ½è¯»å–10ä¸ªå­—èŠ‚ï¼Œå¯èƒ½ä¼šæ¯”10ä¸ªå­—èŠ‚å°ï¼Œå› ä¸ºreadæ€»æ˜¯åœ¨æ¥æ”¶ç¼“å†²åŒºæœ‰","date":"2020-05-13","objectID":"/ftplib_source/:2:1","tags":["c"],"title":"ftplibæºç åˆ†æ","uri":"/ftplib_source/"},{"categories":["C"],"content":"åŠ¨æ€é“¾æ¥åº“å’Œé™æ€é“¾æ¥åº“ é™æ€é“¾æ¥åº“ä¼šåœ¨ç¼–è¯‘æ—¶åŒ…å«åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œè¿™æ ·çš„ç¨‹åºè™½ç„¶æ²¡æœ‰ä¾èµ–é—®é¢˜ï¼Œä½†æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ä½“ç§¯è¾ƒå¤§ï¼ŒåŒ…å«ç›¸åŒçš„å…¬å…±ä»£ç ï¼Œéå¸¸æµªè´¹å†…å­˜ã€‚ åŠ¨æ€é“¾æ¥åº“çš„å¥½å¤„å°±æ˜¯èŠ‚çœå†…å­˜ç©ºé—´ï¼Œè¿˜æœ‰å°†ä¸€äº›ç¨‹åºå‡çº§å˜å¾—ç®€å•ã€‚ç”¨æˆ·åªéœ€è¦å‡çº§åŠ¨æ€é“¾æ¥åº“ï¼Œè€Œæ— éœ€é‡æ–°ç¼–è¯‘é“¾æ¥å…¶ä»–åŸæœ‰çš„ä»£ç å°±å¯ä»¥å®Œæˆæ•´ä¸ªç¨‹åºçš„å‡çº§ã€‚ åœ¨windowsä¸‹åŠ¨æ€é“¾æ¥åº“æ˜¯ä»¥.dllåç¼€çš„æ–‡ä»¶ï¼Œé™æ€é“¾æ¥åº“æ˜¯ä»¥.libçš„æ–‡ä»¶ è€Œåœ¨Linuxä¸­ï¼ŒåŠ¨æ€é“¾æ¥åº“æ˜¯ä»¥.soä½œåç¼€çš„æ–‡ä»¶ï¼Œé™æ€é“¾æ¥åº“æ˜¯ä»¥.aï¼ˆarchiveçš„ç¼©å†™ï¼‰çš„æ–‡ä»¶ã€‚ æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬çš„é“¾æ¥åº“æ¥è‡ªäºftplibï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨Cè¯­è¨€å®ç°çš„è·¨å¹³å°FTPåº“ï¼Œæˆ‘ä»¬å°†ä¼šç”¨å®ƒç”Ÿæˆçš„åŠ¨æ€é“¾æ¥åº“å†™ä¸ªç®€å•çš„ç¨‹åºï¼ˆè¿æ¥ftpæœåŠ¡å™¨ï¼Œç„¶åæŸ¥è¯¢å½“å‰ç›®å½•ï¼‰ã€‚ æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.4 LTS è¿˜æœ‰ Windows 10ä¸“ä¸šç‰ˆ ftplibï¼šV4.0-1 gccï¼š 7.5.0 (Ubuntu 7.5.0-3ubuntu1~18.04) ","date":"2020-05-03","objectID":"/c_dynamic-linkc/:1:0","tags":["C"],"title":"Cè¯­è¨€åŠ¨æ€é“¾æ¥åº“å›é¡¾","uri":"/c_dynamic-linkc/"},{"categories":["C"],"content":"Linuxä¸‹ åœ¨Linuxä¸­ï¼Œæ ‡å‡†åº“çš„å¤§éƒ¨åˆ†å‡½æ•°é€šå¸¸æ”¾åœ¨æ–‡ä»¶ libc.a ä¸­ï¼ˆè¿™æ˜¯é™æ€é“¾æ¥åº“ï¼‰ï¼Œæˆ–è€…æ”¾åœ¨ç”¨äºå…±äº«çš„åŠ¨æ€é“¾æ¥æ–‡ä»¶ libc.so ä¸­ï¼ˆæ–‡ä»¶ååç¼€.soä»£è¡¨â€œshare objectâ€ï¼Œè¯‘ä¸ºâ€œå…±äº«å¯¹è±¡â€ï¼Œè¿™æ˜¯åŠ¨æ€é“¾æ¥åº“ï¼‰ã€‚è¿™äº›é“¾æ¥åº“ä¸€èˆ¬ä½äº /lib/ æˆ– /usr/lib/ï¼Œæˆ–è€…ä½äº GCC é»˜è®¤æœç´¢çš„å…¶ä»–ç›®å½•ï¼ˆé»˜è®¤æœç´¢ç›®å½•æœ‰/lib /usr/lib /usr/local/libï¼‰ã€‚ è§‚å¯Ÿä¸€ä¸‹ftplibçš„Makefile .... install : all install qftp /usr/local/bin install -m 644 libftp.so.$(SOVERSION) /usr/local/lib install -m 644 ftplib.h /usr/local/include (cd /usr/local/lib \u0026\u0026 \\ ln -sf libftp.so.$(SOVERSION) libftp.so.$(SONAME) \u0026\u0026 \\ ln -sf libftp.so.$(SONAME) libftp.so) -(cd /usr/local/bin \u0026\u0026 \\ for f in ftpdir ftpget ftplist ftprm ftpsend; \\ do ln -s qftp $$f; done) ... make installçš„æ—¶å€™ä¼šæŠŠftplib.hæ”¾åˆ°/usr/local/includeï¼ŒæŠŠlibftp.soæ”¾åˆ°/usr/local/libï¼Œä¸€ä¸ªæ˜¯gccé»˜è®¤çš„å¤´æ–‡ä»¶æœç´¢ç›®å½•ï¼Œä¸€ä¸ªæ˜¯gccé»˜è®¤çš„åº“æ–‡ä»¶æœç´¢ç›®å½•ã€‚ ","date":"2020-05-03","objectID":"/c_dynamic-linkc/:2:0","tags":["C"],"title":"Cè¯­è¨€åŠ¨æ€é“¾æ¥åº“å›é¡¾","uri":"/c_dynamic-linkc/"},{"categories":["C"],"content":"å®‰è£…åŠ¨æ€é“¾æ¥åº“ åœ¨ftplibçš„srcç›®å½•ä¸­æ‰§è¡Œ make sudo make install ä»¥ä¸Šæ“ä½œä¼šæŠŠåŠ¨æ€é“¾æ¥åº“æ”¾å…¥åˆ°æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ã€‚ ","date":"2020-05-03","objectID":"/c_dynamic-linkc/:3:0","tags":["C"],"title":"Cè¯­è¨€åŠ¨æ€é“¾æ¥åº“å›é¡¾","uri":"/c_dynamic-linkc/"},{"categories":["C"],"content":"ç¨‹åºå¼•ç”¨ ç„¶åæˆ‘ä»¬å†™ä¸€ä¸ªç®€å•çš„ç¨‹åº #include \u003cstdio.h\u003e #include \"ftplib.h\" netbuf *con = NULL; char host[] = \"192.168.1.175:2121\"; // å°ç±³æ‰‹æœºçš„ftpæœåŠ¡ char username[] = \"**********\"; char password[] = \"********\"; int main() { if(!FtpConnect(host, \u0026con)) { printf(\"connect failed!!\\n\"); return 0; } // ç™»å½• if(!FtpLogin(username, password, con)) { printf(\"login failed!\\n\"); FtpQuit(con); return 0; } printf(\"Login successfully!\\n\"); char currentDir[20]; FtpPwd(currentDir, 10, con); printf(\"Current Directory is %s\\n\", currentDir); FtpQuit(con); return 0; } å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç”¨gccç¼–è¯‘å®ƒäº†ï¼Œå› ä¸ºè¿™é‡Œå¼•ç”¨äº†ftplibåº“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ·»åŠ é“¾æ¥åº“ gcc main.c -o main /usr/local/lib/libftp.so ä¸Šé¢ä½¿ç”¨äº†é“¾æ¥åº“çš„å®Œæ•´è·¯å¾„ï¼Œå…¶å®æˆ‘ä»¬å¯ä»¥ç”¨-lé€‰é¡¹ï¼Œå› ä¸ºç”Ÿæˆçš„é“¾æ¥åº“å‘½åæ˜¯è§„èŒƒçš„ï¼ˆ-lXXä¼šå»æ‰¾libxx.soè¿™æ ·çš„æ–‡ä»¶ï¼Œè‡ªåŠ¨åŠ libå‰ç¼€ï¼‰è€Œä¸”ä¹Ÿåœ¨gccçš„é»˜è®¤æœç´¢ç›®å½•ä¸­ gcc main.c -o main -lftp å¦å¤–è¯´ä¸€å¥ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬æƒ³å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„æœç´¢ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨-Lé€‰é¡¹ï¼Œä¾‹å¦‚ gcc main.c -o main.out -L/usr/lib -lhello å¦å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡LD_LIBRARY_PATHæŒ‡å®šæœç´¢ç›®å½•ï¼ˆåœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰å®šä¹‰è¿™ä¸ªé‡å°±è¡Œï¼‰ï¼Œè·¯å¾„ä¹‹é—´ç”¨å†’å·â€:â€åˆ†éš”ã€‚ æˆ‘ä»¬å¯ä»¥ç”¨lddå‘½ä»¤æŸ¥çœ‹ç¨‹åºç”¨åˆ°çš„é“¾æ¥åº“ï¼š $ ldd main linux-vdso.so.1 (0x00007fff7a7fa000) libftp.so.4 =\u003e /usr/local/lib/libftp.so.4 (0x00007f7b5215a000) libc.so.6 =\u003e /lib/x86_64-linux-gnu/libc.so.6 (0x00007f7b51d69000) /lib64/ld-linux-x86-64.so.2 (0x00007f7b52563000) å‚è€ƒï¼š Shared libraries with GCC on Linux ","date":"2020-05-03","objectID":"/c_dynamic-linkc/:3:1","tags":["C"],"title":"Cè¯­è¨€åŠ¨æ€é“¾æ¥åº“å›é¡¾","uri":"/c_dynamic-linkc/"},{"categories":["Docker","Linux"],"content":" æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.4 LTS Golangç‰ˆæœ¬ï¼š1.12.13 ","date":"2020-04-28","objectID":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/:0:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Dockerç½‘ç»œåŸç†","uri":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/"},{"categories":["Docker","Linux"],"content":"è‡ªå·±åˆ›å»ºDockerç½‘ç»œ å½“ Docker å¯åŠ¨æ—¶ï¼Œä¼šè‡ªåŠ¨åœ¨ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ª docker0 è™šæ‹Ÿç½‘æ¡¥ï¼Œå®é™…ä¸Šæ˜¯ Linux çš„ä¸€ä¸ª bridgeï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªè½¯ä»¶äº¤æ¢æœºã€‚å®ƒä¼šåœ¨æŒ‚è½½åˆ°å®ƒçš„ç½‘å£ä¹‹é—´è¿›è¡Œè½¬å‘ã€‚ åŒæ—¶ï¼ŒDocker éšæœºåˆ†é…ä¸€ä¸ªæœ¬åœ°æœªå ç”¨çš„ç§æœ‰ç½‘æ®µï¼ˆåœ¨ RFC1918 ä¸­å®šä¹‰ï¼‰ä¸­çš„ä¸€ä¸ªåœ°å€ç»™ docker0 æ¥å£ã€‚æ¯”å¦‚å…¸å‹çš„ 172.17.42.1ï¼Œæ©ç ä¸º 255.255.0.0ã€‚æ­¤åå¯åŠ¨çš„å®¹å™¨å†…çš„ç½‘å£ä¹Ÿä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåŒä¸€ç½‘æ®µï¼ˆ172.17.0.0/16ï¼‰çš„åœ°å€ã€‚ å½“åˆ›å»ºä¸€ä¸ª Docker å®¹å™¨çš„æ—¶å€™ï¼ŒåŒæ—¶ä¼šåˆ›å»ºäº†ä¸€å¯¹ veth pair æ¥å£ï¼ˆå½“æ•°æ®åŒ…å‘é€åˆ°ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¦å¤–ä¸€ä¸ªæ¥å£ä¹Ÿå¯ä»¥æ”¶åˆ°ç›¸åŒçš„æ•°æ®åŒ…ï¼‰ã€‚è¿™å¯¹æ¥å£ä¸€ç«¯åœ¨å®¹å™¨å†…ï¼Œå³ eth0ï¼›å¦ä¸€ç«¯åœ¨æœ¬åœ°å¹¶è¢«æŒ‚è½½åˆ° docker0 ç½‘æ¡¥ï¼Œåç§°ä»¥ veth å¼€å¤´ï¼ˆä¾‹å¦‚ vethAQI2QTï¼‰ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä¸»æœºå¯ä»¥è·Ÿå®¹å™¨é€šä¿¡ï¼Œå®¹å™¨ä¹‹é—´ä¹Ÿå¯ä»¥ç›¸äº’é€šä¿¡ã€‚Docker å°±åˆ›å»ºäº†åœ¨ä¸»æœºå’Œæ‰€æœ‰å®¹å™¨ä¹‹é—´ä¸€ä¸ªè™šæ‹Ÿå…±äº«ç½‘ç»œã€‚å¦‚å›¾ ä¸‹é¢ä»¥è‡ªå®šä¹‰çš„å®¹å™¨æ–¹å¼ï¼Œä¸€æ­¥æ­¥é…ç½®ç½‘ç»œ, è¾¾åˆ°ä»¥ä¸‹ç›®æ ‡: å®¹å™¨é—´èƒ½å¤Ÿé€šä¿¡ å®¹å™¨èƒ½å¤Ÿè”å¤–ç½‘ é¦–å…ˆåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œä½†ä¸ä½¿ç”¨é»˜è®¤ç½‘ç»œé…ç½®ï¼Œä½¿ç”¨--net=noneé€‰é¡¹: docker run -t -i --net=none ubuntu:14.04 bash docker ps # è·å–å®¹å™¨id=6414d7278905 è·å–å®¹å™¨pid: docker inspect 6414d7278905 | grep -i \"\\\u003cpid\\\"\" # \"Pid\": 11776, pid=11776 åˆ›å»ºä¸€ä¸ªæ–°çš„netnsï¼Œå¹¶æŠŠå®¹å™¨æ”¾å…¥æ–°å»ºçš„netnsä¸­ã€‚ï¼ˆæ ¹æ®çº¦å®šï¼Œå‘½åçš„ network namespace æ˜¯å¯ä»¥æ‰“å¼€çš„ /var/run/netns/ ç›®å½•ä¸‹çš„ä¸€ä¸ªå¯¹è±¡ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªåç§°ä¸º net1 çš„ network namespace å¯¹è±¡ï¼Œåˆ™å¯ä»¥ç”±æ‰“å¼€ /var/run/netns/net1 å¯¹è±¡äº§ç”Ÿçš„æ–‡ä»¶æè¿°ç¬¦å¼•ç”¨ network namespace net1ã€‚é€šè¿‡å¼•ç”¨è¯¥æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥ä¿®æ”¹è¿›ç¨‹çš„ network namespaceã€‚ï¼‰ sudo ip netns add netns666 # ä¼šäº§ç”Ÿä¸€ä¸ª/var/run/netns/netns666çš„æ–‡ä»¶ sudo ip netns ls # æŸ¥çœ‹æ–°åˆ›å»ºnetns netns666 sudo mount --bind /proc/$pid/ns/net /var/run/netns/netns666 # åŠ å…¥æ–°çš„netns sudo ip netns pids netns666 # æŸ¥çœ‹netns666ä¸­è¿›ç¨‹çš„ PID 11776 æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªvethå¯¹ï¼Œå…¶ä¸­ä¸€ä¸ªè®¾ç½®ä¸ºå®¹å™¨æ‰€åœ¨çš„netnsï¼Œå³netns666 sudo ip link add name veth_d366 type veth peer name veth_d366_peer sudo ip link set veth_d366_peer netns netns666 è¿›å…¥netns666 netnsè®¾ç½®ç½‘å¡åç§°å’Œip: sudo ip netns exec netns666 bash sudo ip link set veth_d366_peer name eth0 sudo ifconfig eth0 10.0.0.2/24 # è®¾ç½®ipä¸º10.0.0.2 ping 10.0.0.2 # èƒ½pingé€š exit ä¸Šè¿°å‘½ä»¤ç»™veth_d366_peeré…ç½®å®Œipçš„æƒ…å†µï¼š ip addr show 1: lo: \u003cLOOPBACK,UP,LOWER_UP\u003e mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever 36: eth0@if37: \u003cNO-CARRIER,BROADCAST,MULTICAST,UP\u003e mtu 1500 qdisc noqueue state LOWERLAYERDOWN group default qlen 1000 link/ether 9e:67:30:e3:65:34 brd ff:ff:ff:ff:ff:ff link-netnsid 0 inet 10.0.0.2/24 brd 10.0.0.255 scope global eth0 valid_lft forever preferred_lft forever åœ¨å®¹å™¨ä¸­ping 10.0.0.2ä¹Ÿèƒ½pingé€š,è¯´æ˜è®¾ç½®æ­£ç¡® ping 10.0.0.2 # å®¿ä¸»æœºä¸Šåº”è¯¥ä¸é€š docker exec 6414d7278905 ping 10.0.0.2 # æˆåŠŸpingé€š åˆ›å»ºç½‘æ¡¥ï¼Œå¹¶æŠŠvethå¦ä¸€ç«¯çš„è™šæ‹Ÿç½‘å¡åŠ å…¥æ–°åˆ›å»ºçš„ç½‘æ¡¥ä¸­: sudo brctl addbr br666 # åˆ›å»ºæ–°ç½‘æ¡¥br666 sudo brctl addif br666 veth_d366 # æŠŠè™šæ‹Ÿç½‘å¡åŠ å…¥ç½‘æ¡¥br666ä¸­ sudo ifconfig br666 10.0.0.1/24 # è®¾ç½®ç½‘æ¡¥ip sudo ip link set veth_d366 up # å¯åŠ¨è™šæ‹Ÿç½‘å¡ æµ‹è¯•ä¸‹ï¼š ping 10.0.0.2 # å®¿ä¸»æœºä¸ŠæˆåŠŸpingé€š docker exec 6414d7278905 ping 10.0.0.1 # æˆåŠŸpingé€š è‹¥ä»¥ä¸Šä¸¤ä¸ªéƒ½èƒ½pingé€šè¯´æ˜é…ç½®æˆåŠŸï¼ æœ€åï¼Œæˆ‘ä»¬éœ€è¦ä½¿å¾—å®¹å™¨èƒ½å¤Ÿè”å¤–ç½‘ï¼Œéœ€è¦è®¾ç½®NATï¼Œä½¿ç”¨iptablesè®¾ç½®: sudo iptables -t nat -A POSTROUTING -s 10.0.0.0/24 -o em1 -j MASQUERADE em1æ˜¯çœŸæ­£çš„ç‰©ç†ç½‘å¡å¯¹åº”çš„ç½‘ç»œè®¾å¤‡ï¼Œä¸åŒç”µè„‘ä¸Šåå­—ä¸ä¸€æ ·ï¼Œæˆ‘çš„Ubuntuä¸Šä¸ºenp7s0ã€‚ å¦å¤–ï¼Œè¿˜éœ€è¦è®¾ç½®FORWARDè§„åˆ™ï¼ˆå…è®¸br666è½¬å‘ï¼ŒIP forwardingè¦å¼€å¯ï¼Œä½¿ç”¨sudo sysctl -w net.ipv4.ip_forward=1ï¼‰ sudo iptables -A FORWARD -i br666 -o br666 -j ACCEPT sudo iptables -A FORWARD -i br666 ! -o br666 -j ACCEPT sudo iptables -A FORWARD ! -i br666 -o br666 -j ACCEPT è®¾ç½®å®¹å™¨é»˜è®¤è·¯ç”±ä¸ºç½‘æ¡¥ipï¼ˆæ³¨æ„åœ¨å®¹å™¨å†…ä½¿ç”¨route add æ·»åŠ , ä¼šå‡ºç°SIOCADDRT: Operation not permittedé”™è¯¯), å› æ­¤åªèƒ½ä½¿ç”¨ip netns execè®¾ç½®: sudo ip netns exec netns666 route add default gw 10.0.0.1 æµ‹è¯•ï¼Œæ­¤æ—¶è¯·ç¡®ä¿å®¿ä¸»æœºèƒ½å¤Ÿè”å¤–ç½‘,è¿›å…¥å®¹å™¨å†…éƒ¨: ping baidu.com # æˆåŠŸpingé€šï¼Œç¡®ä¿icmpæ²¡æœ‰è¢«ç¦ æ•ˆæœå›¾ï¼š ","date":"2020-04-28","objectID":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/:1:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Dockerç½‘ç»œåŸç†","uri":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/"},{"categories":["Docker","Linux"],"content":"Dockerç½‘ç»œå’Œè™šæ‹Ÿæœºç½‘ç»œåŒºåˆ« ","date":"2020-04-28","objectID":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/:2:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Dockerç½‘ç»œåŸç†","uri":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/"},{"categories":["Docker","Linux"],"content":"è™šæ‹Ÿæœº è™šæ‹Ÿæœºï¼Œå¦‚å›¾ï¼Œè™šæ‹Ÿæœºé€šè¿‡tun/tapæˆ–è€…å…¶å®ƒç±»ä¼¼çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡ï¼Œå°†è™šæ‹Ÿæœºå†…çš„ç½‘å¡åŒbr0è¿æ¥èµ·æ¥ï¼Œè¿™æ ·å°±è¾¾åˆ°å’ŒçœŸå®äº¤æ¢æœºä¸€æ ·çš„æ•ˆæœï¼Œè™šæ‹Ÿæœºå‘å‡ºå»çš„æ•°æ®åŒ…å…ˆåˆ°è¾¾br0ï¼Œç„¶åç”±br0äº¤ç»™eth0å‘é€å‡ºå»ï¼Œæ•°æ®åŒ…éƒ½ä¸éœ€è¦ç»è¿‡hostæœºå™¨çš„åè®®æ ˆï¼Œæ•ˆç‡é«˜ã€‚ ","date":"2020-04-28","objectID":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/:2:1","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Dockerç½‘ç»œåŸç†","uri":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/"},{"categories":["Docker","Linux"],"content":"Docker dockerï¼Œå¦‚å›¾ï¼Œç”±äºå®¹å™¨è¿è¡Œåœ¨è‡ªå·±å•ç‹¬çš„network namespaceé‡Œé¢ï¼Œæ‰€ä»¥éƒ½æœ‰è‡ªå·±å•ç‹¬çš„åè®®æ ˆï¼Œæƒ…å†µå’Œä¸Šé¢çš„è™šæ‹Ÿæœºå·®ä¸å¤šï¼Œä½†å®ƒé‡‡ç”¨äº†å¦ä¸€ç§æ–¹å¼æ¥å’Œå¤–ç•Œé€šä¿¡ å®¹å™¨ä¸­é…ç½®ç½‘å…³ä¸º.9.1ï¼Œå‘å‡ºå»çš„æ•°æ®åŒ…å…ˆåˆ°è¾¾br0ï¼Œç„¶åäº¤ç»™hostæœºå™¨çš„åè®®æ ˆï¼Œç”±äºç›®çš„IPæ˜¯å¤–ç½‘IPï¼Œä¸”hostæœºå™¨å¼€å¯äº†IP forwardåŠŸèƒ½ï¼Œäºæ˜¯æ•°æ®åŒ…ä¼šé€šè¿‡eth0å‘é€å‡ºå»ï¼Œç”±äº.9.1æ˜¯å†…ç½‘IPï¼Œæ‰€ä»¥ä¸€èˆ¬å‘å‡ºå»ä¹‹å‰ä¼šå…ˆåšNATè½¬æ¢ï¼ˆNATè½¬æ¢å’ŒIP forwardåŠŸèƒ½éƒ½éœ€è¦è‡ªå·±é…ç½®ï¼‰ã€‚ç”±äºè¦ç»è¿‡hostæœºå™¨çš„åè®®æ ˆï¼Œå¹¶ä¸”è¿˜è¦åšNATè½¬æ¢ï¼Œæ‰€ä»¥æ€§èƒ½æ²¡æœ‰ä¸Šé¢è™šæ‹Ÿæœºé‚£ç§æ–¹æ¡ˆå¥½ï¼Œä¼˜ç‚¹æ˜¯å®¹å™¨å¤„äºå†…ç½‘ä¸­ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¦é«˜ç‚¹ã€‚ï¼ˆç”±äºæ•°æ®åŒ…ç»Ÿä¸€ç”±IPå±‚ä»eth0è½¬å‘å‡ºå»ï¼Œæ‰€ä»¥ä¸å­˜åœ¨macåœ°å€çš„é—®é¢˜ï¼Œåœ¨æ— çº¿ç½‘ç»œç¯å¢ƒä¸‹ä¹Ÿå·¥ä½œè‰¯å¥½ï¼‰ å‚è€ƒï¼š Linux ip netns å‘½ä»¤ dockerç½‘ç»œåŸç†.md Docker ç½‘ç»œä¹‹ç†è§£ bridge é©±åŠ¨ Linuxå†…æ ¸ç½‘ç»œè®¾å¤‡â€”â€”bridgeè®¾å¤‡ ","date":"2020-04-28","objectID":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/:2:2","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Dockerç½‘ç»œåŸç†","uri":"/step_to_step_docker%E4%B9%8Bdocker_network_underlying/"},{"categories":["Linux"],"content":"ç®€ä»‹ ç®¡ç†ç½‘ç»œæµé‡æ˜¯ç³»ç»Ÿç®¡ç†å‘˜å¿…éœ€å¤„ç†çš„æœ€æ£˜æ‰‹å·¥ä½œä¹‹ä¸€ï¼Œæˆ‘ä»¬å¿…éœ€è§„å®šè¿æ¥ç³»ç»Ÿçš„ç”¨æˆ·æ»¡è¶³é˜²ç«å¢™çš„ä¼ å…¥å’Œä¼ å‡ºè¦æ±‚ï¼Œä»¥æœ€å¤§é™åº¦ä¿è¯ç³»ç»Ÿå…å—æ”»å‡»ã€‚iptablesæ­£æ˜¯è¿™æ ·çš„å·¥å…·ã€‚ å…¶å®ä¸æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå®¢æˆ·ç«¯ä»£ç†ï¼Œç”¨æˆ·é€šè¿‡iptablesè¿™ä¸ªä»£ç†ï¼Œå°†ç”¨æˆ·çš„å®‰å…¨è®¾å®šæ‰§è¡Œåˆ°å¯¹åº”çš„\"å®‰å…¨æ¡†æ¶\"ä¸­ï¼Œè¿™ä¸ª\"å®‰å…¨æ¡†æ¶\"æ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œè¿™ä¸ªæ¡†æ¶çš„åå­—å«netfilterã€‚ ","date":"2020-04-26","objectID":"/linux_iptables/:1:0","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"æµç¨‹ iptablesæœ‰5ä¸ªé“¾:PREROUTING,INPUT,FORWARD,OUTPUT,POSTROUTING,4ä¸ªè¡¨:filter,nat,mangle,rawã€‚ï¼ˆ4è¡¨5é“¾ï¼‰ 4ä¸ªè¡¨çš„ä¼˜å…ˆçº§ç”±é«˜åˆ°ä½çš„é¡ºåºä¸º:rawâ€“\u003emangleâ€“\u003enatâ€“\u003efilter filterï¼šä¸€èˆ¬çš„è¿‡æ»¤åŠŸèƒ½ nat:ç”¨äºnatåŠŸèƒ½ï¼ˆç«¯å£æ˜ å°„ï¼Œåœ°å€æ˜ å°„ç­‰ï¼‰ mangle:ç”¨äºå¯¹ç‰¹å®šæ•°æ®åŒ…çš„ä¿®æ”¹ raw:ä¼˜å…ˆçº§æœ€é«˜ï¼Œè®¾ç½®rawæ—¶ä¸€èˆ¬æ˜¯ä¸ºäº†ä¸å†è®©iptablesåšæ•°æ®åŒ…çš„é“¾æ¥è·Ÿè¸ªå¤„ç†ï¼Œæé«˜æ€§èƒ½ å›¾ç‰‡ä¸­ï¼ŒPREROUTINGä¼šæœ‰ä¸ªåˆ†å‰ï¼Œç³»ç»Ÿæ˜¯æ ¹æ®IPæ•°æ®åŒ…ä¸­çš„destination ip addressä¸­çš„IPåœ°å€å¯¹æ•°æ®åŒ…è¿›è¡Œåˆ†å‘ã€‚ å¦‚æœdestination ip adressæ˜¯æœ¬æœºåœ°å€ï¼Œæ•°æ®å°†ä¼šè¢«è½¬äº¤ç»™INPUTé“¾ã€‚å¦‚æœä¸æ˜¯æœ¬æœºåœ°å€ï¼Œåˆ™äº¤ç»™FORWARDé“¾æ£€æµ‹ã€‚ ","date":"2020-04-26","objectID":"/linux_iptables/:2:0","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"ä½¿ç”¨ ","date":"2020-04-26","objectID":"/linux_iptables/:3:0","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"å¯åŠ¨ã€åœæ­¢å’Œé‡å¯iptables è™½ç„¶ iptables å¹¶ä¸æ˜¯ä¸€é¡¹æœåŠ¡ï¼Œä½†åœ¨ Linux ä¸­è¿˜æ˜¯å¯ä»¥åƒæœåŠ¡ä¸€æ ·å¯¹å…¶çŠ¶æ€è¿›è¡Œç®¡ç†ã€‚ åŸºäºSystemDçš„ç³»ç»Ÿ systemctl start iptables systemctl stop iptables systemctl restart iptables ","date":"2020-04-26","objectID":"/linux_iptables/:3:1","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"æŸ¥çœ‹è§„åˆ™ æŸ¥çœ‹iptablesé˜²ç«å¢™ç­–ç•¥ sudo iptables -vL æˆ–è€…å¸¦ä¸Šåºå· sudo iptables -vL --line-number //--line-numberå¯ä»¥æ˜¾ç¤ºè§„åˆ™åºå·ï¼Œåœ¨åˆ é™¤çš„æ—¶å€™æ¯”è¾ƒæ–¹ä¾¿ ä»¥ä¸Šå‘½ä»¤æ˜¯æŸ¥çœ‹é»˜è®¤çš„ FILTER è¡¨ï¼Œå¦‚æœä½ åªå¸Œæœ›æŸ¥çœ‹ç‰¹å®šçš„è¡¨ï¼Œå¯ä»¥åœ¨ -t å‚æ•°åè·Ÿä¸Šè¦å•ç‹¬æŸ¥çœ‹çš„è¡¨åã€‚ä¾‹å¦‚åªæŸ¥çœ‹ NAT è¡¨ä¸­çš„è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š sudo iptables -vL -t nat ","date":"2020-04-26","objectID":"/linux_iptables/:3:2","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"æ·»åŠ è§„åˆ™ å‘½ä»¤æ ¼å¼ä¸ºï¼šâ€œiptables [-t è¡¨å] é€‰é¡¹ [é“¾å] [æ¡ä»¶] [-j æ§åˆ¶åŠ¨ä½œ]\"ã€‚ æ­¤å¤„åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„åŠ¨ä½œï¼š ACCEPTï¼šå…è®¸æ•°æ®åŒ…é€šè¿‡ã€‚ DROPï¼šç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›åº”ä¿¡æ¯ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯ä¼šæ„Ÿè§‰è‡ªå·±çš„è¯·æ±‚æ³¥ç‰›å…¥æµ·äº†ï¼Œè¿‡äº†è¶…æ—¶æ—¶é—´æ‰ä¼šæœ‰ååº”ã€‚ REJECTï¼šæ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¿…è¦æ—¶ä¼šç»™æ•°æ®å‘é€ç«¯ä¸€ä¸ªå“åº”çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åˆšè¯·æ±‚å°±ä¼šæ”¶åˆ°æ‹’ç»çš„ä¿¡æ¯ã€‚ SNATï¼šæºåœ°å€è½¬æ¢ï¼Œè§£å†³å†…ç½‘ç”¨æˆ·ç”¨åŒä¸€ä¸ªå…¬ç½‘åœ°å€ä¸Šç½‘çš„é—®é¢˜ã€‚ MASQUERADEï¼šæ˜¯SNATçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€‚ç”¨äºåŠ¨æ€çš„ã€ä¸´æ—¶ä¼šå˜çš„ipä¸Šã€‚ DNATï¼šç›®æ ‡åœ°å€è½¬æ¢ã€‚ REDIRECTï¼šåœ¨æœ¬æœºåšç«¯å£æ˜ å°„ã€‚ LOGï¼šåœ¨/var/log/messagesæ–‡ä»¶ä¸­è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åå°†æ•°æ®åŒ…ä¼ é€’ç»™ä¸‹ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†è®°å½•ä»¥å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶è®©ä¸‹ä¸€æ¡è§„åˆ™å»åŒ¹é…ã€‚ æ‹’ç»è½¬å‘æ¥è‡ª192.168.1.10ä¸»æœºçš„æ•°æ®ï¼Œå…è®¸è½¬å‘æ¥è‡ª192.168.0.0/24ç½‘æ®µçš„æ•°æ® iptables -A FORWARD -s 192.168.1.11 -j REJECT iptables -A FORWARD -s 192.168.0.0/24 -j ACCEPT è¯´æ˜ï¼šæ³¨æ„è¦æŠŠæ‹’ç»çš„æ”¾åœ¨å‰é¢ä¸ç„¶å°±ä¸èµ·ä½œç”¨äº†å•Šã€‚ å…è®¸æœ¬æœºå¼€æ”¾ä»TCPç«¯å£20-1024æä¾›çš„åº”ç”¨æœåŠ¡ã€‚ iptables -A INPUT -p tcp --dport 20:1024 -j ACCEPT iptables -A OUTPUT -p tcp --sport 20:1024 -j ACCEPT å…è®¸è½¬å‘æ¥è‡ª192.168.0.0/24å±€åŸŸç½‘æ®µçš„DNSè§£æè¯·æ±‚æ•°æ®åŒ…ã€‚ iptables -A FORWARD -s 192.168.0.0/24 -p udp --dport 53 -j ACCEPT iptables -A FORWARD -d 192.168.0.0/24 -p udp --sport 53 -j ACCEPT ","date":"2020-04-26","objectID":"/linux_iptables/:3:3","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"DNATå’ŒSNAT æˆ‘ä»¬è¦åšçš„DNATè¦åœ¨è¿›å…¥è¿™ä¸ªè±å½¢è½¬å‘åŒºåŸŸä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯åœ¨PREROUTINGé“¾ä¸­åšï¼Œä¾‹å¦‚è¦æŠŠè®¿é—®202.103.96.112çš„è®¿é—®è½¬å‘åˆ°192.168.0.112ä¸Šï¼š iptables -t nat -A PREROUTING -d 202.103.96.112 -j DNAT --to-destination 192.168.0.112 è€ŒSNATè‡ªç„¶æ˜¯è¦åœ¨æ•°æ®åŒ…æµå‡ºè¿™å°æœºå™¨ä¹‹å‰çš„æœ€åä¸€ä¸ªé“¾ä¹Ÿå°±æ˜¯POSTROUTINGé“¾æ¥è¿›è¡Œæ“ä½œ iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -j SNAT --to-source 58.20.51.66 å‡å¦‚å½“å‰ç³»ç»Ÿç”¨çš„æ˜¯ADSL/3G/4GåŠ¨æ€æ‹¨å·æ–¹å¼ï¼Œé‚£ä¹ˆæ¯æ¬¡æ‹¨å·ï¼Œå‡ºå£IPéƒ½ä¼šæ”¹å˜ï¼ŒSNATå°±ä¼šæœ‰å±€é™æ€§ã€‚ iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth0 -j MASQUERADE é‡ç‚¹åœ¨é‚£ä¸ªã€ MASQUERADE ã€ï¼è¿™ä¸ªè®¾å®šå€¼å°±æ˜¯ã€IPä¼ªè£…æˆä¸ºå°åŒ…å‡ºå»(-o)çš„é‚£å—è£…ç½®ä¸Šçš„IPã€ï¼ ä¸ç®¡ç°åœ¨eth0çš„å‡ºå£è·å¾—äº†æ€æ ·çš„åŠ¨æ€ipï¼ŒMASQUERADEä¼šè‡ªåŠ¨è¯»å–eth0ç°åœ¨çš„ipåœ°å€ç„¶ååšSNATå‡ºå»ï¼Œè¿™æ ·å°±å®ç°äº†å¾ˆå¥½çš„åŠ¨æ€SNATåœ°å€è½¬æ¢ã€‚ ","date":"2020-04-26","objectID":"/linux_iptables/:3:4","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"åˆ é™¤iptablesè§„åˆ™ iptables -D INPUT 3 //åˆ é™¤inputçš„ç¬¬3æ¡è§„åˆ™ iptables -t nat -D POSTROUTING 1 //åˆ é™¤natè¡¨ä¸­postroutingçš„ç¬¬ä¸€æ¡è§„åˆ™ iptables -F INPUT //æ¸…ç©º filterè¡¨INPUTæ‰€æœ‰è§„åˆ™ iptables -F //æ¸…ç©ºæ‰€æœ‰è§„åˆ™ iptables -t nat -F POSTROUTING //æ¸…ç©ºnatè¡¨POSTROUTINGæ‰€æœ‰è§„åˆ™ ","date":"2020-04-26","objectID":"/linux_iptables/:3:5","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Linux"],"content":"ä¿å­˜å’Œæ¢å¤ iptables å‘½ä»¤ä¿®æ”¹åè§„åˆ™åªå­˜åœ¨äºå†…å­˜ä¸­ï¼Œä½†æ˜¯æˆ‘ä»¬ä¿å­˜å½“å‰è§„åˆ™ç”¨æ¥æ¢å¤ iptables-save \u003e /etc/sysconfig/iptables.20180606 iptables-restore \u003c /etc/sysconfig/iptables.20180606 å‚è€ƒï¼š iptablesä¹‹FORWARDè½¬å‘é“¾ iptablesä¸­DNATã€SNATå’ŒMASQUERADE iptablesä»‹ç» Linux iptablesç”¨æ³•ä¸NAT ","date":"2020-04-26","objectID":"/linux_iptables/:3:6","tags":["Linux","iptables"],"title":"Linuxä¹‹iptables","uri":"/linux_iptables/"},{"categories":["Java"],"content":"Elasticsearch Elasticsearchæ˜¯ä¸€ä¸ªåŸºäºLuceneçš„æœç´¢æœåŠ¡å™¨ï¼ˆLuceneå¯ä»¥è¢«è®¤ä¸ºæ˜¯è¿„ä»Šä¸ºæ­¢æœ€å…ˆè¿›ã€æ€§èƒ½æœ€å¥½çš„ã€åŠŸèƒ½æœ€å…¨çš„æœç´¢å¼•æ“åº“ï¼‰ã€‚Elasticsearchä½¿ç”¨Javaç¼–å†™å¹¶ä½¿ç”¨Luceneæ¥å»ºç«‹ç´¢å¼•å¹¶å®ç°æœç´¢åŠŸèƒ½ï¼Œä½†æ˜¯å®ƒçš„ç›®çš„æ˜¯é€šè¿‡ç®€å•è¿è´¯çš„RESTful APIè®©å…¨æ–‡æœç´¢å˜å¾—ç®€å•å¹¶éšè—Luceneçš„å¤æ‚æ€§ã€‚ ","date":"2020-04-21","objectID":"/elasticsearch_to_know/:1:0","tags":["Java","Elasticsearch"],"title":"Elasticsearchç®€å•ä½¿ç”¨","uri":"/elasticsearch_to_know/"},{"categories":["Java"],"content":"å®‰è£…å•èŠ‚ç‚¹Elasticsearch Elasticsearchæ˜¯ç”¨Javaè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥ä½ éœ€è¦å®‰è£…Javaç¯å¢ƒï¼Œä½†ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œæˆ‘è¿™é‡Œé€‰ç”¨äº†Dockerå®‰è£…ESï¼ˆå…¶å®ESå®˜ç½‘ä¹Ÿæœ‰ç”¨Dockerå®‰è£…çš„ä¾‹å­ï¼Œè¿™é‡Œæˆ‘å°±æŠŠå®ƒå†™æˆäº†docker-composeæœåŠ¡ï¼‰ã€‚ docker-compose.yml version: '2.2' services: es: image: elasticsearch:6.7.0 container_name: es0 environment: - node.name=es0 - \"discovery.type=single-node\" - node.data=true - bootstrap.memory_lock=true - network.host=0.0.0.0 - \"ES_JAVA_OPTS=-Xms1g -Xmx1g\" ulimits: memlock: soft: -1 hard: -1 volumes: - ./data:/usr/share/elasticsearch/data ports: - 9200:9200 - 9300:9300 Elasticsearch å¯åŠ¨åï¼Œå¯åŠ¨äº†ä¸¤ä¸ªç«¯å£ 9200 å’Œ 9300ï¼š 9200 ç«¯å£ï¼šHTTP RESTful æ¥å£çš„é€šè®¯ç«¯å£ 9300 ç«¯å£ï¼šTCP é€šè®¯ç«¯å£ï¼Œç”¨äºé›†ç¾¤é—´èŠ‚ç‚¹é€šä¿¡å’Œä¸ Java å®¢æˆ·ç«¯é€šä¿¡çš„ç«¯å£ - bootstrap.memory_lock=true ... ulimits: memlock: soft: -1 hard: -1 è¿™ä¸¤éƒ¨åˆ†æ˜¯ä¸ºäº†ç¦æ­¢ä½¿ç”¨swapå†…å­˜ï¼Œå› ä¸ºå½“jvmå¼€å§‹swappingæ—¶ESçš„æ•ˆç‡ä¼šé™ä½ã€‚ -Xms1g -Xmx1gæ˜¯è®¾ç½®äº†JVMçš„åˆå§‹å †å¤§å°å’Œæœ€å¤§å †å¤§å°ï¼ˆå…·ä½“å‚æ•°å«ä¹‰å¯ä»¥å‚è€ƒè¿™é‡Œï¼‰ã€‚ å¯åŠ¨ä¹‹å‰è¿˜æ˜¯éœ€è¦è°ƒé«˜JVMçº¿ç¨‹æ•°é™åˆ¶æ•°é‡ï¼Œä¸ç„¶å¯åŠ¨ä¼šæŠ¥é”™ vim /etc/sysctl.conf # æ·»åŠ è¿™ä¸ª vm.max_map_count=262144 # ä¿å­˜åæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ sysctl -p ","date":"2020-04-21","objectID":"/elasticsearch_to_know/:2:0","tags":["Java","Elasticsearch"],"title":"Elasticsearchç®€å•ä½¿ç”¨","uri":"/elasticsearch_to_know/"},{"categories":["Java"],"content":"æ¦‚å¿µ åœ¨è¿›ä¸€æ­¥ä½¿ç”¨ Elasticsearch ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªå…³é”®æ¦‚å¿µã€‚ åœ¨é€»è¾‘å±‚é¢ï¼š Index (ç´¢å¼•)å’ŒType (ç±»å‹)ï¼šè¿™é‡Œçš„ Index æ˜¯åè¯ï¼Œåœ¨ä¹‹å‰å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ**ç´¢å¼•ï¼ˆindexï¼‰å’Œç±»å‹ï¼ˆtypeï¼‰**ç±»æ¯”äºSQLæ•°æ®åº“ä¸­çš„ database å’Œ tableï¼Œä½†æ˜¯è¿™æ ·ç±»æ¯”æ˜¯ä¸åˆé€‚çš„ã€‚åˆšå¼€å§‹çš„ESç‰ˆæœ¬ä¸€ä¸ªç´¢å¼•å¯ä»¥æœ‰å¤šä¸ªç±»å‹ï¼Œåœ¨ES6ä¹‹åæ¯ä¸ªç´¢å¼•åªèƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œæ‰€ä»¥ä»–ä»¬ç°åœ¨éƒ½å¯ä»¥å½“åšä¸€å¼ æ•°æ®è¡¨äº†ã€‚ Document (æ–‡æ¡£)ï¼šElasticsearch ä½¿ç”¨ JSON æ–‡æ¡£æ¥è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡ï¼Œå°±åƒæ˜¯å…³ç³»æ•°æ®åº“ä¸­ä¸€ä¸ª Table ä¸­çš„ä¸€è¡Œæ•°æ® Field (å­—æ®µ)ï¼šæ¯ä¸ªæ–‡æ¡£åŒ…å«å¤šä¸ªå­—æ®µï¼Œç±»ä¼¼å…³ç³»æ•°æ®åº“ä¸­ä¸€ä¸ª Table çš„åˆ— ä¸ºä»€ä¹ˆè¦ç§»é™¤æ˜ å°„ç±»å‹ å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ**ç´¢å¼•ï¼ˆindexï¼‰å’Œç±»å‹ï¼ˆtypeï¼‰**ç±»æ¯”äºSQLæ•°æ®åº“ä¸­çš„ database å’Œ tableï¼Œä½†æ˜¯è¿™æ ·ç±»æ¯”æ˜¯ä¸åˆé€‚çš„ã€‚åœ¨SQLæ•°æ®åº“ä¸­ï¼Œè¡¨ä¹‹é—´æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ä¸€ä¸ªè¡¨ä¸­çš„å„åˆ—å¹¶ä¸ä¼šå½±å“åˆ°å…¶å®ƒè¡¨ä¸­çš„åŒåçš„åˆ—ã€‚è€Œåœ¨æ˜ å°„ç±»å‹ï¼ˆmapping typeï¼‰ä¸­å´ä¸æ˜¯è¿™æ ·çš„ã€‚ åœ¨åŒä¸€ä¸ª Elasticsearch ç´¢å¼•ä¸­ï¼Œå…¶ä¸­ä¸åŒæ˜ å°„ç±»å‹ä¸­çš„åŒåå­—æ®µåœ¨å†…éƒ¨æ˜¯ç”±åŒä¸€ä¸ª Lucene å­—æ®µæ¥æ”¯æŒçš„ã€‚æ¢å¥è¯è¯´ï¼Œä½¿ç”¨ä¸Šé¢çš„ä¾‹å­ï¼Œuser ç±»å‹ä¸­çš„ user_name å­—æ®µä¸ tweet ç±»å‹ä¸­çš„ user_name å­—æ®µæ˜¯å®Œå…¨ä¸€æ ·çš„ï¼Œå¹¶ä¸”ä¸¤ä¸ª user_name å­—æ®µåœ¨ä¸¤ä¸ªç±»å‹ä¸­å¿…é¡»å…·æœ‰ç›¸åŒçš„æ˜ å°„ï¼ˆå®šä¹‰ï¼‰ã€‚ è¿™ä¼šåœ¨æŸäº›æƒ…å†µä¸‹å¯¼è‡´ä¸€äº›æ··ä¹±ï¼Œæ¯”å¦‚ï¼Œåœ¨åŒä¸€ä¸ªç´¢å¼•ä¸­ï¼Œå½“ä½ æƒ³åœ¨å…¶ä¸­çš„ä¸€ä¸ªç±»å‹ä¸­å°† deleted å­—æ®µä½œä¸º date ç±»å‹ï¼Œè€Œåœ¨å¦ä¸€ä¸ªç±»å‹ä¸­å°†å…¶ä½œä¸º boolean å­—æ®µã€‚ åœ¨æ­¤ä¹‹ä¸Šéœ€è¦è€ƒè™‘ä¸€ç‚¹ï¼Œå¦‚æœåŒä¸€ä¸ªç´¢å¼•ä¸­å­˜å‚¨çš„å„ä¸ªå®ä½“å¦‚æœåªæœ‰å¾ˆå°‘æˆ–è€…æ ¹æœ¬æ²¡æœ‰åŒæ ·çš„å­—æ®µï¼Œè¿™ç§æƒ…å†µä¼šå¯¼è‡´ç¨€ç–æ•°æ®ï¼Œå¹¶ä¸”ä¼šå½±å“åˆ°Luceneçš„é«˜æ•ˆå‹ç¼©æ•°æ®çš„èƒ½åŠ› åœ¨ç‰©ç†å±‚é¢ï¼š Node (èŠ‚ç‚¹)ï¼šnode æ˜¯ä¸€ä¸ªè¿è¡Œç€çš„ Elasticsearch å®ä¾‹ï¼Œä¸€ä¸ª node å°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„ server Cluster (é›†ç¾¤)ï¼šcluster æ˜¯å¤šä¸ª node çš„é›†åˆ Shard (åˆ†ç‰‡)ï¼šæ•°æ®åˆ†ç‰‡ï¼Œä¸€ä¸ª index å¯èƒ½ä¼šå­˜åœ¨äºå¤šä¸ª shard ","date":"2020-04-21","objectID":"/elasticsearch_to_know/:3:0","tags":["Java","Elasticsearch"],"title":"Elasticsearchç®€å•ä½¿ç”¨","uri":"/elasticsearch_to_know/"},{"categories":["Java"],"content":"ä½¿ç”¨ ä¸‹é¢ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå­˜å‚¨ç”µå½±ä¿¡æ¯çš„ Documentï¼š Index çš„åç§°ä¸º movie Type ä¸º adventure Document æœ‰ä¸¤ä¸ªå­—æ®µï¼šname å’Œ actors æˆ‘ä»¬ä½¿ç”¨ Elasticsearch æä¾›çš„ RESTful API æ¥æ‰§è¡Œä¸Šè¿°æ“ä½œï¼Œå¦‚å›¾æ‰€ç¤ºï¼š ç”¨ url è¡¨ç¤ºä¸€ä¸ªèµ„æºï¼Œæ¯”å¦‚ /movie/adventure/1 å°±è¡¨ç¤ºä¸€ä¸ª index ä¸º movieï¼Œtype ä¸º adventureï¼Œid ä¸º 1 çš„ document ç”¨ http æ–¹æ³•æ“ä½œèµ„æºï¼Œå¦‚ä½¿ç”¨ GET è·å–èµ„æºï¼Œä½¿ç”¨ POSTã€PUT æ–°å¢æˆ–æ›´æ–°èµ„æºï¼Œä½¿ç”¨ DELETE åˆ é™¤èµ„æºç­‰ ç”¨curlå‘½ä»¤å®ç°ä¸Šè¿°æ“ä½œï¼š curl -i -X PUT \"localhost:9200/movie/adventure/1\" -H 'Content-Type: application/json' -d '{\"name\": \"Life of Pi\", \"actors\": [\"Suraj\", \"Irrfan\"]}' ES6ä¹‹åéœ€è¦åŠ ä¸ŠheadContent-Type: application/json ä¸Šè¿°å‘½ä»¤è¿”å›ï¼š HTTP/1.1 201 Created Location: /movie/adventure/1 content-type: application/json; charset=UTF-8 content-length: 158 {\"_index\":\"movie\",\"_type\":\"adventure\",\"_id\":\"4\",\"_version\":1,\"result\":\"created\",\"_shards\":{\"total\":2,\"successful\":1,\"failed\":0},\"_seq_no\":1,\"_primary_term\":1} ","date":"2020-04-21","objectID":"/elasticsearch_to_know/:4:0","tags":["Java","Elasticsearch"],"title":"Elasticsearchç®€å•ä½¿ç”¨","uri":"/elasticsearch_to_know/"},{"categories":["Java"],"content":"elasticsearch.ymlé…ç½®è¯´æ˜ #é›†ç¾¤çš„åç§° cluster.name: es6.2 #èŠ‚ç‚¹åç§°,å…¶ä½™ä¸¤ä¸ªèŠ‚ç‚¹åˆ†åˆ«ä¸ºnode-2 å’Œnode-3 node.name: node-1 #æŒ‡å®šè¯¥èŠ‚ç‚¹æ˜¯å¦æœ‰èµ„æ ¼è¢«é€‰ä¸¾æˆä¸ºmasterèŠ‚ç‚¹ï¼Œé»˜è®¤æ˜¯trueï¼Œesæ˜¯é»˜è®¤é›†ç¾¤ä¸­çš„ç¬¬ä¸€å°æœºå™¨ä¸ºmasterï¼Œå¦‚æœè¿™å°æœºæŒ‚äº†å°±ä¼šé‡æ–°é€‰ä¸¾master node.master: true #å…è®¸è¯¥èŠ‚ç‚¹å­˜å‚¨æ•°æ®(é»˜è®¤å¼€å¯) node.data: true #ç´¢å¼•æ•°æ®çš„å­˜å‚¨è·¯å¾„ path.data: /usr/local/elk/elasticsearch/data #æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨è·¯å¾„ path.logs: /usr/local/elk/elasticsearch/logs #è®¾ç½®ä¸ºtrueæ¥é”ä½å†…å­˜ã€‚å› ä¸ºå†…å­˜äº¤æ¢åˆ°ç£ç›˜å¯¹æœåŠ¡å™¨æ€§èƒ½æ¥è¯´æ˜¯è‡´å‘½çš„ï¼Œå½“jvmå¼€å§‹swappingæ—¶esçš„æ•ˆç‡ä¼šé™ä½ï¼Œæ‰€ä»¥è¦ä¿è¯å®ƒä¸swap bootstrap.memory_lock: true #ç»‘å®šçš„ipåœ°å€ network.host: 0.0.0.0 #è®¾ç½®å¯¹å¤–æœåŠ¡çš„httpç«¯å£ï¼Œé»˜è®¤ä¸º9200 http.port: 9200 # è®¾ç½®èŠ‚ç‚¹é—´äº¤äº’çš„tcpç«¯å£,é»˜è®¤æ˜¯9300 transport.tcp.port: 9300 #Elasticsearchå°†ç»‘å®šåˆ°å¯ç”¨çš„ç¯å›åœ°å€ï¼Œå¹¶å°†æ‰«æç«¯å£9300åˆ°9305ä»¥å°è¯•è¿æ¥åˆ°è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„å…¶ä»–èŠ‚ç‚¹ã€‚ #è¿™æä¾›äº†è‡ªåŠ¨é›†ç¾¤ä½“éªŒï¼Œè€Œæ— éœ€è¿›è¡Œä»»ä½•é…ç½®ã€‚æ•°ç»„è®¾ç½®æˆ–é€—å·åˆ†éš”çš„è®¾ç½®ã€‚æ¯ä¸ªå€¼çš„å½¢å¼åº”è¯¥æ˜¯host:portæˆ–host #ï¼ˆå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œporté»˜è®¤è®¾ç½®ä¼štransport.profiles.default.port å›è½åˆ°transport.tcp.portï¼‰ã€‚ #è¯·æ³¨æ„ï¼ŒIPv6ä¸»æœºå¿…é¡»æ”¾åœ¨æ‹¬å·å†…ã€‚é»˜è®¤ä¸º127.0.0.1, [::1] discovery.zen.ping.unicast.hosts: [\"192.168.8.101:9300\", \"192.168.8.103:9300\", \"192.168.8.104:9300\"] #å¦‚æœæ²¡æœ‰è¿™ç§è®¾ç½®,é­å—ç½‘ç»œæ•…éšœçš„é›†ç¾¤å°±æœ‰å¯èƒ½å°†é›†ç¾¤åˆ†æˆä¸¤ä¸ªç‹¬ç«‹çš„é›†ç¾¤ - åˆ†è£‚çš„å¤§è„‘ - è¿™å°†å¯¼è‡´æ•°æ®ä¸¢å¤± discovery.zen.minimum_master_nodes: 3 å‚è€ƒï¼š Elasticsearch6.2é›†ç¾¤æ­å»º Elasticsearchå…¥é—¨ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº† ","date":"2020-04-21","objectID":"/elasticsearch_to_know/:5:0","tags":["Java","Elasticsearch"],"title":"Elasticsearchç®€å•ä½¿ç”¨","uri":"/elasticsearch_to_know/"},{"categories":["Python"],"content":"Pythonæ›²çº¿æ‹Ÿåˆ æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.4 LTS Pythonç‰ˆæœ¬ï¼š3.6.9 ","date":"2020-04-12","objectID":"/python_curve_fit/:1:0","tags":["Python","Matplotlib"],"title":"Pythonæ›²çº¿æ‹Ÿåˆ","uri":"/python_curve_fit/"},{"categories":["Python"],"content":"æ›²çº¿æ‹Ÿåˆ ç°åœ¨æˆ‘ä»¬æœ‰ä¸€ç»„æ•°æ®ï¼Œè¡¨è¾¾çš„å«ä¹‰æ˜¯åœ¨ä¸åŒçš„æ—¶é—´ç‚¹çš„å……å€¼é‡‘é¢ï¼Œåæ˜ åœ¨åæ ‡ä¸Šå°±æ˜¯ä¸€ç³»åˆ—çš„æ•£ç‚¹ï¼Œæˆ‘ä»¬å¸Œæœ›é€‰æ‹©é€‚å½“çš„æ›²çº¿ç±»å‹ï¼ˆå¦‚y = a*x^2 + bï¼‰â€œæœ€ä½³â€åœ°é€¼è¿‘æˆ–æ‹Ÿåˆå·²çŸ¥æ•°æ®ï¼Œè¿™ä¾¿æ˜¯æ›²çº¿æ‹Ÿåˆï¼ˆcurve fittingï¼‰ã€‚å½“ç„¶ï¼Œå˜é‡é—´æœªå¿…éƒ½æ˜¯çº¿æ€§å…³ç³»ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç”¨åˆ°æŒ‡æ•°å‡½æ•°ã€å¯¹æ•°å‡½æ•°ã€å¹‚å‡½æ•°ç­‰ã€‚ ","date":"2020-04-12","objectID":"/python_curve_fit/:2:0","tags":["Python","Matplotlib"],"title":"Pythonæ›²çº¿æ‹Ÿåˆ","uri":"/python_curve_fit/"},{"categories":["Python"],"content":"Pythonæ‹Ÿåˆåº“ Pythonçš„SciPyåº“æ˜¯ä¸€ä¸ªç”¨äºæ•°å­¦ã€ç§‘å­¦ã€å·¥ç¨‹é¢†åŸŸçš„å¸¸ç”¨è½¯ä»¶åŒ…ï¼Œå¯ä»¥å¤„ç†æ’å€¼ã€ç§¯åˆ†ã€ä¼˜åŒ–ã€å›¾åƒå¤„ç†ã€å¸¸å¾®åˆ†æ–¹ç¨‹æ•°å€¼è§£çš„æ±‚è§£ã€ä¿¡å·å¤„ç†ç­‰é—®é¢˜ã€‚SciPyæ˜¯åŸºäºNumPyï¼Œæ‰€ä»¥ä½ ä¹Ÿéœ€è¦å®‰è£…NumPyï¼Œå¦å¤–ç”¨äº†Matplotlibåº“æ¥ç»˜åˆ¶å›¾è¡¨ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦å®‰è£…Matplotlibã€‚ï¼ˆPythonåœ¨ç§‘å­¦è®¡ç®—é¢†åŸŸï¼Œnumpyã€Scipyã€Matplotlibæ˜¯éå¸¸å—æ¬¢è¿çš„ä¸‰ä¸ªåº“ï¼‰ ","date":"2020-04-12","objectID":"/python_curve_fit/:3:0","tags":["Python","Matplotlib"],"title":"Pythonæ›²çº¿æ‹Ÿåˆ","uri":"/python_curve_fit/"},{"categories":["Python"],"content":"ä½¿ç”¨æ¡ˆä¾‹ é¦–å…ˆå®‰è£…æ‰€éœ€ä¾èµ–ï¼ˆpipä½¿ç”¨è±†ç“£é•œåƒï¼‰ pip install -i https://pypi.doubanio.com/simple/ numpy scipy matplotlib ","date":"2020-04-12","objectID":"/python_curve_fit/:4:0","tags":["Python","Matplotlib"],"title":"Pythonæ›²çº¿æ‹Ÿåˆ","uri":"/python_curve_fit/"},{"categories":["Python"],"content":"å¤šé¡¹å¼æ‹Ÿåˆ ç¬¬ä¸€ç§æ˜¯è¿›è¡Œå¤šé¡¹å¼æ‹Ÿåˆï¼Œæ•°å­¦ä¸Šå¯ä»¥è¯æ˜ï¼Œä»»æ„å‡½æ•°éƒ½å¯ä»¥è¡¨ç¤ºä¸ºå¤šé¡¹å¼å½¢å¼ã€‚ç”¨çš„å‡½æ•°æ˜¯numpyçš„polyfitå‡½æ•° import numpy as np import matplotlib.pyplot as plt # å®šä¹‰xã€yæ•£ç‚¹åæ ‡ x = [10, 20, 30, 40, 50, 60, 70, 80] y = [174, 236, 305, 334, 349, 351, 342, 323] # è½¬åŒ–ä¸ºnumpyçš„æ•°ç»„ x = np.array(x) y = np.array(y) # è¿™é‡Œçš„3è¡¨ç¤ºæœ€é«˜å¹‚ï¼Œä¹Ÿå°±æ˜¯å‡½æ•°å½¢å¼ä¸ºy = a* x^3 + b * x^2 + c * x + d parameter = np.polyfit(x, y, 3) print('å‡½æ•°ç³»æ•°ä¸º:\\n', parameter) func1 = np.poly1d(parameter) print('å‡½æ•°ä¸º :\\n', func1) # ä¹Ÿå¯ä½¿ç”¨newY=np.polyval(func1, x) newY = func1(x) # æ‹Ÿåˆyå€¼ # ç»˜å›¾ plot1 = plt.plot(x, y, 's', label='original values') plot2 = plt.plot(x, newY, 'r', label='polyfit values') plt.xlabel('x') plt.ylabel('y') plt.legend(loc=4) # æŒ‡å®šlegendçš„ä½ç½®å³ä¸‹è§’ plt.title('polyfitting') plt.show() æ‹Ÿåˆç»“æœ: ","date":"2020-04-12","objectID":"/python_curve_fit/:4:1","tags":["Python","Matplotlib"],"title":"Pythonæ›²çº¿æ‹Ÿåˆ","uri":"/python_curve_fit/"},{"categories":["Python"],"content":"ç»™å®šå‡½æ•°å½¢å¼æ‹Ÿåˆ scipyæ¨¡å—çš„å­æ¨¡å—optimizeä¸­æä¾›äº†ä¸€ä¸ªä¸“é—¨ç”¨äºæ›²çº¿æ‹Ÿåˆçš„å‡½æ•°curve_fit() ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¥è¯´æ˜ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨curve_fit()è¿›è¡Œç›´çº¿å’Œæ›²çº¿çš„æ‹Ÿåˆä¸ç»˜åˆ¶ã€‚ import numpy as np import matplotlib.pyplot as plt from scipy import optimize #ç›´çº¿æ–¹ç¨‹å‡½æ•° def f_1(x, A, B): return A*x + B #äºŒæ¬¡æ›²çº¿æ–¹ç¨‹ def f_2(x, A, B, C): return A*x*x + B*x + C #ä¸‰æ¬¡æ›²çº¿æ–¹ç¨‹ def f_3(x, A, B, C, D): return A*x*x*x + B*x*x + C*x + D def plot_test(): plt.figure() #æ‹Ÿåˆç‚¹ x0 = [1, 2, 3, 4, 5] y0 = [1, 3, 8, 18, 36] #ç»˜åˆ¶æ•£ç‚¹ plt.scatter(x0[:], y0[:], 25, \"red\") #ç›´çº¿æ‹Ÿåˆä¸ç»˜åˆ¶ A1, B1 = optimize.curve_fit(f_1, x0, y0)[0] x1 = np.arange(0, 6, 0.01) y1 = A1*x1 + B1 plt.plot(x1, y1, \"blue\") #äºŒæ¬¡æ›²çº¿æ‹Ÿåˆä¸ç»˜åˆ¶ A2, B2, C2 = optimize.curve_fit(f_2, x0, y0)[0] x2 = np.arange(0, 6, 0.01) y2 = A2*x2*x2 + B2*x2 + C2 plt.plot(x2, y2, \"green\") #ä¸‰æ¬¡æ›²çº¿æ‹Ÿåˆä¸ç»˜åˆ¶ A3, B3, C3, D3= optimize.curve_fit(f_3, x0, y0)[0] x3 = np.arange(0, 6, 0.01) y3 = A3*x3*x3*x3 + B3*x3*x3 + C3*x3 + D3 plt.plot(x3, y3, \"purple\") plt.title(\"test\") plt.xlabel('x') plt.ylabel('y') plt.show() return å½“ç„¶ï¼Œcurve_fit()å‡½æ•°ä¸ä»…å¯ä»¥ç”¨äºç›´çº¿ã€äºŒæ¬¡æ›²çº¿ã€ä¸‰æ¬¡æ›²çº¿çš„æ‹Ÿåˆå’Œç»˜åˆ¶ï¼Œä»¿ç…§ä»£ç ä¸­çš„å½¢å¼ï¼Œå¯ä»¥é€‚ç”¨äºä»»æ„å½¢å¼çš„æ›²çº¿çš„æ‹Ÿåˆå’Œç»˜åˆ¶ï¼Œåªè¦å®šä¹‰å¥½åˆé€‚çš„æ›²çº¿æ–¹ç¨‹å³å¯ã€‚ å‚è€ƒï¼š np.polyfit()ä¸np.poly1d()å°†ç‚¹æ‹Ÿåˆæˆæ›²çº¿ ç›´çº¿å’Œæ›²çº¿çš„æ‹Ÿåˆä¸ç»˜åˆ¶ ","date":"2020-04-12","objectID":"/python_curve_fit/:4:2","tags":["Python","Matplotlib"],"title":"Pythonæ›²çº¿æ‹Ÿåˆ","uri":"/python_curve_fit/"},{"categories":["Java"],"content":" æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.4 LTS Javaç‰ˆæœ¬ï¼š1.8.0_221 ","date":"2020-04-09","objectID":"/java_lookback_java-web/:0:0","tags":["Java","Java Web"],"title":"Javaç»å…¸å›é¡¾ä¹‹Java Web","uri":"/java_lookback_java-web/"},{"categories":["Java"],"content":"Java Web è™½ç„¶æˆ‘ä»¬ç°åœ¨ä¼šç”¨SpringBootå¿«é€Ÿåˆ›å»ºä¸€ä¸ªWeb Demoï¼Œä½†æ˜¯åŸºç¡€ä¸èƒ½å¿˜ï¼ˆSpringBootæˆ–è€…SpringMVCéƒ½æ˜¯å°è£…åçš„äº§ç‰©ï¼‰ï¼Œä¸‹é¢å°±è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä¸€ä¸ªæœ€åŸºæœ¬çš„Java Webé¡¹ç›®ã€‚ ","date":"2020-04-09","objectID":"/java_lookback_java-web/:1:0","tags":["Java","Java Web"],"title":"Javaç»å…¸å›é¡¾ä¹‹Java Web","uri":"/java_lookback_java-web/"},{"categories":["Java"],"content":"åˆ›å»ºé¡¹ç›® è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨IDEAæ¥åˆ›å»ºé¡¹ç›®ï¼Œç‚¹å‡»èœå•File=\u003eNew=\u003eProjectï¼Œé€‰æ‹©Java Enterpriseï¼Œåœ¨Additional Libraries and Frameworkä¸­ï¼Œé€‰æ‹©Web Applicationï¼ˆæˆ‘è¿™é‡Œæ˜¯4.0ï¼Œæ—§ç‰ˆæœ¬çš„IDEAå¯èƒ½å…¶ä»–çš„ï¼‰ï¼ŒApplication Serverå°±æ˜¯Java Webé¡¹ç›®ç¼–è¯‘æ‰“åŒ…åè¿è¡Œæ‰€éœ€è¦çš„WebæœåŠ¡å™¨ï¼ˆä½ éœ€è¦è‡ªå·±é…ç½®ä¸€ä¸‹ï¼‰ã€‚ ç‚¹å‡»Nextåï¼Œå¡«å†™é¡¹ç›®åç§°å°±å¥½äº†ï¼Œè¿™é‡Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªsimplejavawebçš„é¡¹ç›®ã€‚ æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹é¡¹ç›®ç»“æ„ srcå°±æ˜¯æˆ‘ä»¬å†™Javaä»£ç çš„åœ°æ–¹ webç›®å½•æ˜¯webåº”ç”¨éƒ¨ç½²æ ¹ç›®å½• webä¸­çš„WEB_INFæ˜¯Javaçš„webåº”ç”¨çš„å®‰å…¨ç›®å½•ã€‚æ‰€è°“å®‰å…¨å°±æ˜¯å®¢æˆ·ç«¯æ— æ³•è®¿é—®ï¼Œåªæœ‰æœåŠ¡ç«¯å¯ä»¥è®¿é—®çš„ç›®å½•ã€‚å¦‚æœæƒ³åœ¨é¡µé¢ä¸­ç›´æ¥è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ï¼Œå¿…é¡»é€šè¿‡web.xmlæ–‡ä»¶å¯¹è¦è®¿é—®çš„æ–‡ä»¶è¿›è¡Œç›¸åº”æ˜ å°„æ‰èƒ½è®¿é—®ã€‚ WEB_INFä¸­çš„web.xmlæ˜¯Java web é¡¹ç›®æœ€ä¸»è¦çš„æ„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œå®ƒæ˜¯Webåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚ ","date":"2020-04-09","objectID":"/java_lookback_java-web/:2:0","tags":["Java","Java Web"],"title":"Javaç»å…¸å›é¡¾ä¹‹Java Web","uri":"/java_lookback_java-web/"},{"categories":["Docker"],"content":" æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.4 LTS Golangç‰ˆæœ¬ï¼š1.12.13 ","date":"2020-04-06","objectID":"/docker_cgroups/:0:0","tags":["Docker","Cgroups"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Cgroups","uri":"/docker_cgroups/"},{"categories":["Docker"],"content":"ä»€ä¹ˆæ˜¯Linux Cgroups Linux Cgroupsï¼ˆControl Groupsï¼‰æä¾›äº†å¯¹ä¸€ç»„è¿›ç¨‹åŠå°†æ¥çš„å­è¿›ç¨‹çš„èµ„æºé™åˆ¶ã€æ§åˆ¶å’Œç»Ÿè®¡çš„èƒ½åŠ›ï¼Œè¿™äº›èµ„æºåŒ…æ‹¬CPUã€å†…å­˜ã€å­˜å‚¨ã€ç½‘ç»œç­‰ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼ŒCgroups æ˜¯å†…æ ¸é™„åŠ åœ¨ç¨‹åºä¸Šçš„ä¸€ç³»åˆ—é’©å­(hook)ï¼Œé€šè¿‡ç¨‹åºè¿è¡Œæ—¶å¯¹èµ„æºçš„è°ƒåº¦è§¦å‘ç›¸åº”çš„é’©å­ä»¥è¾¾åˆ°èµ„æºè¿½è¸ªå’Œé™åˆ¶çš„ç›®çš„ã€‚ å‚è€ƒï¼š linux cgroups ç®€ä»‹ ","date":"2020-04-06","objectID":"/docker_cgroups/:1:0","tags":["Docker","Cgroups"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Cgroups","uri":"/docker_cgroups/"},{"categories":["Java"],"content":"GC GCå°±æ˜¯åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ï¼Œå¦‚æœä½ å†™è¿‡C++æˆ–è€…Cç¨‹åºçš„ï¼Œä½ å°±ä¼šçŸ¥é“newä¸€ä¸ªæ•°æ®åï¼Œå°±éœ€è¦deleteå®ƒçš„å†…å­˜ï¼Œè¿™å°±æ˜¯æ‰‹åŠ¨ç®¡ç†å†…å­˜ï¼Œä½†è¿™æ ·å¦‚æœä½ ç²—å¿ƒç‚¹çš„è¯ï¼Œå°±å®¹æ˜“é€ æˆå†…å­˜æ³„éœ²ï¼Œæ‰€ä»¥å°±æœ‰äº†è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œä¹Ÿå°±æˆ‘ä»¬è¿™é‡Œæ‰€è®¨è®ºçš„GCã€‚Javaçš„GCä¼šå¯¹JVMï¼ˆJava Virtual Machineï¼‰ä¸­çš„å†…å­˜è¿›è¡Œæ ‡è®°ï¼Œå¹¶ç¡®å®šå“ªäº›å†…å­˜éœ€è¦å›æ”¶ï¼Œæ ¹æ®ä¸€å®šçš„å›æ”¶ç­–ç•¥ï¼Œè‡ªåŠ¨çš„å›æ”¶å†…å­˜ï¼Œæ°¸ä¸åœæ¯ï¼ˆNerver Stopï¼‰çš„ä¿è¯JVMä¸­çš„å†…å­˜ç©ºé—´ï¼Œé˜²æ­¢å‡ºç°å†…å­˜æ³„éœ²å’Œæº¢å‡ºé—®é¢˜ã€‚ å…¶å®GCå¾ˆæ—©å°±æœ‰äº†ï¼Œ1960å¹´è¯ç”ŸäºMITçš„Lispæ˜¯ç¬¬ä¸€é—¨çœŸæ­£ä½¿ç”¨å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯çš„è¯­è¨€ã€‚ ","date":"2020-04-01","objectID":"/java_gc/:1:0","tags":["GC","Java"],"title":"Javaä¹‹GC","uri":"/java_gc/"},{"categories":["Java"],"content":"å†…å­˜å¸ƒå±€ JVM åœ¨æ‰§è¡Œ Java ç¨‹åºçš„è¿‡ç¨‹ä¸­ä¼šæŠŠå®ƒæ‰€ç®¡ç†çš„å†…å­˜åˆ’åˆ†ä¸ºè‹¥å¹²ä¸ªä¸åŒçš„æ•°æ®åŒºåŸŸã€‚æœ‰çš„åŒºåŸŸä¾èµ–çº¿ç¨‹çš„å¯åŠ¨å’Œç»“æŸè€Œå»ºç«‹å’Œé”€æ¯ï¼Œè¿™æ ·çš„åŒºåŸŸå¯çœ‹ä½œæ˜¯çº¿ç¨‹ç§æœ‰çš„åŒºåŸŸï¼ˆPer-Thread Data Areaï¼‰ï¼›å…¶ä»–çš„åŒºåŸŸåˆ™éšç€è™šæ‹Ÿæœºè¿›ç¨‹çš„å¯åŠ¨è€Œå­˜åœ¨ï¼Œå¯ä»¥çœ‹åšæ˜¯çº¿ç¨‹é—´å…±äº«çš„åŒºåŸŸã€‚ å…·ä½“è€Œè¨€ï¼ŒJVM çš„è¿è¡Œæ—¶æ•°æ®åŒºåŸŸåŒ…æ‹¬å¦‚ä¸‹ï¼š ç¨‹åºè®¡æ•°å™¨ï¼ˆProgram Counter Registerï¼‰ï¼šçº¿ç¨‹ç§æœ‰çš„æ•°æ®åŒºåŸŸï¼Œä¿å­˜å½“å‰æ­£åœ¨æ‰§è¡Œçš„è™šæ‹ŸæœºæŒ‡ä»¤çš„åœ°å€ï¼› Java è™šæ‹Ÿæœºæ ˆï¼ˆJava Virtual Machine Stackï¼‰ï¼šçº¿ç¨‹ç§æœ‰çš„æ•°æ®åŒºåŸŸï¼Œæ¯ä¸ªæ ˆå¸§ä¸­å­˜æ”¾å½“å‰æ‰§è¡Œæ–¹æ³•çš„æœ¬åœ°å˜é‡åŠè¿”å›åœ°å€ï¼› Java å †ï¼ˆHeapï¼‰ï¼šçº¿ç¨‹å…±äº«çš„æ•°æ®åŒºåŸŸï¼Œå¯¹è±¡åŠæ•°ç»„çš„åˆ†é…ç©ºé—´ï¼› æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ï¼šçº¿ç¨‹å…±äº«çš„æ•°æ®åŒºåŸŸï¼Œå­˜æ”¾ç”±ç±»åŠ è½½å™¨åŠ è½½çš„ç±»å‹ä¿¡æ¯ã€å¸¸é‡åŠé™æ€å˜é‡ï¼› æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰ï¼šç”¨äº Native æ–¹æ³•çš„æ–¹æ³•æ ˆ è¿è¡Œæ—¶å¸¸é‡æ± ï¼ˆRuntime Constant Poolï¼‰æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºå­˜å‚¨ç¼–è¯‘å™¨ç”Ÿæˆçš„å¸¸é‡å’Œå¼•ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¸¸é‡çš„åˆ†é…åœ¨ç¼–è¯‘æ—¶å°±èƒ½ç¡®å®šï¼Œä½†ä¹Ÿä¸å…¨æ˜¯ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨åœ¨è¿è¡Œæ—¶æœŸäº§ç”Ÿçš„å¸¸é‡ã€‚æ¯”å¦‚Stringç±»çš„internï¼ˆï¼‰æ–¹æ³•ï¼Œä½œç”¨æ˜¯Stringç±»ç»´æŠ¤äº†ä¸€ä¸ªå¸¸é‡æ± ï¼Œå¦‚æœè°ƒç”¨çš„å­—ç¬¦\"hello\"å·²ç»åœ¨å¸¸é‡æ± ä¸­ï¼Œåˆ™ç›´æ¥è¿”å›å¸¸é‡æ± ä¸­çš„åœ°å€ï¼Œå¦åˆ™æ–°å»ºä¸€ä¸ªå¸¸é‡åŠ å…¥æ± ä¸­ï¼Œå¹¶è¿”å›åœ°å€ã€‚ ","date":"2020-04-01","objectID":"/java_gc/:2:0","tags":["GC","Java"],"title":"Javaä¹‹GC","uri":"/java_gc/"},{"categories":["Java"],"content":"GCå¤§è‡´è¿‡ç¨‹ åœ¨JVMçš„å †å†…å­˜ä¸­ï¼Œè¢«åˆ†ä¸ºäº†å¹´è½»ä»£ï¼ˆYoung Generationï¼‰å’Œè€å¹´ä»£ï¼ˆOld Generationã€æŒä¹…ä»£ï¼ˆPermanent Generationï¼‰ã€‚å…¶ä¸­å¹´è½»ä»£åˆè¢«åˆ†ä¸ºEdenåŒºå’ŒsurvivoråŒºï¼Œè€ŒsurvivoråŒºåˆè¢«åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„2ä¸ªåŒºï¼Œåˆ†åˆ«ç§°ä¸ºS1åŒºå’ŒS2åŒºã€‚æŒä¹…ä»£åœ¨Sun Hotpotè™šæ‹Ÿæœºä¸­å°±æ˜¯æŒ‡æ–¹æ³•åŒºï¼ˆæœ‰äº›JVMæ ¹æœ¬å°±æ²¡æœ‰æŒä¹…ä»£è¿™ä¸€è¯´æ³•ï¼‰ å½“ç¨‹åºéœ€è¦åœ¨å †ä¸Šåˆ†é…å†…å­˜æ—¶ï¼Œä¼šé¦–å…ˆåœ¨edenåŒºè¿›è¡Œåˆ†é…ã€‚ å½“edenåŒºå†…å­˜å·²æ»¡æ— æ³•å†åˆ†é…å¯¹è±¡æ—¶ï¼Œä¼šè§¦å‘ç¬¬ä¸€æ¬¡minor gcï¼Œå°†edenåŒºå­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°å…¶ä¸­ä¸€ä¸ªsurvivoråŒºï¼Œæ¯”å¦‚S1ï¼Œå¹¶æŠŠedenåŒºçš„å†…å­˜æ¸…ç©ºï¼Œä»¥å¤‡ä½¿ç”¨ã€‚ å½“edenåŒºçš„å†…å­˜å†æ¬¡è¢«ä½¿ç”¨å®Œæ—¶ï¼Œä¼šè§¦å‘ç¬¬äºŒæ¬¡minor gcï¼Œå°†edenåŒºå’ŒS1åŒºä¸­å­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°S2åŒºï¼Œå¹¶å°†edenåŒºå’ŒS1åŒºçš„å†…å­˜æ¸…ç©ºä»¥å¤‡ä½¿ç”¨ã€‚åœ¨æœ‰çš„ä¹¦ä¸­ä¼šæåˆ°fromåŒºå’ŒtoåŒºï¼Œå…¶å®fromåŒºå’ŒtoåŒºæ˜¯ç›¸å¯¹è€Œè¨€çš„ï¼Œå½“æŠŠS1åŒºçš„å†…å®¹æ‹·è´åˆ°S2åŒºæ—¶ï¼ŒS1ä¸ºfromåŒºï¼ŒS2ä¸ºtoåŒºã€‚è€Œå°†S2åŒºçš„å†…å®¹æ‹·è´åˆ°S1æ—¶ï¼ŒS2ä¸ºfromåŒºï¼ŒS1ä¸ºtoåŒºã€‚ å½“edenåŒºçš„å†…å­˜å†æ¬¡è¢«ç”¨å®Œæ—¶ï¼Œä¼šè§¦å‘ç¬¬ä¸‰æ¬¡minor gcï¼Œå°†edenåŒºå’ŒS2åŒºå­˜æ´»çš„å¯¹è±¡æ‹·è´åˆ°S1åŒºï¼Œå¹¶æ¸…ç©ºedenåŒºå’ŒS2åŒºçš„å†…å­˜ï¼Œä»¥å¤‡ä½¿ç”¨ã€‚ ä¸Šè¿°è¿‡ç¨‹å¾ªç¯å¾€å¤ã€‚ å½“æŸä¸ªå¯¹è±¡ç»å†äº†ä¸€æ¬¡minor gcå¹¶ä¸”å­˜æ´»ä¸‹æ¥ï¼Œæ²¡æœ‰è¢«æ¸…ç†æ‰ï¼Œåˆ™è¯´è¿™ä¸ªå¯¹è±¡é•¿å¤§äº†ä¸€å²ã€‚å½“æŸä¸ªå¯¹è±¡çš„å¹´é¾„å¤§äºä¸€å®šé˜ˆå€¼ï¼Œé€šå¸¸æ˜¯15å²æ—¶ï¼Œè¯¥å¯¹è±¡åœ¨ä¸‹æ¬¡minor gcæ—¶ä¼šè¢«æ”¾åˆ°è€å¹´ä»£ä¸­ã€‚ å½“è€å¹´ä»£ä¸­çš„å†…å­˜ä¸å¤Ÿç”¨æ—¶ï¼Œä¼šè§¦å‘full gcã€‚ ","date":"2020-04-01","objectID":"/java_gc/:3:0","tags":["GC","Java"],"title":"Javaä¹‹GC","uri":"/java_gc/"},{"categories":["Docker","Golang"],"content":" æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.4 LTS Golangç‰ˆæœ¬ï¼š1.12.13 ","date":"2020-03-26","objectID":"/docker_go_namespace/:0:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Goè°ƒç”¨Namespace","uri":"/docker_go_namespace/"},{"categories":["Docker","Golang"],"content":"Golang Goè¯­è¨€æ˜¯Googleå¼€å‘çš„ä¸€ç§é™æ€ç±»å‹ã€ç¼–è¯‘å‹çš„é«˜çº§è¯­è¨€ï¼Œå®ƒè®¾è®¡çš„è›®ç®€å•çš„ï¼Œå­¦è¿‡Cçš„è¯ï¼Œå…¶å®ä¸Šæ‰‹Goå¾ˆå¿«çš„ï¼Œå½“ç„¶ç›¸æ¯”äºCçš„è¯ï¼ŒGoæœ‰åƒåœ¾å›æ”¶å’Œå¹¶å‘æ”¯æŒï¼Œæ‰€ä»¥å†™èµ·æ¥å¿ƒæ™ºè´Ÿæ‹…æ›´ä½ä¸€ç‚¹ã€‚ å¯¹äºGoçš„å®‰è£…å’Œé…ç½®ï¼Œæˆ‘ä»¥å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« â€”â€”goè¯­è¨€åŸºæœ¬é…ç½®ï¼Œæˆ‘è¿™é‡Œå°±ä¸åœ¨èµ˜è¿°äº†ã€‚Go1.11å¢åŠ äº†go modulesï¼Œä½¿ç”¨å®ƒçš„è¯ï¼Œå°±æ²¡å¿…è¦ä¸€å®šè¦æŠŠä»£ç æ”¾åˆ°GOPATHä¸‹é¢å•¦~(â‰§â–½â‰¦)/~ã€‚ go modulesè¯¦ç»† ä½¿ç”¨è¯·å‚è€ƒgo mod ä½¿ç”¨ã€‚ ","date":"2020-03-26","objectID":"/docker_go_namespace/:1:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Goè°ƒç”¨Namespace","uri":"/docker_go_namespace/"},{"categories":["Docker","Golang"],"content":"Goè°ƒç”¨Namespace å…¶å®å¯¹äºNamespaceè¿™ç§ç³»ç»Ÿè°ƒç”¨ï¼Œä½¿ç”¨Cè¯­è¨€æè¿°æ˜¯æœ€å¥½çš„ï¼ˆä¸Šä¸€ç¯‡æ–‡ç« å°±æ˜¯ç”¨Cå†™çš„ç¤ºä¾‹ï¼‰ï¼Œä½†æ˜¯Cæ¯”è¾ƒéš¾ï¼Œè€Œä¸”Dockerä¹Ÿæ˜¯ç”¨Goæ˜¯å®ç°çš„ï¼Œæ‰€ä»¥æˆ‘åé¢çš„æ–‡ç« éƒ½ä¼šç”¨Goæ¥å†™ç¤ºä¾‹ä»£ç ã€‚ è¿™é‡Œæˆ‘å…ˆå†™äº†ä¸€ä¸ªUTS Namespaceçš„ä¾‹å­ï¼ŒUTS Namespaceä¸»è¦ç”¨æ¥éš”ç¦»nodenameå’Œdomainnameè¿™ä¸¤ä¸ªç³»ç»Ÿæ ‡è¯†ï¼š package main import ( \"log\" \"os\" \"os/exec\" \"syscall\" ) func main() { cmd := exec.Command(\"sh\") cmd.SysProcAttr = \u0026syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUTS, } cmd.Stdin = os.Stdin cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr if err := cmd.Run(); err != nil { log.Fatal(err) } } exec.Command(\"sh\")æ˜¯æŒ‡å®šäº†forkå‡ºæ¥çš„æ–°è¿›ç¨‹å†…çš„åˆå§‹å‘½ä»¤ï¼Œcmd.SysProcAttrè¿™è¡Œå°±æ˜¯è®¾ç½®äº†ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼ŒGoå¸®æˆ‘ä»¬å°è£…äº†clone()å‡½æ•°ï¼Œsyscall.CLONE_NEWUTSè¿™ä¸ªæ ‡è¯†ç¬¦æ ‡æ˜åˆ›å»ºä¸€ä¸ªUTS Namespaceã€‚ go build .ç¼–è¯‘ä»£ç åï¼Œæ‰§è¡Œç¨‹åºæ—¶æˆ‘ä»¬ä¼šé‡åˆ°é”™è¯¯fork/exec /bin/sh: operation not permittedï¼Œè¿™æ˜¯å› ä¸ºclone()å‡½æ•°éœ€è¦CAP_SYS_ADMINæƒé™ï¼ˆè¿™ä¸ªé—®é¢˜æˆ‘åœ¨vç«™ä¸Šé—®è¿‡ï¼‰ï¼Œè§£å†³æ–¹æ³•æ˜¯æ·»åŠ è®¾ç½® uid æ˜ å°„ï¼š package main import ( \"log\" \"os\" \"os/exec\" \"syscall\" ) func main() { cmd := exec.Command(\"sh\") cmd.SysProcAttr = \u0026syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWUSER, UidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getuid(), Size: 1, }, }, GidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getgid(), Size: 1, }, }, } // set identify for this demo cmd.Env = []string{\"PS1=-[namespace-process]-# \"} cmd.Stdin = os.Stdin cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr if err := cmd.Run(); err != nil { log.Fatal(err) } } æˆ‘å¢åŠ äº†CLONE_NEWUSERæ ‡è¯†ï¼Œè®©æ–°è¿›ç¨‹åœ¨User Namespaceä¸­å˜æˆrootç”¨æˆ·ã€‚ $ ./uts-easy -[namespace-process]-# id uid=0(root) gid=0(root) groups=0(root),65534(nogroup) -[namespace-process]-# hostname -b bird -[namespace-process]-# hostname bird å¯åŠ¨å¦ä¸€ä¸ªshellï¼ŒæŸ¥çœ‹å®¿ä¸»æœºä¸Šhostname: $ hostname salamander-PC å¯ä»¥çœ‹åˆ°ï¼Œå¤–éƒ¨çš„hostnameå¹¶æ²¡æœ‰è¢«å†…éƒ¨çš„ä¿®æ”¹æ‰€å½±å“ï¼Œè¿™é‡Œæˆ‘ä»¬å¤§è‡´æ„Ÿå—äº†ä¸‹UTS Namespaceçš„ä½œç”¨ã€‚ ","date":"2020-03-26","objectID":"/docker_go_namespace/:2:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Goè°ƒç”¨Namespace","uri":"/docker_go_namespace/"},{"categories":["Docker","Golang"],"content":"å¢åŠ IPC Namespace IPC Namespaceç”¨æ¥éš”ç¦»System V IPCå’ŒPOSIX message queuesã€‚æ¯ä¸€ä¸ªIPC Namespaceéƒ½æœ‰è‡ªå·±çš„System V IPCå’ŒPOSIX message queuesã€‚æˆ‘ä»¬ç¨å¾®æ”¹åŠ¨ä¸€ä¸‹ä¸Šé¢çš„ä»£ç ã€‚ package main import ( \"log\" \"os\" \"os/exec\" \"syscall\" ) func main() { cmd := exec.Command(\"sh\") cmd.SysProcAttr = \u0026syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWUSER | syscall.CLONE_NEWIPC, // å¢åŠ IPC Namespace UidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getuid(), Size: 1, }, }, GidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getgid(), Size: 1, }, }, } // set identify for this demo cmd.Env = []string{\"PS1=-[namespace-process]-# \"} cmd.Stdin = os.Stdin cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr if err := cmd.Run(); err != nil { log.Fatal(err) } } æ–°å¼€ä¸€ä¸ªshellï¼Œåœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºä¸€ä¸ªmessage queue: $ ipcs -q --------- æ¶ˆæ¯é˜Ÿåˆ— ----------- é”® msqid æ‹¥æœ‰è€… æƒé™ å·²ç”¨å­—èŠ‚æ•° æ¶ˆæ¯ $ ipcmk -Q æ¶ˆæ¯é˜Ÿåˆ— idï¼š0 $ ipcs -q --------- æ¶ˆæ¯é˜Ÿåˆ— ----------- é”® msqid æ‹¥æœ‰è€… æƒé™ å·²ç”¨å­—èŠ‚æ•° æ¶ˆæ¯ 0xc59399dd 0 salamander 644 0 0 è¿è¡Œæˆ‘ä»¬è‡ªå·±çš„ç¨‹åºï¼š $ ./uts-easy -[namespace-process]-# ipcs -q ------ Message Queues -------- key msqid owner perms used-bytes messages å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ–°çš„Namespaceä¸­ï¼Œçœ‹ä¸åˆ°å®¿ä¸»æœºä¸Šåˆ›å»ºçš„message queue,è¯´æ˜IPCæ˜¯éš”ç¦»çš„ã€‚ ","date":"2020-03-26","objectID":"/docker_go_namespace/:3:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Goè°ƒç”¨Namespace","uri":"/docker_go_namespace/"},{"categories":["Docker","Golang"],"content":"å¢åŠ PID Namespace PID Namespaceæ˜¯ç”¨æ¥éš”ç¦»è¿›ç¨‹IDçš„ã€‚æˆ‘ä»¬è‡ªå·±è¿›å…¥Docker å®¹å™¨çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç°é‡Œé¢çš„å‰å°è¿›ç¨‹çš„PIDä¸º1ï¼Œä½†æ˜¯åœ¨å®¹å™¨å¤–PIDå´ä¸æ˜¯1ï¼Œè¿™å°±æ˜¯é€šè¿‡PID Namespaceåšåˆ°çš„ã€‚ä¿®æ”¹ä¸Šè¿°çš„ä»£ç ï¼Œå¢åŠ CLONE_NEWPIDï¼š package main import ( \"log\" \"os\" \"os/exec\" \"syscall\" ) func main() { cmd := exec.Command(\"sh\") cmd.SysProcAttr = \u0026syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWUSER | syscall.CLONE_NEWIPC | syscall.CLONE_NEWPID, // å¢åŠ PID Namespace UidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getuid(), Size: 1, }, }, GidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getgid(), Size: 1, }, }, } // set identify for this demo cmd.Env = []string{\"PS1=-[namespace-process]-# \"} cmd.Stdin = os.Stdin cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr if err := cmd.Run(); err != nil { log.Fatal(err) } } è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼š ./uts-easy -[namespace-process]-# echo $$ 1 å¯ä»¥çœ‹åˆ°åœ¨æ–°çš„PID Namespaceä¸­è¿›ç¨‹IDä¸º1ã€‚ $ pstree -pl | grep easy | | |-bash(10739)---uts-easy(10768)-+-sh(10773) | | | |-{uts-easy}(10769) | | | |-{uts-easy}(10770) | | | |-{uts-easy}(10771) | | | `-{uts-easy}(10772) è€Œæˆ‘ä»¬åœ¨å®¿ä¸»æœºä¸Šå¯ä»¥çœ‹åˆ°å®ƒå®é™…çš„PIDï¼ˆuts-easyè¿™ä¸ªè¿›ç¨‹ï¼‰ä¸º10768ã€‚ å¦‚æœç»†å¿ƒç‚¹ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ä½¿ç”¨psï¼Œtopè¿™äº›å‘½ä»¤å‡ºæ¥çš„ç»“æœè·Ÿå®¿ä¸»æœºä¸Šæ˜¯ä¸€æ ·çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿™äº›å‘½ä»¤å…¶å®æ˜¯å»ä½¿ç”¨**/proc**è¿™ä¸ªæ–‡ä»¶å¤¹çš„å†…å®¹ï¼Œè¿™ä¸ªå°±éœ€è¦ä¸‹é¢çš„Mount Namespaceäº†ã€‚ ","date":"2020-03-26","objectID":"/docker_go_namespace/:4:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Goè°ƒç”¨Namespace","uri":"/docker_go_namespace/"},{"categories":["Docker","Golang"],"content":"å¢åŠ Mount Namespace Mount Namespaceç”¨æ¥éš”ç¦»å„ä¸ªè¿›ç¨‹çœ‹åˆ°çš„æŒ‚è½½ç‚¹è§†å›¾ã€‚åœ¨ä¸åŒNamespaceçš„è¿›ç¨‹ä¸­ï¼Œçœ‹åˆ°çš„æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡æ˜¯ä¸ä¸€æ ·çš„ã€‚åœ¨Mount Namespaceä¸­è°ƒç”¨mount()å’Œunmount()åªä¼šå½±å“å½“å‰Namespaceå†…çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œå¯¹å…¨å±€çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯æ²¡æœ‰å½±å“çš„ã€‚ çœ‹åˆ°è¿™é‡Œï¼Œä¹Ÿè®¸ä¼šæƒ³åˆ°chroot()ã€‚å®ƒä¹Ÿèƒ½å°†æŸä¸€ä¸ªå­ç›®å½•å˜ä¸ºæ ¹èŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼ŒMount Namespaceä¸ä»…èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”èƒ½ä»¥æ›´åŠ çµæ´»å’Œå®‰å…¨çš„æ–¹å¼å®ç°ã€‚ ç°åœ¨ç»§ç»­ä¿®æ”¹ä¸Šè¿°ä»£ç ï¼Œå¢åŠ CLONE_NEWNSï¼ˆMount Namespaceæ˜¯Linuxå®ç°çš„ç¬¬ä¸€ä¸ªNamespaceç±»å‹ï¼Œå› ä¸ºï¼Œå®ƒçš„ç³»ç»Ÿè°ƒç”¨å‚æ•°æ˜¯NEWNSï¼ŒNSæ˜¯New Namespaceçš„ç¼©å†™ã€‚å½“æ—¶äººä»¬æ²¡æœ‰æ„è¯†åˆ°ï¼Œä»¥åè¿˜ä¼šæœ‰å¾ˆå¤šç±»å‹çš„NamespaceåŠ å…¥Linuxå¤§å®¶åº­ï¼‰ã€‚ package main import ( \"log\" \"os\" \"os/exec\" \"syscall\" ) func main() { cmd := exec.Command(\"sh\") cmd.SysProcAttr = \u0026syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWUSER | syscall.CLONE_NEWIPC | syscall.CLONE_NEWPID| syscall.CLONE_NEWNS, // å¢åŠ Mount Namespace UidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getuid(), Size: 1, }, }, GidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getgid(), Size: 1, }, }, } // set identify for this demo cmd.Env = []string{\"PS1=-[namespace-process]-# \"} cmd.Stdin = os.Stdin cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr if err := cmd.Run(); err != nil { log.Fatal(err) } } è¿è¡Œç¨‹åºï¼ŒæŸ¥çœ‹/procçš„æ–‡ä»¶å†…å®¹ã€‚ -[namespace-process]-# ls /proc 1 1537 198 212 2487 2818 29 3131 329 3363 3422 3557 3793 4250 492 5273 595 62 6519 72 80 87 919 crypto kmsg schedstat vmstat 10 16 1983 213 2501 2841 2902 3139 3297 3367 3425 3571 38 430 493 53 598 6220 654 7221 8042 88 922 devices kpagecgroup scsi zoneinfo 1025 17 2 2133 2506 2846 2913 3156 .... è¿™é‡Œè¾“å‡ºçš„ç»“æœå¾ˆå¤šï¼Œå› ä¸º**/procè¿˜æ˜¯å®¿ä¸»æœºçš„ï¼Œä¸‹é¢å°†/proc** mountåˆ°æˆ‘ä»¬è‡ªå·±çš„Namespaceä¸‹é¢æ¥ï¼š -[namespace-process]-# mount -t proc proc /proc -[namespace-process]-# ls /proc 1 buddyinfo consoles diskstats fb iomem kcore kpagecgroup locks modules pagetypeinfo schedstat softirqs sysrq-trigger tty vmallocinfo 4 bus cpuinfo dma filesystems ioports key-users kpagecount mdstat mounts partitions scsi stat sysvipc uptime vmstat acpi cgroups crypto driver fs irq keys kpageflags meminfo mtrr pressure self swaps thread-self version zoneinfo asound cmdline devices execdomains interrupts kallsyms kmsg loadavg misc net sched_debug slabinfo sys timer_list version_signature ç»“æœä¸€ä¸‹å­å°‘äº†å¾ˆå¤šï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨psæ¥æŸ¥çœ‹ç³»ç»Ÿçš„è¿›ç¨‹äº†ã€‚ -[namespace-process]-# ps -ef UID PID PPID C STIME TTY TIME CMD root 1 0 0 17:07 pts/1 00:00:00 sh root 5 1 0 17:11 pts/1 00:00:00 ps -ef å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰çš„Namespaceä¸­ï¼Œshè¿›ç¨‹æ˜¯PIDä¸º1çš„è¿›ç¨‹ã€‚ ","date":"2020-03-26","objectID":"/docker_go_namespace/:5:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Goè°ƒç”¨Namespace","uri":"/docker_go_namespace/"},{"categories":["Docker","Golang"],"content":"å¢åŠ Network Namespace Network Namespaceæ˜¯ç”¨æ¥éš”ç¦»ç½‘ç»œè®¾å¤‡ã€IPåœ°å€ç«¯å£ç­‰ç½‘ç»œæ ˆçš„Namespaceã€‚Network Namespaceå¯ä»¥è®©æ¯ä¸ªå®¹å™¨æ‹¥æœ‰è‡ªå·±ç‹¬ç«‹ï¼ˆè™šæ‹Ÿçš„ï¼‰ç½‘ç»œè®¾å¤‡ï¼Œè€Œä¸”å®¹å™¨å†…çš„åº”ç”¨å¯ä»¥ç»‘å®šåˆ°è‡ªå·±çš„ç«¯å£ï¼Œæ¯ä¸ªNamespaceå†…çš„ç«¯å£éƒ½ä¸ä¼šäº’ç›¸å†²çªã€‚åœ¨å®¿ä¸»æœºä¸Šæ­å»ºç½‘æ¡¥åï¼Œå°±èƒ½å¾ˆæ–¹ä¾¿åœ°å®ç°å®¹å™¨ä¹‹é—´é€šè®¯ï¼Œè€Œä¸”ä¸åŒå®¹å™¨ä¸Šçš„åº”ç”¨å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ç«¯å£ã€‚ ç»§ç»­ä¸Šè¿°ä»£ç ï¼ŒåŠ å…¥CLONE_NEWNETï¼š package main import ( \"log\" \"os\" \"os/exec\" \"syscall\" ) func main() { cmd := exec.Command(\"sh\") cmd.SysProcAttr = \u0026syscall.SysProcAttr{ Cloneflags: syscall.CLONE_NEWUTS | syscall.CLONE_NEWUSER | syscall.CLONE_NEWIPC | syscall.CLONE_NEWPID| syscall.CLONE_NEWNS | syscall.CLONE_NEWNET, // å¢åŠ Network Namespace UidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getuid(), Size: 1, }, }, GidMappings: []syscall.SysProcIDMap{ { ContainerID: 0, HostID: os.Getgid(), Size: 1, }, }, } // set identify for this demo cmd.Env = []string{\"PS1=-[namespace-process]-# \"} cmd.Stdin = os.Stdin cmd.Stdout = os.Stdout cmd.Stderr = os.Stderr if err := cmd.Run(); err != nil { log.Fatal(err) } } è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºï¼ŒæŸ¥çœ‹ç½‘ç»œè®¾å¤‡ï¼Œå‘ç°ä¸ºç©º -[namespace-process]-# ifconfig -[namespace-process]-# åœ¨å®¿ä¸»æœºä¸ŠæŸ¥çœ‹ç½‘ç»œè®¾å¤‡ï¼Œå‘ç°æœ‰lo, enp7s0è¿™äº›ç½‘ç»œè®¾å¤‡ã€‚ enp7s0: flags=4099\u003cUP,BROADCAST,MULTICAST\u003e mtu 1500 ether 98:fa:9b:f0:85:c2 txqueuelen 1000 (ä»¥å¤ªç½‘) RX packets 0 bytes 0 (0.0 B) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 0 bytes 0 (0.0 B) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 lo: flags=73\u003cUP,LOOPBACK,RUNNING\u003e mtu 65536 inet 127.0.0.1 netmask 255.0.0.0 inet6 ::1 prefixlen 128 scopeid 0x10\u003chost\u003e loop txqueuelen 1000 (æœ¬åœ°ç¯å›) RX packets 16381 bytes 23729834 (23.7 MB) RX errors 0 dropped 0 overruns 0 frame 0 TX packets 16381 bytes 23729834 (23.7 MB) TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0 .... ä»ä¸Šé¢çš„ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºNetworkæ˜¯éš”ç¦»äº†ã€‚ ","date":"2020-03-26","objectID":"/docker_go_namespace/:6:0","tags":["Docker","Linux"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Goè°ƒç”¨Namespace","uri":"/docker_go_namespace/"},{"categories":["protocol","https"],"content":"https httpså°±æ˜¯åœ¨httpçš„åŸºç¡€ä¸Šåˆå¢åŠ äº†ä¸€ä¸ªTLSå±‚ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªå¥—å£³åè®®ã€‚ ","date":"2020-03-21","objectID":"/https_more/:1:0","tags":["https","åè®®"],"title":"httpsæ·±å…¥åˆ†æ","uri":"/https_more/"},{"categories":["protocol","https"],"content":"åŠ å¯†å’Œè§£å¯† httpsçš„å‘å±•å’Œå¯†ç å­¦çš„å‘å±•æ˜¯åˆ†ä¸å¼€çš„ã€‚åŠ å¯†æ–¹å¼å¯ä»¥å¤§ä½“åˆ†ä¸ºå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯† å¯¹ç§°åŠ å¯†ï¼Œå°±æ˜¯åŠ å¯†å’Œè§£å¯†éƒ½æ˜¯ç”¨åŒä¸€ä¸ªç§˜é’¥ï¼Œè¿™ç§æ–¹å¼ä¼˜ç‚¹å°±æ˜¯é€Ÿåº¦å¿«ï¼Œç¼ºç‚¹å°±æ˜¯åœ¨ç®¡ç†å’Œåˆ†é…ç§˜é’¥çš„æ—¶å€™ä¸å®‰å…¨ã€‚ éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œéå¯¹ç§°åŠ å¯†æœ‰ä¸€ä¸ªç§˜é’¥å¯¹ï¼Œå«åšå…¬é’¥å’Œç§é’¥ï¼Œç§é’¥è‡ªå·±æŒæœ‰ï¼Œå…¬é’¥å¯ä»¥å…¬å¼€çš„å‘é€ç»™ä½¿ç”¨çš„äººã€‚ä½¿ç”¨å…¬é’¥è¿›è¡ŒåŠ å¯†çš„ä¿¡æ¯ï¼Œåªæœ‰å’Œå…¶é…å¯¹çš„ç§é’¥å¯ä»¥è§£å¼€ã€‚ç›®å‰å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯RSAï¼Œéå¯¹ç§°çš„åŠ å¯†ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å®‰å…¨ï¼Œå› ä¸ºä»–ä¸éœ€è¦æŠŠç§é’¥æš´éœ²å‡ºå»ã€‚ åœ¨æ­£å¼çš„ä½¿ç”¨åœºæ™¯ä¸­ä¸€èˆ¬éƒ½æ˜¯å¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆä½¿ç”¨ï¼Œä½¿ç”¨éå¯¹ç§°åŠ å¯†å®Œæˆç§˜é’¥çš„ä¼ é€’ï¼Œç„¶åä½¿ç”¨å¯¹ç§°ç§˜é’¥è¿›è¡Œæ•°æ®åŠ å¯†å’Œè§£å¯† ","date":"2020-03-21","objectID":"/https_more/:2:0","tags":["https","åè®®"],"title":"httpsæ·±å…¥åˆ†æ","uri":"/https_more/"},{"categories":["protocol","https"],"content":"httpsçš„ç®€è¦æµç¨‹ å…ˆæ˜¯ç»å…¸çš„TCPä¸‰æ¬¡æ¡æ‰‹ï¼Œè¿™é‡Œä¸è¯¦ç»†å±•å¼€äº†ã€‚ client Hello,å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨ï¼‰å…ˆå‘æœåŠ¡å™¨å‘å‡ºåŠ å¯†é€šä¿¡çš„è¯·æ±‚ * æ”¯æŒçš„åè®®ç‰ˆæœ¬ï¼Œæ¯”å¦‚TLS 1.0ç‰ˆã€‚ * ä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•° random1ï¼Œç¨åç”¨äºç”Ÿæˆ\"å¯¹è¯å¯†é’¥\"ã€‚ * æ”¯æŒçš„åŠ å¯†æ–¹æ³•ï¼Œæ¯”å¦‚RSAå…¬é’¥åŠ å¯†ã€‚ * æ”¯æŒçš„å‹ç¼©æ–¹æ³•ã€‚ æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚,ç„¶åå“åº” (server Hello) * ç¡®è®¤ä½¿ç”¨çš„åŠ å¯†é€šä¿¡åè®®ç‰ˆæœ¬ï¼Œæ¯”å¦‚TLS 1.0ç‰ˆæœ¬ã€‚å¦‚æœæµè§ˆå™¨ä¸æœåŠ¡å™¨æ”¯æŒçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼ŒæœåŠ¡å™¨å…³é—­åŠ å¯†é€šä¿¡ã€‚ * ä¸€ä¸ªæœåŠ¡å™¨ç”Ÿæˆçš„éšæœºæ•°random2ï¼Œç¨åç”¨äºç”Ÿæˆ\"å¯¹è¯å¯†é’¥\"ã€‚ * ç¡®è®¤ä½¿ç”¨çš„åŠ å¯†æ–¹æ³•ï¼Œæ¯”å¦‚RSAå…¬é’¥åŠ å¯†ã€‚ * æœåŠ¡å™¨è¯ä¹¦ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°è¯ä¹¦ä¹‹åä¼šé¦–å…ˆä¼šè¿›è¡ŒéªŒè¯ éªŒè¯é€šè¿‡ä¹‹åï¼Œå®¢æˆ·ç«¯ä¼šç”Ÿæˆä¸€ä¸ªéšæœºæ•°pre-master secretï¼Œç„¶åä½¿ç”¨è¯ä¹¦ä¸­çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç„¶åä¼ é€’ç»™æœåŠ¡å™¨ç«¯ æœåŠ¡å™¨æ”¶åˆ°ä½¿ç”¨å…¬é’¥åŠ å¯†çš„å†…å®¹ï¼Œåœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ç§é’¥è§£å¯†ä¹‹åè·å¾—éšæœºæ•°pre-master secretï¼Œç„¶åæ ¹æ®radom1ã€radom2ã€pre-master secreté€šè¿‡ä¸€å®šçš„ç®—æ³•å¾—å‡ºsession Keyå’ŒMACç®—æ³•ç§˜é’¥ï¼Œä½œä¸ºåé¢äº¤äº’è¿‡ç¨‹ä¸­ä½¿ç”¨å¯¹ç§°ç§˜é’¥ã€‚åŒæ—¶å®¢æˆ·ç«¯ä¹Ÿä¼šä½¿ç”¨radom1ã€radom2ã€pre-master secretï¼Œå’ŒåŒæ ·çš„ç®—æ³•ç”Ÿæˆsession Keyå’ŒMACç®—æ³•çš„ç§˜é’¥ã€‚ ","date":"2020-03-21","objectID":"/https_more/:3:0","tags":["https","åè®®"],"title":"httpsæ·±å…¥åˆ†æ","uri":"/https_more/"},{"categories":["protocol","https"],"content":"httpsè¯ä¹¦ æœåŠ¡å™¨å‘ç»™äº†å®¢æˆ·ç«¯è¯ä¹¦ï¼Œå®¢æˆ·ç«¯æ˜¯å¦‚ä½•éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§çš„å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬åˆ†æä¸€ä¸‹å®ƒçš„åŸç†ã€‚ SSL è¯ä¹¦ä¸­åŒ…å«çš„å…·ä½“å†…å®¹æœ‰ï¼š ï¼ˆ1ï¼‰è¯ä¹¦çš„å‘å¸ƒæœºæ„CA ï¼ˆ2ï¼‰è¯ä¹¦çš„æœ‰æ•ˆæœŸ ï¼ˆ3ï¼‰å…¬é’¥ ï¼ˆ4ï¼‰è¯ä¹¦æ‰€æœ‰è€… ï¼ˆ5ï¼‰ç­¾å â€¦ CAæœºæ„åœ¨ç­¾å‘è¯ä¹¦çš„æ—¶å€™ï¼Œéƒ½ä¼šä½¿ç”¨è‡ªå·±çš„ç§é’¥å¯¹è¯ä¹¦è¿›è¡Œç­¾åï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯è´­ä¹°çš„è¯ä¹¦ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½ï¼Œé¢å‘è¿™ä¸ªè¯ä¹¦çš„CAæœºæ„çš„å…¬é’¥å·²ç»é¢„ç½®åœ¨æ“ä½œç³»ç»Ÿä¸­ã€‚è¿™æ ·æµè§ˆå™¨å°±å¯ä»¥ä½¿ç”¨CAæœºæ„çš„å…¬é’¥å¯¹æœåŠ¡å™¨çš„è¯ä¹¦è¿›è¡ŒéªŒç­¾ï¼ŒéªŒç­¾ä¹‹åå¾—åˆ°çš„æ˜¯CAæœºæ„ä½¿ç”¨sha256å¾—åˆ°çš„è¯ä¹¦æ‘˜è¦ï¼Œå®¢æˆ·ç«¯å°±ä¼šå¯¹æœåŠ¡å™¨å‘é€è¿‡æ¥çš„è¯ä¹¦ä½¿ç”¨sha256è¿›è¡Œå“ˆå¸Œè®¡ç®—å¾—åˆ°ä¸€ä»½æ‘˜è¦ï¼Œç„¶åå¯¹æ¯”ä¹‹å‰ç”±CAå¾—å‡ºæ¥çš„æ‘˜è¦ï¼Œå°±å¯ä»¥çŸ¥é“è¿™ä¸ªè¯ä¹¦æ˜¯ä¸æ˜¯æ­£ç¡®çš„ï¼Œæ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚ æ‰€ä»¥è¯´åŸç†å°±æ˜¯å› ä¸ºCAæœºæ„çš„å…¬é’¥å·²ç»é¢„å­˜äºæˆ‘ä»¬çš„æ“ä½œç³»ç»Ÿä¹‹ä¸­ã€‚ å®Œæ•´çš„éªŒè¯è¿‡ç¨‹å¦‚ä¸‹ï¼š é¦–å…ˆæµè§ˆå™¨è¯»å–è¯ä¹¦ä¸­çš„è¯ä¹¦æ‰€æœ‰è€…ã€æœ‰æ•ˆæœŸç­‰ä¿¡æ¯è¿›è¡Œä¸€ä¸€æ ¡éªŒï¼› æµè§ˆå™¨å¼€å§‹æŸ¥æ‰¾æ“ä½œç³»ç»Ÿä¸­å·²å†…ç½®çš„å—ä¿¡ä»»çš„è¯ä¹¦å‘å¸ƒæœºæ„CAï¼Œä¸æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ä¸­çš„é¢å‘è€…CAæ¯”å¯¹ï¼Œç”¨äºæ ¡éªŒè¯ä¹¦æ˜¯å¦ä¸ºåˆæ³•æœºæ„é¢å‘ï¼› å¦‚æœæ‰¾ä¸åˆ°ï¼Œæµè§ˆå™¨å°±ä¼šæŠ¥é”™ï¼Œè¯´æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦æ˜¯ä¸å¯ä¿¡ä»»çš„ï¼› å¦‚æœæ‰¾åˆ°ï¼Œé‚£ä¹ˆæµè§ˆå™¨å°±ä¼šä»æ“ä½œç³»ç»Ÿä¸­å–å‡º é¢å‘è€…CA çš„å…¬é’¥ï¼Œç„¶åå¯¹æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦é‡Œé¢çš„ç­¾åè¿›è¡Œè§£å¯†ï¼› æµè§ˆå™¨ä½¿ç”¨ç›¸åŒçš„hashç®—æ³•è®¡ç®—å‡ºæœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦çš„hashå€¼ï¼Œå°†è¿™ä¸ªè®¡ç®—çš„hashå€¼ä¸è¯ä¹¦ä¸­ç­¾ååšå¯¹æ¯”ï¼› å¯¹æ¯”ç»“æœä¸€è‡´ï¼Œåˆ™è¯æ˜æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦åˆæ³•ï¼Œæ²¡æœ‰è¢«å†’å……ï¼› æ­¤æ—¶æµè§ˆå™¨å°±å¯ä»¥è¯»å–è¯ä¹¦ä¸­çš„å…¬é’¥ï¼Œç”¨äºåç»­åŠ å¯†äº† å‚è€ƒï¼š æ·±å…¥ç†è§£HTTPSåè®® HTTPSåè®®åŸç†å’Œæµç¨‹åˆ†æ ","date":"2020-03-21","objectID":"/https_more/:4:0","tags":["https","åè®®"],"title":"httpsæ·±å…¥åˆ†æ","uri":"/https_more/"},{"categories":["Java"],"content":" Zookeeper æ˜¯ Apache çš„ä¸€ä¸ªé¡¶çº§é¡¹ç›®ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›é«˜æ•ˆã€é«˜å¯ç”¨çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œæä¾›äº†è¯¸å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥å’Œåˆ†å¸ƒå¼é”ç­‰åˆ†å¸ƒå¼åŸºç¡€æœåŠ¡ã€‚ ç”±äº ZooKeeper ä¾¿æ·çš„ä½¿ç”¨æ–¹å¼ã€å“è¶Šçš„æ€§èƒ½å’Œè‰¯å¥½çš„ç¨³å®šæ€§ï¼Œè¢«å¹¿æ³›åœ°åº”ç”¨äºè¯¸å¦‚ Hadoopã€HBaseã€Kafka å’Œ Dubbo ç­‰å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ã€‚ ","date":"2020-03-12","objectID":"/zookeeper_cluster_lock/:0:0","tags":["zookeeper","Java"],"title":"åŸºäºZookeeperçš„åˆ†å¸ƒå¼é”","uri":"/zookeeper_cluster_lock/"},{"categories":["Java"],"content":"æ­å»ºZookeeperé›†ç¾¤ è¿™é‡Œæˆ‘ä»¬ç”¨Dockeråœ¨æœ¬æœºä¸Šå¿«é€Ÿæ­å»ºä¸€ä¸ªzké›†ç¾¤ï¼Œæ ¹æ®å®˜æ–¹çš„zookeeperé•œåƒç»™çš„docker-composeæ–‡ä»¶ï¼Œæˆ‘ä»¬ç¨åŠ ä¿®æ”¹å°±å¯ä»¥äº†ï¼š version: '2' services: zoo1: image: zookeeper:3.4 restart: always hostname: zoo1 ports: - 2181:2181 environment: ZOO_MY_ID: 1 ZOO_SERVERS: server.1=0.0.0.0:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888 volumes: - ./zoo1/data:/data - ./zoo1/datalog:/datalog zoo2: image: zookeeper:3.4 restart: always hostname: zoo2 ports: - 2182:2181 environment: ZOO_MY_ID: 2 ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=0.0.0.0:2888:3888 server.3=zoo3:2888:3888 volumes: - ./zoo2/data:/data - ./zoo2/datalog:/datalog zoo3: image: zookeeper:3.4 restart: always hostname: zoo3 ports: - 2183:2181 environment: ZOO_MY_ID: 3 ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=0.0.0.0:2888:3888 volumes: - ./zoo3/data:/data - ./zoo3/datalog:/datalog docker-compose up å¯åŠ¨é›†ç¾¤ï¼Œç„¶åæŸ¥çœ‹æœåŠ¡çŠ¶æ€ï¼š $ docker-compose ps Name Command State Ports ------------------------------------------------------------------------------------------------------------------------ zookeeper-cluster_zoo1_1 /docker-entrypoint.sh zkSe ... Up 0.0.0.0:2181-\u003e2181/tcp, 2888/tcp, 3888/tcp, 8080/tcp zookeeper-cluster_zoo2_1 /docker-entrypoint.sh zkSe ... Up 0.0.0.0:2182-\u003e2181/tcp, 2888/tcp, 3888/tcp, 8080/tcp zookeeper-cluster_zoo3_1 /docker-entrypoint.sh zkSe ... Up 0.0.0.0:2183-\u003e2181/tcp, 2888/tcp, 3888/tcp, 8080/tcp $ docker-compose exec zoo1 ./bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /conf/zoo.cfg Mode: follower $ docker-compose exec zoo2 ./bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /conf/zoo.cfg Mode: follower $ docker-compose exec zoo3 ./bin/zkServer.sh status ZooKeeper JMX enabled by default Using config: /conf/zoo.cfg Mode: leader å¯ä»¥çœ‹åˆ°zoo3è¿™ä¸ªèŠ‚ç‚¹æ˜¯leaderèŠ‚ç‚¹ï¼ˆzookeeper3.5çš„é•œåƒä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œé›†ç¾¤èµ·æ¥åæœ‰ä¸ªèŠ‚ç‚¹ä¸€ç›´å‡ºé”™ï¼Œæ‰€ä»¥æˆ‘ç”¨äº†3.4ï¼‰ã€‚ ","date":"2020-03-12","objectID":"/zookeeper_cluster_lock/:1:0","tags":["zookeeper","Java"],"title":"åŸºäºZookeeperçš„åˆ†å¸ƒå¼é”","uri":"/zookeeper_cluster_lock/"},{"categories":["Java"],"content":"zookeeperé…ç½®æ–‡ä»¶ zoo.cfgé…ç½®æ–‡ä»¶å¸¸è§é…ç½® tickTime=2000 initLimit=10 syncLimit=5 dataLogDir=/opt/zookeeper/logs dataDir=/opt/zookeeper/data clientPort=2181 autopurge.snapRetainCount=500 autopurge.purgeInterval=24 server.1= 192.168.1.148:2888:3888 server.2= 192.168.1.149:2888:3888 server.3= 192.168.1.150:2888:3888 zoo.cfgé…ç½®æ–‡ä»¶å‚æ•°è¯¦ç»†è¯´æ˜ å‚æ•°å è¯´æ˜ clientPort å®¢æˆ·ç«¯è¿æ¥serverçš„ç«¯å£ï¼Œå³å¯¹å¤–æœåŠ¡ç«¯å£ï¼Œä¸€èˆ¬è®¾ç½®ä¸º2181å§ã€‚ dataDir å­˜å‚¨å¿«ç…§æ–‡ä»¶snapshotçš„ç›®å½•ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡æ—¥å¿—ä¹Ÿä¼šå­˜å‚¨åœ¨è¿™é‡Œã€‚å»ºè®®åŒæ—¶é…ç½®å‚æ•°dataLogDir, äº‹åŠ¡æ—¥å¿—çš„å†™æ€§èƒ½ç›´æ¥å½±å“zkæ€§èƒ½ã€‚ tickTime ZKä¸­çš„ä¸€ä¸ªæ—¶é—´å•å…ƒã€‚ZKä¸­æ‰€æœ‰æ—¶é—´éƒ½æ˜¯ä»¥è¿™ä¸ªæ—¶é—´å•å…ƒä¸ºåŸºç¡€ï¼Œè¿›è¡Œæ•´æ•°å€é…ç½®çš„ã€‚ä¾‹å¦‚ï¼Œsessionçš„æœ€å°è¶…æ—¶æ—¶é—´æ˜¯2*tickTimeã€‚ dataLogDir äº‹åŠ¡æ—¥å¿—è¾“å‡ºç›®å½•ã€‚å°½é‡ç»™äº‹åŠ¡æ—¥å¿—çš„è¾“å‡ºé…ç½®å•ç‹¬çš„ç£ç›˜æˆ–æ˜¯æŒ‚è½½ç‚¹ï¼Œè¿™å°†æå¤§çš„æå‡ZKæ€§èƒ½ã€‚ ï¼ˆNo Java system propertyï¼‰ globalOutstandingLimit æœ€å¤§è¯·æ±‚å †ç§¯æ•°ã€‚é»˜è®¤æ˜¯1000ã€‚ZKè¿è¡Œçš„æ—¶å€™ï¼Œ å°½ç®¡serverå·²ç»æ²¡æœ‰ç©ºé—²æ¥å¤„ç†æ›´å¤šçš„å®¢æˆ·ç«¯è¯·æ±‚äº†ï¼Œä½†æ˜¯è¿˜æ˜¯å…è®¸å®¢æˆ·ç«¯å°†è¯·æ±‚æäº¤åˆ°æœåŠ¡å™¨ä¸Šæ¥ï¼Œä»¥æé«˜ååæ€§èƒ½ã€‚å½“ç„¶ï¼Œä¸ºäº†é˜²æ­¢Serverå†…å­˜æº¢å‡ºï¼Œè¿™ä¸ªè¯·æ±‚å †ç§¯æ•°è¿˜æ˜¯éœ€è¦é™åˆ¶ä¸‹çš„ã€‚ (Java system property:zookeeper.globalOutstandingLimit. ) preAllocSize é¢„å…ˆå¼€è¾Ÿç£ç›˜ç©ºé—´ï¼Œç”¨äºåç»­å†™å…¥äº‹åŠ¡æ—¥å¿—ã€‚é»˜è®¤æ˜¯64Mï¼Œæ¯ä¸ªäº‹åŠ¡æ—¥å¿—å¤§å°å°±æ˜¯64Mã€‚å¦‚æœZKçš„å¿«ç…§é¢‘ç‡è¾ƒå¤§çš„è¯ï¼Œå»ºè®®é€‚å½“å‡å°è¿™ä¸ªå‚æ•°ã€‚(Java system property:zookeeper.preAllocSize ) snapCount æ¯è¿›è¡ŒsnapCountæ¬¡äº‹åŠ¡æ—¥å¿—è¾“å‡ºåï¼Œè§¦å‘ä¸€æ¬¡å¿«ç…§(snapshot), æ­¤æ—¶ï¼ŒZKä¼šç”Ÿæˆä¸€ä¸ªsnapshot.æ–‡ä»¶ï¼ŒåŒæ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡æ—¥å¿—æ–‡ä»¶log.ã€‚é»˜è®¤æ˜¯100000.ï¼ˆçœŸæ­£çš„ä»£ç å®ç°ä¸­ï¼Œä¼šè¿›è¡Œä¸€å®šçš„éšæœºæ•°å¤„ç†ï¼Œä»¥é¿å…æ‰€æœ‰æœåŠ¡å™¨åœ¨åŒä¸€æ—¶é—´è¿›è¡Œå¿«ç…§è€Œå½±å“æ€§èƒ½ï¼‰(Java system property:zookeeper.snapCount ) traceFile ç”¨äºè®°å½•æ‰€æœ‰è¯·æ±‚çš„logï¼Œä¸€èˆ¬è°ƒè¯•è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç”Ÿäº§ç¯å¢ƒä¸å»ºè®®ä½¿ç”¨ï¼Œä¼šä¸¥é‡å½±å“æ€§èƒ½ã€‚(Java system property:? requestTraceFile ) maxClientCnxns å•ä¸ªå®¢æˆ·ç«¯ä¸å•å°æœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ•°çš„é™åˆ¶ï¼Œæ˜¯ipçº§åˆ«çš„ï¼Œé»˜è®¤æ˜¯60ï¼Œå¦‚æœè®¾ç½®ä¸º0ï¼Œé‚£ä¹ˆè¡¨æ˜ä¸ä½œä»»ä½•é™åˆ¶ã€‚è¯·æ³¨æ„è¿™ä¸ªé™åˆ¶çš„ä½¿ç”¨èŒƒå›´ï¼Œä»…ä»…æ˜¯å•å°å®¢æˆ·ç«¯æœºå™¨ä¸å•å°ZKæœåŠ¡å™¨ä¹‹é—´çš„è¿æ¥æ•°é™åˆ¶ï¼Œä¸æ˜¯é’ˆå¯¹æŒ‡å®šå®¢æˆ·ç«¯IPï¼Œä¹Ÿä¸æ˜¯ZKé›†ç¾¤çš„è¿æ¥æ•°é™åˆ¶ï¼Œä¹Ÿä¸æ˜¯å•å°ZKå¯¹æ‰€æœ‰å®¢æˆ·ç«¯çš„è¿æ¥æ•°é™åˆ¶ã€‚æŒ‡å®šå®¢æˆ·ç«¯IPçš„é™åˆ¶ç­–ç•¥ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªpatchï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹ï¼šhttp://rdc.taobao.com/team/jm/archives/1334ï¼ˆNo Java system propertyï¼‰ clientPortAddress å¯¹äºå¤šç½‘å¡çš„æœºå™¨ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªIPæŒ‡å®šä¸åŒçš„ç›‘å¬ç«¯å£ã€‚é»˜è®¤æƒ…å†µæ˜¯æ‰€æœ‰IPéƒ½ç›‘å¬ clientPort æŒ‡å®šçš„ç«¯å£ã€‚ New in 3.3.0 minSessionTimeoutmaxSessionTimeoutSession è¶…æ—¶æ—¶é—´é™åˆ¶ï¼Œå¦‚æœå®¢æˆ·ç«¯è®¾ç½®çš„è¶…æ—¶æ—¶é—´ä¸åœ¨è¿™ä¸ªèŒƒå›´ï¼Œé‚£ä¹ˆä¼šè¢«å¼ºåˆ¶è®¾ç½®ä¸ºæœ€å¤§æˆ–æœ€å°æ—¶é—´ã€‚é»˜è®¤çš„Sessionè¶…æ—¶æ—¶é—´æ˜¯åœ¨2 * tickTime ~ 20 * tickTime è¿™ä¸ªèŒƒå›´ New in 3.3.0 fsync.warningthresholdms äº‹åŠ¡æ—¥å¿—è¾“å‡ºæ—¶ï¼Œå¦‚æœè°ƒç”¨fsyncæ–¹æ³•è¶…è¿‡æŒ‡å®šçš„è¶…æ—¶æ—¶é—´ï¼Œé‚£ä¹ˆä¼šåœ¨æ—¥å¿—ä¸­è¾“å‡ºè­¦å‘Šä¿¡æ¯ã€‚é»˜è®¤æ˜¯1000msã€‚(Java system property: fsync.warningthresholdms )New in 3.3.4 autopurge.purgeInterval åœ¨ä¸Šæ–‡ä¸­å·²ç»æåˆ°ï¼Œ3.4.0åŠä¹‹åç‰ˆæœ¬ï¼ŒZKæä¾›äº†è‡ªåŠ¨æ¸…ç†äº‹åŠ¡æ—¥å¿—å’Œå¿«ç…§æ–‡ä»¶çš„åŠŸèƒ½ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†æ¸…ç†é¢‘ç‡ï¼Œå•ä½æ˜¯å°æ—¶ï¼Œéœ€è¦é…ç½®ä¸€ä¸ª1æˆ–æ›´å¤§çš„æ•´æ•°ï¼Œé»˜è®¤æ˜¯0ï¼Œè¡¨ç¤ºä¸å¼€å¯è‡ªåŠ¨æ¸…ç†åŠŸèƒ½ã€‚(No Java system property) New in 3.4.0 autopurge.snapRetainCount è¿™ä¸ªå‚æ•°å’Œä¸Šé¢çš„å‚æ•°æ­é…ä½¿ç”¨ï¼Œè¿™ä¸ªå‚æ•°æŒ‡å®šäº†éœ€è¦ä¿ç•™çš„æ–‡ä»¶æ•°ç›®ã€‚é»˜è®¤æ˜¯ä¿ç•™3ä¸ªã€‚(No Java system property) New in 3.4.0 electionAlg åœ¨ä¹‹å‰çš„ç‰ˆæœ¬ä¸­ï¼Œ è¿™ä¸ªå‚æ•°é…ç½®æ˜¯å…è®¸æˆ‘ä»¬é€‰æ‹©leaderé€‰ä¸¾ç®—æ³•ï¼Œä½†æ˜¯ç”±äºåœ¨ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œåªä¼šç•™ä¸‹ä¸€ç§â€œTCP-based version of fast leader electionâ€ç®—æ³•ï¼Œæ‰€ä»¥è¿™ä¸ªå‚æ•°ç›®å‰çœ‹æ¥æ²¡æœ‰ç”¨äº†ï¼Œè¿™é‡Œä¹Ÿä¸è¯¦ç»†å±•å¼€è¯´äº†ã€‚(No Java system property) initLimitFollowe råœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼Œä¼šä»LeaderåŒæ­¥æ‰€æœ‰æœ€æ–°æ•°æ®ï¼Œç„¶åç¡®å®šè‡ªå·±èƒ½å¤Ÿå¯¹å¤–æœåŠ¡çš„èµ·å§‹çŠ¶æ€ã€‚Leaderå…è®¸Fåœ¨ initLimit æ—¶é—´å†…å®Œæˆè¿™ä¸ªå·¥ä½œã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸ç”¨å¤ªåœ¨æ„è¿™ä¸ªå‚æ•°çš„è®¾ç½®ã€‚å¦‚æœZKé›†ç¾¤çš„æ•°æ®é‡ç¡®å®å¾ˆå¤§äº†ï¼ŒFåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä»Leaderä¸ŠåŒæ­¥æ•°æ®çš„æ—¶é—´ä¹Ÿä¼šç›¸åº”å˜é•¿ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦é€‚å½“è°ƒå¤§è¿™ä¸ªå‚æ•°äº†ã€‚(No Java system property) syncLimit åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒLeaderè´Ÿè´£ä¸ZKé›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚é€šè¿‡ä¸€äº›å¿ƒè·³æ£€æµ‹æœºåˆ¶ï¼Œæ¥æ£€æµ‹æœºå™¨çš„å­˜æ´»çŠ¶æ€ã€‚å¦‚æœLå‘å‡ºå¿ƒè·³åŒ…åœ¨syncLimitä¹‹åï¼Œè¿˜æ²¡æœ‰ä»Fé‚£é‡Œæ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆå°±è®¤ä¸ºè¿™ä¸ªFå·²ç»ä¸åœ¨çº¿äº†ã€‚æ³¨æ„ï¼šä¸è¦æŠŠè¿™ä¸ªå‚æ•°è®¾ç½®å¾—è¿‡å¤§ï¼Œå¦åˆ™å¯èƒ½ä¼šæ©ç›–ä¸€äº›é—®é¢˜ã€‚(No Java system property) leaderServes é»˜è®¤æƒ…å†µä¸‹ï¼ŒLeaderæ˜¯ä¼šæ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œå¹¶æä¾›æ­£å¸¸çš„è¯»å†™æœåŠ¡ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³è®©Leaderä¸“æ³¨äºé›†ç¾¤ä¸­æœºå™¨çš„åè°ƒï¼Œé‚£ä¹ˆå¯ä»¥å°†è¿™ä¸ªå‚æ•°è®¾ç½®ä¸ºnoï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¼šå¤§å¤§æé«˜å†™æ“ä½œçš„æ€§èƒ½ã€‚(Java system property: zookeeper. leaderServes )ã€‚ server.x=[hostname]:nnnnn[:nnnnn] è¿™é‡Œçš„xæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œä¸myidæ–‡ä»¶ä¸­çš„idæ˜¯ä¸€è‡´çš„ã€‚å³è¾¹å¯ä»¥é…ç½®ä¸¤ä¸ªç«¯å£ï¼Œç¬¬ä¸€ä¸ªç«¯å£ç”¨äºFå’ŒLä¹‹é—´çš„æ•°æ®åŒæ­¥å’Œå…¶å®ƒé€šä¿¡ï¼Œç¬¬äºŒä¸ªç«¯å£ç”¨äºLeaderé€‰ä¸¾è¿‡ç¨‹ä¸­æŠ•ç¥¨é€šä¿¡ã€‚ (No Java system property) group.x=nnnnn[:nnnnn]weight.x=nnnnn å¯¹æœºå™¨åˆ†ç»„å’Œæƒé‡è®¾ç½®ï¼Œå¯ä»¥ å‚è§è¿™é‡Œ(No Java system property) cnxTimeoutLeader é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œæ‰“å¼€ä¸€æ¬¡è¿æ¥çš„è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯5sã€‚(Java system property: zookeeper. cnxTimeout) zookeeper.DigestAuthenticationProvider.superDigestZK æƒé™è®¾ç½®ç›¸å…³ï¼Œå…·ä½“å‚è§ ã€Š ä½¿ç”¨super èº«ä»½å¯¹æœ‰æƒé™çš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œ ã€‹ å’Œ ã€Š ZooKeeper æƒé™æ§åˆ¶ ã€‹ skipACL å¯¹æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚éƒ½ä¸ä½œACLæ£€æŸ¥ã€‚å¦‚æœä¹‹å‰èŠ‚ç‚¹ä¸Šè®¾ç½®æœ‰æƒé™é™åˆ¶ï¼Œä¸€æ—¦æœåŠ¡å™¨ä¸Šæ‰“å¼€è¿™ä¸ªå¼€å¤´ï¼Œé‚£ä¹ˆä¹Ÿå°†å¤±æ•ˆã€‚(Java system property: zookeeper.skipACL ) forceSync è¿™ä¸ªå‚æ•°ç¡®å®šäº†æ˜¯å¦éœ€è¦åœ¨äº‹åŠ¡æ—¥å¿—æäº¤çš„æ—¶å€™è°ƒç”¨ FileChannel .forceæ¥ä¿è¯æ•°æ®å®Œå…¨åŒæ­¥åˆ°ç£ç›˜ã€‚(Java system property: zookeeper.forceSync ) jute.maxbuffer æ¯ä¸ªèŠ‚ç‚¹æœ€å¤§æ•°æ®é‡ï¼Œæ˜¯é»˜è®¤æ˜¯1Mã€‚è¿™ä¸ªé™åˆ¶å¿…é¡»åœ¨serverå’Œclientç«¯éƒ½è¿›è¡Œè®¾ç½®æ‰ä¼šç”Ÿæ•ˆã€‚(Java system property: jute.maxbuffer ) ä¸Šé¢çš„docker-compose.ymlæ–‡ä»¶ä¸­ï¼Œæˆ‘æ²¡ç”¨é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯ä¸Šé¢çš„é…ç½®é¡¹å…¶å®å¯ä»¥ç”¨zookeeperé•œåƒé‡Œçš„ç¯å¢ƒå˜é‡æ¥å®ç°ï¼Œä¾‹å¦‚ZOO_TICK_TIMEã€‚ ","date":"2020-03-12","objectID":"/zookeeper_cluster_lock/:2:0","tags":["zookeeper","Java"],"title":"åŸºäºZookeeperçš„åˆ†å¸ƒå¼é”","uri":"/zookeeper_cluster_lock/"},{"categories":["Java"],"content":"Zookeeperåˆ†å¸ƒå¼é”å®ç° ","date":"2020-03-12","objectID":"/zookeeper_cluster_lock/:3:0","tags":["zookeeper","Java"],"title":"åŸºäºZookeeperçš„åˆ†å¸ƒå¼é”","uri":"/zookeeper_cluster_lock/"},{"categories":["Java"],"content":"Zookeeperçš„èŠ‚ç‚¹ è¦ç”¨Zookeeperå®ç°åˆ†å¸ƒå¼é”ï¼Œæˆ‘å°±ä¸å¾—ä¸è¯´è¯´Zookeeperçš„æ•°æ®å­˜å‚¨ã€‚é¦–å…ˆzookeeperçš„æ ¸å¿ƒä¿å­˜ç»“æ„æ˜¯ä¸€ä¸ªDataTreeæ•°æ®ç»“æ„ï¼Œå…¶å®å†…éƒ¨æ˜¯ä¸€ä¸ªMap\u003cString, DataNode\u003e nodesçš„æ•°æ®ç»“æ„ï¼Œå…¶ä¸­keyæ˜¯pathï¼ŒDataNodeæ‰æ˜¯çœŸæ­£ä¿å­˜æ•°æ®çš„æ ¸å¿ƒæ•°æ®ç»“æ„ï¼ŒDataNodeæ ¸å¿ƒå­—æ®µåŒ…æ‹¬byte data[]ç”¨äºä¿å­˜èŠ‚ç‚¹å†…å®¹ã€‚ èŠ‚ç‚¹æ˜¯Zookeeperï¼ˆzkï¼‰ä¸­æ•°æ®å­˜å‚¨çš„åŸºç¡€ç»“æ„ï¼Œzkä¸­ä¸‡ç‰©çš†èŠ‚ç‚¹ï¼Œå°±å¥½æ¯”Javaä¸­ä¸‡ç‰©çš†å¯¹è±¡ä¸€æ ·ã€‚zkçš„æ•°æ®æ¨¡å‹å°±æ˜¯åŸºäºèŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„ï¼Œä½†zkè§„å®šæ¯ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨è§„åˆ™æ˜¯è·¯å¾„å¼•ç”¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«å­èŠ‚ç‚¹å¼•ç”¨ã€å­˜å‚¨æ•°æ®ã€è®¿é—®æƒé™ä»¥åŠèŠ‚ç‚¹å…ƒæ•°æ®ç­‰å››éƒ¨åˆ†ã€‚ zookeeperä¸­æä¾›äº†èŠ‚ç‚¹ç±»å‹ä¸»è¦æœ‰ï¼š æŒä¹…èŠ‚ç‚¹ï¼šèŠ‚ç‚¹åˆ›å»ºåï¼Œå°±ä¸€ç›´å­˜åœ¨ï¼Œç›´åˆ°æœ‰åˆ é™¤æ“ä½œæ¥ä¸»åŠ¨æ¸…é™¤ã€‚ é¡ºåºèŠ‚ç‚¹ï¼šå‡å¦‚å½“å‰æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ä¸º/lockï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªçˆ¶èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºå­èŠ‚ç‚¹ï¼›zkæä¾›äº†ä¸€ä¸ªå¯é€‰çš„æœ‰åºç‰¹æ€§ï¼Œä¾‹å¦‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºå­èŠ‚ç‚¹â€œ/lock/test_â€å¹¶ä¸”æŒ‡æ˜æœ‰åºï¼Œé‚£ä¹ˆzkåœ¨ç”Ÿæˆå­èŠ‚ç‚¹æ—¶ä¼šæ ¹æ®å½“å‰å­èŠ‚ç‚¹æ•°é‡è‡ªåŠ¨æ·»åŠ æ•´æ•°åºå·ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ä¸º/lock/test_0000000000ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹åˆ™ä¸º/lock/test_0000000001ï¼Œä¾æ¬¡ç±»æ¨ã€‚ ä¸´æ—¶èŠ‚ç‚¹ï¼šå®¢æˆ·ç«¯å¯ä»¥å»ºç«‹ä¸€ä¸ªä¸´æ—¶èŠ‚ç‚¹ï¼Œåœ¨ä¼šè¯ç»“æŸæˆ–è€…ä¼šè¯è¶…æ—¶åï¼Œzookeeperä¼šè‡ªåŠ¨åˆ é™¤è¯¥èŠ‚ç‚¹ã€‚ ","date":"2020-03-12","objectID":"/zookeeper_cluster_lock/:3:1","tags":["zookeeper","Java"],"title":"åŸºäºZookeeperçš„åˆ†å¸ƒå¼é”","uri":"/zookeeper_cluster_lock/"},{"categories":["Java"],"content":"synchronized åœ¨Javaå¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬æœ€å…ˆç¢°åˆ°çš„ä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹æ³•å°±åˆ©ç”¨synchronizedå…³é”®å­—ã€‚ç”¨å®ƒçš„æ–¹å¼æœ‰ä¸‰ç§ï¼š ä¿®é¥°å®ä¾‹æ–¹æ³•ï¼Œé”æ˜¯å½“å‰å®ä¾‹å¯¹è±¡ ä¿®é¥°é™æ€æ–¹æ³•ï¼Œé”æ˜¯å½“å‰ç±»çš„classå¯¹è±¡ï¼ˆæ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼‰ ä¿®é¥°ä»£ç å—ï¼Œé”å®šæ‹¬å·é‡Œçš„å¯¹è±¡ åŠ ä¸Šsynchronizedä¹‹åï¼Œæˆ‘ä»¬çš„ä»£ç å°±å˜æˆäº†åŒæ­¥ä»£ç ï¼Œç¥å¥‡åˆå¼ºå¤§ï¼Œä½†æœ‰çš„æ—¶å€™ä¹Ÿä¸ç¦ä¼šæ€è€ƒä¸‹ï¼šJavaåº•å±‚æ˜¯æ€ä¹ˆå®ç°synchronizedå…³é”®å­—çš„ï¼Ÿ åœ¨é˜…è¯»äº†ä¸€äº›æ–‡ç« ä¹‹åï¼Œæˆ‘åœ¨è¿™é‡Œåšäº†ä¸€äº›å½’çº³å’Œæ€»ç»“ã€‚ é¦–å…ˆï¼Œçœ‹ä¸€æ®µç®€å•çš„Javaä»£ç ï¼š public class SyncTest { public synchronized void test1(){ } public void test2(){ synchronized (this){ } } } å…ˆç”¨javac SyncTest.javaç¼–è¯‘å‡ºclassæ–‡ä»¶ï¼Œå†åˆ©ç”¨javap -v -c SyncTest.classæŸ¥çœ‹synchronizedçš„å®ç°ã€‚javapæ˜¯jdkè‡ªå¸¦çš„åè§£æå·¥å…·ã€‚å®ƒçš„ä½œç”¨å°±æ˜¯æ ¹æ®classå­—èŠ‚ç æ–‡ä»¶ï¼Œåè§£æå‡ºå½“å‰ç±»å¯¹åº”çš„codeåŒºï¼ˆæ±‡ç¼–æŒ‡ä»¤ï¼‰ã€æœ¬åœ°å˜é‡è¡¨ã€å¼‚å¸¸è¡¨å’Œä»£ç è¡Œåç§»é‡æ˜ å°„è¡¨ã€å¸¸é‡æ± ç­‰ç­‰ä¿¡æ¯ã€‚ åè§£æç»“æœä¸ºï¼š .... { public synchronized void test1(); descriptor: ()V flags: ACC_PUBLIC, ACC_SYNCHRONIZED Code: stack=0, locals=1, args_size=1 0: return LineNumberTable: line 4: 0 public void test2(); descriptor: ()V flags: ACC_PUBLIC Code: stack=2, locals=3, args_size=1 0: aload_0 1: dup 2: astore_1 3: monitorenter // ç›‘è§†å™¨è¿›å…¥ï¼Œè·å–é” 4: aload_1 5: monitorexit // ç›‘è§†å™¨é€€å‡ºï¼Œé‡Šæ”¾é” 6: goto 14 9: astore_2 10: aload_1 11: monitorexit 12: aload_2 13: athrow 14: return Exception table: from to target type 4 6 9 any 9 12 9 any LineNumberTable: line 7: 0 line 9: 4 line 10: 14 StackMapTable: number_of_entries = 2 frame_type = 255 /* full_frame */ offset_delta = 9 locals = [ class SyncTest, class java/lang/Object ] stack = [ class java/lang/Throwable ] frame_type = 250 /* chop */ offset_delta = 4 } SourceFile: \"SyncTest.java\" ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºï¼ŒåŒæ­¥ä»£ç å—æ˜¯ä½¿ç”¨monitorenterå’ŒmonitorexitæŒ‡ä»¤å®ç°çš„ï¼ŒåŒæ­¥æ–¹æ³•ï¼ˆåœ¨è¿™çœ‹ä¸å‡ºæ¥éœ€è¦çœ‹JVMåº•å±‚å®ç°ï¼‰ä¾é çš„æ˜¯æ–¹æ³•ä¿®é¥°ç¬¦ä¸Šçš„ACC_SYNCHRONIZEDå®ç°ã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:1:0","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"Javaå¯¹è±¡å¤´ Javaå¯¹è±¡å¤´å’Œmonitoræ˜¯å®ç°synchronizedçš„åŸºç¡€ã€‚ HotSpotè™šæ‹Ÿæœºä¸­ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„å¸ƒå±€å¯ä»¥åˆ†ä¸ºä¸‰å—åŒºåŸŸï¼šå¯¹è±¡å¤´ï¼ˆHeaderï¼‰ã€å®ä¾‹æ•°æ®ï¼ˆInstance Dataï¼‰å’Œå¯¹é½å¡«å……ï¼ˆPaddingï¼‰ã€‚ æ™®é€šå¯¹è±¡çš„å¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼šMark Word å’Œ Class Metadata Address ï¼ˆç±»å‹æŒ‡é’ˆï¼‰ï¼ˆå¦‚ä¸Šå›¾æ‰€ç¤ºï¼‰ï¼Œå¦‚æœæ˜¯æ•°ç»„å¯¹è±¡è¿˜åŒ…æ‹¬ä¸€ä¸ªé¢å¤–çš„Array lengthæ•°ç»„é•¿åº¦éƒ¨åˆ†ï¼ˆè¿™é‡Œæˆ‘æ²¡ç»™å‡ºå›¾ç‰‡ï¼‰ã€‚ åœ¨32ä½è™šæ‹Ÿæœºä¸­ï¼Œä¸€å­—å®½ç­‰äºå››å­—èŠ‚ï¼Œå³32bitã€‚ HotSpotè™šæ‹Ÿæœºçš„å¯¹è±¡å¤´(Object Header)åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œ å¦‚å“ˆå¸Œç ï¼ˆHashCodeï¼‰ã€GCåˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹IDã€åå‘æ—¶é—´æˆ³ç­‰ç­‰ï¼Œè¿™éƒ¨åˆ†æ•°æ®çš„é•¿åº¦åœ¨32ä½å’Œ64ä½çš„è™šæ‹Ÿæœºï¼ˆæš‚ä¸è€ƒè™‘å¼€å¯å‹ç¼©æŒ‡é’ˆçš„åœºæ™¯ï¼‰ä¸­åˆ†åˆ«ä¸º32ä¸ªå’Œ64ä¸ªBitsï¼Œå®˜æ–¹ç§°å®ƒä¸ºâ€œMark Wordâ€ï¼ˆæ ‡è®°å­—æ®µï¼‰ã€‚ å¯¹è±¡éœ€è¦å­˜å‚¨çš„è¿è¡Œæ—¶æ•°æ®å¾ˆå¤šï¼Œå…¶å®å·²ç»è¶…å‡ºäº†32ã€64ä½Bitmapç»“æ„æ‰€èƒ½è®°å½•çš„é™åº¦ï¼Œä½†æ˜¯å¯¹è±¡å¤´ä¿¡æ¯æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰çš„æ•°æ®æ— å…³çš„é¢ å¤–å­˜å‚¨æˆæœ¬ï¼Œè€ƒè™‘åˆ°è™šæ‹Ÿæœºçš„ç©ºé—´æ•ˆç‡ï¼ŒMark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å‚¨å°½é‡å¤šçš„ä¿¡æ¯ï¼Œå®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚åœ¨32ä½çš„HotSpotè™šæ‹Ÿæœº ä¸­å¯¹è±¡æœªè¢«é”å®šçš„çŠ¶æ€ä¸‹ï¼ŒMark Wordçš„32ä¸ªBitsç©ºé—´ä¸­çš„25Bitsç”¨äºå­˜å‚¨å¯¹è±¡å“ˆå¸Œç ï¼ˆHashCodeï¼‰ï¼Œ4Bitsç”¨äºå­˜å‚¨å¯¹è±¡åˆ†ä»£å¹´é¾„ï¼Œ2Bitsç”¨äºå­˜å‚¨é”æ ‡å¿— ä½ï¼Œ1Bitå›ºå®šä¸º0ï¼Œåœ¨å…¶ä»–çŠ¶æ€ï¼ˆè½»é‡çº§é”å®šã€é‡é‡çº§é”å®šã€GCæ ‡è®°ã€å¯åå‘ï¼‰ä¸‹å¯¹è±¡çš„å­˜å‚¨å†…å®¹å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š æ³¨æ„åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”ç­‰éƒ½æ˜¯jdk 1.6ä»¥åå¼•å…¥çš„ã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:2:0","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"monitorå¯¹è±¡ è½»é‡çº§é”å’Œåå‘é”æ˜¯Java 6 å¯¹ synchronized é”è¿›è¡Œä¼˜åŒ–åæ–°å¢åŠ çš„ï¼Œç¨åæˆ‘ä»¬ä¼šç®€è¦åˆ†æã€‚è¿™é‡Œæˆ‘ä»¬ä¸»è¦åˆ†æä¸€ä¸‹é‡é‡çº§é”ä¹Ÿå°±æ˜¯é€šå¸¸è¯´synchronizedçš„å¯¹è±¡é”ï¼Œé”æ ‡è¯†ä½ä¸º10ï¼Œå…¶ä¸­æŒ‡é’ˆæŒ‡å‘çš„æ˜¯monitorå¯¹è±¡ï¼ˆä¹Ÿç§°ä¸ºç®¡ç¨‹æˆ–ç›‘è§†å™¨é”ï¼‰çš„èµ·å§‹åœ°å€ã€‚æ¯ä¸ªå¯¹è±¡éƒ½å­˜åœ¨ç€ä¸€ä¸ª monitor ä¸ä¹‹å…³è”ï¼Œå¯¹è±¡ä¸å…¶ monitor ä¹‹é—´çš„å…³ç³»æœ‰å­˜åœ¨å¤šç§å®ç°æ–¹å¼ï¼Œå¦‚monitorå¯ä»¥ä¸å¯¹è±¡ä¸€èµ·åˆ›å»ºé”€æ¯æˆ–å½“çº¿ç¨‹è¯•å›¾è·å–å¯¹è±¡é”æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œä½†å½“ä¸€ä¸ª monitor è¢«æŸä¸ªçº¿ç¨‹æŒæœ‰åï¼Œå®ƒä¾¿å¤„äºé”å®šçŠ¶æ€ã€‚åœ¨Javaè™šæ‹Ÿæœº(HotSpot)ä¸­ï¼Œmonitoræ˜¯ç”±ObjectMonitorå®ç°çš„ï¼Œå…¶ä¸»è¦æ•°æ®ç»“æ„å¦‚ä¸‹ï¼ˆä½äºHotSpotè™šæ‹Ÿæœºæºç ObjectMonitor.hppæ–‡ä»¶ï¼ŒC++å®ç°çš„ï¼‰ï¼š ObjectMonitor() { _header = NULL; _count = 0; //è®°å½•ä¸ªæ•° _waiters = 0, _recursions = 0; _object = NULL; _owner = NULL; _WaitSet = NULL; //å¤„äºwaitçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°_WaitSet _WaitSetLock = 0 ; _Responsible = NULL ; _succ = NULL ; _cxq = NULL ; FreeNext = NULL ; _EntryList = NULL ; //å¤„äºç­‰å¾…é”blockçŠ¶æ€çš„çº¿ç¨‹ï¼Œä¼šè¢«åŠ å…¥åˆ°è¯¥åˆ—è¡¨ _SpinFreq = 0 ; _SpinClock = 0 ; OwnerIsThread = 0 ; } ObjectMonitorä¸­æœ‰ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œ_WaitSetå’Œ_EntryListï¼Œç”¨æ¥ä¿å­˜ObjectWaiterå¯¹è±¡åˆ—è¡¨(æ¯ä¸ªç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¢«å°è£…æˆObjectWaiterå¯¹è±¡)ï¼Œ_owneræŒ‡å‘æŒæœ‰ObjectMonitorå¯¹è±¡çš„çº¿ç¨‹ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€æ®µåŒæ­¥ä»£ç æ—¶ï¼Œé¦–å…ˆä¼šè¿›å…¥ _EntryList é›†åˆï¼Œå½“çº¿ç¨‹è·å–åˆ°å¯¹è±¡çš„monitor åè¿›å…¥ _Owner åŒºåŸŸå¹¶æŠŠmonitorä¸­çš„ownerå˜é‡è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹åŒæ—¶monitorä¸­çš„è®¡æ•°å™¨countåŠ 1ï¼Œè‹¥çº¿ç¨‹è°ƒç”¨wait()æ–¹æ³•ï¼Œå°†é‡Šæ”¾å½“å‰æŒæœ‰çš„monitorï¼Œownerå˜é‡æ¢å¤ä¸ºnullï¼Œcountè‡ªå‡1ï¼ŒåŒæ—¶è¯¥çº¿ç¨‹è¿›å…¥WaitSeté›†åˆä¸­ç­‰å¾…è¢«å”¤é†’ã€‚è‹¥å½“å‰çº¿ç¨‹æ‰§è¡Œå®Œæ¯•ä¹Ÿå°†é‡Šæ”¾monitor(é”)å¹¶å¤ä½å˜é‡çš„å€¼ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹è¿›å…¥è·å–monitor(é”)ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:3:0","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"é”ä¼˜åŒ– ä»ä¸Šä¸€èŠ‚çœ‹å‡ºï¼Œsynchronizedçš„å®ç°ä¾èµ–äºä¸æŸä¸ªå¯¹è±¡å‘å…³è”çš„monitorï¼ˆç›‘è§†å™¨ï¼‰å®ç°ï¼Œè€Œmonitoræ˜¯åŸºäºåº•å±‚æ“ä½œç³»ç»Ÿçš„Mutex Lockå®ç°çš„ï¼Œè€ŒåŸºäºMutex Lockå®ç°çš„åŒæ­¥å¿…é¡»ç»å†ä»ç”¨æˆ·æ€åˆ°æ ¸å¿ƒæ€çš„è½¬æ¢ï¼Œè¿™ä¸ªå¼€é”€ç‰¹åˆ«å¤§ï¼Œæˆæœ¬éå¸¸é«˜ã€‚æ‰€ä»¥é¢‘ç¹çš„é€šè¿‡Synchronizedå®ç°åŒæ­¥ä¼šä¸¥é‡å½±å“åˆ°ç¨‹åºæ•ˆç‡ï¼Œè€Œè¿™ç§ä¾èµ–äºMutex Lockå®ç°çš„é”æœºåˆ¶ä¹Ÿè¢«ç§°ä¸ºâ€œé‡é‡çº§é”â€ï¼Œä¸ºäº†å‡å°‘é‡é‡çº§é”å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼ŒJDKå¯¹synchronizedè¿›è¡Œäº†ç§ç§ä¼˜åŒ–ã€‚ Java SE1.6ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”æ‰€å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ï¼Œæ‰€ä»¥åœ¨Java SE1.6é‡Œé”ä¸€å…±æœ‰å››ç§çŠ¶æ€ï¼Œæ— é”çŠ¶æ€ï¼Œåå‘é”çŠ¶æ€ï¼Œè½»é‡çº§é”çŠ¶æ€å’Œé‡é‡çº§é”çŠ¶æ€ï¼Œå®ƒä¼šéšç€ç«äº‰æƒ…å†µé€æ¸å‡çº§ã€‚é”å¯ä»¥å‡çº§ä½†ä¸èƒ½é™çº§ï¼Œæ„å‘³ç€åå‘é”å‡çº§æˆè½»é‡çº§é”åä¸èƒ½é™çº§æˆåå‘é”ã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:0","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"åå‘é” Hotspotçš„ä½œè€…ç»è¿‡ä»¥å¾€çš„ç ”ç©¶å‘ç°å¤§å¤šæ•°æƒ…å†µä¸‹é”ä¸ä»…ä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œè€Œä¸”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸ºäº†è®©çº¿ç¨‹è·å¾—é”çš„ä»£ä»·æ›´ä½è€Œå¼•å…¥äº†åå‘é”ã€‚ è·å–é”ï¼š æ£€æµ‹Mark Wordæ˜¯å¦ä¸ºå¯åå‘çŠ¶æ€ï¼Œå³æ˜¯å¦ä¸ºåå‘é”1ï¼Œé”æ ‡è¯†ä½ä¸º01ï¼› è‹¥ä¸ºå¯åå‘çŠ¶æ€ï¼Œåˆ™æµ‹è¯•çº¿ç¨‹IDæ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹IDï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ5ï¼‰ï¼Œå¦åˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ3ï¼‰ï¼› å¦‚æœçº¿ç¨‹IDä¸ä¸ºå½“å‰çº¿ç¨‹IDï¼Œåˆ™é€šè¿‡CASæ“ä½œç«äº‰é”ï¼Œç«äº‰æˆåŠŸï¼Œåˆ™å°†Mark Wordçš„çº¿ç¨‹IDæ›¿æ¢ä¸ºå½“å‰çº¿ç¨‹IDï¼Œå¦åˆ™æ‰§è¡Œçº¿ç¨‹ï¼ˆ4ï¼‰ï¼› é€šè¿‡CASç«äº‰é”å¤±è´¥ï¼Œè¯æ˜å½“å‰å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰æƒ…å†µï¼Œå½“åˆ°è¾¾å…¨å±€å®‰å…¨ç‚¹ï¼Œè·å¾—åå‘é”çš„çº¿ç¨‹è¢«æŒ‚èµ·ï¼Œåå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œç„¶åè¢«é˜»å¡åœ¨å®‰å…¨ç‚¹çš„çº¿ç¨‹ç»§ç»­å¾€ä¸‹æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼› æ‰§è¡ŒåŒæ­¥ä»£ç å— é‡Šæ”¾é”ï¼š åå‘é”çš„é‡Šæ”¾é‡‡ç”¨äº†ä¸€ç§åªæœ‰ç«äº‰æ‰ä¼šé‡Šæ”¾é”çš„æœºåˆ¶ï¼Œçº¿ç¨‹æ˜¯ä¸ä¼šä¸»åŠ¨å»é‡Šæ”¾åå‘é”ï¼Œéœ€è¦ç­‰å¾…å…¶ä»–çº¿ç¨‹æ¥ç«äº‰ã€‚åå‘é”çš„æ’¤é”€éœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆè¿™ä¸ªæ—¶é—´ç‚¹æ˜¯ä¸Šæ²¡æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»£ç ï¼‰ã€‚å…¶æ­¥éª¤å¦‚ä¸‹ï¼š æš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡çŸ³æ˜¯å¦è¿˜å¤„äºè¢«é”å®šçŠ¶æ€ï¼› æ’¤é”€åå‘è‹ï¼Œæ¢å¤åˆ°æ— é”çŠ¶æ€ï¼ˆ01ï¼‰æˆ–è€…è½»é‡çº§é”çš„çŠ¶æ€ï¼› ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:1","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"è½»é‡çº§é” å¼•å…¥è½»é‡çº§é”çš„ä¸»è¦ç›®çš„æ˜¯åœ¨å¤šæ²¡æœ‰å¤šçº¿ç¨‹ç«äº‰çš„å‰æä¸‹ï¼Œå‡å°‘ä¼ ç»Ÿçš„é‡é‡çº§é”ä½¿ç”¨æ“ä½œç³»ç»Ÿäº’æ–¥é‡äº§ç”Ÿçš„æ€§èƒ½æ¶ˆè€—ã€‚ å½“å…³é—­åå‘é”åŠŸèƒ½æˆ–è€…å¤šä¸ªçº¿ç¨‹ç«äº‰åå‘é”å¯¼è‡´åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œåˆ™ä¼šå°è¯•è·å–è½»é‡çº§é”ï¼Œå…¶æ­¥éª¤å¦‚ä¸‹ï¼š è·å–é”ï¼š åˆ¤æ–­å½“å‰å¯¹è±¡æ˜¯å¦å¤„äºæ— é”çŠ¶æ€ï¼ˆhashcodeã€0ã€01ï¼‰ï¼Œè‹¥æ˜¯ï¼Œåˆ™JVMé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼ˆå®˜æ–¹æŠŠè¿™ä»½æ‹·è´åŠ äº†ä¸€ä¸ªDisplacedå‰ç¼€ï¼Œå³Displaced Mark Wordï¼‰ï¼›å¦åˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ3ï¼‰ï¼› JVMåˆ©ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡æ­£ï¼Œå¦‚æœæˆåŠŸè¡¨ç¤ºç«äº‰åˆ°é”ï¼Œåˆ™å°†é”æ ‡å¿—ä½å˜æˆ00ï¼ˆè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”çŠ¶æ€ï¼‰ï¼Œæ‰§è¡ŒåŒæ­¥æ“ä½œï¼›å¦‚æœå¤±è´¥åˆ™æ‰§è¡Œæ­¥éª¤ï¼ˆ3ï¼‰ï¼› åˆ¤æ–­å½“å‰å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯åˆ™è¡¨ç¤ºå½“å‰çº¿ç¨‹å·²ç»æŒæœ‰å½“å‰å¯¹è±¡çš„é”ï¼Œåˆ™ç›´æ¥æ‰§è¡ŒåŒæ­¥ä»£ç å—ï¼›å¦åˆ™åªèƒ½è¯´æ˜è¯¥é”å¯¹è±¡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŠ¢å äº†ï¼Œè¿™æ—¶è½»é‡çº§é”éœ€è¦è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé”æ ‡å¿—ä½å˜æˆ10ï¼Œåé¢ç­‰å¾…çš„çº¿ç¨‹å°†ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼› é‡Šæ”¾é”ï¼š è½»é‡çº§é”çš„é‡Šæ”¾ä¹Ÿæ˜¯é€šè¿‡CASæ“ä½œæ¥è¿›è¡Œçš„ï¼Œä¸»è¦æ­¥éª¤å¦‚ä¸‹ï¼š å–å‡ºåœ¨è·å–è½»é‡çº§é”ä¿å­˜åœ¨Displaced Mark Wordä¸­çš„æ•°æ®ï¼› ç”¨CASæ“ä½œå°†å–å‡ºçš„æ•°æ®æ›¿æ¢å½“å‰å¯¹è±¡çš„Mark Wordä¸­ï¼Œå¦‚æœæˆåŠŸï¼Œåˆ™è¯´æ˜é‡Šæ”¾é”æˆåŠŸï¼Œå¦åˆ™æ‰§è¡Œï¼ˆ3ï¼‰ï¼› å¦‚æœCASæ“ä½œæ›¿æ¢å¤±è´¥ï¼Œè¯´æ˜æœ‰å…¶ä»–çº¿ç¨‹å°è¯•è·å–è¯¥é”ï¼Œåˆ™éœ€è¦åœ¨é‡Šæ”¾é”çš„åŒæ—¶éœ€è¦å”¤é†’è¢«æŒ‚èµ·çš„çº¿ç¨‹ã€‚ è½»é‡çº§é”çŠ¶æ€æ—¶ï¼Œä½ç½®è¢«é”æŒ‡é’ˆå ç”¨ï¼Œé‚£hashCodeç­‰ä¿¡æ¯è¦å­˜åˆ°å“ªé‡Œï¼Ÿè¿™é‡Œçš„é—®é¢˜å°±æ¯”è¾ƒç®€å•äº†ï¼Œå› ä¸ºæœ‰æ‹·è´çš„mark wordï¼Œæ‰€ä»¥Displaced Mark Wordä¸­å­˜åœ¨æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:2","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"é‡é‡çº§é” é‡é‡çº§é”é€šè¿‡å¯¹è±¡å†…éƒ¨çš„ç›‘è§†å™¨ï¼ˆmonitorï¼‰å®ç°ï¼Œå…¶ä¸­monitorçš„æœ¬è´¨æ˜¯ä¾èµ–äºåº•å±‚æ“ä½œç³»ç»Ÿçš„Mutex Lockå®ç°ï¼Œæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éœ€è¦ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ï¼Œåˆ‡æ¢æˆæœ¬éå¸¸é«˜ã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:3","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"è‡ªæ—‹é” è½»é‡çº§é”å¤±è´¥åï¼Œè™šæ‹Ÿæœºä¸ºäº†é¿å…çº¿ç¨‹çœŸå®åœ°åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æŒ‚èµ·ï¼Œè¿˜ä¼šè¿›è¡Œä¸€é¡¹ç§°ä¸ºè‡ªæ—‹é”çš„ä¼˜åŒ–æ‰‹æ®µã€‚è¿™æ˜¯åŸºäºåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´éƒ½ä¸ä¼šå¤ªé•¿ï¼Œå¦‚æœç›´æ¥æŒ‚èµ·æ“ä½œç³»ç»Ÿå±‚é¢çš„çº¿ç¨‹å¯èƒ½ä¼šå¾—ä¸å¿å¤±ï¼Œæ¯•ç«Ÿæ“ä½œç³»ç»Ÿå®ç°çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢æ—¶éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢åˆ°æ ¸å¿ƒæ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¹‹é—´çš„è½¬æ¢éœ€è¦ç›¸å¯¹æ¯”è¾ƒé•¿çš„æ—¶é—´ï¼Œæ—¶é—´æˆæœ¬ç›¸å¯¹è¾ƒé«˜ï¼Œå› æ­¤è‡ªæ—‹é”ä¼šå‡è®¾åœ¨ä¸ä¹…å°†æ¥ï¼Œå½“å‰çš„çº¿ç¨‹å¯ä»¥è·å¾—é”ï¼Œå› æ­¤è™šæ‹Ÿæœºä¼šè®©å½“å‰æƒ³è¦è·å–é”çš„çº¿ç¨‹åšå‡ ä¸ªç©ºå¾ªç¯(è¿™ä¹Ÿæ˜¯ç§°ä¸ºè‡ªæ—‹çš„åŸå› )ï¼Œä¸€èˆ¬ä¸ä¼šå¤ªä¹…ï¼Œå¯èƒ½æ˜¯50ä¸ªå¾ªç¯æˆ–100å¾ªç¯ï¼Œåœ¨ç»è¿‡è‹¥å¹²æ¬¡å¾ªç¯åï¼Œå¦‚æœå¾—åˆ°é”ï¼Œå°±é¡ºåˆ©è¿›å…¥ä¸´ç•ŒåŒºã€‚å¦‚æœè¿˜ä¸èƒ½è·å¾—é”ï¼Œé‚£å°±ä¼šå°†çº¿ç¨‹åœ¨æ“ä½œç³»ç»Ÿå±‚é¢æŒ‚èµ·ï¼Œè¿™å°±æ˜¯è‡ªæ—‹é”çš„ä¼˜åŒ–æ–¹å¼ï¼Œè¿™ç§æ–¹å¼ç¡®å®ä¹Ÿæ˜¯å¯ä»¥æå‡æ•ˆç‡çš„ã€‚æœ€åæ²¡åŠæ³•ä¹Ÿå°±åªèƒ½å‡çº§ä¸ºé‡é‡çº§é”äº†ã€‚è‡ªæ—‹æ˜¯æŠŠåŒåˆƒå‰‘ï¼Œå¦‚æœæ—‹çš„æ—¶é—´è¿‡é•¿ä¼šå½±å“æ•´ä½“æ€§èƒ½ï¼Œæ—¶é—´è¿‡çŸ­åˆè¾¾ä¸åˆ°å»¶è¿Ÿé˜»å¡çš„ç›®çš„ã€‚æ˜¾ç„¶ï¼Œè‡ªæ—‹çš„å‘¨æœŸé€‰æ‹©æ˜¾å¾—éå¸¸é‡è¦ï¼Œä½†è¿™ä¸æ“ä½œç³»ç»Ÿã€ç¡¬ä»¶ä½“ç³»ã€ç³»ç»Ÿçš„è´Ÿè½½ç­‰è¯¸å¤šåœºæ™¯ç›¸å…³ï¼Œå¾ˆéš¾é€‰æ‹©ï¼Œå¦‚æœé€‰æ‹©ä¸å½“ï¼Œä¸ä½†æ€§èƒ½å¾—ä¸åˆ°æé«˜ï¼Œå¯èƒ½è¿˜ä¼šä¸‹é™ã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:4","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"é€‚åº”è‡ªæ—‹é” JDK 1.6å¼•å…¥äº†æ›´åŠ èªæ˜çš„è‡ªæ—‹é”ï¼Œå³è‡ªé€‚åº”è‡ªæ—‹é”ã€‚æ‰€è°“è‡ªé€‚åº”å°±æ„å‘³ç€è‡ªæ—‹çš„æ¬¡æ•°ä¸å†æ˜¯å›ºå®šçš„ï¼Œå®ƒæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å®ƒæ€ä¹ˆåšå‘¢ï¼Ÿçº¿ç¨‹å¦‚æœè‡ªæ—‹æˆåŠŸäº†ï¼Œé‚£ä¹ˆä¸‹æ¬¡è‡ªæ—‹çš„æ¬¡æ•°ä¼šæ›´åŠ å¤šï¼Œå› ä¸ºè™šæ‹Ÿæœºè®¤ä¸ºæ—¢ç„¶ä¸Šæ¬¡æˆåŠŸäº†ï¼Œé‚£ä¹ˆæ­¤æ¬¡è‡ªæ—‹ä¹Ÿå¾ˆæœ‰å¯èƒ½ä¼šå†æ¬¡æˆåŠŸï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­çš„æ¬¡æ•°æ›´å¤šã€‚åä¹‹ï¼Œå¦‚æœå¯¹äºæŸä¸ªé”ï¼Œå¾ˆå°‘æœ‰è‡ªæ—‹èƒ½å¤ŸæˆåŠŸçš„ï¼Œé‚£ä¹ˆåœ¨ä»¥åè¦æˆ–è€…è¿™ä¸ªé”çš„æ—¶å€™è‡ªæ—‹çš„æ¬¡æ•°ä¼šå‡å°‘ç”šè‡³çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œä»¥å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:5","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"é”æ¶ˆé™¤ ä¸ºäº†ä¿è¯æ•°æ®çš„å®Œæ•´æ€§ï¼Œæˆ‘ä»¬åœ¨è¿›è¡Œæ“ä½œæ—¶éœ€è¦å¯¹è¿™éƒ¨åˆ†æ“ä½œè¿›è¡ŒåŒæ­¥æ§åˆ¶ï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼ŒJVMæ£€æµ‹åˆ°ä¸å¯èƒ½å­˜åœ¨å…±äº«æ•°æ®ç«äº‰ï¼Œè¿™æ˜¯JVMä¼šå¯¹è¿™äº›åŒæ­¥é”è¿›è¡Œé”æ¶ˆé™¤ã€‚é”æ¶ˆé™¤çš„ä¾æ®æ˜¯é€ƒé€¸åˆ†æçš„æ•°æ®æ”¯æŒã€‚ å¦‚æœä¸å­˜åœ¨ç«äº‰ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦åŠ é”å‘¢ï¼Ÿæ‰€ä»¥é”æ¶ˆé™¤å¯ä»¥èŠ‚çœæ¯«æ— æ„ä¹‰çš„è¯·æ±‚é”çš„æ—¶é—´ã€‚å˜é‡æ˜¯å¦é€ƒé€¸ï¼Œå¯¹äºè™šæ‹Ÿæœºæ¥è¯´éœ€è¦ä½¿ç”¨æ•°æ®æµåˆ†ææ¥ç¡®å®šï¼Œä½†æ˜¯å¯¹äºæˆ‘ä»¬ç¨‹åºå‘˜æ¥è¯´è¿™è¿˜ä¸æ¸…æ¥šä¹ˆï¼Ÿæˆ‘ä»¬ä¼šåœ¨æ˜æ˜çŸ¥é“ä¸å­˜åœ¨æ•°æ®ç«äº‰çš„ä»£ç å—å‰åŠ ä¸ŠåŒæ­¥å—ï¼Ÿä½†æ˜¯æœ‰æ—¶å€™ç¨‹åºå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æƒ³çš„é‚£æ ·ï¼Ÿæˆ‘ä»¬è™½ç„¶æ²¡æœ‰æ˜¾ç¤ºä½¿ç”¨é”ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸€äº›JDKçš„å†…ç½®APIæ—¶ï¼Œå¦‚StringBufferã€Vectorã€HashTableç­‰ï¼Œè¿™ä¸ªæ—¶å€™ä¼šå­˜åœ¨éšå½¢çš„åŠ é”æ“ä½œã€‚æ¯”å¦‚StringBufferçš„append()æ–¹æ³•ï¼ŒVectorçš„add()æ–¹æ³•ã€‚ ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:6","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java"],"content":"é”çš„è†¨èƒ€æµç¨‹ åœ¨å‰é¢åå‘é”å’Œè½»é‡çº§é”çš„å°èŠ‚ä¸­å·²ç»å¤§æ¦‚äº†è§£çš„é”çš„è†¨èƒ€æµç¨‹ï¼š åå‘é”-\u003eè½»é‡çº§é”-\u003eé‡é‡çº§é” åå‘æ‰€é”ï¼Œè½»é‡çº§é”éƒ½æ˜¯ä¹è§‚é”ï¼Œé‡é‡çº§é”æ˜¯æ‚²è§‚é”ã€‚ ä¸€ä¸ªå¯¹è±¡åˆšå¼€å§‹å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œæ²¡æœ‰ä»»ä½•çº¿ç¨‹æ¥è®¿é—®å®ƒçš„æ—¶å€™ã€‚å®ƒæ˜¯å¯åå‘çš„ï¼Œæ„å‘³ç€ï¼Œå®ƒç°åœ¨è®¤ä¸ºåªå¯èƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è®¿é—®å®ƒï¼Œæ‰€ä»¥å½“ç¬¬ä¸€ä¸ªçº¿ç¨‹æ¥è®¿é—®å®ƒçš„æ—¶å€™ï¼Œå®ƒä¼šåå‘è¿™ä¸ªçº¿ç¨‹ï¼Œæ­¤æ—¶ï¼Œå¯¹è±¡æŒæœ‰åå‘é”ã€‚ åå‘ç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹å¯¹è±¡å¤´æˆä¸ºåå‘é”çš„æ—¶å€™ä½¿ç”¨CASæ“ä½œï¼Œå¹¶å°†å¯¹è±¡å¤´ä¸­çš„ThreadIDæ”¹æˆè‡ªå·±çš„IDï¼Œä¹‹åå†æ¬¡è®¿é—®è¿™ä¸ªå¯¹è±¡æ—¶ï¼Œåªéœ€è¦å¯¹æ¯”IDï¼Œä¸éœ€è¦å†ä½¿ç”¨CASåœ¨è¿›è¡Œæ“ä½œã€‚ ä¸€æ—¦æœ‰ç¬¬äºŒä¸ªçº¿ç¨‹è®¿é—®è¿™ä¸ªå¯¹è±¡ï¼Œå› ä¸ºåå‘é”ä¸ä¼šä¸»åŠ¨é‡Šæ”¾ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªçº¿ç¨‹å¯ä»¥çœ‹åˆ°å¯¹è±¡æ˜¯åå‘çŠ¶æ€ï¼Œè¿™æ—¶è¡¨æ˜åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šå·²ç»å­˜åœ¨ç«äº‰äº†ï¼Œæ£€æŸ¥åŸæ¥æŒæœ‰è¯¥å¯¹è±¡é”çš„çº¿ç¨‹æ˜¯å¦ä¾ç„¶å­˜æ´»ï¼Œå¦‚æœæŒ‚äº†ï¼Œåˆ™å¯ä»¥å°†å¯¹è±¡å˜ä¸ºæ— é”çŠ¶æ€ï¼Œç„¶åé‡æ–°åå‘æ–°çš„çº¿ç¨‹ï¼Œå¦‚æœåŸæ¥çš„çº¿ç¨‹ä¾ç„¶å­˜æ´»ï¼Œåˆ™é©¬ä¸Šæ‰§è¡Œé‚£ä¸ªçº¿ç¨‹çš„æ“ä½œæ ˆï¼Œæ£€æŸ¥è¯¥å¯¹è±¡çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚æœä»ç„¶éœ€è¦æŒæœ‰åå‘é”ï¼Œåˆ™åå‘é”å‡çº§ä¸ºè½»é‡çº§é”ï¼Œï¼ˆåå‘é”å°±æ˜¯è¿™ä¸ªæ—¶å€™å‡çº§ä¸ºè½»é‡çº§é”çš„ï¼‰ã€‚å¦‚æœä¸å­˜åœ¨ä½¿ç”¨äº†ï¼Œåˆ™å¯ä»¥å°†å¯¹è±¡å›å¤æˆæ— é”çŠ¶æ€ï¼Œç„¶åé‡æ–°åå‘ã€‚ è½»é‡çº§é”è®¤ä¸ºç«äº‰å­˜åœ¨ï¼Œä½†æ˜¯ç«äº‰çš„ç¨‹åº¦å¾ˆè½»ï¼Œä¸€èˆ¬ä¸¤ä¸ªçº¿ç¨‹å¯¹äºåŒä¸€ä¸ªé”çš„æ“ä½œéƒ½ä¼šé”™å¼€ï¼Œæˆ–è€…è¯´ç¨å¾®ç­‰å¾…ä¸€ä¸‹ï¼ˆè‡ªæ—‹ï¼‰ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°±ä¼šé‡Šæ”¾é”ã€‚ ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”è†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œé‡é‡çº§é”ä½¿é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ï¼Œé˜²æ­¢CPUç©ºè½¬ã€‚ å‚è€ƒï¼š ã€æ­»ç£•Javaå¹¶å‘ã€‘â€”â€“æ·±å…¥åˆ†æsynchronizedçš„å®ç°åŸç† javaå¯¹è±¡åœ¨å†…å­˜ä¸­çš„ç»“æ„ï¼ˆHotSpotè™šæ‹Ÿæœºï¼‰ Difference between lock and monitor â€“ Java Concurrency ","date":"2020-02-25","objectID":"/java_synchronized_underlying/:4:7","tags":["synchronized","java"],"title":"Javaä¹‹synchronizedçš„å®ç°åŸç†","uri":"/java_synchronized_underlying/"},{"categories":["Java",""],"content":" å…¶å®ï¼Œæ— è®ºæ˜¯Mybatisã€Hibernateéƒ½æ˜¯ORMçš„ä¸€ç§å®ç°æ¡†æ¶ï¼Œéƒ½æ˜¯å¯¹JDBCçš„ä¸€ç§å°è£…ã€‚ ä¹‹å‰æˆ‘å†™è¿‡ä¸€ç¯‡Spring Booté›†æˆMyBatisæ“ä½œMySQLï¼Œä¸è¿‡åœ¨è¿™é‡Œè®©æˆ‘ä»¬è„±ç¦»Springï¼ˆä¸è¿‡å¾ˆå¤šä»£ç æ˜¯ä¸€æ ·çš„,Daoç±»ï¼ŒModelç±»ï¼Œæ•°æ®åº“é…ç½®ï¼‰ï¼Œå°±å•ç‹¬å›é¡¾ä¸‹MyBatisçš„ä½¿ç”¨ï¼Œæ¥äº†è§£ä¸‹MyBatisçš„ä½¿ç”¨æµç¨‹ã€‚ ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:0:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["Java",""],"content":"Mybatiså·¥ä½œæµç¨‹ é€šè¿‡Readerå¯¹è±¡è¯»å–Mybatisé…ç½®æ–‡ä»¶ é€šè¿‡SqlSessionFactoryBuilderå¯¹è±¡åˆ›å»ºSqlSessionFactoryå¯¹è±¡ è·å–å½“å‰çº¿ç¨‹çš„SQLSession äº‹åŠ¡é»˜è®¤å¼€å¯ é€šè¿‡SQLSessionè¯»å–æ˜ å°„æ–‡ä»¶ä¸­çš„æ“ä½œç¼–å·ï¼Œä»è€Œè¯»å–SQLè¯­å¥ æäº¤äº‹åŠ¡ å…³é—­èµ„æº SqlSessionFactoryæ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„ç±»ï¼Œæ¯ä¸ªåŸºäº MyBatis çš„åº”ç”¨éƒ½æ˜¯ä»¥ä¸€ä¸ª SqlSessionFactory çš„å®ä¾‹ä¸ºæ ¸å¿ƒçš„ã€‚SqlSessionFactory çš„å®ä¾‹å¯ä»¥é€šè¿‡ SqlSessionFactoryBuilder è·å¾—ã€‚è€Œ SqlSessionFactoryBuilder åˆ™å¯ä»¥ä» XML é…ç½®æ–‡ä»¶æˆ–ä¸€ä¸ªé¢„å…ˆå®šåˆ¶çš„ Configuration çš„å®ä¾‹æ„å»ºå‡º SqlSessionFactory çš„å®ä¾‹ã€‚ ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:1:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["Java",""],"content":"pom.xml \u003c?xml version=\"1.0\" encoding=\"UTF-8\"?\u003e \u003cproject xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"\u003e \u003cmodelVersion\u003e4.0.0\u003c/modelVersion\u003e \u003cgroupId\u003ecom.51lucy.test\u003c/groupId\u003e \u003cartifactId\u003emybatis-simple\u003c/artifactId\u003e \u003cversion\u003e1.0\u003c/version\u003e \u003cdependencies\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.mybatis\u003c/groupId\u003e \u003cartifactId\u003emybatis\u003c/artifactId\u003e \u003cversion\u003e3.5.3\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003emysql\u003c/groupId\u003e \u003cartifactId\u003emysql-connector-java\u003c/artifactId\u003e \u003cversion\u003e5.1.41\u003c/version\u003e \u003c/dependency\u003e \u003c/dependencies\u003e \u003c/project\u003e ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:2:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["Java",""],"content":"æ•°æ®åº“é…ç½®jdbc.properties åœ¨src/main/resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºjdbc.propertiesæ–‡ä»¶ï¼š jdbc.driverClassName=com.mysql.jdbc.Driver jdbc.url=jdbc:mysql://localhost:3306/spring_db jdbc.username=root jdbc.password=*********** ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:3:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["Java",""],"content":"mybatisé…ç½®æ–‡ä»¶ åœ¨src/main/resourcesæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºmybatis-config.xmlæ–‡ä»¶ï¼š \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"\u003e \u003cconfiguration\u003e \u003cproperties resource=\"jdbc.properties\"/\u003e \u003cenvironments default=\"development\"\u003e \u003c!-- è®¾ç½®ä¸€ä¸ªé»˜è®¤çš„è¿æ¥ç¯å¢ƒä¿¡æ¯ --\u003e \u003cenvironment id=\"development\"\u003e \u003ctransactionManager type=\"JDBC\"/\u003e \u003cdataSource type=\"POOLED\"\u003e \u003cproperty name=\"driver\" value=\"${jdbc.driverClassName}\"/\u003e \u003cproperty name=\"url\" value=\"${jdbc.url}\"/\u003e \u003cproperty name=\"username\" value=\"${jdbc.username}\"/\u003e \u003cproperty name=\"password\" value=\"${jdbc.password}\"/\u003e \u003c/dataSource\u003e \u003c/environment\u003e \u003c/environments\u003e \u003cmappers\u003e \u003cmapper resource=\"mappers/User.xml\"/\u003e \u003c/mappers\u003e \u003c/configuration\u003e ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:4:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["Java",""],"content":"æ·»åŠ Daoæ¥å£ UserDaoæ¥å£ï¼ˆå…¶å®å°±æ˜¯Mapperæ¥å£ï¼‰ package com.lucy.test.dao; import com.lucy.test.model.User; public interface UserDao { User findByName(String name); int insertUser(User user); } ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:5:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["Java",""],"content":"xmlæ˜ å°„æ–‡ä»¶ åœ¨src/main/resources/mappersæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºUser.xmlæ–‡ä»¶ï¼š \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Mapper 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e \u003c!--namespaceè¦å†™å¯¹--\u003e \u003cmapper namespace=\"com.lucy.test.dao.UserDao\"\u003e \u003cselect id=\"findByName\" parameterType=\"java.lang.String\" resultType=\"com.lucy.test.model.User\"\u003e select uid, name, age, address, created_time from user where name = #{name} \u003c/select\u003e \u003cinsert id=\"insertUser\" parameterType=\"com.lucy.test.model.User\"\u003e insert into user(name, age, address, created_time) VALUES ( #{name}, #{age}, #{address}, #{createdDatetime} ) \u003c/insert\u003e \u003c/mapper\u003e ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:6:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["Java",""],"content":"æµ‹è¯•ç±» è®©æˆ‘ä»¬å†™ä¸ªæµ‹è¯•ç±»çœ‹çœ‹æ•ˆæœï¼š package com.lucy.test; import com.lucy.test.dao.UserDao; import com.lucy.test.model.User; import org.apache.ibatis.io.Resources; import org.apache.ibatis.session.SqlSession; import org.apache.ibatis.session.SqlSessionFactory; import org.apache.ibatis.session.SqlSessionFactoryBuilder; import java.io.IOException; import java.io.InputStream; public class Main { public static void main(String[] args) throws IOException { String resource = \"mybatis-config.xml\"; InputStream inputStream = Resources.getResourceAsStream(resource); SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(inputStream); SqlSession sqlSession = sqlSessionFactory.openSession(); try { UserDao userMapper = sqlSession.getMapper(UserDao.class); User user = userMapper.findByName(\"meng\"); System.out.println(user.toString()); sqlSession.commit(); } catch (Exception ex) { ex.printStackTrace(); } finally { sqlSession.close(); } } } å‚è€ƒï¼š MyBatis Tutorial â€“ CRUD Operations and Mapping Relationships â€“ Part 1 ","date":"2020-02-21","objectID":"/mybatis_getstart_lookback/:7:0","tags":["MyBatis"],"title":"MyBatisç»å…¸å…¥é—¨å›é¡¾","uri":"/mybatis_getstart_lookback/"},{"categories":["C++","Qt"],"content":"æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.3 LTS Qtç‰ˆæœ¬ï¼š5.14.1 Qt Creatorç‰ˆæœ¬ï¼š4.10.1 ","date":"2020-02-12","objectID":"/qt%E4%B9%8B%E5%B8%83%E5%B1%80%E7%AE%A1%E7%90%86/:0:0","tags":["Qt"],"title":"Qtä¹‹å¸ƒå±€ç®¡ç†","uri":"/qt%E4%B9%8B%E5%B8%83%E5%B1%80%E7%AE%A1%E7%90%86/"},{"categories":["C++","Qt"],"content":"å¸ƒå±€å™¨æ¦‚è§ˆ æˆ‘ä»¬ä»¥ä¸‹å›¾çš„ Qt è®¾è®¡å¸ˆç•Œé¢æ¥è¯´æ˜å¸ƒå±€åŠŸèƒ½ï¼ŒQtCreator è®¾è®¡æ¨¡å¼çš„å¸ƒå±€åŠŸèƒ½ä¸ Qt è®¾è®¡å¸ˆæ˜¯ä¸€æ ·çš„ã€‚ åœ¨è®¾è®¡å¸ˆå·¦è¾¹åˆ—è¡¨ï¼Œå¯ä»¥çœ‹åˆ° Layouts æ ç›®é‡Œæœ‰å››ä¸ªå¸ƒå±€å™¨ï¼š ç›´å¸ƒå±€å™¨ QVBoxLayoutï¼šå°†å†…éƒ¨çš„æ§ä»¶æŒ‰ç…§å‚ç›´æ–¹å‘æ’å¸ƒï¼Œä¸€è¡Œä¸€ä¸ªã€‚ â—† æ°´å¹³å¸ƒå±€å™¨ QHBoxLayoutï¼šå°†å†…éƒ¨çš„æ§ä»¶æŒ‰ç…§æ°´å¹³æ–¹å‘æ’å¸ƒï¼Œä¸€åˆ—ä¸€ä¸ªã€‚ â—† ç½‘æ ¼å¸ƒå±€å™¨ QGridLayoutï¼šæŒ‰ç…§å¤šè¡Œã€å¤šåˆ—çš„ç½‘æ ¼æ’å¸ƒå†…éƒ¨æ§ä»¶ï¼Œå•ä¸ªæ§ä»¶å¯ä»¥å ä¸€ä¸ªæ ¼å­æˆ–è€…å æ®è¿ç»­å¤šä¸ªæ ¼å­ã€‚ â—† è¡¨å•å¸ƒå±€å™¨ QFormLayoutï¼šQt è®¾è®¡å¸ˆé‡ŒæŠŠè¿™ä¸ªå¸ƒå±€å™¨ç§°ä¸ºçª—ä½“å¸ƒå±€å™¨ï¼Œçª—ä½“å¸ƒå±€å™¨è¿™ä¸ªå«æ³•ä¸å‡†ã€‚è¿™ä¸ªå¸ƒå±€å™¨å°±æ˜¯å¯¹åº”ç½‘é¡µè®¾è®¡çš„è¡¨å•ï¼Œé€šå¸¸ç”¨äºæ¥æ”¶ç”¨æˆ·è¾“å…¥ã€‚è¯¥å¸ƒå±€å™¨å°±å¦‚å®ƒçš„å›¾æ ‡ä¸€æ ·ï¼Œå°±æ˜¯å›ºå®šçš„ä¸¤åˆ—æ§ ä»¶ï¼Œç¬¬ä¸€åˆ—é€šå¸¸æ˜¯æ ‡ç­¾ï¼Œç¬¬äºŒåˆ—æ˜¯è¾“å…¥æ§ä»¶æˆ–å«æœ‰è¾“å…¥æ§ä»¶çš„å¸ƒå±€å™¨ã€‚ â—† Qt å¦å¤–è¿˜æœ‰ä¸€ä¸ªå †æ ˆå¸ƒå±€å™¨ QStackedLayoutï¼Œé€šå¸¸ç”¨äºå®¹çº³å¤šä¸ªå­çª—å£å¸ƒå±€ï¼Œæ¯æ¬¡åªæ˜¾ç¤ºå…¶ä¸­ä¸€ä¸ªã€‚è¿™ä¸ªå¸ƒå±€å™¨éšå«åœ¨å †æ ˆéƒ¨ä»¶ QStackedWidget å†…éƒ¨ï¼Œä¸€èˆ¬ç›´æ¥ç”¨ QStackedWidget å°±è¡Œäº†ï¼Œä¸éœ€è¦ä¸“é—¨è®¾ç½®å †æ ˆå¸ƒå±€å™¨ã€‚ ä¸å¸ƒå±€ç´§å¯†å…³è”çš„æ˜¯ä¸¤ä¸ªç©ºç™½æ¡ï¼ˆæˆ–å«å¼¹ç°§æ¡ï¼‰ï¼šHorizontal Spacer æ°´å¹³ç©ºç™½æ¡å’Œ Vertical Spacer å‚ç›´ç©ºç™½æ¡ï¼Œç©ºç™½æ¡çš„ä½œç”¨å°±æ˜¯å¡«å……æ— ç”¨çš„ç©ºéš™ï¼Œå¦‚æœä¸å¸Œæœ›çœ‹åˆ°æ§ä»¶æ‹‰ä¼¸åå˜ä¸‘ï¼Œå°±å¯ä»¥å¡ä¸€ä¸ªç©ºç™½æ¡åˆ°å¸ƒå±€å™¨é‡Œé¢ï¼Œå¸ƒå±€å™¨é€šå¸¸ä¼šä¼˜å…ˆæ‹‰ä¼¸ç©ºç™½æ¡ã€‚ä¸¤ç§ç©ºç™½æ¡çš„ç±»åéƒ½æ˜¯ QSpacerItemï¼Œä¸¤ç§ç©ºç™½æ¡åªæ˜¯é»˜è®¤çš„æ‹‰ä¼¸æ–¹å‘ä¸ä¸€æ ·ã€‚ ","date":"2020-02-12","objectID":"/qt%E4%B9%8B%E5%B8%83%E5%B1%80%E7%AE%A1%E7%90%86/:1:0","tags":["Qt"],"title":"Qtä¹‹å¸ƒå±€ç®¡ç†","uri":"/qt%E4%B9%8B%E5%B8%83%E5%B1%80%E7%AE%A1%E7%90%86/"},{"categories":["C++","Qt"],"content":"QBoxLayout æ°´å¹³å¸ƒå±€å™¨ QHBoxLayout å’Œå‚ç›´å¸ƒå±€å™¨ QVBoxLayout çš„åŸºç±»éƒ½æ˜¯ QBoxLayoutï¼Œåªæ˜¯äºŒè€…æ’åˆ—æ–¹å‘ä¸åŒã€‚æ°´å¹³å’Œå‚ç›´å¸ƒå±€å™¨çš„ä¸»è¦åŠŸèƒ½å‡½æ•°éƒ½ä½äºåŸºç±» QBoxLayout é‡Œé¢ï¼Œæˆ‘ä»¬è¿™é‡Œä¸“é—¨ä»‹ç»ä¸€ä¸‹è¿™ä¸ªåŸºç±»çš„åŠŸèƒ½ã€‚ QBoxLayout æ„é€ å‡½æ•°å’Œ setDirection() éƒ½å¯ä»¥æŒ‡å®šå¸ƒå±€å™¨çš„æ–¹å‘ï¼š QBoxLayout(Direction dir, QWidget * parent = 0) void setDirection(Direction direction) QBoxLayout å¸ƒå±€å™¨çš„æ–¹å‘ QBoxLayout::â€‹Direction æšä¸¾ä¸ä»…å¯ä»¥æŒ‡å®šæ°´å¹³å’Œå‚ç›´ï¼Œè¿˜èƒ½æŒ‡å®šåæ–¹å‘æ’åˆ—ï¼š æšä¸¾å¸¸é‡ æ•°å€¼ æè¿° QBoxLayout::LeftToRight 0 æ°´å¹³å¸ƒå±€ï¼Œä»å·¦åˆ°å³æ’åˆ— QBoxLayout::RightToLeft 1 æ°´å¹³å¸ƒå±€ï¼Œä»å³åˆ°å·¦æ’åˆ— QBoxLayout::TopToBottom 2 å‚ç›´å¸ƒå±€ï¼Œä»ä¸Šåˆ°ä¸‹æ’åˆ— QBoxLayout::BottomToTop 3 å‚ç›´å¸ƒå±€ï¼Œä»ä¸‹åˆ°ä¸Šæ’åˆ— æ°´å¹³å¸ƒå±€å™¨ QHBoxLayout å’Œå‚ç›´å¸ƒå±€å™¨ QVBoxLayout é»˜è®¤æ˜¯å…¶ä¸­çš„ä¸¤ç§ï¼šQBoxLayout::LeftToRight å’Œ QBoxLayout::TopToBottom ã€‚ å¸ƒå±€å™¨æ˜¯ä¸€å®šè¦å¾€é‡Œé¢æ·»åŠ æ§ä»¶æ‰æœ‰ç”¨ï¼Œæ·»åŠ æ§ä»¶çš„å‡½æ•°å¦‚ä¸‹ï¼š void addWidget(QWidget * widget, int stretch = 0, Qt::Alignment alignment = 0) void insertWidget(int index, QWidget * widget, int stretch = 0, Qt::Alignment alignment = 0) widget å°±æ˜¯è¦æ·»åŠ çš„æ§ä»¶æŒ‡é’ˆï¼Œstretch æ˜¯ä¼¸å±•å› å­ï¼Œä¼¸å±•å› å­è¶Šå¤§ï¼Œçª—å£å˜å¤§æ—¶æ‹‰ä¼¸è¶Š å¤šï¼Œalignment ä¸€èˆ¬ä¸éœ€è¦æŒ‡å®šï¼Œç”¨é»˜è®¤çš„å³å¯ã€‚ ç¬¬ä¸€ä¸ª addWidget() æ˜¯å°†æ§ä»¶æ·»åŠ åˆ°å¸ƒå±€é‡Œé¢çš„æ§ä»¶åˆ—è¡¨æœ«å°¾ï¼Œç¬¬äºŒä¸ª insertWidget() æ˜¯å°†æ§ä»¶æ’å…¥åˆ°å¸ƒå±€é‡Œæ§ä»¶åˆ—è¡¨åºå·ä¸º index çš„ä½ç½®ã€‚ ä¸‹é¢çœ‹ä¸ªä¾‹å­ï¼Œæˆ‘åœ¨å‚ç›´å¸ƒå±€å™¨ä¸­æ·»åŠ äº†5ä¸ªLabelï¼Œå®ƒä»¬é«˜åº¦æŒ‰ä¸åŒçš„æ¯”ä¾‹åˆ†é… mainwwindow.cpp MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent) , ui(new Ui::MainWindow) { ui-\u003esetupUi(this); QLabel *label1 = new QLabel(\"One\"); QLabel *label2 = new QLabel(\"Two\"); QLabel *label3 = new QLabel(\"Three\"); QLabel *label4 = new QLabel(\"Four\"); QLabel *label5 = new QLabel(\"Five\"); label1-\u003esetStyleSheet(\"background-color: red\"); label2-\u003esetStyleSheet(\"background-color: yellow\"); label3-\u003esetStyleSheet(\"background-color: green\"); label4-\u003esetStyleSheet(\"background-color: black\"); label5-\u003esetStyleSheet(\"background-color: orange\"); QVBoxLayout *layout = new QVBoxLayout; layout-\u003eaddWidget(label1); layout-\u003eaddWidget(label2, 2); layout-\u003eaddWidget(label3, 3); layout-\u003eaddWidget(label4, 4); layout-\u003eaddWidget(label5, 5); auto central = new QWidget; central-\u003esetLayout(layout); this-\u003esetCentralWidget(central); } æœ€ç»ˆå‘ˆç°çš„æ•ˆæœæ˜¯ï¼š ç„¶åï¼Œæˆ‘å†æ·»åŠ ä¸€ä¸ªæ°´å“å¸ƒå±€å™¨ï¼Œåœ¨é‡Œå¤´æ”¾å…¥3ä¸ªlabel QHBoxLayout *layoutH = new QHBoxLayout; layout-\u003eaddLayout(layoutH, 4); // stretchæ¯”ä¾‹ä¸º4 QLabel *label6 = new QLabel(\"Six\"); QLabel *label7 = new QLabel(\"seven\"); QLabel *label8 = new QLabel(\"eight\"); label6-\u003esetStyleSheet(\"background-color: #7B72E9\"); label7-\u003esetStyleSheet(\"background-color: #1B9AF7\"); label8-\u003esetStyleSheet(\"background-color: #FF4351\"); layoutH-\u003eaddWidget(label6); layoutH-\u003eaddWidget(label7); layoutH-\u003eaddWidget(label8); æœ€ç»ˆæ•ˆæœä¸ºï¼š å‚è€ƒï¼š 6.2 æ°´å¹³å’Œå‚ç›´å¸ƒå±€å™¨ ","date":"2020-02-12","objectID":"/qt%E4%B9%8B%E5%B8%83%E5%B1%80%E7%AE%A1%E7%90%86/:2:0","tags":["Qt"],"title":"Qtä¹‹å¸ƒå±€ç®¡ç†","uri":"/qt%E4%B9%8B%E5%B8%83%E5%B1%80%E7%AE%A1%E7%90%86/"},{"categories":["C++","Qt"],"content":"æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.3 LTS Qtç‰ˆæœ¬ï¼š5.14.1 Qt Creatorç‰ˆæœ¬ï¼š4.10.1 ","date":"2020-01-18","objectID":"/qt_begin/:0:0","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"Qtå®‰è£… é¦–å…ˆï¼Œæˆ‘ä»¬å¾—æ˜ç™½ä¸€äº›æ¦‚å¿µã€‚ Qtæ˜¯ä¸€ä¸ªC++åº“ï¼Œæˆ–è€…è¯´æ˜¯å¼€å‘æ¡†æ¶ï¼Œé‡Œé¢é›†æˆäº†ä¸€äº›åº“å‡½æ•°ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚ Qt Creatoræ˜¯Qté›†æˆå¼€å‘ç¯å¢ƒï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œç¼–å†™ï¼Œç¼–è¯‘ï¼Œè¿è¡Œä½ çš„ç¨‹åºã€‚æ‰€ä»¥æœ€å¼€å§‹å†™Qtåªå®‰è£…Qt Creatorè¿™ä¸ªæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºè¿˜æ²¡æœ‰ç›¸å…³çš„Qtåº“å‘¢ï¼Œä½†æ˜¯æ–°ç‰ˆçš„Qt Creatorï¼ˆ5.9å¼€å§‹ï¼‰å·²ç»é›†æˆäº†Qtäº†ï¼Œæ‰€ä»¥å…¥é—¨å°±æ–¹ä¾¿å¾ˆå¤šäº†ã€‚ å…³äºQtä¸‹è½½ï¼Œå¤§å®¶å¯ä»¥æ‰“å¼€è¿™é‡Œçš„é“¾æ¥ï¼Œé‡Œé¢æœ‰å„ç‰ˆæœ¬Qtï¼ˆQtå’ŒQt Creatorçš„é›†æˆåŒ…ï¼‰ï¼Œæ“ä½œç®€å•ï¼Œæœ€æ–°ç‰ˆæœ¬æ˜¯5.14ã€‚ windowsç‰ˆæœ¬åªè¦åŒå‡»exeå°±å¯ä»¥å®‰è£…äº†ï¼ŒLinuxç‰ˆæœ¬éœ€è¦å…ˆæ·»åŠ æ‰§è¡Œæƒé™ç„¶åè¿è¡Œæ–‡ä»¶ $ chmod +x qt-opensource-linux-x64-5.13.2.run $ ./qt-opensource-linux-x64-5.13.2.run å¯¹äºLinuxç³»ç»Ÿï¼Œéœ€è¦å®‰è£…C/C++ç¼–è¯‘å™¨ï¼Œä»¥Ubuntuä¸ºä¾‹ï¼Œéœ€è¦æ‰§è¡Œï¼š sudo apt-get install -y gcc g++ åœ¨ç”¨åˆ°WebEngineç»„ä»¶çš„ä¼šé‡åˆ°é—®é¢˜ error: GL/gl.h: No such file or directoryï¼Œéœ€è¦ sudo apt-get install mesa-common-dev Note: Just installing the above-mentioned mesa-common-dev kit is not sufficient for more recent Ubuntu versions. Based on a comment in the Qt forum an additional package needs installation. Execute following command: sudo apt-get install libglu1-mesa-dev -y Tested with Qt5.3.1 and Ubuntu 14.04 and it solved the problem with missing -lGL. è¿™ä¸€æ­¥éœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªå³å¯ã€‚ è¿™ä¸€æ­¥é€‰æ‹©ä½ éœ€è¦çš„ç»„ä»¶ï¼ˆä¸æ¸…æ¥šçš„è¯ï¼Œå°±åƒæˆ‘è¿™æ ·é€‰æ‹©å¥½äº†ï¼‰ æœ€åæ¥åˆ°Qt Creatorçš„å¯åŠ¨ç•Œé¢ ","date":"2020-01-18","objectID":"/qt_begin/:1:0","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"é…ç½®ç¯å¢ƒå˜é‡ è¿™ä¸€æ­¥é…ç½®çš„ç¯å¢ƒå˜é‡åœ¨æ‰“åŒ…Qtç¨‹åºçš„æ—¶å€™æ˜¯éœ€è¦çš„ã€‚ ç¼–è¾‘vim ~/.bashrcï¼ŒåŠ å…¥ä»¥ä¸‹å˜é‡ export QTDIR=/home/salamander/Qt5.14.1/5.14.1/gcc_64 #è¿™ä¸ªè·¯å¾„ä¾æ®ä½ å®‰è£…çš„Qtè·¯å¾„å®š export PATH=$QTDIR/bin:$PATH export MANPATH=$QTDIR/man:$MANPATH export LD_LIBRARY_PATH=$QTDIR/lib:$LD_LIBRARY_PATH ä½†æ˜¯åœ¨ä½ æ‰§è¡Œqmakeå‘½ä»¤çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°é”™è¯¯ï¼š qmake: could not exec '/usr/lib/x86_64-linux-gnu/qt4/bin/qmake': no such file or directory æˆ‘ä»¬å‘ç°qmakeé»˜è®¤æŒ‡å‘äº†qt4ï¼ˆUbuntu 18é»˜è®¤è£…äº†qt4ï¼‰ï¼Œå…¶å®ç°åœ¨qtå®˜æ–¹æ¨èä½¿ç”¨qtchooseræ¥ç®¡ç†å¤šä¸ªqtç‰ˆæœ¬ã€‚ ","date":"2020-01-18","objectID":"/qt_begin/:2:0","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"ä»€ä¹ˆæ˜¯qtchooser qtchooserå…¶å®å’Œjdkç‰ˆæœ¬ç®¡ç†è½¯ä»¶ä¸€æ ·,æ˜¯ä¸€ä¸ªqtç‰ˆæœ¬ç®¡ç†è½¯ä»¶.ç”¨äºè®¾ç½®å®‰è£…å¤šä¸ªqtçš„ç³»ç»Ÿä¸­é»˜è®¤ä½¿ç”¨çš„qtç‰ˆæœ¬.æˆ‘ä»¬çŸ¥é“ç¯å¢ƒå˜é‡æœ‰ä¸€ä¸ªç¼ºé™·:ä¸€æ¬¡åªæ”¯æŒä¸€ä¸ªç‰ˆæœ¬çš„qt,æœ‰çš„åº”ç”¨å¯èƒ½åªå…¼å®¹ä½ç‰ˆæœ¬qt,è¿™æ ·åˆè¦é…ç½®ç¯å¢ƒå˜é‡éå¸¸éº»çƒ¦.ä½¿ç”¨qtchooseræ–¹ä¾¿å¿«é€Ÿåˆ‡æ¢qtç‰ˆæœ¬è€Œåˆä¸ç”¨æ¯æ¬¡é‡æ–°é…ç½®ç¯å¢ƒå˜é‡ é¦–å…ˆï¼Œæˆ‘ä»¬å¯¼å…¥è‡ªå·±å®‰è£…çš„qt sudo qtchooser -install 5.14.1 /home/salamander/Qt5.14.1/5.14.1/gcc_64/bin/qmake æ³¨æ„ç›®å½•ä¸€å®šè¦ç²¾ç¡®åˆ°qmakeè¿™ä¸ªç¨‹åº,ç„¶åç”¨qtchooser -læŸ¥çœ‹å½“å‰ç³»ç»Ÿæ‰€æœ‰çš„qtç‰ˆæœ¬,å¾—åˆ°å¦‚ä¸‹è¾“å‡º: 4 5.14.1 5 default qt4-x86_64-linux-gnu qt4 qt5-x86_64-linux-gnu qt5 å¯ä»¥çœ‹åˆ°æˆ‘ä»¬è‡ªå·±æ–°å®‰è£…å¹¶å‘½åçš„5.14.1å·²ç»å¯¼å…¥äº†,æ¥ä¸‹æ¥å°±æ˜¯è®¾å®šé»˜è®¤qtç‰ˆæœ¬äº†,æŒ‰ç…§qtchooserä½¿ç”¨æç¤º,å¯ä»¥æ·»åŠ ä¸€ä¸ªåä¸ºQT_SELECTçš„ç¯å¢ƒå˜é‡,æ¥é€‰æ‹©é»˜è®¤qtç‰ˆæœ¬: export QT_SELECT=5.14.1 å¯ä»¥çœ‹å‡ºè¿™ä¸ªç¯å¢ƒå˜é‡åé¢çš„å€¼è·Ÿçš„æ˜¯ç³»ç»Ÿå·²å®‰è£…çš„qtçš„åç§°,è¿™äº›åç§°å¯ä»¥ç”¨qtchooser -læŸ¥çœ‹. æ‰§è¡Œqmake -vï¼Œå‘ç°ç‰ˆæœ¬å·²ç»æ˜¯æˆ‘ä»¬è‡ªå·±å®‰è£…çš„äº†ï¼š $ qmake -v QMake version 3.1 Using Qt version 5.14.1 in /home/salamander/Qt5.14.1/5.14.1/gcc_64/lib æ¯æ¬¡exportè¿™ä¸ªQT_SELECTå˜é‡æœ‰ç‚¹éº»çƒ¦ï¼Œä½ å¯ä»¥ç¼–è¾‘.bashrcæ¥è‡ªåŠ¨åˆ‡æ¢qtç‰ˆæœ¬ã€‚ ","date":"2020-01-18","objectID":"/qt_begin/:2:1","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"å†™ä¸ªhello world ç‚¹å‡»æ–‡ä»¶èœå•ï¼Œç„¶åæ–°å»ºé¡¹ç›®ï¼Œé€‰æ‹©Qt Console Applicationã€‚ ç¼–è¾‘main.cppæ–‡ä»¶ï¼Œä»£ç ä¸ºï¼š #include \u003cQCoreApplication\u003e #include \u003cQDebug\u003e int main(int argc, char *argv[]) { QCoreApplication a(argc, argv); qDebug() \u003c\u003c \"hello world\"; return a.exec(); } ç‚¹å‡»å·¦ä¸‹è§’çš„RunæŒ‰é’®ï¼Œå°±å¯ä»¥å¯åŠ¨ç¨‹åºã€‚ ","date":"2020-01-18","objectID":"/qt_begin/:3:0","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"ä¿¡å·å’Œæ§½ ä¿¡å·å’Œæ§½æœºåˆ¶æ˜¯ QT çš„æ ¸å¿ƒæœºåˆ¶ï¼Œè¦ç²¾é€š QT ç¼–ç¨‹å°±å¿…é¡»å¯¹ä¿¡å·å’Œæ§½æœ‰æ‰€äº†è§£ã€‚ä¸åŒäºä¼ ç»Ÿçš„å‡½æ•°å›è°ƒæ–¹å¼ã€‚ä¿¡å·å’Œæ’æ§½æ˜¯ Qt ä¸­éå¸¸æœ‰ç‰¹è‰²çš„åœ°æ–¹ï¼Œå¯ä»¥è¯´æ˜¯Qtç¼–ç¨‹åŒºåˆ«äºå…¶å®ƒç¼–ç¨‹çš„æ ‡å¿—ã€‚ä¿¡å·å’Œæ§½æ˜¯ä¸€ç§é«˜çº§æ¥å£ï¼Œåº”ç”¨äºå¯¹è±¡ä¹‹é—´çš„é€šä¿¡ï¼Œå®ƒæ˜¯ Qt çš„æ ¸å¿ƒç‰¹æ€§ã€‚ ","date":"2020-01-18","objectID":"/qt_begin/:4:0","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"ä¿¡å·ï¼ˆsignalï¼‰ å½“ä¸€ä¸ªå¯¹è±¡ä¸­æŸäº›å¯èƒ½ä¼šæœ‰åˆ«çš„å¯¹è±¡å…³å¿ƒçš„çŠ¶æ€è¢«ä¿®æ”¹æ—¶ï¼Œå°†ä¼šå‘å‡ºä¿¡å·ã€‚åªæœ‰å®šä¹‰äº†ä¿¡å·çš„ç±»åŠå…¶å­ç±»å¯ä»¥å‘å‡ºä¿¡å·ã€‚ å½“ä¸€ä¸ªä¿¡å·è¢«å‘å‡ºæ—¶ï¼Œè¿æ¥åˆ°è¿™ä¸ªä¿¡å·çš„æ§½ç«‹å³è¢«è°ƒç”¨ï¼Œå°±åƒä¸€ä¸ªæ™®é€šçš„å‡½æ•°è°ƒç”¨ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œä¿¡å·æ§½æœºåˆ¶ç‹¬ç«‹äºä»»ä½• GUI äº‹ä»¶å¾ªç¯ã€‚emit è¯­å¥ä¹‹åçš„ä»£ç å°†åœ¨æ‰€æœ‰çš„æ§½è¿”å›ä¹‹åè¢«æ‰§è¡Œã€‚è¿™ç§æƒ…å†µä¸ä½¿ç”¨è¿æ¥é˜Ÿåˆ—ç•¥æœ‰ä¸åŒï¼šä½¿ç”¨è¿æ¥é˜Ÿåˆ—çš„æ—¶å€™ï¼Œemit è¯­å¥ä¹‹åçš„ä»£ç å°†ç«‹å³è¢«æ‰§è¡Œï¼Œè€Œæ§½åœ¨ä¹‹åæ‰§è¡Œã€‚ å¦‚æœä¸€ä¸ªä¿¡å·è¿æ¥äº†å¤šä¸ªæ§½ï¼Œå½“ä¿¡å·å‘å‡ºæ—¶ï¼Œè¿™äº›æ§½å°†ä»¥è¿æ¥çš„é¡ºåºä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è¢«æ‰§è¡Œï¼ˆé¡ºåºä¸ç¡®å®šï¼‰ã€‚ ","date":"2020-01-18","objectID":"/qt_begin/:4:1","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"æ§½ï¼ˆslotï¼‰ å½“è¿æ¥åˆ°çš„ä¿¡å·å‘å‡ºæ—¶ï¼Œæ§½å°±ä¼šè¢«è°ƒç”¨ã€‚æ§½æ˜¯æ™®é€šçš„ C++ å‡½æ•°ï¼Œèƒ½å¤Ÿè¢«æ­£å¸¸çš„è°ƒç”¨ã€‚å®ƒä»¬çš„å”¯ä¸€ç‰¹ç‚¹æ˜¯èƒ½å¤Ÿä¸ä¿¡å·è¿æ¥ã€‚ æ—¢ç„¶ä¿¡å·å°±æ˜¯æ™®é€šçš„æˆå‘˜å‡½æ•°ï¼Œå½“å®ƒä»¬åƒæ™®é€šå‡½æ•°ä¸€æ ·è°ƒç”¨çš„æ—¶å€™ï¼Œéµå¾ªæ ‡å‡† C++ çš„è§„åˆ™ã€‚ä½†æ˜¯ï¼Œä½œä¸ºæ§½ï¼Œå®ƒä»¬åˆèƒ½å¤Ÿé€šè¿‡ä¿¡å·æ§½çš„è¿æ¥è¢«ä»»ä½•ç»„ä»¶è°ƒç”¨ï¼Œä¸è®ºè¿™ä¸ªç»„ä»¶çš„è®¿é—®çº§åˆ«ã€‚è¿™æ„å‘³ç€ä»»æ„ç±»çš„å®ä¾‹å‘å‡ºçš„ä¿¡å·ï¼Œéƒ½å¯ä»¥ä½¿å¾—ä¸ç›¸å…³çš„ç±»çš„ç§æœ‰æ§½è¢«è°ƒç”¨ã€‚ ä½ ä¹Ÿèƒ½æŠŠæ§½å®šä¹‰æˆè™šçš„ï¼Œè¿™ä¸€ç‚¹åœ¨å®é™…åº”ç”¨ä¸­éå¸¸æœ‰ç”¨ã€‚ ","date":"2020-01-18","objectID":"/qt_begin/:4:2","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"ä¿¡å·ä¸æ§½çš„å…³è” é€šè¿‡è°ƒç”¨ QObject å¯¹è±¡çš„ connect å‡½æ•°æ¥å°†æŸä¸ªå¯¹è±¡çš„ä¿¡å·ä¸å¦å¤–ä¸€ä¸ªå¯¹è±¡çš„æ§½å‡½æ•°ç›¸å…³è”ï¼Œè¿™æ ·å½“å‘å°„è€…å‘å°„ä¿¡å·æ—¶ï¼Œæ¥æ”¶è€…çš„æ§½å‡½æ•°å°†è¢«è°ƒç”¨ã€‚ connect()è¯­å¥çš„åŸå‹ç±»ä¼¼äºï¼š connect(sender, SIGNAL(signal), receiver, SLOT(slot)); è¿™é‡Œï¼Œsender å’Œ receiver éƒ½æ˜¯ QObject ç±»å‹çš„ï¼Œsingal å’Œ slot éƒ½æ˜¯æ²¡æœ‰å‚æ•°åç§°çš„å‡½æ•°ç­¾åã€‚SINGAL()å’ŒSLOT()å®ç”¨äºæŠŠå‚æ•°è½¬æ¢æˆå­—ç¬¦ä¸²ã€‚ ä¸€ä¸ªä¿¡å·å¯ä»¥å’Œå¤šä¸ªæ§½ç›¸è¿ï¼š connect(slider, SIGNAL(valueChanged(int)), spinBox, SLOT(setValue(int))); connect(slider, SIGNAL(valueChanged(int)), this, SLOT(updateStatusBarIndicator(int))); ","date":"2020-01-18","objectID":"/qt_begin/:4:3","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"Guiç®€å•ä¾‹å­ è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ç”¨äº†ä¸Šé¢æ§½çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬åœ¨ç•Œé¢ä¸Šæ”¾äº†ä¸€ä¸ªbuttonï¼Œç„¶åæ·»åŠ äº†slotè·å¾—äº†buttonçš„clickäº‹ä»¶å‘é€è€…çš„objectNameã€‚ ç•Œé¢ mainwindow.h #ifndef MAINWINDOW_H #define MAINWINDOW_H #include \u003cQMainWindow\u003e QT_BEGIN_NAMESPACE namespace Ui { class MainWindow; } QT_END_NAMESPACE class MainWindow : public QMainWindow { Q_OBJECT public: MainWindow(QWidget *parent = nullptr); ~MainWindow(); private: Ui::MainWindow *ui; private slots: void handleButton(); // å¤„ç†å‡½æ•° }; #endif // MAINWINDOW_H mainwindow.cpp #include \"mainwindow.h\" #include \"ui_mainwindow.h\" #include \u003cQDebug\u003e MainWindow::MainWindow(QWidget *parent) : QMainWindow(parent) , ui(new Ui::MainWindow) { ui-\u003esetupUi(this); connect(ui-\u003emyPushButton, SIGNAL(clicked()), this, SLOT(handleButton())); } void MainWindow::handleButton() { QObject *senderObj = sender(); // This will give Sender object QString senderObjName = senderObj-\u003eobjectName(); qDebug() \u003c\u003c senderObjName; // get myPushButton } MainWindow::~MainWindow() { delete ui; } ","date":"2020-01-18","objectID":"/qt_begin/:5:0","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["C++","Qt"],"content":"å‚è€ƒ æ²¹ç®¡ä¸ŠVoidRealmsçš„Qtè§†é¢‘ Install Qt5 On Ubuntu Ubuntu 18.04å®‰è£…QtCreator+é…ç½®qtç¯å¢ƒ+qtchooser ","date":"2020-01-18","objectID":"/qt_begin/:6:0","tags":["Qt","Qt Creator"],"title":"Qtä¹‹åˆæ­¥å°è¯•","uri":"/qt_begin/"},{"categories":["linux"],"content":"Veth Vethç¼©å†™æ˜¯Virtual ETHernetã€‚vethè®¾å¤‡æ˜¯åœ¨linuxå†…æ ¸ä¸­æ˜¯æˆå¯¹å‡ºç°ï¼ˆæ‰€ä»¥ä¹Ÿå«veth-pairï¼‰ï¼Œä¸¤ä¸ªè®¾å¤‡å½¼æ­¤ç›¸è¿ï¼Œä¸€ä¸ªè®¾å¤‡ä»åè®®æ ˆè¯»å–æ•°æ®åï¼Œä¼šå°†æ•°æ®å‘é€åˆ°å¦ä¸€ä¸ªè®¾å¤‡ä¸Šå»ã€‚è¿™ä¸ªè®¾å¤‡å…¶å®æ˜¯ä¸“é—¨ä¸ºcontaineræ‰€å»ºçš„ï¼Œä½œç”¨å°±æ˜¯æŠŠä¸€ä¸ªnetwork namespaceå‘å‡ºçš„æ•°æ®åŒ…è½¬å‘åˆ°å¦ä¸€ä¸ªnamespaceï¼ˆé€šå¸¸å°±æ˜¯å®¿ä¸»æœºï¼‰ã€‚ ","date":"2020-01-14","objectID":"/linu_veth_and_bridge/:1:0","tags":["linux","network"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹Vethå’ŒBridge","uri":"/linu_veth_and_bridge/"},{"categories":["linux"],"content":"æ·»åŠ Vethè®¾å¤‡ $ sudo ip netns add net0 $ sudo ip netns add net1 $ sudo ip link add veth0 netns net0 type veth peer name veth1 netns net1 #æ·»åŠ  veth è®¾å¤‡å¯¹ ä¸Šé¢çš„å‘½ä»¤å°†åˆ›å»ºä¸¤ä¸ªå‘½åç©ºé—´net0å’Œnet1ï¼Œä»¥åŠä¸€å¯¹vethè®¾å¤‡ï¼Œå¹¶å°†veth1åˆ†é…ç»™å‘½åç©ºé—´net0ï¼Œå°†veth2åˆ†é…ç»™å‘½åç©ºé—´net1ã€‚è¿™ä¸¤ä¸ªåç§°ç©ºé—´ä¸æ­¤VETHå¯¹ç›¸è¿ã€‚åˆ†é…ä¸€å¯¹IPåœ°å€ï¼Œä½ å°±å¯ä»¥pingé€šä¸¤è€…ä¹‹é—´çš„é€šè®¯ã€‚ $ ip netns ls # æŸ¥çœ‹åˆ›å»ºçš„network namespace net1 net0 $ sudo ip netns exec net0 ip addr # æŸ¥çœ‹net0ä¸‹çš„ç½‘ç»œè®¾å¤‡ 1: lo: \u003cLOOPBACK\u003e mtu 65536 qdisc noop state DOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 2: veth0@if2: \u003cBROADCAST,MULTICAST\u003e mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether d6:6e:4f:fb:6b:76 brd ff:ff:ff:ff:ff:ff link-netnsid 0 $ sudo ip netns exec net1 ip addr 1: lo: \u003cLOOPBACK\u003e mtu 65536 qdisc noop state DOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 2: veth1@if2: \u003cBROADCAST,MULTICAST\u003e mtu 1500 qdisc noop state DOWN group default qlen 1000 link/ether 92:05:82:e6:da:73 brd ff:ff:ff:ff:ff:ff link-netnsid 0 æˆ‘ä»¬ç»™è¿™å¯¹ veth pair é…ç½®ä¸Š ip åœ°å€ï¼Œå¹¶å¯ç”¨å®ƒä»¬ä»¥åŠ lo æ¥å£: sudo ip netns exec net0 ip link set veth0 up sudo ip netns exec net0 ip addr add 10.0.1.1/24 dev veth0 sudo ip netns exec net0 ip link set lo up sudo ip netns exec net0 ip route 10.0.1.0/24 dev veth0 proto kernel scope link src 10.0.1.1 linkdown sudo ip netns exec net1 ip link set veth1 up sudo ip netns exec net1 ip addr add 10.0.1.2/24 dev veth1 sudo ip netns exec net1 ip link set lo up sudo ip netns exec net1 ip route 10.0.1.0/24 dev veth1 proto kernel scope link src 10.0.1.2 å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ¯ä¸ª namespace ä¸­ï¼Œåœ¨é…ç½®äº† ip ä¹‹åï¼Œè¿˜è‡ªåŠ¨ç”Ÿæˆäº†å¯¹åº”çš„ è·¯ç”±è¡¨ä¿¡æ¯ï¼Œç½‘ç»œ 10.0.1.0/24 æ•°æ®æŠ¥æ–‡éƒ½ä¼šé€šè¿‡ vethpair è¿›è¡Œä¼ è¾“ã€‚ä¸‹é¢ä½¿ç”¨ ping å‘½ä»¤ å¯ä»¥éªŒè¯å®ƒä»¬çš„è¿é€šæ€§ï¼Œå¹¶åœ¨ veth0 å’Œ veth1 ä¸ŠæŠ“åŒ…ï¼š sudo ip netns exec net0 ping -c 3 10.0.1.2 ","date":"2020-01-14","objectID":"/linu_veth_and_bridge/:1:1","tags":["linux","network"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹Vethå’ŒBridge","uri":"/linu_veth_and_bridge/"},{"categories":["linux"],"content":"Bridge Bridgeï¼ˆæ¡¥ï¼‰æ˜¯ Linux ä¸Šç”¨æ¥åš TCP/IP äºŒå±‚åè®®äº¤æ¢çš„è®¾å¤‡ï¼Œä¸ç°å®ä¸–ç•Œä¸­çš„äº¤æ¢æœºåŠŸèƒ½ç›¸ä¼¼ã€‚Bridge è®¾å¤‡å®ä¾‹å¯ä»¥å’Œ Linux ä¸Šå…¶ä»–ç½‘ç»œè®¾å¤‡å®ä¾‹è¿æ¥ï¼Œæ—¢ attach ä¸€ä¸ªä»è®¾å¤‡ï¼Œç±»ä¼¼äºåœ¨ç°å®ä¸–ç•Œä¸­çš„äº¤æ¢æœºå’Œä¸€ä¸ªç”¨æˆ·ç»ˆç«¯ä¹‹é—´è¿æ¥ä¸€æ ¹ç½‘çº¿ã€‚å½“æœ‰æ•°æ®åˆ°è¾¾æ—¶ï¼ŒBridge ä¼šæ ¹æ®æŠ¥æ–‡ä¸­çš„ MAC ä¿¡æ¯è¿›è¡Œå¹¿æ’­ã€è½¬å‘ã€ä¸¢å¼ƒå¤„ç†ã€‚ ä½¿ç”¨Bridgeå‰ï¼Œéœ€è¦å®‰è£…bridge-utilsåŒ… sudo apt install bridge-utils ","date":"2020-01-14","objectID":"/linu_veth_and_bridge/:2:0","tags":["linux","network"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹Vethå’ŒBridge","uri":"/linu_veth_and_bridge/"},{"categories":["linux"],"content":"æŸ¥çœ‹bridge $ brctl show bridge name bridge id STP enabled interfaces br-1f7059361887 8000.0242740c4703 no veth35716a0 vethc51a0aa vethd17adab br-4646ac4e576a 8000.02421afdd01b no br-4b05476c9f71 8000.024240053946 no br-5282ac3290df 8000.0242ad5bae1e no br-638972aaac40 8000.024278b6d203 no br-67973b91b458 8000.024279f6c039 no br-96dbd98373e7 8000.0242f23b4758 no veth13b0e48 veth3af358a veth52b951a veth5adc514 veth6e141f8 veth6fcb89b veth710d968 vethc9477cd vethcf35aff docker0 8000.0242fee4c327 no ä¸Šé¢è¿™ä¸ªæ˜¯docker0çš„æ˜¯Dockerç»™ä½ åˆ›å»ºçš„bridgeï¼ˆå¦‚æœä½ è®¾å¤‡ä¸Šè£…æœ‰dockerçš„è¯ å°±å¯ä»¥çœ‹åˆ°ï¼‰ã€‚ ","date":"2020-01-14","objectID":"/linu_veth_and_bridge/:2:1","tags":["linux","network"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹Vethå’ŒBridge","uri":"/linu_veth_and_bridge/"},{"categories":["linux"],"content":"åˆ›å»ºä¸€ä¸ªbridge brctl addbr br66 ä¸Šé¢å‘½ä»¤åˆ›å»ºä¸€ä¸ªåä¸ºbr66çš„æ¡¥ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æŠŠå·²æœ‰çš„ç½‘ç»œè®¾å¤‡ç»‘å®šåˆ°è¿™ä¸ªæ¡¥ä¸Šï¼Œåœ¨è¿™ä¹‹å‰å¯ä»¥çœ‹çœ‹æˆ‘ä»¬æœ‰æœ‰å“ªäº›ç½‘å¡æ¥å£ï¼Œå¯ä»¥ç”¨ ip addr show å‡è®¾ä¸Šé¢æŸ¥å‡ºæ¥ï¼Œæœ‰eth0å’Œeth1ä¸¤ä¸ªç½‘å¡æ¥å£ï¼Œä¸‹é¢æˆ‘ä»¬æŠŠä»–ä»¬ç”¨å‘½ä»¤ç»‘å®šåˆ°ä¸€èµ· brctl addif br0 eth0 eth1 # eth0å’Œeth1çš„é¡ºåºä¸é‡è¦ï¼Œä¸å½±å“ç»“æœ å†æ¥æŸ¥çœ‹ç»‘å®šå…³ç³» $ brctl show bridge name bridge id STP enabled interfaces br66 8000.001ec952d26b yes eth0 eth1 å°±æ˜¯è¯´eth0å’Œeth1ç»‘å®šåˆ°äº†br0è¿™ä¸ªæ¡¥ä¸Šäº†ã€‚ ","date":"2020-01-14","objectID":"/linu_veth_and_bridge/:2:2","tags":["linux","network"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹Vethå’ŒBridge","uri":"/linu_veth_and_bridge/"},{"categories":["linux"],"content":"å‚è€ƒæ–‡ç«  Linux ä¸Šçš„åŸºç¡€ç½‘ç»œè®¾å¤‡è¯¦è§£ ","date":"2020-01-14","objectID":"/linu_veth_and_bridge/:3:0","tags":["linux","network"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹Vethå’ŒBridge","uri":"/linu_veth_and_bridge/"},{"categories":["linux"],"content":"æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒLinuxå®é™…æ˜¯é€šè¿‡ç½‘ç»œè®¾å¤‡å»æ“ä½œå’Œä½¿ç”¨ç½‘å¡çš„ï¼Œç³»ç»Ÿå®‰è£…äº†ä¸€ä¸ªç½‘å¡ä¹‹åä¼šä¸ºå…¶ç”Ÿæˆä¸€ä¸ªç½‘ç»œè®¾å¤‡å®ä¾‹ï¼Œæ¯”å¦‚eth0ï¼ˆæˆ–è€…å«enp7s0ï¼Œä¸åŒå‘è¡Œç‰ˆé»˜è®¤ç½‘å¡å‘½åè§„åˆ™ä¸åŒï¼‰ã€‚éšç€ç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯çš„å‘å±•ï¼ŒLinuxæ”¯æŒåˆ›å»ºå‡ºè™šæ‹ŸåŒ–çš„è®¾å¤‡ï¼Œå¯ä»¥é€šè¿‡è™šæ‹ŸåŒ–è®¾å¤‡çš„ç»„åˆå®ç°å¤šç§å¤šæ ·çš„åŠŸèƒ½å’Œç½‘ç»œæ‹“æ‰‘ã€‚ å¸¸è§çš„è™šæ‹ŸåŒ–è®¾å¤‡æœ‰tun/tapã€Vethã€Bridgeã€802.1q VLAN deviceã€‚ æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.3 LTS å…ˆå›é¡¾ä¸€ä¸‹ç»å…¸çš„OSIä¸ƒå±‚ç½‘ç»œæ¨¡å‹ï¼š â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”‚ã€€åº”ç”¨å±‚ã€€â”‚â†ç¬¬ä¸ƒå±‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ã€€è¡¨ç¤ºå±‚ã€€â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ã€€ä¼šè¯å±‚ã€€â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ã€€ä¼ è¾“å±‚ã€€â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ã€€ç½‘ç»œå±‚ã€€â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚æ•°æ®é“¾è·¯å±‚â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”¤ â”‚ã€€ç‰©ç†å±‚ã€€â”‚â†ç¬¬ä¸€å±‚ â””â”€â”€â”€â”€â”€â”€â”€â”˜Â OSIä¸ƒå±‚å‚è€ƒæ¨¡å‹ ","date":"2020-01-13","objectID":"/tun-tap/:0:0","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["linux"],"content":"è™šæ‹Ÿè®¾å¤‡å’Œç‰©ç†è®¾å¤‡çš„åŒºåˆ« å¯¹äºä¸€ä¸ªç½‘ç»œè®¾å¤‡æ¥è¯´ï¼Œå°±åƒä¸€ä¸ªç®¡é“ï¼ˆpipeï¼‰ä¸€æ ·ï¼Œæœ‰ä¸¤ç«¯ï¼Œä»å…¶ä¸­ä»»æ„ä¸€ç«¯æ”¶åˆ°çš„æ•°æ®å°†ä»å¦ä¸€ç«¯å‘é€å‡ºå»ã€‚ æ¯”å¦‚ä¸€ä¸ªç‰©ç†ç½‘å¡eth0ï¼Œå®ƒçš„ä¸¤ç«¯åˆ†åˆ«æ˜¯å†…æ ¸åè®®æ ˆï¼ˆé€šè¿‡å†…æ ¸ç½‘ç»œè®¾å¤‡ç®¡ç†æ¨¡å—é—´æ¥çš„é€šä¿¡ï¼‰å’Œå¤–é¢çš„ç‰©ç†ç½‘ç»œï¼Œä»ç‰©ç†ç½‘ç»œæ”¶åˆ°çš„æ•°æ®ï¼Œä¼šè½¬å‘ç»™å†…æ ¸åè®®æ ˆï¼Œè€Œåº”ç”¨ç¨‹åºä»åè®®æ ˆå‘è¿‡æ¥çš„æ•°æ®å°†ä¼šé€šè¿‡ç‰©ç†ç½‘ç»œå‘é€å‡ºå»ã€‚ é‚£ä¹ˆå¯¹äºä¸€ä¸ªè™šæ‹Ÿç½‘ç»œè®¾å¤‡å‘¢ï¼Ÿé¦–å…ˆå®ƒä¹Ÿå½’å†…æ ¸çš„ç½‘ç»œè®¾å¤‡ç®¡ç†å­ç³»ç»Ÿç®¡ç†ï¼Œå¯¹äºLinuxå†…æ ¸ç½‘ç»œè®¾å¤‡ç®¡ç†æ¨¡å—æ¥è¯´ï¼Œè™šæ‹Ÿè®¾å¤‡å’Œç‰©ç†è®¾å¤‡æ²¡æœ‰åŒºåˆ«ï¼Œéƒ½æ˜¯ç½‘ç»œè®¾å¤‡ï¼Œéƒ½èƒ½é…ç½®IPï¼Œä»ç½‘ç»œè®¾å¤‡æ¥çš„æ•°æ®ï¼Œéƒ½ä¼šè½¬å‘ç»™åè®®æ ˆï¼Œåè®®æ ˆè¿‡æ¥çš„æ•°æ®ï¼Œä¹Ÿä¼šäº¤ç”±ç½‘ç»œè®¾å¤‡å‘é€å‡ºå»ï¼Œè‡³äºæ˜¯æ€ä¹ˆå‘é€å‡ºå»çš„ï¼Œå‘åˆ°å“ªé‡Œå»ï¼Œé‚£æ˜¯è®¾å¤‡é©±åŠ¨çš„äº‹æƒ…ï¼Œè·ŸLinuxå†…æ ¸å°±æ²¡å…³ç³»äº†ï¼Œæ‰€ä»¥è¯´è™šæ‹Ÿç½‘ç»œè®¾å¤‡çš„ä¸€ç«¯ä¹Ÿæ˜¯åè®®æ ˆï¼Œè€Œå¦ä¸€ç«¯æ˜¯ä»€ä¹ˆå–å†³äºè™šæ‹Ÿç½‘ç»œè®¾å¤‡çš„é©±åŠ¨å®ç°ã€‚ ","date":"2020-01-13","objectID":"/tun-tap/:1:0","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["linux"],"content":"tun/tap ","date":"2020-01-13","objectID":"/tun-tap/:2:0","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["linux"],"content":"tunåˆ†æå®éªŒ å…ˆä¸Šå›¾è¯´è¯ï¼š ä¸Šå›¾ä¸­æ˜¯tunè®¾å¤‡çš„æ•°æ®èµ°å‘ã€‚ å›¾ä¸­nsfocus_tun0å°±æ˜¯tun0ï¼Œæ˜¯ä¸€ä¸ªtun/tapè™šæ‹Ÿè®¾å¤‡ï¼Œè€Œeno16777736å°±æ˜¯eth0ã€‚ socketã€åè®®æ ˆï¼ˆNewwork Protocol Stackï¼‰å’Œç½‘ç»œè®¾å¤‡ï¼ˆeth0å’Œtun0ï¼‰éƒ¨åˆ†éƒ½åœ¨å†…æ ¸å±‚ï¼Œå…¶å®socketæ˜¯åè®®æ ˆçš„ä¸€éƒ¨åˆ†ï¼Œè¿™é‡Œåˆ†å¼€æ¥çš„ç›®çš„æ˜¯ä¸ºäº†çœ‹çš„æ›´ç›´è§‚ã€‚ ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºå®ƒå’Œç‰©ç†è®¾å¤‡eth0çš„å·®åˆ«ï¼Œå®ƒä»¬çš„ä¸€ç«¯è™½ç„¶éƒ½è¿ç€åè®®æ ˆï¼Œä½†å¦ä¸€ç«¯ä¸ä¸€æ ·ï¼Œeth0çš„å¦ä¸€ç«¯æ˜¯ç‰©ç†ç½‘ç»œï¼Œè¿™ä¸ªç‰©ç†ç½‘ç»œå¯èƒ½å°±æ˜¯ä¸€ä¸ªäº¤æ¢æœºï¼Œè€Œtun0çš„å¦ä¸€ç«¯æ˜¯ä¸€ä¸ªç”¨æˆ·å±‚çš„ç¨‹åºï¼Œåè®®æ ˆå‘ç»™tun0çš„æ•°æ®åŒ…èƒ½è¢«è¿™ä¸ªåº”ç”¨ç¨‹åºè¯»å–åˆ°ï¼Œå¹¶ä¸”åº”ç”¨ç¨‹åºèƒ½ç›´æ¥å‘tun0å†™æ•°æ®ã€‚ æ•°æ®æµå‘åˆ†æï¼š User Application Aé€šè¿‡å¥—æ¥å­—ï¼ˆsocket Aï¼‰å‘æ•°æ®å‘ç»™ä½¿ç”¨ä¸eno16777736å¤„äºåŒä¸€ä¸ªç½‘æ®µipçš„åº”ç”¨ç¨‹åºï¼Œæ•°æ®èµ°å‘ä¸ºé€šè¿‡socket Aå‘ç»™åè®®æ ˆï¼Œæœ€åé€šè¿‡netdeviceå­ç³»ç»Ÿä¸­çš„eno16777736çš„è®¾å¤‡é©±åŠ¨ï¼ˆä»¥å¤ªç½‘é©±åŠ¨ï¼‰å‘é€å‡ºå»ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡çœŸå®çš„ç‰©ç†ç½‘å¡å‘é€å‡ºå»ã€‚ User Application Bé€šè¿‡å¥—æ¥å­—ï¼ˆsocket Bï¼‰å‘é€æ•°æ®ç»™ä½¿ç”¨ä¸nsfocus_tun0å¤„äºåŒä¸€ä¸ªç½‘æ®µipçš„åº”ç”¨ç¨‹åºï¼Œæ•°æ®èµ°å‘ä¸ºé€šè¿‡socket Bå‘é€ç»™åè®®æ ˆï¼Œæœ€åé€šè¿‡netdeviceå­ç³»ç»Ÿä¸­çš„nsfocus_tun0çš„è®¾å¤‡é©±åŠ¨ï¼ˆtuné©±åŠ¨ï¼‰å‘é€å‡ºå»ã€‚ç”±äºtunè®¾å¤‡æ²¡æœ‰å¯¹åº”çœŸå®çš„ç‰©ç†ç½‘å¡ï¼Œæ‰€ä»¥nsfocus_tun0å¯¹ç«¯æ”¶å–æ•°æ®çš„æ˜¯User Application Cã€‚User Application Cé€šè¿‡è¯»å†™/dev/tunè®¾å¤‡æ–‡ä»¶è¿›è¡Œæ•°æ®çš„æ”¶å‘ã€‚ å…¶å®ä¸€èˆ¬User Application Cå°±æ˜¯ä¸ªVPNç¨‹åºï¼ˆä¾‹å¦‚openvpnï¼‰ï¼Œå®ƒæ”¶åˆ°æ•°æ®åŒ…ä¹‹åï¼Œåšä¸€äº›è·Ÿä¸šåŠ¡ç›¸å…³çš„å¤„ç†ï¼Œç„¶åæ„é€ ä¸€ä¸ªæ–°çš„æ•°æ®åŒ…ï¼Œå°†åŸæ¥çš„æ•°æ®åŒ…åµŒå…¥åœ¨æ–°çš„æ•°æ®åŒ…ä¸­ï¼Œæœ€åé€šè¿‡socket Bå°†æ•°æ®åŒ…è½¬å‘å‡ºå»ï¼Œè¿™æ—¶å€™æ–°æ•°æ®åŒ…çš„æºåœ°å€å˜æˆäº†eth0çš„åœ°å€ï¼Œè€Œç›®çš„IPåœ°å€å˜æˆäº†ä¸€ä¸ªå…¶å®ƒçš„åœ°å€ï¼Œæ¯”å¦‚æ˜¯10.33.0.1ï¼ˆVPNæœåŠ¡å™¨åœ°å€ï¼‰ï¼Œåè®®æ ˆæ ¹æ®æœ¬åœ°è·¯ç”±ï¼Œå‘ç°è¿™ä¸ªæ•°æ®åŒ…åº”è¯¥è¦é€šè¿‡eth0å‘é€å‡ºå»ï¼Œäºæ˜¯å°†æ•°æ®åŒ…äº¤ç»™eth0ï¼Œæœ€åeth0é€šè¿‡ç‰©ç†ç½‘ç»œå°†æ•°æ®åŒ…å‘é€å‡ºå»ã€‚ ä»ä¸Šé¢çš„æµç¨‹ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ•°æ®åŒ…é€‰æ‹©èµ°å“ªä¸ªç½‘ç»œè®¾å¤‡å®Œå…¨ç”±è·¯ç”±è¡¨æ§åˆ¶ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬æƒ³è®©æŸäº›ç½‘ç»œæµé‡èµ°åº”ç”¨ç¨‹åºBçš„è½¬å‘æµç¨‹ï¼Œå°±éœ€è¦é…ç½®è·¯ç”±è¡¨è®©è¿™éƒ¨åˆ†æ•°æ®èµ°tun0ã€‚ ","date":"2020-01-13","objectID":"/tun-tap/:2:1","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["linux"],"content":"ç¤ºä¾‹ç¨‹åº ä¸ºäº†ä½¿ç”¨tun/tapè®¾å¤‡ï¼Œç”¨æˆ·å±‚ç¨‹åºéœ€è¦é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‰“å¼€/dev/net/tunè·å¾—ä¸€ä¸ªè¯»å†™è¯¥è®¾å¤‡çš„æ–‡ä»¶æè¿°ç¬¦(FD)ï¼Œå¹¶ä¸”è°ƒç”¨ioctl()å‘å†…æ ¸æ³¨å†Œä¸€ä¸ªTUNæˆ–TAPç±»å‹çš„è™šæ‹Ÿç½‘å¡(å®ä¾‹åŒ–ä¸€ä¸ªtun/tapè®¾å¤‡)ï¼Œå…¶åç§°å¯èƒ½æ˜¯tap7b7ee9a9-c1/vnetXX/tunXX/tap0ç­‰ã€‚ è¿™é‡Œå†™äº†ä¸€ä¸ªç¨‹åºï¼Œå®ƒæ”¶åˆ°tunè®¾å¤‡çš„æ•°æ®åŒ…ä¹‹åï¼Œåªæ‰“å°å‡ºæ”¶åˆ°äº†å¤šå°‘å­—èŠ‚çš„æ•°æ®åŒ…ï¼Œå…¶å®ƒçš„ä»€ä¹ˆéƒ½ä¸åšã€‚ #include \u003cnet/if.h\u003e #include \u003csys/ioctl.h\u003e #include \u003csys/stat.h\u003e #include \u003cfcntl.h\u003e #include \u003cstring.h\u003e #include \u003csys/types.h\u003e #include \u003clinux/if_tun.h\u003e #include\u003cstdlib.h\u003e #include\u003cstdio.h\u003e int tun_alloc(int flags) { struct ifreq ifr; int fd, err; char *clonedev = \"/dev/net/tun\"; if ((fd = open(clonedev, O_RDWR)) \u003c 0) { return fd; } memset(\u0026ifr, 0, sizeof(ifr)); ifr.ifr_flags = flags; if ((err = ioctl(fd, TUNSETIFF, (void *) \u0026ifr)) \u003c 0) { close(fd); return err; } printf(\"Open tun/tap device: %s for reading...\\n\", ifr.ifr_name); return fd; } int main() { int tun_fd, nread; char buffer[1500]; /* Flags: IFF_TUN - TUN device (no Ethernet headers) * IFF_TAP - TAP device * IFF_NO_PI - Do not provide packet information */ tun_fd = tun_alloc(IFF_TUN | IFF_NO_PI); if (tun_fd \u003c 0) { perror(\"Allocating interface\"); exit(1); } while (1) { nread = read(tun_fd, buffer, sizeof(buffer)); if (nread \u003c 0) { perror(\"Reading from interface\"); close(tun_fd); exit(1); } printf(\"Read %d bytes from tun/tap device\\n\", nread); } return 0; } ç¼–è¯‘ã€è¿è¡Œç¨‹åºï¼Œä¼šå‘ç°å¤šå‡ºä¸€ä¸ªç½‘ç»œè®¾å¤‡ $ gcc -o tun tun.c $ sudo ./tun Open tun/tap device: tun0 for reading... $ ip addr ... 8: tun0: \u003cPOINTOPOINT,MULTICAST,NOARP\u003e mtu 1500 qdisc noop state DOWN group default qlen 500 link/none tun0å°±æ˜¯æ–°å¢çš„ç½‘ç»œè®¾å¤‡ï¼Œç°åœ¨ç»™å®ƒé…ç½®ä¸€ä¸ªipï¼ŒæŸ¥çœ‹æ¥å£ä¿¡æ¯ $ sudo ifconfig tun0 192.168.10.11/24 $ ip addr ... 8: tun0: \u003cPOINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP\u003e mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500 link/none inet 192.168.10.11/24 scope global tun0 valid_lft forever preferred_lft forever inet6 fe80::dd59:736:65ee:e31a/64 scope link stable-privacy valid_lft forever preferred_lft forever è¿™æ—¶å€™æˆ‘ä»¬pingåœ°å€192.168.10.12 ping 192.168.10.12 -c 2 å‘ç°tunç¨‹åºæ”¶åˆ°äº†æ•°æ® ","date":"2020-01-13","objectID":"/tun-tap/:2:2","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["linux"],"content":"tunå’ŒtapåŒºåˆ« ä¸¤è€…å¾ˆç±»ä¼¼ï¼Œåªæ˜¯tunå’Œtapè®¾å¤‡ä»–ä»¬å·¥ä½œçš„åè®®æ ˆå±‚æ¬¡ä¸åŒï¼Œtapç­‰åŒäºä¸€ä¸ªä»¥å¤ªç½‘è®¾å¤‡ï¼Œç”¨æˆ·å±‚ç¨‹åºå‘tapè®¾å¤‡è¯»å†™çš„æ˜¯äºŒå±‚æ•°æ®åŒ…å¦‚ä»¥å¤ªç½‘æ•°æ®å¸§ï¼Œtapè®¾å¤‡æœ€å¸¸ç”¨çš„å°±æ˜¯ä½œä¸ºè™šæ‹Ÿæœºç½‘å¡ã€‚tunåˆ™æ¨¡æ‹Ÿäº†ç½‘ç»œå±‚è®¾å¤‡ï¼Œæ“ä½œç¬¬ä¸‰å±‚æ•°æ®åŒ…æ¯”å¦‚IPæ•°æ®åŒ…ï¼Œopenvpnä½¿ç”¨TUNè®¾å¤‡åœ¨C/Sé—´å»ºç«‹VPNéš§é“ã€‚ ","date":"2020-01-13","objectID":"/tun-tap/:2:3","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["linux"],"content":"tapåˆ†æå®éªŒ tapè®¾å¤‡æœ€å¸¸è§çš„ç”¨é€”å°±æ˜¯ä½œä¸ºè™šæ‹Ÿæœºç½‘å¡ã€‚ ","date":"2020-01-13","objectID":"/tun-tap/:2:4","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["linux"],"content":"å‚è€ƒæ–‡ç«  Linuxè™šæ‹Ÿç½‘ç»œè®¾å¤‡ä¹‹tun/tap äº‘è®¡ç®—åº•å±‚æŠ€æœ¯-è™šæ‹Ÿç½‘ç»œè®¾å¤‡(tun/tap,veth) ","date":"2020-01-13","objectID":"/tun-tap/:3:0","tags":["network","linux","tun","tap"],"title":"Linuxç½‘ç»œè™šæ‹ŸåŒ–æŠ€æœ¯ä¹‹tun/tap","uri":"/tun-tap/"},{"categories":["kubernetes"],"content":" Kubernetesï¼Œç®€ç§° k8sï¼ˆkï¼Œ8 ä¸ªå­—ç¬¦ï¼Œsâ€”â€”æ˜ç™½äº†ï¼Ÿï¼‰æˆ–è€… â€œkubeâ€ï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ Linux å®¹å™¨è‡ªåŠ¨åŒ–è¿ç»´å¹³å°ï¼Œå®ƒæ¶ˆé™¤äº†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºåœ¨éƒ¨ç½²ã€ä¼¸ç¼©æ—¶æ¶‰åŠåˆ°çš„è®¸å¤šæ‰‹åŠ¨æ“ä½œã€‚æ¢å¥è¯è¯´ï¼Œä½ å¯ä»¥å°†å¤šå°ä¸»æœºç»„åˆæˆé›†ç¾¤æ¥è¿è¡Œ Linux å®¹å™¨ï¼Œè€Œ Kubernetes å¯ä»¥å¸®åŠ©ä½ ç®€å•é«˜æ•ˆåœ°ç®¡ç†é‚£äº›é›†ç¾¤ã€‚æ„æˆè¿™äº›é›†ç¾¤çš„ä¸»æœºè¿˜å¯ä»¥è·¨è¶Šå…¬æœ‰äº‘ã€ç§æœ‰äº‘ä»¥åŠæ··åˆäº‘ã€‚ æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.3 LTS Vagrantç‰ˆæœ¬ï¼š2.2.6 VirtualBoxç‰ˆæœ¬ï¼š6.0.14 r133895 (Qt5.9.5) Kubernetesç‰ˆæœ¬ï¼š1.16.3 ","date":"2019-12-16","objectID":"/vagrant_kubernetes_cluster/:0:0","tags":["kubernetes","vagrant","virtualbox"],"title":"Vagrantæœ¬åœ°å¿«é€Ÿå¯åŠ¨Kubernetesé›†ç¾¤","uri":"/vagrant_kubernetes_cluster/"},{"categories":["kubernetes"],"content":"å®‰è£…Vagrant Vagrantæ˜¯ä¸€ä¸ªåŸºäºRubyçš„å·¥å…·ï¼Œç”¨äºåˆ›å»ºå’Œéƒ¨ç½²è™šæ‹ŸåŒ–å¼€å‘ç¯å¢ƒã€‚å®ƒä½¿ç”¨Oracleçš„å¼€æºVirtualBoxï¼ˆå…¶å®ä¹Ÿå¯ä»¥ç”¨åˆ«çš„ï¼‰è™šæ‹ŸåŒ–ç³»ç»Ÿï¼Œä½¿ç”¨Chefåˆ›å»ºè‡ªåŠ¨åŒ–è™šæ‹Ÿç¯å¢ƒã€‚ é¦–å…ˆåˆ°å®˜ç½‘ä¸‹è½½æœ€æ–°çš„Vagrantï¼Œç°åœ¨æœ€æ–°çš„ç‰ˆæœ¬æ˜¯2.2.6ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä¸‹è½½ï¼š wget https://releases.hashicorp.com/vagrant/2.2.6/vagrant_2.2.6_x86_64.deb éªŒè¯Vagrantå®‰è£…æˆåŠŸ $ vagrant --version Vagrant 2.2.6 ","date":"2019-12-16","objectID":"/vagrant_kubernetes_cluster/:1:0","tags":["kubernetes","vagrant","virtualbox"],"title":"Vagrantæœ¬åœ°å¿«é€Ÿå¯åŠ¨Kubernetesé›†ç¾¤","uri":"/vagrant_kubernetes_cluster/"},{"categories":["kubernetes"],"content":"å®‰è£…VirtualBox Vagrantæ˜¯åŸºäºè™šæ‹Ÿæœºï¼ˆVirtualBoxï¼ŒVMwareè¿™äº›ï¼‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…VirtualBoxã€‚åœ¨Vagrantå®˜ç½‘å¯ä»¥å®ƒé€‚é…çš„VirtualBoxç‰ˆæœ¬ Vagrant comes with support out of the box for VirtualBox, a free, cross-platform consumer virtualization product. The VirtualBox provider is compatible with VirtualBox versions 4.0.x, 4.1.x, 4.2.x, 4.3.x, 5.0.x, 5.1.x, 5.2.x, and 6.0.x. è¿™é‡Œæˆ‘ä¸‹è½½6.0ç‰ˆæœ¬çš„VirtualBoxï¼Œä¸‹è½½åœ°å€ wget https://download.virtualbox.org/virtualbox/6.0.14/virtualbox-6.0_6.0.14-133895~Ubuntu~bionic_amd64.deb æ³¨æ„ï¼šä¸è¦é€šè¿‡apt-getå®‰è£…VirtualBoxï¼Œå› ä¸º5.1.0ç‰ˆæœ¬å¼€å§‹ï¼ŒVirtualBoxå·²ç»ä¸éœ€è¦DKMSï¼Œaptå®˜æ–¹æºä¸­VirtualBoxæ¯”è¾ƒè€ï¼Œæ˜¯ä¼šå¸¦ä¸ŠDKMSçš„ï¼š DKMS isn't required by VirtualBox since 5.1.0. Which means that you downloaded VirtualBox from your Debian \"store\". That's a fork, not supported. You can either ask in their forums for help, or completely remove/uninstall/delete/purge their version and install the official version from the Downloads section of VirtualBox (https://www.virtualbox.org/wiki/Downloads). ","date":"2019-12-16","objectID":"/vagrant_kubernetes_cluster/:2:0","tags":["kubernetes","vagrant","virtualbox"],"title":"Vagrantæœ¬åœ°å¿«é€Ÿå¯åŠ¨Kubernetesé›†ç¾¤","uri":"/vagrant_kubernetes_cluster/"},{"categories":["kubernetes"],"content":"å¯åŠ¨è™šæ‹Ÿæœº Vagrantè·Ÿdockerç±»ä¼¼ï¼Œå¯ä»¥æä¾›ä¸€è‡´æ€§ç¯å¢ƒçš„ï¼Œå®ƒå¯ä»¥ç¼–å†™Vagrantfileï¼ˆç±»ä¼¼docker-compose.ymlï¼‰æ¥å®šä¹‰è™šæ‹Ÿæœºä¸­å®‰è£…ä»€ä¹ˆè½¯ä»¶ï¼Œç¯å¢ƒå’Œé…ç½®ï¼Œå®ƒä½¿ç”¨rubyè¯­æ³•ã€‚Vagrantä¹Ÿåšäº†boxæºï¼Œç±»ä¼¼docker imageã€‚ ä¸‹é¢ç»™å‡ºä¸€ä¸ªå°æ —å­æ„Ÿå—ä¸‹ï¼Œè¿™é‡Œä½¿ç”¨ubuntu/xenial64ï¼ˆUbuntu 16.06 64ä½ï¼‰è¿™ä¸ªbox # -*- mode: ruby -*- # vi: set ft=ruby : # All Vagrant configuration is done below. The \"2\" in Vagrant.configure # configures the configuration version (we support older styles for # backwards compatibility). Please don't change it unless you know what # you're doing. Vagrant.configure(\"2\") do |config| ##### DEFINE VM ##### # The most common configuration options are documented and commented below. # For a complete reference, please see the online documentation at # https://docs.vagrantup.com. # Every Vagrant development environment requires a box. You can search for # boxes at https://app.vagrantup.com/boxes/search. config.vm.box = \"ubuntu/xenial64\" config.vm.hostname = \"ubuntu-01\" config.vm.box_check_update = false # Create a private network, which allows host-only access to the machine # using a specific IP. config.vm.network \"private_network\", ip: \"192.168.10.50\" # Create a public network, which generally matched to bridged network. # Bridged networks make the machine appear as another physical device on # your network. # config.vm.network \"public_network\" # Share an additional folder to the guest VM. The first argument is # the path on the host to the actual folder. The second argument is # the path on the guest to mount the folder. And the optional third # argument is a set of non-required options. # config.vm.synced_folder \"../data\", \"/vagrant_data\" # Provider-specific configuration so you can fine-tune various # backing providers for Vagrant. These expose provider-specific options. # Example for VirtualBox: # # config.vm.provider \"virtualbox\" do |vb| # # Display the VirtualBox GUI when booting the machine # vb.gui = true # # # Customize the amount of memory on the VM: # vb.memory = \"1024\" # end # # View the documentation for the provider you are using for more # information on available options. config.vm.provider \"virtualbox\" do |v| v.name = \"ubuntu-for-fun\" v.customize [\"modifyvm\", :id, \"--memory\", \"2048\"] v.customize [\"modifyvm\", :id, \"--cpus\", \"2\"] end # Create a forwarded port mapping which allows access to a specific port # within the machine from a port on the host machine. In the example below, # accessing \"localhost:8080\" will access port 80 on the guest machine. # config.vm.network \"forwarded_port\", guest: 80, host: 8080 end æ›´å¤šè™šæ‹Ÿæœºçš„é…ç½®å¯ä»¥æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ åœ¨Vagrantfileå¯¹åº”çš„ç›®å½•ä¸‹ç»ˆç«¯é”®å…¥ï¼švagrant upï¼Œç„¶åVagrantä¼šå¸®æˆ‘ä»¬ä¸‹è½½ubuntu/xenial64è¿™ä¸ªboxï¼Œä¸è¿‡åœ¨ä¸­å›½ä¸‹è½½é€Ÿåº¦éå¸¸æ…¢ï¼Œåœ¨è¿è¡Œvagrant upæ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªboxçš„ä¸‹è½½urlï¼Œä½ å¯ä»¥ç”¨è¿…é›·è¿™äº›å·¥å…·ç›´æ¥ä¸‹è½½ï¼Œç„¶ååœ¨æœ¬åœ°æ‰‹åŠ¨æ·»åŠ box $ vagrant up Bringing machine 'default' up with 'virtualbox' provider... ==\u003e default: Box 'ubuntu/xenial64' could not be found. Attempting to find and install... default: Box Provider: virtualbox default: Box Version: \u003e= 0 ==\u003e default: Loading metadata for box 'ubuntu/xenial64' default: URL: https://vagrantcloud.com/ubuntu/xenial64 ==\u003e default: Adding box 'ubuntu/xenial64' (v20191217.0.0) for provider: virtualbox default: Downloading: https://vagrantcloud.com/ubuntu/boxes/xenial64/versions/20191217.0.0/providers/virtualbox.box ==\u003e default: Box download is resuming from prior download progress default: Download redirected to host: cloud-images.ubuntu.com ......... $ cd ~/box-add $ ls metadata.json virtualbox.box $ vagrant box add metadata.json ==\u003e box: Loading metadata for box 'metadata.json' box: URL: file:///home/lucy/vm-add/metadata.json ==\u003e box: Adding box 'ubuntu/xenial64' (v20191217.0.0) for provider: virtualbox box: Downloading: ./virtualbox.box ==\u003e box: Successfully added box 'ubuntu/xenial64' (v20191217.0.0) for 'virtualbox'! $ vagrant box list ubuntu/xenial64 (virtualbox, 20191217.0.0) ä¸‹è½½boxçš„URLæ˜¯https://vagrantcloud.com/ubuntu/boxes/xenial64/versions/20191217.0.0/providers/virtualbox.boxï¼Œå¯ä»¥çœ‹åˆ°ä¸‹è½½çš„ç‰ˆæœ¬æ˜¯20191217.0.0ï¼Œå¦å¤–æ³¨æ„ä¸€ä¸‹è¿™é‡Œæ·»åŠ boxçš„æ˜¯ä½¿ç”¨ä¸€ä¸ªmetadata.jsonæ–‡ä»¶ï¼Œä½¿ç”¨è¿™æ ·çš„æ–¹å¼å¯ä»¥å®šä¹‰boxç‰ˆæœ¬å·ï¼Œå®ƒçš„å†…å®¹æ˜¯ï¼š { \"name\": \"ubuntu/xenial64\", \"versions\": [{ \"version\": \"20191217.0.0\"","date":"2019-12-16","objectID":"/vagrant_kubernetes_cluster/:3:0","tags":["kubernetes","vagrant","virtualbox"],"title":"Vagrantæœ¬åœ°å¿«é€Ÿå¯åŠ¨Kubernetesé›†ç¾¤","uri":"/vagrant_kubernetes_cluster/"},{"categories":["kubernetes"],"content":"å¯åŠ¨Kubernetesé›†ç¾¤ è¿™é‡Œæˆ‘ç¼–å†™äº†ä¸€ä¸ªVagrantfileï¼Œä¸€é”®å¯åŠ¨é›†ç¾¤ï¼š # -*- mode: ruby -*- # vi: set ft=ruby : k8sVersion = '1.16.3' servers = [ { :name =\u003e \"k8s-head\", :type =\u003e \"master\", :box =\u003e \"ubuntu/xenial64\", :box_version =\u003e \"20191217.0.0\", :eth1 =\u003e \"192.168.205.10\", :mem =\u003e \"2048\", :cpu =\u003e \"2\" }, { :name =\u003e \"k8s-node-1\", :type =\u003e \"node\", :box =\u003e \"ubuntu/xenial64\", :box_version =\u003e \"20191217.0.0\", :eth1 =\u003e \"192.168.205.11\", :mem =\u003e \"2048\", :cpu =\u003e \"2\" }, { :name =\u003e \"k8s-node-2\", :type =\u003e \"node\", :box =\u003e \"ubuntu/xenial64\", :box_version =\u003e \"20191217.0.0\", :eth1 =\u003e \"192.168.205.12\", :mem =\u003e \"2048\", :cpu =\u003e \"2\" } ] # This script to install k8s using kubeadm will get executed after a box is provisioned $configureBox = \u003c\u003c-SCRIPT cp /etc/apt/sources.list /etc/apt/sources.list.bak # use Aliyun apt source cat \u003e /etc/apt/sources.list\u003c\u003cEOF # é»˜è®¤æ³¨é‡Šäº†æºç é•œåƒä»¥æé«˜ apt update é€Ÿåº¦ï¼Œå¦‚æœ‰éœ€è¦å¯è‡ªè¡Œå–æ¶ˆæ³¨é‡Š deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ xenial-security main restricted universe multiverse EOF export DEBIAN_FRONTEND=noninteractive # install docker v17.03 # reason for not using docker provision is that it always installs latest version of the docker, but kubeadm requires 17.03 or older apt-get update # step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…· apt-get install -y apt-transport-https ca-certificates curl software-properties-common # step 2: å®‰è£…GPGè¯ä¹¦ curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - add-apt-repository \"deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/$(. /etc/os-release; echo \"$ID\") $(lsb_release -cs) stable\" apt-get update \u0026\u0026 apt-get install -y docker-ce=$(apt-cache madison docker-ce | grep 17.03 | head -1 | awk '{print $3}') # run docker commands as vagrant user (sudo not required) usermod -aG docker vagrant # ä¿®æ”¹dockeré…ç½® sudo bash -c 'cat \u003e /etc/docker/daemon.json \u003c\u003cEOF { \"exec-opts\": [\"native.cgroupdriver=systemd\"], \"log-driver\": \"json-file\", \"log-opts\": { \"max-size\": \"100m\" }, \"storage-driver\": \"overlay2\" } EOF' sudo systemctl daemon-reload sudo systemctl restart docker # install kubeadm apt-get install -y apt-transport-https curl curl -s https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | sudo apt-key add - # aliyun GPG cat \u003c\u003cEOF \u003e/etc/apt/sources.list.d/kubernetes.list deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main EOF apt-get update apt-get install -y kubelet=#{k8sVersion}-00 kubeadm=#{k8sVersion}-00 kubectl=#{k8sVersion}-00 apt-mark hold kubelet kubeadm kubectl # kubelet requires swap off swapoff -a # keep swap off after reboot sudo sed -i '/ swap / s/^\\(.*\\)$/#\\1/g' /etc/fstab # ip of this box IP_ADDR=`ifconfig enp0s8 | grep Mask | awk '{print $2}'| cut -f2 -d:` # set node-ip sudo sh -c 'echo KUBELET_EXTRA_ARGS= \u003e\u003e /etc/default/kubelet' sudo sed -i \"/^[^#]*KUBELET_EXTRA_ARGS=/c\\KUBELET_EXTRA_ARGS=--node-ip=$IP_ADDR\" /etc/default/kubelet sudo systemctl restart kubelet SCRIPT $configureMaster = \u003c\u003c-SCRIPT export DEBIAN_FRONTEND=noninteractive echo \"This is master\" # ip of this box IP_ADDR=`ifconfig enp0s8 | grep Mask | awk '{print $2}'| cut -f2 -d:` # install k8s master HOST_NAME=$(hostname -s) kubeadm init --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v#{k8sVersion} \\ --apiserver-advertise-address=$IP_ADDR --apiserver-cert-extra-sans=$IP_ADDR --node-name $HOST_NAME -","date":"2019-12-16","objectID":"/vagrant_kubernetes_cluster/:4:0","tags":["kubernetes","vagrant","virtualbox"],"title":"Vagrantæœ¬åœ°å¿«é€Ÿå¯åŠ¨Kubernetesé›†ç¾¤","uri":"/vagrant_kubernetes_cluster/"},{"categories":["kubernetes"],"content":"å®‰è£…å®˜æ–¹Dashboard Dashboardæ˜¯Kubernetesçš„ä¸€ä¸ªæ’ä»¶ï¼Œä»£ç å•ç‹¬æ”¾åœ¨Githubçš„ä¸€ä¸ªä»“åº“é‡Œã€‚ æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ï¼Œæ­¥éª¤ä¹Ÿè›®ç®€å•çš„ï¼Œé¦–å…ˆæ‰§è¡Œå‘½ä»¤ï¼š $ kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml æŸ¥çœ‹ä¸€ä¸‹Dashboardçš„æœåŠ¡ï¼š $ kubectl get pod,deploy,svc -n kubernetes-dashboard NAME READY STATUS RESTARTS AGE pod/dashboard-metrics-scraper-6c554969c6-jqhjx 1/1 Running 0 5h5m pod/kubernetes-dashboard-56c5f95c6b-jrj58 1/1 Running 5 5h5m NAME READY UP-TO-DATE AVAILABLE AGE deployment.extensions/dashboard-metrics-scraper 1/1 1 1 5h5m deployment.extensions/kubernetes-dashboard 1/1 1 1 5h5m NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE service/dashboard-metrics-scraper ClusterIP 10.106.117.224 \u003cnone\u003e 8000/TCP 5h5m service/kubernetes-dashboard ClusterIP 10.98.23.78 \u003cnone\u003e 443/TCP 5h5m # æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®˜æ–¹çš„dashboardå¸®æˆ‘ä»¬å¯åŠ¨äº†web-uiï¼Œå¹¶ä¸”å¸®æˆ‘ä»¬å¯åŠ¨äº†ä¸€ä¸ªMetricæœåŠ¡ # ä½†æ˜¯dashboardé»˜è®¤ä½¿ç”¨çš„httpsçš„443ç«¯å£ # æµ‹è¯•ä¸‹Dashboardæ˜¯å¦æ­£å¸¸ $ curl https://10.98.23.78:443 -k -I HTTP/1.1 200 OK Accept-Ranges: bytes Cache-Control: no-store Content-Length: 1262 Content-Type: text/html; charset=utf-8 Last-Modified: Fri, 06 Dec 2019 15:14:02 GMT Date: Tue, 31 Dec 2019 06:35:55 GMT ","date":"2019-12-16","objectID":"/vagrant_kubernetes_cluster/:5:0","tags":["kubernetes","vagrant","virtualbox"],"title":"Vagrantæœ¬åœ°å¿«é€Ÿå¯åŠ¨Kubernetesé›†ç¾¤","uri":"/vagrant_kubernetes_cluster/"},{"categories":["kubernetes"],"content":"è®¿é—®Dashboard è®¿é—®Dashboardæœ‰å¥½å‡ ç§æ–¹å¼ å°†kubernetes-dashboard Serviceæš´éœ² NodePortï¼Œä½¿ç”¨ http://NodeIP:nodePort åœ°å€è®¿é—® dashboard ä½¿ç”¨Ingressä¹‹ç±»çš„å…¥å£æœåŠ¡è¿›è¡Œä»£ç†è®¿é—® é€šè¿‡ API server è®¿é—® dashboardï¼ˆhttps 6443ç«¯å£å’Œhttp 8080ç«¯å£æ–¹å¼ï¼‰ é€šè¿‡ kubectl proxy è®¿é—® dashboard kubectl proxy é¦–å…ˆè¿™é‡Œæˆ‘ä»¬é€šè¿‡kubectl proxyï¼Œåœ¨k8s-headèŠ‚ç‚¹æ‰§è¡Œï¼š $ kubectl proxy --address='0.0.0.0' --accept-hosts='^*$' åœ¨è®¿é—®ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªUserï¼ˆä¸€ä¸ªServiceAccountï¼Œk8så†…æ¦‚å¿µï¼‰ï¼Œåˆ›å»ºdashboard-adminuser.yamlæ–‡ä»¶ï¼Œå†™å…¥ apiVersion: v1 kind: ServiceAccount metadata: name: admin-user namespace: kubernetes-dashboard --- apiVersion: rbac.authorization.k8s.io/v1 kind: ClusterRoleBinding metadata: name: admin-user roleRef: apiGroup: rbac.authorization.k8s.io kind: ClusterRole name: cluster-admin subjects: - kind: ServiceAccount name: admin-user namespace: kubernetes-dashboard æ‰§è¡Œkubectl apply -f dashboard-adminuser.yamlã€‚ æŸ¥çœ‹ç”¨æˆ·tokenï¼ˆä¹‹ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ï¼‰ $ kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk '{print $1}') Name: admin-user-token-mxmtr Namespace: kubernetes-dashboard Labels: \u003cnone\u003e Annotations: kubernetes.io/service-account.name: admin-user kubernetes.io/service-account.uid: 54ddc041-f3af-41fa-a824-6a3e29f0ffa3 Type: kubernetes.io/service-account-token Data ==== ca.crt: 1025 bytes namespace: 20 bytes token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLW14bXRyIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI1NGRkYzA0MS1mM2FmLTQxZmEtYTgyNC02YTNlMjlmMGZmYTMiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZXJuZXRlcy1kYXNoYm9hcmQ6YWRtaW4tdXNlciJ9.osyqbUwS4pLDEhZ0iL0aAu2f5me82bGTEfXEW8ycS5-JRar4iYcWkqhJZ9FhZV47P0WKLT9UWiLcDw1rVPZbMSHrRnFZcRHmLO35tVBaijjvgsgm2X5856G-HS1VNMgQBSZXiQXr1Lt3Dj9JHHksbiLGg-3wRy7HqD-I8JcR1pHZ_ViOqQ1j6WIbvhfEE3FpTuuSPAcjwVNutXAfur6oJktjYAcwMjWTQ4-yMQ2NRSWM7AcJtjp_7p3WwnHmO6fH6LtrGQzmXwHh5ICmei2LrAE2cxwN251aMVnrPGt00Ff4ij2-yLyI4VZOgAsNuPegctm-GuCOTGNX9Ew-o1si_Q ä¸ºäº†åœ¨å®¿ä¸»æœºä¸Šèƒ½è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦ç”¨VirutalBoxç®¡ç†ç•Œé¢æ·»åŠ ä¸€ä¸ªç«¯å£æ˜ å°„ï¼š å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—®Dashboardäº†ï¼Œæµè§ˆå†…è¾“å…¥http://localhost:31694/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/.ï¼Œå¯ä»¥çœ‹åˆ° NodePort è¿™ä¸ªè¿‡ç¨‹æ¯”kubectl proxyç®€å•ï¼Œå†å®‰è£…Dashboardä¹‹å‰ï¼ŒæŠŠServiceç±»å‹æ”¹æˆNodePortå³å¯ï¼š $ wget https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta8/aio/deploy/recommended.yaml #ä¸‹è½½yaml $ vim recommended.yaml æ‰¾åˆ°Serviceéƒ¨åˆ†ï¼Œæ”¹æˆNodePort kind: Service apiVersion: v1 metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kubernetes-dashboard spec: type: NodePort # è¿™ä¸ªæ˜¯æ–°å¢éƒ¨åˆ† ports: - port: 443 targetPort: 8443 selector: k8s-app: kubernetes-dashboard ``` æŸ¥çœ‹ï¼ŒServiceçš„éšæœºç«¯å£ï¼š ``` $ kubectl get pods,svc --all-namespaces NAMESPACE NAME READY STATUS RESTARTS AGE kube-system pod/calico-node-ffn9k 2/2 Running 10 32d kube-system pod/calico-node-fz8v6 2/2 Running 12 32d kube-system pod/calico-node-gvjft 2/2 Running 8 32d kube-system pod/coredns-94d74667-8jp5k 1/1 Running 4 32d kube-system pod/coredns-94d74667-tlph7 1/1 Running 4 32d kube-system pod/etcd-k8s-head 1/1 Running 4 32d kube-system pod/kube-apiserver-k8s-head 1/1 Running 4 32d kube-system pod/kube-controller-manager-k8s-head 1/1 Running 4 32d kube-system pod/kube-proxy-4rsp4 1/1 Running 5 32d kube-system pod/kube-proxy-dccdc 1/1 Running 5 32d kube-system pod/kube-proxy-x82tl 1/1 Running 4 32d kube-system pod/kube-scheduler-k8s-head 1/1 Running 4 32d kubernetes-dashboard pod/dashboard-metrics-scraper-6c554969c6-wmwpt 1/1 Running 0 18m kubernetes-dashboard pod/kubernetes-dashboard-56c5f95c6b-s66g8 1/1 Running 0 18m NAMESPACE NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE default service/kubernetes ClusterIP 10.96.0.1 \u003cnone\u003e 443/TCP 32d kube-system service/calico-typha ClusterIP 10.104.182.223 \u003cnone\u003e 5473/TCP 32d kube-system service/kube-dns ClusterIP 10.96.0.10 \u003cnone\u003e 53/UDP,53/T","date":"2019-12-16","objectID":"/vagrant_kubernetes_cluster/:5:1","tags":["kubernetes","vagrant","virtualbox"],"title":"Vagrantæœ¬åœ°å¿«é€Ÿå¯åŠ¨Kubernetesé›†ç¾¤","uri":"/vagrant_kubernetes_cluster/"},{"categories":["ç®—æ³•",""],"content":" è§£å†³æœ€å°ç”Ÿæˆæ ‘ï¼ˆMinimum spanning treeï¼‰é—®é¢˜çš„ç®—æ³•ï¼Œä¹¦ä¸Šä»‹ç»äº†ä¸¤ä¸ªï¼šPrimeç®—æ³•å’ŒKruskalç®—æ³•ã€‚ ","date":"2019-12-10","objectID":"/min_spanning_tree/:0:0","tags":["å›¾","æœ€å°ç”Ÿæˆæ ‘","æ•°æ®ç»“æ„"],"title":"æœ€å°ç”Ÿæˆæ ‘å›é¡¾","uri":"/min_spanning_tree/"},{"categories":["ç®—æ³•",""],"content":"Primç®—æ³• #include \u003cstdio.h\u003e #include \"graph.h\" extern void DispMat1(MGraph); void Prim(MGraph g, int v) { int lowcost[MAXV], min, n = g.n; int closest[MAXV], i, j, k; for (i = 0; i \u003c n; i++) { lowcost[i] = g.edges[v][i]; closest[i] = v; } for (i = 1; i \u003c n; i++) // æ‰¾å‡ºn - 1ä¸ªé¡¶ç‚¹ { min = INF; for (j = 0; j \u003c n; j++) { if (lowcost[j] != 0 \u0026\u0026 lowcost[j] \u003c min) { min = lowcost[j]; k = j; } } printf(\" è¾¹ï¼ˆ%dï¼Œ %dï¼‰æƒä¸ºï¼š%d\\n\", closest[k], k, min); lowcost[k] = 0; // æ ‡è®°kå·²ç»åŠ å…¥U for (j = 0; j \u003c n; j++) { if (g.edges[k][j] != 0 \u0026\u0026 g.edges[k][j] \u003c lowcost[j]) { lowcost[j] = g.edges[k][j]; lowcost[j] = k; } } } } ","date":"2019-12-10","objectID":"/min_spanning_tree/:1:0","tags":["å›¾","æœ€å°ç”Ÿæˆæ ‘","æ•°æ®ç»“æ„"],"title":"æœ€å°ç”Ÿæˆæ ‘å›é¡¾","uri":"/min_spanning_tree/"},{"categories":["ç®—æ³•",""],"content":"Kruskalç®—æ³• å®ç°å…‹é²æ–¯å¡å°”ç®—æ³•çš„å…³é”®æ˜¯åˆ¤æ–­é€‰å–çš„è¾¹æ˜¯å¦ä¸ç”Ÿæˆæ ‘ä¸­å·²ä¿ç•™çš„è¾¹å½¢æˆå›è·¯ï¼Œè¿™å¯ä»¥é€šè¿‡åˆ¤æ–­è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹æ‰€åœ¨çš„è¿é€šåˆ†é‡æ¥è§£å†³ï¼ˆç»™é¡¶ç‚¹æ‰€åœ¨è¿é€šåˆ†é‡ç¼–å·ï¼‰ã€‚ typedef struct { int u; // è¾¹çš„èµ·å§‹é¡¶ç‚¹ int v; // è¾¹çš„ç»ˆæ­¢é¡¶ç‚¹ int w; // è¾¹çš„æƒå€¼ } Edge; void Kruskal(MGraph g, int v) { int i, j, u1, v1, sn1, sn2, k; int vset[MAXV]; // å­˜æ”¾æ‰€æœ‰è¾¹ Edge E[MaxSize]; // eæ•°ç»„çš„ä¸‹æ ‡ä»0å¼€å§‹è®¡ k = 0; for (i = 0; i \u003c g.n; i++) // ç”±gäº§ç”Ÿçš„è¾¹é›†E { for (j = 0; j \u003c g.n; j++) { if (g.edges[i][j] != 0 \u0026\u0026 g.edges[i][j] != INF) { E[k].u = i; E[k].v = i; E[k].w = g.edges[i][j]; k++; } } } InsertSort(E, g.e); for (i = 0; i \u003c g.n; i++) { vset[i] = i; } k = 1; // kè¡¨ç¤ºå½“å‰æ„é€ ç”Ÿæˆæ ‘çš„ç¬¬å‡ æ¡è¾¹ï¼Œåˆå€¼ä¸º1 j = 0; // Eä¸­è¾¹çš„ä¸‹æ ‡ï¼Œåˆå€¼ä¸º0 while (k \u003c g.n) { u1 = E[j].u; v1 = E[j].v; sn1 = vset[u1]; sn2 = vset[v1]; if (sn1 != sn2) { printf(\" (%d, %d): %d\\n\", u1, v1, E[j].w); k++; // ç”Ÿæˆè¾¹æ•°å¢1 for (i = 0; i \u003c g.n; i++) // ä¸¤ä¸ªé›†åˆç»Ÿä¸€ç¼–å· { if (vset[i] == sn2) // é›†åˆç¼–å·ä¸ºsn2çš„æ”¹ä¸ºsn1 { if (vset[i] == sn2) { vset[i] = sn1; } } } } j++; } } ç®—æ³•å‚è€ƒï¼š ã€Šæ•°æ®ç»“æ„æ•™ç¨‹ï¼ˆç¬¬4ç‰ˆï¼‰ã€‹ï¼ˆææ˜¥è‘†ï¼‰ ","date":"2019-12-10","objectID":"/min_spanning_tree/:2:0","tags":["å›¾","æœ€å°ç”Ÿæˆæ ‘","æ•°æ®ç»“æ„"],"title":"æœ€å°ç”Ÿæˆæ ‘å›é¡¾","uri":"/min_spanning_tree/"},{"categories":["Docker"],"content":" æœ¬æ–‡ç¯å¢ƒï¼š OSï¼šUbuntu 18.04.3 LTS å†…æ ¸ç‰ˆæœ¬ï¼š 5.0.0-36-generic ","date":"2019-11-28","objectID":"/docker-linux-namespace-intro/:0:0","tags":["Docker","Namespace","Cgroup"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Linux Namespace ç®€ä»‹","uri":"/docker-linux-namespace-intro/"},{"categories":["Docker"],"content":"Linux Namespaces Dockerçš„æ‰€ç”¨çš„ä¸¤ä¸ªå…³é”®æŠ€æœ¯ï¼Œä¸€ä¸ªæ˜¯Namespacesï¼Œä¸€ä¸ªæ˜¯Cgroupsã€‚å®ƒä¿©éƒ½ä¸æ˜¯æ–°æŠ€æœ¯ï¼ŒLinuxå†…æ ¸å¾ˆæ—©å°±æ”¯æŒï¼Œä½†æ˜¯DockeræŠŠå®ƒä»¬æœ‰æœºåœ°ç»“åˆèµ·æ¥ï¼ŒåŠ ä¸Šè‡ªå·±åˆ›æ–°ï¼Œä½¿å¾—ç°åœ¨å®¹å™¨æŠ€æœ¯éå¸¸æµè¡Œã€‚ Linux Namespaceså…¶å®æ˜¯åšåˆ°äº†è¿›ç¨‹ä¹‹é—´å…¨å±€èµ„æºçš„éš”ç¦»ï¼Œè­¬å¦‚ï¼ŒUTS Namespaceéš”ç¦»äº†Hostnameç©ºé—´ã€‚è¿™æ„å‘³ç€åœ¨æ–°çš„UTS Namespaceä¸­çš„è¿›ç¨‹ï¼Œå¯ä»¥æ‹¥æœ‰ä¸åŒäºå®¿ä¸»æœºçš„ä¸»æœºåã€‚ ç›®å‰Linuxå†…æ ¸ä¸»è¦å®ç°äº†ä»¥ä¸‹å‡ ç§ä¸åŒçš„èµ„æºNamespaceï¼š åç§° å®å®šä¹‰ éš”ç¦»çš„å†…å®¹ IPC CLONE_NEWIPC System V IPC, POSIX message queues (since Linux 2.6.19) Network CLONE_NEWNET network device interfaces, IPv4 and IPv6 protocol stacks, IP routing tables, firewall rules, the /proc/net and /sys/class/net directory trees, sockets, etc (since Linux 2.6.24) Mount CLONE_NEWNS Mount points (since Linux 2.4.19) PID CLONE_NEWPID Process IDs (since Linux 2.6.24) User CLONE_NEWUSER User and group IDs (started in Linux 2.6.23 and completed in Linux 3.8) UTS CLONE_NEWUTS Hostname and NIS domain name (since Linux 2.6.19) Cgroup CLONE_NEWCGROUP Cgroup root directory (since Linux 4.6) è¦æ³¨æ„ä¸€ç‚¹çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„ç³»ç»Ÿèµ„æºéƒ½èƒ½éš”ç¦»ï¼Œæ—¶é—´å°±æ˜¯ä¸ªä¾‹å¤–ï¼Œæ²¡æœ‰å¯¹åº”çš„Namespaceï¼Œå› æ­¤åŒä¸€å°Linuxå¯åŠ¨çš„å®¹å™¨æ—¶é—´éƒ½æ˜¯ç›¸åŒçš„ã€‚ ","date":"2019-11-28","objectID":"/docker-linux-namespace-intro/:1:0","tags":["Docker","Namespace","Cgroup"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Linux Namespace ç®€ä»‹","uri":"/docker-linux-namespace-intro/"},{"categories":["Docker"],"content":"å°è¯•ä¸€ä¸‹Namespace lucy@lucy-computer:~$ unshare -h ç”¨æ³•ï¼š unshare [é€‰é¡¹] [\u003cç¨‹åº\u003e [\u003cå‚æ•°\u003e...]] ä»¥æŸäº›æœªä¸çˆ¶(è¿›ç¨‹)å…±äº«çš„åå­—ç©ºé—´è¿è¡ŒæŸä¸ªç¨‹åºã€‚ é€‰é¡¹ï¼š -m, --mount[=\u003cæ–‡ä»¶\u003e] å–æ¶ˆå…±äº« mounts åå­—ç©ºé—´ -u, --uts[=\u003cæ–‡ä»¶\u003e] å–æ¶ˆå…±äº« UTS åå­—ç©ºé—´(ä¸»æœºåç­‰) -i, --ipc[=\u003cæ–‡ä»¶\u003e] å–æ¶ˆå…±äº« System V IPC åå­—ç©ºé—´ -n, --net[=\u003cfile\u003e] å–æ¶ˆå…±äº«ç½‘ç»œåå­—ç©ºé—´ -p, --pid[=\u003cæ–‡ä»¶\u003e] å–æ¶ˆå…±äº« pid åå­—ç©ºé—´ -U, --user[=\u003cæ–‡ä»¶\u003e] å–æ¶ˆå…±äº«ç”¨æˆ·åå­—ç©ºé—´ -C, --cgroup[=\u003cæ–‡ä»¶\u003e] å–æ¶ˆå…±äº« cgroup åå­—ç©ºé—´ -f, --fork åœ¨å¯åŠ¨\u003cç¨‹åº\u003eå‰ fork --mount-proc[=\u003cç›®å½•\u003e] å…ˆæŒ‚è½½ proc æ–‡ä»¶ç³»ç»Ÿ(è¿å¸¦æ‰“å¼€ --mount) -r, --map-root-user å°†å½“å‰ç”¨æˆ·æ˜ å°„ä¸º root (è¿å¸¦æ‰“å¼€ --user) --propagation slave|shared|private|unchanged ä¿®æ”¹ mount åå­—ç©ºé—´ä¸­çš„ mount ä¼ æ’­ -s, --setgroups allow|deny æ§åˆ¶ç”¨æˆ·åå­—ç©ºé—´ä¸­çš„ setgroups ç³»ç»Ÿè°ƒç”¨ -h, --help display this help -V, --version display version unshareå‘½ä»¤å¯ä»¥è®©ä½ åœ¨æ–°çš„åç§°ç©ºé—´é›†ä¸­å¯åŠ¨ä¸€ä¸ªæ–°çš„ç¨‹åºï¼ˆunsharedæœ¬èº«çš„å«ä¹‰å°±æ˜¯ä¸å’Œçˆ¶è¿›ç¨‹å…±äº«ï¼‰ã€‚ ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨äº†UTS namespaceï¼Œå¯ä»¥çœ‹åˆ°åœ¨æ–°çš„/bin/shè¿›ç¨‹ä¸­ä¿®æ”¹hostnameï¼Œå¹¶æ²¡æœ‰å½±å“å®¿ä¸»æœºï¼š $ sudo su # become root user $ hostname # check current hostname lucy-computer $ unshare -u /bin/sh # create a shell in new UTS namespace $ hostname my-new-hostname # set hostname $ hostname # confirm new hostname my-new-hostname $ exit # exit new UTS namespace $ hostname # confirm original hostname unchanged lucy-computer ","date":"2019-11-28","objectID":"/docker-linux-namespace-intro/:1:1","tags":["Docker","Namespace","Cgroup"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Linux Namespace ç®€ä»‹","uri":"/docker-linux-namespace-intro/"},{"categories":["Docker"],"content":"ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨ unshareå‘½ä»¤å¾ˆæ£’ï¼Œä½†æ˜¯å½“æˆ‘ä»¬æƒ³è¦å¯¹ç¨‹åºä¸­çš„å‘½åç©ºé—´è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶æ—¶ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ Linux å†…æ ¸æä¾›çš„åŠŸèƒ½éƒ½ä¼šæä¾›ç³»ç»Ÿè°ƒç”¨æ¥å£ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ï¼ŒNamespaceä¹Ÿä¸ä¾‹å¤–ã€‚å’ŒNamespaceç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ä¸»è¦æœ‰ä¸‰ä¸ªï¼š clone setns unshare æ³¨æ„ï¼šè¿™äº›ç³»ç»Ÿè°ƒç”¨éƒ½æ˜¯ linux å†…æ ¸å®ç°çš„ï¼Œä¸èƒ½ç›´æ¥é€‚ç”¨äºå…¶ä»–æ“ä½œç³»ç»Ÿã€‚ æŸ¥çœ‹ä¸€ä¸‹å®ƒä»¬å¯¹åº”çš„Cè¯­è¨€å‡½æ•°åŸå‹ï¼š cloneï¼šåˆ›å»ºæ–°è¿›ç¨‹å¹¶è®¾ç½®å®ƒçš„Namespace cloneç±»ä¼¼äºforkç³»ç»Ÿè°ƒç”¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œä¸åŒçš„æ˜¯ä½ å¯ä»¥æŒ‡å®šè¦å­è¿›ç¨‹è¦æ‰§è¡Œçš„å‡½æ•°ä»¥åŠé€šè¿‡å‚æ•°æ§åˆ¶å­è¿›ç¨‹çš„è¿è¡Œç¯å¢ƒã€‚ å®é™…ä¸Šï¼Œclone() æ˜¯åœ¨ C è¯­è¨€åº“ä¸­å®šä¹‰çš„ä¸€ä¸ªå°è£…(wrapper)å‡½æ•°ï¼Œå®ƒè´Ÿè´£å»ºç«‹æ–°è¿›ç¨‹çš„å †æ ˆå¹¶ä¸”è°ƒç”¨å¯¹ç¼–ç¨‹è€…éšè—çš„ clone() ç³»ç»Ÿè°ƒç”¨ã€‚Clone() å…¶å®æ˜¯ linux ç³»ç»Ÿè°ƒç”¨ fork() çš„ä¸€ç§æ›´é€šç”¨çš„å®ç°æ–¹å¼ï¼Œå®ƒå¯ä»¥é€šè¿‡ flags æ¥æ§åˆ¶ä½¿ç”¨å¤šå°‘åŠŸèƒ½ã€‚ #define _GNU_SOURCE #include \u003csched.h\u003e int clone(int (*fn)(void *), void *child_stack, int flags, void *arg); fnï¼šæŒ‡å®šä¸€ä¸ªç”±æ–°è¿›ç¨‹æ‰§è¡Œçš„å‡½æ•°ã€‚å½“è¿™ä¸ªå‡½æ•°è¿”å›æ—¶ï¼Œå­è¿›ç¨‹ç»ˆæ­¢ã€‚è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå­è¿›ç¨‹çš„é€€å‡ºä»£ç ã€‚ child_stackï¼šä¼ å…¥å­è¿›ç¨‹ä½¿ç”¨çš„æ ˆç©ºé—´ï¼Œä¹Ÿå°±æ˜¯æŠŠç”¨æˆ·æ€å †æ ˆæŒ‡é’ˆèµ‹ç»™å­è¿›ç¨‹çš„ esp å¯„å­˜å™¨ã€‚è°ƒç”¨è¿›ç¨‹(æŒ‡è°ƒç”¨ clone() çš„è¿›ç¨‹)åº”è¯¥æ€»æ˜¯ä¸ºå­è¿›ç¨‹åˆ†é…æ–°çš„å †æ ˆã€‚ flagsï¼šè¡¨ç¤ºä½¿ç”¨å“ªäº› CLONE_ å¼€å¤´çš„æ ‡å¿—ä½ï¼Œä¸ namespace ç›¸å…³çš„æœ‰CLONE_NEWIPCã€CLONE_NEWNETã€CLONE_NEWNSã€CLONE_NEWPIDã€CLONE_NEWUSERã€CLONE_NEWUTS å’Œ CLONE_NEWCGROUPï¼Œå¦‚æœè¦åŒæ—¶éš”ç¦»å¤šä¸ª namespaceï¼Œå¯ä»¥ä½¿ç”¨ | (æŒ‰ä½æˆ–)ç»„åˆè¿™äº›å‚æ•°ã€‚ argï¼šæŒ‡å‘ä¼ é€’ç»™ fn() å‡½æ•°çš„å‚æ•°ã€‚ setnsï¼šè®©è¿›ç¨‹åŠ å…¥å·²ç»å­˜åœ¨Namespace setns èƒ½å¤ŸæŠŠæŸä¸ªè¿›ç¨‹åŠ å…¥åˆ°ç»™å®šçš„ namespaceï¼Œå®ƒçš„å®šä¹‰æ˜¯è¿™æ ·çš„ï¼š #define _GNU_SOURCE #include \u003csched.h\u003e int setns(int fd, int nstype); å’Œclone()å‡½æ•°ä¸€æ ·ï¼ŒC è¯­è¨€åº“ä¸­çš„setns()å‡½æ•°ä¹Ÿæ˜¯å¯¹setnsç³»ç»Ÿè°ƒç”¨çš„å°è£…ã€‚ fdï¼šè¡¨ç¤ºè¦åŠ å…¥ namespace çš„æ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘ /proc/[pid]/ns ç›®å½•ä¸­æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¯ä»¥é€šè¿‡ç›´æ¥æ‰“å¼€è¯¥ç›®å½•ä¸‹çš„é“¾æ¥æ–‡ä»¶æˆ–è€…æ‰“å¼€ä¸€ä¸ªæŒ‚è½½äº†è¯¥ç›®å½•ä¸‹é“¾æ¥æ–‡ä»¶çš„æ–‡ä»¶å¾—åˆ°ã€‚ nstypeï¼šå‚æ•° nstype è®©è°ƒç”¨è€…å¯ä»¥æ£€æŸ¥ fd æŒ‡å‘çš„ namespace ç±»å‹æ˜¯å¦ç¬¦åˆå®é™…è¦æ±‚ã€‚è‹¥æŠŠè¯¥å‚æ•°è®¾ç½®ä¸º 0 è¡¨ç¤ºä¸æ£€æŸ¥ã€‚ unshareï¼šè®©è¿›ç¨‹åŠ å…¥æ–°çš„Namespace #define _GNU_SOURCE #include \u003csched.h\u003e int unshare(int flags); unshare()å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œåªæœ‰ä¸€ä¸ªå‚æ•°flagsï¼Œå®ƒçš„å«ä¹‰å’Œclone()çš„flagsç›¸åŒã€‚unshareå’Œ setns çš„åŒºåˆ«æ˜¯ï¼Œsetns åªèƒ½è®©è¿›ç¨‹åŠ å…¥åˆ°å·²ç»å­˜åœ¨çš„namespaceä¸­ï¼Œè€Œunshareåˆ™è®©è¿›ç¨‹ç¦»å¼€å½“å‰çš„namespaceï¼ŒåŠ å…¥åˆ°æ–°å»ºçš„namespaceä¸­ã€‚ unshare()å’Œclone()çš„åŒºåˆ«åœ¨äºï¼šunshare()æ˜¯æŠŠå½“å‰è¿›ç¨‹è¿›å…¥åˆ°æ–°çš„namespaceï¼›clone()æ˜¯åˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œç„¶åè®©æ–°åˆ›å»ºçš„è¿›ç¨‹ï¼ˆå­è¿›ç¨‹ï¼‰åŠ å…¥åˆ°æ–°çš„namespaceã€‚ ","date":"2019-11-28","objectID":"/docker-linux-namespace-intro/:1:2","tags":["Docker","Namespace","Cgroup"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Linux Namespace ç®€ä»‹","uri":"/docker-linux-namespace-intro/"},{"categories":["Docker"],"content":"Cç¨‹åºä¸­ä½¿ç”¨cloneç³»ç»Ÿè°ƒç”¨ æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ clone ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ä¾‹å­ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¹¶æ‰§è¡Œ /bin/bashï¼Œè¿™æ ·å°±å¯ä»¥æ¥å—å‘½ä»¤ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹æ–°è¿›ç¨‹çš„ä¿¡æ¯ã€‚ #define _GNU_SOURCE #include \u003csched.h\u003e #include \u003csys/wait.h\u003e #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003cunistd.h\u003e #include \u003cstring.h\u003e // è®¾ç½®å­è¿›ç¨‹è¦ä½¿ç”¨çš„æ ˆç©ºé—´ #define STACK_SIZE (1024*1024) static char container_stack[STACK_SIZE]; #define errExit(code, msg); {if(code == -1){perror(msg); exit(-1);} } char* const container_args[] = { \"/bin/bash\", NULL }; static int container_func(void *arg) { pid_t pid = getpid(); printf(\"Container[%d] - inside the container!\\n\", pid); // ç”¨ä¸€ä¸ªæ–°çš„bashæ¥æ›¿æ¢æ‰å½“å‰å­è¿›ç¨‹ï¼Œ // è¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡ bash æŸ¥çœ‹å½“å‰å­è¿›ç¨‹çš„æƒ…å†µ. // bashé€€å‡ºåï¼Œå­è¿›ç¨‹æ‰§è¡Œå®Œæ¯• execv(container_args[0], container_args); // ä»è¿™é‡Œå¼€å§‹çš„ä»£ç å°†ä¸ä¼šè¢«æ‰§è¡Œåˆ°ï¼Œå› ä¸ºå½“å‰å­è¿›ç¨‹å·²ç»è¢«ä¸Šé¢çš„bashæ›¿æ¢æ‰äº†; // æ‰€ä»¥å¦‚æœæ‰§è¡Œåˆ°è¿™é‡Œï¼Œä¸€å®šæ˜¯å‡ºé”™äº† printf(\"Container[%d] - oops!\\n\", pid); return 1; } int main(int argc, char *argv[]) { pid_t pid = getpid(); printf(\"Parent[%d] - create a container!\\n\", pid); // åˆ›å»ºå¹¶å¯åŠ¨å­è¿›ç¨‹ï¼Œè°ƒç”¨è¯¥å‡½æ•°åï¼Œçˆ¶è¿›ç¨‹å°†ç»§ç»­å¾€åæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œåé¢çš„waitpid pid_t child_pid = clone(container_func, // å­è¿›ç¨‹å°†æ‰§è¡Œcontainer_funcè¿™ä¸ªå‡½æ•° container_stack + sizeof(container_stack), // è¿™é‡ŒSIGCHLDæ˜¯å­è¿›ç¨‹é€€å‡ºåè¿”å›ç»™çˆ¶è¿›ç¨‹çš„ä¿¡å·ï¼Œè·Ÿnamespaceæ— å…³ SIGCHLD, NULL); // ä¼ ç»™child_funcçš„å‚æ•° errExit(child_pid, \"clone\"); waitpid(child_pid, NULL, 0); // ç­‰å¾…å­è¿›ç¨‹ç»“æŸ printf(\"Parent[%d] - container exited!\\n\", pid); return 0; } è¿™æ®µä»£ç ä¸é•¿ï¼Œä½†æ˜¯åšäº†å¾ˆå¤šäº‹æƒ…ï¼š é€šè¿‡clone()åˆ›å»ºå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œå¹¶è®¾ç½®å¯åŠ¨æ—¶çš„å‚æ•° åœ¨å­è¿›ç¨‹ä¸­è°ƒç”¨ execv æ¥æ‰§è¡Œ /bin/bashï¼Œç­‰å¾…ç”¨æˆ·è¿›è¡Œäº¤äº’ å­è¿›ç¨‹é€€å‡ºä¹‹åï¼Œçˆ¶è¿›ç¨‹ä¹Ÿè·Ÿç€é€€å‡º æˆ‘ä»¬å¯ä»¥ç”¨ls -l /proc/$$/nsæŸ¥çœ‹å½“å‰è¿›ç¨‹æ‰€åœ¨å‘½åç©ºé—´çš„ä¿¡æ¯ï¼Œè¿è¡Œç¨‹åºï¼š lucy@lucy-computer:~$ gcc container.c -o container lucy@lucy-computer:~$ ./container Parent[19644] - create a container! Container[19645] - inside the container! lucy@lucy-computer:~$ ls -l /proc/$$/ns æ€»ç”¨é‡ 0 lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 cgroup -\u003e 'cgroup:[4026531835]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 ipc -\u003e 'ipc:[4026531839]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 mnt -\u003e 'mnt:[4026531840]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 net -\u003e 'net:[4026531992]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 pid -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 pid_for_children -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 user -\u003e 'user:[4026531837]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:36 uts -\u003e 'uts:[4026531838]' lucy@lucy-computer:~$ exit exit Parent[19644] - container exited! lucy@lucy-computer:~$ ls -l /proc/$$/ns æ€»ç”¨é‡ 0 lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 cgroup -\u003e 'cgroup:[4026531835]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 ipc -\u003e 'ipc:[4026531839]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 mnt -\u003e 'mnt:[4026531840]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 net -\u003e 'net:[4026531992]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 pid -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 pid_for_children -\u003e 'pid:[4026531836]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 user -\u003e 'user:[4026531837]' lrwxrwxrwx 1 lucy lucy 0 11æœˆ 28 15:39 uts -\u003e 'uts:[4026531838]' å„ç±»å‘½åç©ºé—´idéƒ½æ˜¯ä¸€æ ·ï¼Œå› ä¸ºæˆ‘ä»¬åªæ˜¯å•å•ä½¿ç”¨äº†cloneï¼Œæœªè®¾ç½®è¦éš”ç¦»çš„å‘½åç©ºé—´ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬åŠ å…¥UTS Namespaceéš”ç¦»ï¼ŒUTS namespace åŠŸèƒ½æœ€ç®€å•ï¼Œå®ƒåªéš”ç¦»äº† hostname å’Œ NIS domain name ä¸¤ä¸ªèµ„æºã€‚ åŒä¸€ä¸ª namespace é‡Œé¢çš„è¿›ç¨‹çœ‹åˆ°çš„ hostname å’Œ domain name æ˜¯ç›¸åŒçš„ï¼Œè¿™ä¸¤ä¸ªå€¼å¯ä»¥é€šè¿‡ sethostname(2) å’Œ setdomainname(2) æ¥è¿›è¡Œè®¾ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ uname(2)ã€gethostname(2) å’Œ getdomainname(2) æ¥è¯»å–ã€‚ æ³¨æ„ï¼š UTS çš„åå­—æ¥è‡ªäºunameå‡½æ•°ç”¨åˆ°çš„ç»“æ„ä½“struct utsnameï¼Œè¿™ä¸ªç»“æ„ä½“çš„åå­—æºè‡ªäºUNIX Time-sharing Systemã€‚ ä»£ç ä¸»è¦ä¿®æ”¹ä¸¤ä¸ªåœ°æ–¹ï¼šclone çš„å‚æ•°åŠ ä¸Šäº† CLONE_NEWUTSï¼Œå­è¿›ç¨‹å‡½æ•°ä¸­ä½¿ç”¨sethostnameæ¥è®¾ç½® hostnameã€‚ #define _GNU_SOURCE #include \u003csched.h\u003e #include \u003csys/wait.h\u003e #include \u003csys/utsname.h\u003e #include \u003cstdio.h\u003e #include \u003cstdlib.h\u003e #include \u003cunistd.h\u003e #include \u003cstring.h\u003e // è®¾ç½®å­è¿›ç¨‹è¦ä½¿ç”¨çš„æ ˆç©ºé—´ #define STACK_SIZE (1024*1024) static char container_stack[STACK_SIZE]; #define errExit(code, msg); {if(code == -1){perror(msg); exit(-1);} } char* const container_args[] = { \"/bin/bash\", NULL }; static int container_func(void *hostname) { pid_t pid = getpid(); printf(\"Container[%d] - inside the container!\\n\", pid); // ä½¿ç”¨ sethostname è®¾ç½®å­è¿›ç¨‹çš„ hostname ä¿¡æ¯ struct utsname uts; if (sethostname(hostname, strlen(hostname)) == -1) { errExit(-1, \"sethostname\") }; // ä½¿ç”¨ uname è·å–å­è¿›ç¨‹çš„æœºå™¨ä¿¡æ¯ï¼Œå¹¶æ‰“å° hostname å‡ºæ¥ if (uname(\u0026uts) == -1){ errExit(-1, \"uname\") } printf(\"Container[%d] - container uts.nodename: [%s]!\\n\", pid, ut","date":"2019-11-28","objectID":"/docker-linux-namespace-intro/:2:0","tags":["Docker","Namespace","Cgroup"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Linux Namespace ç®€ä»‹","uri":"/docker-linux-namespace-intro/"},{"categories":["Docker"],"content":"Letâ€™s Go Cè¯­è¨€å¾ˆåº•å±‚ï¼Œèƒ½æ§åˆ¶åˆ°å¾ˆå¤šç»†èŠ‚ï¼Œä½†æ˜¯å®ƒå¯¹äºå¤§éƒ¨åˆ†äººæœ‰ç‚¹å›°éš¾ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šæœ‰Goè¯­è¨€æ¥ä¸€æ­¥æ­¥å®ç°Dockerå®¹å™¨ã€‚ ","date":"2019-11-28","objectID":"/docker-linux-namespace-intro/:2:1","tags":["Docker","Namespace","Cgroup"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Linux Namespace ç®€ä»‹","uri":"/docker-linux-namespace-intro/"},{"categories":["Docker"],"content":"å‚è€ƒèµ„æ–™ cizixs.com/2017/08/29/linux-namespace Linux Namespace : ç®€ä»‹ ","date":"2019-11-28","objectID":"/docker-linux-namespace-intro/:2:2","tags":["Docker","Namespace","Cgroup"],"title":"ä¸€æ­¥æ­¥è‡ªå·±åšä¸ªDockerä¹‹Linux Namespace ç®€ä»‹","uri":"/docker-linux-namespace-intro/"},{"categories":["C#"],"content":"CefSharp CEFå…¨ç§°ï¼šChromium Embedded Frameworkã€‚ CefSharpæ˜¯ä»€ä¹ˆï¼Ÿå®˜ç½‘ä¸Šå®ƒæ˜¯è¿™ä¹ˆå†™çš„ï¼šCefSharpæ˜¯åœ¨C#æˆ–VB.NETåº”ç”¨ç¨‹åºä¸­åµŒå…¥å…¨åŠŸèƒ½æ ‡å‡†å…¼å®¹webæµè§ˆå™¨çš„æœ€ç®€å•æ–¹æ³•ã€‚CefSharpæœ‰WinFormså’ŒWPFåº”ç”¨ç¨‹åºçš„æµè§ˆå™¨æ§ä»¶ï¼Œä¹Ÿæœ‰è‡ªåŠ¨åŒ–é¡¹ç›®çš„æ— æ ‡é¢˜ï¼ˆå±å¹•å¤–ï¼‰ç‰ˆæœ¬ã€‚CefSharpåŸºäºChromiumåµŒå…¥å¼æ¡†æ¶ï¼Œè¿™æ˜¯Google Chromeçš„å¼€æºç‰ˆæœ¬ã€‚ è¯´ç™½äº†ï¼Œå°±æ˜¯åŸºäºC#æˆ–VBè¯­è¨€çš„å¯ç¼–ç¨‹æµè§ˆå™¨ï¼ˆå½“ç„¶CEFä¹Ÿæœ‰å…¶ä»–è¯­è¨€çš„ï¼Œå¦‚Javaï¼ŒGoï¼‰ã€‚ æœ¬æ–‡ç¯å¢ƒï¼š CefSharpç‰ˆæœ¬ï¼š75.1.143 VSç‰ˆæœ¬ï¼š2015 æ“ä½œç³»ç»Ÿï¼šWindows 10ä¸“ä¸šç‰ˆ ","date":"2019-11-16","objectID":"/cefsharp_summary/:1:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"WPFå¼•å…¥CefSharp CefSharpæœ‰ç°æˆçš„NuGetåŒ…ï¼Œå…ˆå¼•å…¥åˆ°é¡¹ç›®ä¸­ï¼Œç„¶ååœ¨XAMLä¸­æ·»åŠ å“åº”æ§ä»¶ï¼š \u003ccefSharp:ChromiumWebBrowser Name=\"myChrome\" Loaded=\"myChrome_Loaded\"/\u003e æ·»åŠ cefSharpå‘½åç©ºé—´ï¼š xmlns:cefSharp=\"clr-namespace:CefSharp.Wpf;assembly=CefSharp.Wpf\" åœ¨myChrome_Loadedäº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬è®©æµè§ˆå™¨æ‰“å¼€ç™¾åº¦é¦–é¡µï¼š private void myChrome_Loaded(object sender, RoutedEventArgs e) { String url = \"https://www.baidu.com\"; myChrome.Load(url); } è¿è¡Œç¨‹åºï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°ç™¾åº¦é¦–é¡µäº†ã€‚ ","date":"2019-11-16","objectID":"/cefsharp_summary/:2:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"æˆªæ–­è¯·æ±‚ æ ¹æ®æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°RequestHandlerç±»ä¸­çš„æ–¹æ³•GetResourceRequestHandlerä¼šåœ¨æ¯æ¬¡å‘è¯·æ±‚å‰è¢«è°ƒç”¨ï¼š GetResourceRequestHandler Called on the CEF IO thread before a resource request is initiated. RequestHandlerç±»æ˜¯IRequestHandleræ¥å£çš„é»˜è®¤å®ç°ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰è¯·æ±‚å¯ä»¥ç»§æ‰¿è¿™ä¸ªç±»ï¼š Default implementation of IRequestHandler. This class provides default implementations of the methods from IRequestHandler, therefore providing a convenience base class for any custom request handler. æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç»§æ‰¿RequestHandlerçš„ç±» class CustomRequestHandler : RequestHandler { protected override IResourceRequestHandler GetResourceRequestHandler(IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, bool isNavigation, bool isDownload, string requestInitiator, ref bool disableDefaultHandling) { return new CustomResourceRequestHandler(); } } GetResourceRequestHandleræ˜¯æˆ‘ä»¬è¦é‡ç‚¹å…³æ³¨çš„æ–¹æ³•ï¼Œé‡Œå¤´æˆ‘ä»¬è¿”å›äº†ä¸€ä¸ªç±»å®ä¾‹ï¼Œåœ¨è¿™ä¸ªç±»ä¸­æˆ‘ä»¬å°±å¯ä»¥è‡ªå®šä¹‰è¯·æ±‚ã€‚ æ–°ç‰ˆçš„CefSharpï¼ˆ75ç‰ˆæœ¬ä¹‹åï¼‰æŠŠOnBeforeResourceLoadæ–¹æ³•ç§»åŠ¨åˆ°äº†IResourceRequestHandleræ¥å£é‡Œï¼ˆæ–‡æ¡£ï¼‰ï¼ŒåŒæ ·çš„CefSharpä¹Ÿæä¾›äº†è¿™ä¸ªæ¥å£çš„é»˜è®¤å®ç°ï¼šResourceRequestHandlerï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªç»§æ‰¿ResourceRequestHandlerçš„ç±»ï¼ˆä¹Ÿå°±æ˜¯ä¸Šé¢ä»£ç ä¸­çš„CustomResourceRequestHandlerç±»ï¼‰ï¼š public class CustomResourceRequestHandler : ResourceRequestHandler { protected override CefReturnValue OnBeforeResourceLoad(IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, IRequestCallback callback) { var headers = request.Headers; headers[\"Custom-Header\"] = \"My Custom Header\"; request.Headers = headers; return CefReturnValue.Continue; } } æœ€åï¼ŒæŠŠè‡ªå®šä¹‰è¯·æ±‚ç±»è®¾ç½®åˆ°CefSharpå®ä¾‹ä¸­ myChrome.RequestHandler = new CustomRequestHandler(); é€šè¿‡Fiddlerè¿™æ ·çš„æŠ“åŒ…å·¥å…·ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œè‡ªå®šä¹‰çš„Custom-Headerå¤´å·²ç»åŠ ä¸Šäº† ","date":"2019-11-16","objectID":"/cefsharp_summary/:3:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"æ·»åŠ è‡ªå®šä¹‰æŸ¥è¯¢å‚æ•° ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ äº†è‡ªå®šä¹‰çš„headerï¼Œå¦‚æœæˆ‘ä»¬æƒ³æ”¹å†™URLæ·»åŠ ä¸€äº›è‡ªå®šä¹‰çš„æŸ¥è¯¢å‚æ•°å‘¢ï¼Œè­¬å¦‚name=fooï¼Ÿè¿™é‡Œæœ‰ä¸ªå‘ï¼Œå¦‚æœæˆ‘ä»¬ç®€å•åœ°æŠŠrequest.Url += \"?name=foo\"ï¼Œè¿™æ ·ä¼šå¯¼è‡´æ— é™é‡å®šå‘ï¼ˆå› ä¸ºæ”¹äº†Urlå°±ä¼šé‡å®šå‘ï¼‰ã€‚è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸‹æˆ‘ä»¬æƒ³è¦çš„æŸ¥è¯¢å‚æ•°æ˜¯å¦å·²ç»åœ¨Urlé‡Œäº†ï¼š protected override CefReturnValue OnBeforeResourceLoad(IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, IRequestCallback callback) { var headers = request.Headers; headers[\"Custom-Header\"] = \"My Custom Header\"; request.Headers = headers; if (!request.Url.Contains(\"name=foo\")) { request.Url += \"?\" + \"name=foo\"; } return CefReturnValue.Continue; } ","date":"2019-11-16","objectID":"/cefsharp_summary/:3:1","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"æ·»åŠ è‡ªå®šä¹‰Body æ ¹æ®IRequestçš„æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨PostDataå±æ€§ï¼š protected override CefReturnValue OnBeforeResourceLoad(IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, IRequestCallback callback) { var headers = request.Headers; headers[\"Custom-Header\"] = \"My Custom Header\"; request.Headers = headers; string body = \"name=foo\"; byte[] byteArray = System.Text.Encoding.UTF8.GetBytes(body); request.InitializePostData(); var element = request.PostData.CreatePostDataElement(); element.Bytes = byteArray; request.PostData.AddElement(element); return CefReturnValue.Continue; } é€šè¿‡Fiddlerè¿™æ ·çš„æŠ“åŒ…å·¥å…·ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼ŒPOST æ•°æ®å·²ç»åŠ ä¸Šäº†ï¼š ","date":"2019-11-16","objectID":"/cefsharp_summary/:3:2","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"åŠ è½½æœ¬åœ°HTMLå­—ç¬¦ä¸² æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ¸²æŸ“ä¸€ä¸ªå†…å­˜ä¸­çš„HTMLå­—ç¬¦ä¸²ï¼ŒCefSharpä¹Ÿæä¾›è¿™æ ·çš„æ¥å£ï¼Œä»£ç å¾ˆç®€å•ï¼š private void myChrome_Loaded(object sender, RoutedEventArgs e) { string html = @\"\u003c!DOCTYPE html\u003e \u003chtml\u003e \u003chead\u003e \u003ctitle\u003eè¿™æ˜¯ä¸ªæ ‡é¢˜\u003c/title\u003e \u003cmeta charset='utf-8' /\u003e \u003cmeta name = 'viewport' content = 'width=device-width, initial-scale=1' /\u003e \u003c/head\u003e \u003cbody\u003e \u003ch1\u003eè¿™æ˜¯ä¸€ä¸ªä¸€ä¸ªç®€å•çš„HTML\u003c/h1\u003e \u003cp\u003eHello Worldï¼\u003c/p \u003e \u003c/body\u003e \u003c/html\u003e\"; String url = \"https://www.baidu.com\"; myChrome.LoadHtml(html, url); } ","date":"2019-11-16","objectID":"/cefsharp_summary/:4:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"æˆªæ–­å“åº” è¿™é‡Œçš„å…³é”®åœ¨äºGetResourceResponseFilteræ–¹æ³•ï¼Œå®ƒçš„ç­¾åå¦‚ä¸‹ï¼š IResponseFilter GetResourceResponseFilter( IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, IResponse response ) å®ƒè¿”å›äº†ä¸€ä¸ªIResponseFilteræ¥å£ï¼Œåœ¨è¿™ä¸ªæ¥å£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æˆªå–åˆ°è¯·æ±‚å“åº”çš„å†…å®¹ã€‚åœ¨CefSharpæœ€æ–°ç‰ˆæœ¬ä¸­ï¼ŒGetResourceResponseFilterå·²ç»è¢«æ”¾å…¥åˆ°IResourceRequestHandleræ¥å£ä¸­ï¼Œæœ€æ–°æ–‡æ¡£ã€‚ ä¸‹é¢æˆ‘æ”¾äº†ä¸€ä¸ªæˆªæ–­ç½‘é¡µXHRè¯·æ±‚çš„ä¾‹å­ï¼š public class TestJsonFilter : IResponseFilter { public List\u003cbyte\u003e DataAll = new List\u003cbyte\u003e(); public FilterStatus Filter(System.IO.Stream dataIn, out long dataInRead, System.IO.Stream dataOut, out long dataOutWritten) { try { if (dataIn == null || dataIn.Length == 0) { dataInRead = 0; dataOutWritten = 0; return FilterStatus.Done; } dataInRead = dataIn.Length; dataOutWritten = Math.Min(dataInRead, dataOut.Length); dataIn.CopyTo(dataOut); dataIn.Seek(0, SeekOrigin.Begin); byte[] bs = new byte[dataIn.Length]; dataIn.Read(bs, 0, bs.Length); DataAll.AddRange(bs); dataInRead = dataIn.Length; dataOutWritten = dataIn.Length; return FilterStatus.NeedMoreData; } catch (Exception ex) { dataInRead = dataIn.Length; dataOutWritten = dataIn.Length; return FilterStatus.Done; } } public bool InitFilter() { return true; } public void Dispose() { } } public class FilterManager { private static Dictionary\u003cstring, IResponseFilter\u003e dataList = new Dictionary\u003cstring, IResponseFilter\u003e(); public static IResponseFilter CreateFilter(string guid) { lock (dataList) { var filter = new TestJsonFilter(); dataList.Add(guid, filter); return filter; } } public static IResponseFilter GetFileter(string guid) { lock (dataList) { if (dataList.ContainsKey(guid)) // è¿™é‡Œè¦æ£€æµ‹keyå­˜åœ¨ï¼Œä¸ç„¶ä¼šæŠ¥å¼‚å¸¸ï¼Œä¼šå¯¼è‡´ContextSwitchDeadlock { return dataList[guid]; } else { return null; } } } } public class CustomResourceRequestHandler : ResourceRequestHandler { protected override CefReturnValue OnBeforeResourceLoad(IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, IRequestCallback callback) { // æˆªæ–­è¯·æ±‚çš„ä»£ç ... return CefReturnValue.Continue; } protected override IResponseFilter GetResourceResponseFilter(IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, IResponse response) { if (!(request.ResourceType == ResourceType.Xhr)) // ä¸æ˜¯XHRç±»å‹å°±ä¸å»è¿‡æ»¤ { return null; } var filer = FilterManager.CreateFilter(request.Identifier.ToString()); return filer; } protected override void OnResourceLoadComplete(IWebBrowser chromiumWebBrowser, IBrowser browser, IFrame frame, IRequest request, IResponse response, UrlRequestStatus status, long receivedContentLength) { var filer = FilterManager.GetFileter(request.Identifier.ToString()) as TestJsonFilter; if (filer != null) { Console.WriteLine(ASCIIEncoding.UTF8.GetString(filer.DataAll.ToArray())); // æ‰“å°bodyå†…å®¹ } } } private void myChrome_Loaded(object sender, RoutedEventArgs e) { String url = \"https://github.com/salamander-mh\"; // githubé¦–é¡µä¸Šæœ‰ajaxè¯·æ±‚ï¼Œå¯ä»¥çœ‹æ•ˆæœ myChrome.Load(url); } è¿è¡Œç¨‹åºï¼Œåœ¨è¾“å‡ºè§†å›¾å°±å¯ä»¥çœ‹åˆ°Ajaxè¯·æ±‚çš„bodyæ•°æ®ã€‚ ","date":"2019-11-16","objectID":"/cefsharp_summary/:5:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"æˆªå–cookie å»ºç«‹Cookieè¯»å–å¯¹è±¡ï¼Œç»§æ‰¿æ¥å£ ICookieVisitor public class CookieVisitor : CefSharp.ICookieVisitor { public event Action\u003cCefSharp.Cookie\u003e SendCookie; public bool Visit(Cookie cookie, int count, int total, ref bool deleteCookie) { deleteCookie = false; if (SendCookie != null) { SendCookie(cookie); } return true; } public void Dispose() { } } åœ¨browseräº‹ä»¶ä¸­è¿›è¡Œå¤„ç† private void browser_FrameLoadEnd(object sender, CefSharp.FrameLoadEndEventArgs e) { var cookieManager = myChrome.GetCookieManager(); CookieVisitor visitor = new CookieVisitor(); visitor.SendCookie += visitor_SendCookie; cookieManager.VisitAllCookies(visitor); } å›è°ƒäº‹ä»¶ private void visitor_SendCookie(CefSharp.Cookie obj) { Console.WriteLine(\"è·å–cookieï¼š\" + obj.Domain.TrimStart('.') + \"^\" + obj.Name + \"^\" + obj.Value + \"$\"); } è®¾ç½®CefSharpå®ä¾‹äº‹ä»¶ï¼š private void myChrome_Loaded(object sender, RoutedEventArgs e) { String url = \"https://www.baidu.com\"; myChrome.Load(url); myChrome.FrameLoadEnd += browser_FrameLoadEnd; } è¿è¡Œç¨‹åºï¼Œåœ¨è¾“å‡ºè§†å›¾å°±å¯ä»¥çœ‹åˆ°cookieæ•°æ®äº†ã€‚ ","date":"2019-11-16","objectID":"/cefsharp_summary/:6:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"Javascriptäº¤äº’ ","date":"2019-11-16","objectID":"/cefsharp_summary/:7:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"C#æ‰§è¡Œjsæ–¹æ³• myChrome.GetBrowser().MainFrame.ExecuteJavaScriptAsync(\"document.getElementById('testid').click();\"); ä»¥ä¸Šä»£ç å°±ä¼šè§¦å‘idä¸ºtestidçš„å…ƒç´ çš„clickäº‹ä»¶ã€‚ æ³¨æ„ï¼šè„šæœ¬æ˜¯åœ¨ Frame çº§åˆ«æ‰§è¡Œï¼Œé¡µé¢æ°¸è¿œè‡³å°‘æœ‰ä¸€ä¸ªFrameï¼ˆ MainFrame ï¼‰ã€‚ ","date":"2019-11-16","objectID":"/cefsharp_summary/:7:1","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"è·å–Javascriptæ–¹æ³•ç»“æœ è¿™é‡Œéœ€è¦ä½¿ç”¨Task\u003cJavascriptResponse\u003e EvaluateScriptAsync(string script, TimeSpan? timeout)æ–¹æ³•ã€‚ JavaScriptä»£ç æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ï¼Œå› æ­¤ä½¿ç”¨.NET Task ç±»è¿”å›ä¸€ä¸ªå“åº”ï¼Œå…¶ä¸­åŒ…å«é”™è¯¯æ¶ˆæ¯ï¼Œç»“æœå’Œä¸€ä¸ªæˆåŠŸï¼ˆboolï¼‰æ ‡å¿—ã€‚ // Get Document Height var task = frame.EvaluateScriptAsync(\"(function() { var body = document.body, html = document.documentElement; return Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight ); })();\", null); task.ContinueWith(t =\u003e { if (!t.IsFaulted) { var response = t.Result; EvaluateJavaScriptResult = response.Success ? (response.Result ?? \"null\") : response.Message; } }, TaskScheduler.FromCurrentSynchronizationContext()); ","date":"2019-11-16","objectID":"/cefsharp_summary/:7:2","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["C#"],"content":"èµ„æºæ¸…ç† å…³é—­åº”ç”¨ï¼Œå‘ç°CefSharp.BrowserSubprocess.exeè¿›ç¨‹ä¼šå‘ç°æ²¡æœ‰ç»“æŸï¼Œå…¶å®åœ¨é€€å‡ºäº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨Cef.Shutdown()æ–¹æ³• try { if (browser != null) { browser.Dispose(); Cef.Shutdown(); } } catch { } ç¤ºä¾‹ä»£ç ä¸‹è½½ å‚è€ƒï¼š StackOverflow How to read the JSON response content from a XMLHttpRequest? CefSharpä¸­æ–‡å¸®åŠ©æ–‡æ¡£ ","date":"2019-11-16","objectID":"/cefsharp_summary/:8:0","tags":["C#","CefSharp","WPF"],"title":"CefSharpæµ…å°è¾„æ­¢","uri":"/cefsharp_summary/"},{"categories":["ci"],"content":"jenkinsæ˜¯ä»€ä¹ˆï¼Ÿ Jenkinsæ˜¯ä¸€ä¸ªå¼€æºçš„ã€æä¾›å‹å¥½æ“ä½œç•Œé¢çš„æŒç»­é›†æˆ(CI)å·¥å…·ï¼Œèµ·æºäºHudsonï¼ˆHudsonæ˜¯å•†ç”¨çš„ï¼‰ï¼Œä¸»è¦ç”¨äºæŒç»­ã€è‡ªåŠ¨çš„æ„å»º/æµ‹è¯•è½¯ä»¶é¡¹ç›®ã€ç›‘æ§å¤–éƒ¨ä»»åŠ¡çš„è¿è¡Œã€‚Jenkinsç”¨Javaè¯­è¨€ç¼–å†™ï¼Œå¯åœ¨Tomcatç­‰æµè¡Œçš„servletå®¹å™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯ç‹¬ç«‹è¿è¡Œã€‚é€šå¸¸ä¸ç‰ˆæœ¬ç®¡ç†å·¥å…·(SCM)ã€æ„å»ºå·¥å…·ç»“åˆä½¿ç”¨ã€‚å¸¸ç”¨çš„ç‰ˆæœ¬æ§åˆ¶å·¥å…·æœ‰SVNã€GITï¼Œæ„å»ºå·¥å…·æœ‰Mavenã€Antã€Gradleã€‚ ä¸Šé¢çš„ä»‹ç»æ˜¯æŠ„çš„ï¼ˆé€ƒï¼Œç®€å•è®²ï¼Œå°±æ˜¯Jenkinsèƒ½å¸®æˆ‘ä»¬è‡ªåŠ¨ç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œå‘å¸ƒè½¯ä»¶ã€‚ ","date":"2019-11-07","objectID":"/jenkin_and_docker/:1:0","tags":["jenkins","ci","docker"],"title":"Jenkinsåœ¨Dockerä¸­è¿è¡Œä¸­çš„å‘","uri":"/jenkin_and_docker/"},{"categories":["ci"],"content":"å®‰è£…è¿è¡Œ Jenkinsæœ‰å•ç‹¬çš„waråŒ…ï¼Œé€šè¿‡java -jar jenkins.warç›´æ¥å°±å¯ä»¥è¿è¡Œï¼ˆå®˜ç½‘ä¸‹è½½ï¼Œé€‰æ‹©Generic Java package (.war)ï¼Œæˆ–è€…å®˜æ–¹é•œåƒï¼‰ï¼Œé€‰æ‹©LTS Releases ä¸­çš„war-stableï¼‰ï¼Œä½†æ˜¯jreç¯å¢ƒï¼Œå½“ç„¶å¯¹äºç†Ÿæ‚‰Javaçš„äººæ¥è¯´ï¼Œè¿™ä¸ªæ˜¯é…ç½®ä¸€ä¸‹å³å¯ã€‚æœ¬æ–‡ä»‹ç»åœ¨Dockerä¸­è¿è¡ŒJenkinsä»¥åŠä¼šé‡åˆ°çš„ä¸€äº›é—®é¢˜ã€‚ æ“ä½œç³»ç»Ÿï¼šUbuntu 18.04.3 LTS dockerç‰ˆæœ¬ï¼š19.03.4 jdkç‰ˆæœ¬ï¼šjava version â€œ1.8.0_221â€ åœ¨vimä¸­æ‰“å¼€ä¸­æ–‡æœ‰æ—¶å€™ä¼šä¹±ç ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤è§£å†³ï¼š sudo locale-gen zh_CN.UTF-8 å¥½äº†ï¼Œè®©æˆ‘ä»¬å¼€å§‹å®‰è£…Jenkinsã€‚ é¦–å…ˆï¼Œç¼–å†™ä¸€ä»½è‡ªå®šä¹‰çš„Dockerfileï¼š FROM jenkins/jenkins:lts USER root RUN echo ' \\n\\ deb http://mirrors.aliyun.com/debian stretch main contrib non-free \\n\\ deb-src http://mirrors.aliyun.com/debian stretch main contrib non-free \\n\\ deb http://mirrors.aliyun.com/debian stretch-updates main contrib non-free \\n\\ deb-src http://mirrors.aliyun.com/debian stretch-updates main contrib non-free \\n\\ deb http://mirrors.aliyun.com/debian-security stretch/updates main contrib non-free \\n\\ deb-src http://mirrors.aliyun.com/debian-security stretch/updates main contrib non-free ' \u003e /etc/apt/sources.list RUN cat /etc/apt/sources.list #æ›´æ–°æºå¹¶å®‰è£…ç¼ºå°‘çš„åŒ… RUN apt-get update \u0026\u0026 apt-get install -y gcc g++ make openssl pkg-config USER jenkins åŸºç¡€é•œåƒæ˜¯jenkins/jenkins:ltsï¼Œè§‚å¯Ÿä¸€ä¸‹è¿™ä¸ªé•œåƒ å‘ç°å®ƒæ˜¯åŸºäºFROM openjdk:8-jdk-stretchï¼Œè¿™æ˜¯å¸¦æœ‰jdkçš„debian 9é•œåƒã€‚æ‰€ä»¥æˆ‘åœ¨Dockerfileä¸­ä¿®æ”¹äº†aptæºï¼Œè¿™é‡Œä½¿ç”¨äº†é˜¿é‡Œäº‘çš„aptæºï¼ˆ\\n\\æ˜¯æ¢è¡ŒåŠ ä¸Šç»­è¡Œç¬¦ï¼‰ã€‚ å†é…åˆdocker-compose.ymlï¼š version: '3' services: jenkins: build: . volumes: - ./data:/var/jenkins_home environment: - \"JAVA_OPTS=-Duser.timezone=Asia/Shanghai -Xms1g -Xmx1g\" ports: - 127.0.0.1:8080:8080 - 50000:50000 ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨Jenkinsäº†ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œé”®å…¥å‘½ä»¤ï¼š docker-compose up è¿™æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°é”™è¯¯ï¼š jenkins_1 | touch: cannot touch '/var/jenkins_home/copy_reference_file.log': Permission denied jenkins_1 | Can not write to /var/jenkins_home/copy_reference_file.log. Wrong volume permissions? çœ‹æè¿°æ˜¯æƒé™é—®é¢˜ï¼Œè§‚å¯Ÿä¸€ä¸‹ç›®å½•ä¸‹çš„dataæ–‡ä»¶å¤¹ï¼š drwxr-xr-x 2 root root 4096 11æœˆ 17 20:47 data å‘ç°ç›®å½•çš„å±ä¸»æ˜¯rootç”¨æˆ·ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ ","date":"2019-11-07","objectID":"/jenkin_and_docker/:2:0","tags":["jenkins","ci","docker"],"title":"Jenkinsåœ¨Dockerä¸­è¿è¡Œä¸­çš„å‘","uri":"/jenkin_and_docker/"},{"categories":["ci"],"content":"åŸå› æ¢ç©¶ æŸ¥çœ‹Jenkinså®¹å™¨çš„å½“å‰ç”¨æˆ·å’Œç›®å½•/var/jenkins_homeå±ä¸»ï¼Œæˆ‘ä»¬å‘ç°å½“å‰ç”¨æˆ·æ˜¯Jenkinsï¼Œ/var/jenkins_homeå±ä¸»ç”¨æˆ·æ˜¯jenkinsï¼š docker run -ti --rm --entrypoint=\"/bin/bash\" jenkins/jenkins:lts -c \"whoami \u0026\u0026 id\" jenkins uid=1000(jenkins) gid=1000(jenkins) groups=1000(jenkins) docker run -ti --rm --entrypoint=\"/bin/bash\" jenkins/jenkins:lts -c \"ls -la /var\" drwxr-xr-x 1 root root 4096 Oct 17 08:29 cache drwxr-xr-x 2 jenkins jenkins 4096 Nov 17 14:05 jenkins_home ä¸Šè¿°å‘½ä»¤ä¸­ï¼Œ--rmé€‰é¡¹æ˜¯è®©å®¹å™¨é€€å‡ºæ—¶è‡ªåŠ¨æ¸…é™¤ï¼Œ--entrypointæ˜¯è¦†ç›–é•œåƒä¸­çš„ENTRYPOINTã€‚ ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œå› ä¸º/var/jenkins_homeæ˜ å°„åˆ°æœ¬åœ°æ•°æ®å·æ—¶ï¼Œç›®å½•çš„æ‹¥æœ‰è€…å˜æˆäº†rootç”¨æˆ·ï¼Œæ‰€ä»¥å‡ºç°äº†Permission deniedçš„é—®é¢˜ã€‚ å‘ç°é—®é¢˜ä¹‹åï¼Œç›¸åº”çš„è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼šæŠŠå½“å‰ç›®å½•çš„æ‹¥æœ‰è€…èµ‹å€¼ç»™uid 1000ï¼Œå†å¯åŠ¨\"jenkins\"å®¹å™¨å°±ä¸€åˆ‡æ­£å¸¸äº†ã€‚ sudo chown -R 1000:1000 data è¿™æ—¶åˆ©ç”¨æµè§ˆå™¨è®¿é—® â€œhttp://localhost:8080/â€ å°±å¯ä»¥çœ‹åˆ°Jenkinsçš„ç»å…¸Webç•Œé¢äº†ã€‚ å‚è€ƒï¼š è°ˆè°ˆ Docker Volume ä¹‹æƒé™ç®¡ç†ï¼ˆä¸€ï¼‰ ","date":"2019-11-07","objectID":"/jenkin_and_docker/:3:0","tags":["jenkins","ci","docker"],"title":"Jenkinsåœ¨Dockerä¸­è¿è¡Œä¸­çš„å‘","uri":"/jenkin_and_docker/"},{"categories":["Java","MyBatis"],"content":"æœ€è¿‘å­¦ä¹ äº†ä¸€ä¸‹Spring Bootï¼Œå®ƒç¡®å®åšåˆ°äº†ç®€å•å¿«é€Ÿåˆ›å»ºJava Webåº”ç”¨ã€‚è¿™æ˜¯ä¸€ç¯‡ç®€å•çš„ç¬”è®°ï¼Œè®°å½•äº†Spring Booté›†æˆMyBatisï¼Œå®ç°åŸºæœ¬çš„CURDã€‚ ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:0:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"MyBatisé›†æˆæ–¹å¼ æ³¨è§£ç‰ˆé›†æˆ XMLç‰ˆæœ¬é›†æˆ XMLç‰ˆæœ¬ä¸ºè€å¼çš„é…ç½®é›†æˆæ–¹å¼ï¼Œé‡åº¦é›†æˆXMLæ–‡ä»¶ï¼ŒSQLè¯­å¥ä¹Ÿæ˜¯å…¨éƒ¨å†™åœ¨XMLä¸­çš„ï¼Œæˆ‘ä»¥å‰é…SSMï¼ˆSpring+SpringMVC+MyBatisï¼‰ç”¨çš„å°±æ˜¯è¿™ç§æ–¹å¼ï¼›æ³¨è§£ç‰ˆç‰ˆæœ¬ï¼Œç›¸å¯¹æ¥è¯´æ¯”è¾ƒç®€çº¦ï¼Œä¸éœ€è¦XMLé…ç½®ï¼Œåªéœ€è¦ä½¿ç”¨æ³¨è§£å’Œä»£ç æ¥æ“ä½œæ•°æ®ï¼Œæœ¬æ–‡è¿™é‡Œä¸ä½œä»‹ç»ï¼ˆå…¶å®æŒºå¥½å­¦çš„ï¼Œ^_^ï¼‰ã€‚ ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:1:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"å‡†å¤‡ å¯åŠ¨MySQLæœåŠ¡ åˆ›å»ºæ•°æ®åº“spring_db CREATE DATABASE spring_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci; åˆ›å»ºuserè¡¨ create table user ( uid int(11) unsigned auto_increment comment 'ä¸»é”®Id' primary key, name varchar(255) null comment 'åç§°', age int null comment 'å¹´é¾„', address varchar(255) null comment 'åœ°å€', created_time datetime null comment 'åˆ›å»ºæ—¶é—´', updated_time datetime null comment 'æ›´æ–°æ—¶é—´' ) comment 'ç”¨æˆ·è¡¨' collate=utf8_general_ci; ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:2:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"æ·»åŠ ä¾èµ– \u003cdependency\u003e \u003cgroupId\u003emysql\u003c/groupId\u003e \u003cartifactId\u003emysql-connector-java\u003c/artifactId\u003e \u003cversion\u003e5.1.41\u003c/version\u003e \u003c/dependency\u003e \u003cdependency\u003e \u003cgroupId\u003eorg.mybatis.spring.boot\u003c/groupId\u003e \u003cartifactId\u003emybatis-spring-boot-starter\u003c/artifactId\u003e \u003cversion\u003e1.3.25\u003c/version\u003e \u003c/dependency\u003e ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:3:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"é…ç½®æ•°æ®åº“è¿æ¥ è®¾ç½®application.propertiesæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½® spring.datasource.url=jdbc:mysql://127.0.0.1:3306/spring_db?useUnicode=true\u0026characterEncoding=UTF-8 spring.datasource.username=root spring.datasource.password=2LCqvSOJ6m0Ut6ui spring.datasource.driver-class-name=com.mysql.jdbc.Driver spring.datasource.url æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸² spring.datasource.username æ•°æ®åº“ç”¨æˆ·å spring.datasource.password æ•°æ®åº“å¯†ç  spring.datasource.driver-class-name é©±åŠ¨ç±»å‹ï¼ˆæ³¨æ„MySQL 8.0çš„å€¼æ˜¯com.mysql.cj.jdbc.Driverå’Œä¹‹å‰ä¸åŒï¼‰ ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:4:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"è®¾ç½® MapperScan åŒ…è·¯å¾„ ç›´æ¥åœ¨å¯åŠ¨æ–‡ä»¶SpringbootApplication.javaçš„ç±»ä¸Šé…ç½®@MapperScanï¼Œè¿™æ ·å°±å¯ä»¥çœå»ï¼Œå•ç‹¬ç»™æ¯ä¸ªMapperï¼ˆå°±æ˜¯æˆ‘ä»¬è¿™é‡Œçš„daoå±‚ï¼‰ä¸Šæ ‡è¯†@Mapperçš„éº»çƒ¦ã€‚ @SpringBootApplication @MapperScan(\"com.salamander.springbootdemo.dao\") public class SpringbootdemoApplication { public static void main(String[] args) { SpringApplication.run(SpringbootdemoApplication.class, args); } } ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:5:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"æ·»åŠ Entityå’ŒDaoå±‚ç±» com.salamander.springbootdemo.entityä¸‹Userç±»ï¼ˆä½¿ç”¨äº†lombokçš„@Dataæ³¨è§£ï¼‰ï¼š @Data public class User implements Serializable { private Long id; private String name; private String address; private int age; private Date createdDatetime; } com.salamander.springbootdemo.daoä¸‹UserDaoæ¥å£ï¼š public interface UserDao { User findByName(String name); int insertUser(User user); } ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:6:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"XMLæ–¹å¼MyBatis é›†æˆ ä¿®æ”¹application.propertiesï¼Œæ·»åŠ é…ç½® mybatis.config-locations=classpath:mybatis/mybatis-config.xml mybatis.mapper-locations=classpath:mybatis/mapper/*.xml mybatis.config-locations é…ç½®MyBatisåŸºç¡€å±æ€§ mybatis.mapper-locations é…ç½®Mapper XMLæ–‡ä»¶ ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:6:1","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"é…ç½®XMLæ–‡ä»¶ æœ¬ä¾‹åˆ›å»ºä¸¤ä¸ªxmlæ–‡ä»¶ï¼Œåœ¨resource/mybatisä¸‹çš„mybatis-config.xmlï¼ˆé…ç½®MyBatisåŸºç¡€å±æ€§ï¼‰å’Œåœ¨resource/mybatis/mapperä¸‹çš„UserMapper.xmlï¼ˆç”¨æˆ·å’Œæ•°æ®äº¤äº’çš„SQLè¯­å¥ï¼‰ã€‚ mybatis-config.xml \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE configuration PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-config.dtd\"\u003e \u003cconfiguration\u003e \u003ctypeAliases\u003e \u003ctypeAlias alias=\"Integer\" type=\"java.lang.Integer\"/\u003e \u003ctypeAlias alias=\"Long\" type=\"java.lang.Long\"/\u003e \u003ctypeAlias alias=\"HashMap\" type=\"java.util.HashMap\"/\u003e \u003ctypeAlias alias=\"LinkedHashMap\" type=\"java.util.LinkedHashMap\"/\u003e \u003ctypeAlias alias=\"ArrayList\" type=\"java.util.ArrayList\"/\u003e \u003ctypeAlias alias=\"LinkedList\" type=\"java.util.LinkedList\"/\u003e \u003c/typeAliases\u003e \u003c/configuration\u003e UserMapper.xml \u003c?xml version=\"1.0\" encoding=\"UTF-8\" ?\u003e \u003c!DOCTYPE mapper PUBLIC \"-//mybatis.org//DTD Config 3.0//EN\" \"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"\u003e \u003c!--namespaceæ˜¯å‘½åç©ºé—´ï¼Œæ˜¯daoæ¥å£çš„å…¨è·¯å¾„--\u003e \u003cmapper namespace=\"com.salamander.springbootdemo.dao.UserDao\"\u003e \u003cresultMap id=\"userResultMap\" type=\"com.salamander.springbootdemo.entity.User\"\u003e \u003cid property=\"id\" column=\"uid\"\u003e\u003c/id\u003e \u003cresult column=\"name\" property=\"name\" /\u003e \u003cresult column=\"age\" property=\"age\" /\u003e \u003cresult column=\"address\" property=\"address\" /\u003e \u003cresult column=\"created_time\" property=\"createdDatetime\" /\u003e \u003c/resultMap\u003e \u003cselect id=\"findByName\" parameterType=\"java.lang.String\" resultMap=\"userResultMap\"\u003e select uid, name, age, address, created_time from user where name = #{name} \u003c/select\u003e \u003cinsert id=\"insertUser\" parameterType=\"com.salamander.springbootdemo.entity.User\"\u003e insert into user(name, age, address, created_time) VALUES ( #{name}, #{age}, #{address}, #{createdDatetime} ) \u003c/insert\u003e \u003c/mapper\u003e ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:7:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"è°ƒç”¨Daoç±» HomeController.javaç±» @RestController public class HomeController { @Resource private UserDao userDao; @RequestMapping(\"/\") public String index() { return \"Hello World!\"; } @RequestMapping(\"/user/{username}\") @ResponseBody public User getUser(@PathVariable(name = \"username\") String name) { return userDao.findByName(name); } @RequestMapping(\"/user/add/{username}\") @ResponseBody public String addUser(@PathVariable(name = \"username\") String name) { User user = new User(); user.setName(name); user.setAge(20); user.setCreatedDatetime(new Date()); userDao.insertUser(user); return \"insert succesfully\"; } } å¥½äº†ï¼Œè®¿é—®é“¾æ¥http://localhost:8080/user/wangï¼Œå°±ä¼šè¾“å‡ºwangè¿™ä¸ªç”¨æˆ·çš„æ•°æ®ï¼Œè€Œè®¿é—®http://localhost:8080/user/add/zhao,ä¼šæ·»åŠ ä¸€æ¡nameä¸ºzhaoçš„æ•°æ®åˆ°æ•°æ®åº“ã€‚ ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:8:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["Java","MyBatis"],"content":"äº‹åŠ¡æ”¯æŒ åœ¨SpringBootä¸­å¼€å¯äº‹åŠ¡éå¸¸ç®€å•ï¼Œåªéœ€åœ¨ä¸šåŠ¡å±‚æ·»åŠ äº‹åŠ¡æ³¨è§£(@Transactional)å³å¯å¿«é€Ÿå¼€å¯äº‹åŠ¡ã€‚å¥½çš„ï¼Œè®©æˆ‘ä»¬æ¥å°è¯•ä¸€ä¸‹ã€‚ åœ¨ä¸Šé¢çš„ä½¿ç”¨ä¸­ï¼Œæˆ‘ä»¬æ˜¯ç›´æ¥æŠŠDaoç±»åœ¨æ§åˆ¶å±‚ä¸­ä½¿ç”¨çš„ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ˜¯åœ¨ä¸šåŠ¡å±‚ä¸­ä½¿ç”¨Daoç±»çš„ã€‚ åœ¨com.salamander.springbootdemoä¸‹æ–°å»ºServiceçš„packageï¼Œä¹‹ååˆ›å»ºæ¥å£UserServiceï¼š package com.salamander.springbootdemo.service; public interface UserService { void addUsers(String name) throws Exception; } ä¹‹ååœ¨implçš„å­packageä¸­æ·»åŠ å®ç°ç±»UserServiceImplï¼š package com.salamander.springbootdemo.service.impl; import com.salamander.springbootdemo.dao.UserDao; import com.salamander.springbootdemo.entity.User; import com.salamander.springbootdemo.service.UserService; import org.springframework.stereotype.Service; import org.springframework.transaction.annotation.Transactional; import javax.annotation.Resource; import java.util.Date; @Service public class UserServiceImpl implements UserService { @Resource private UserDao userDao; @Transactional @Override public void addUsers(String name) throws Exception { int num = 5; for (int i = 0; i \u003c num; i++) { User user = getNewUser(name + (i + 1)); userDao.insertUser(user); if (i == 3) { throw new Exception(\"å‘ç”Ÿå†…éƒ¨é”™è¯¯äº†\"); } } } private User getNewUser(String name) { User user = new User(); user.setName(name); user.setAge(20); user.setCreatedDatetime(new Date()); return user; } } ç„¶åæˆ‘ä»¬åœ¨HomeControllerä¸­æ³¨å…¥UserServiceï¼Œå¹¶æ·»åŠ è·¯ç”± @Resource private UserService userService; @RequestMapping(\"/users/add/{username}\") @ResponseBody public String addUsers(@PathVariable(name = \"username\") String name) { try { userService.addUsers(name); return \"batch insert succesfully\"; } catch (Exception e) { return e.getMessage(); } } å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨addUsersæ–¹æ³•ä¸Šæ·»åŠ äº†@Transactionalæ³¨è§£å¼€å¯äº†äº‹åŠ¡ï¼Œå¹¶åœ¨æ’å…¥ç¬¬4æ¡æ•°æ®åæŠ›å‡ºäº†å¼‚å¸¸ã€‚å¥½äº†ï¼Œè®©æˆ‘ä»¬è®¿é—®é“¾æ¥http://localhost:8080/users/add/sunï¼Œæˆ‘ä»¬å‘ç°æ•°æ®åº“å¤šå‡ºäº†å››æ¡nameä¸ºsunçš„æ•°æ®ï¼Œå›æ»šå¹¶æ²¡æœ‰èµ·æ•ˆæœ è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„å‘ç‚¹ï¼Œå› ä¸ºSpringçš„é»˜è®¤çš„äº‹åŠ¡è§„åˆ™æ˜¯é‡åˆ°è¿è¡Œå¼‚å¸¸ï¼ˆRuntimeExceptionåŠå…¶å­ç±»ï¼‰å’Œç¨‹åºé”™è¯¯ï¼ˆErrorï¼‰æ‰ä¼šè¿›è¡Œäº‹åŠ¡å›æ»šï¼Œè€ŒExceptionæ˜¯åŸºç±»å°±ä¸è¡Œäº†ï¼Œè®©æˆ‘ä»¬çœ‹ä¸‹Javaçš„å¼‚å¸¸ç±»å±‚æ¬¡å›¾ å¦‚æœæƒ³é’ˆå¯¹æ£€æµ‹å¼‚å¸¸è¿›è¡Œäº‹åŠ¡å›æ»šï¼Œå¯ä»¥åœ¨@Transactionalæ³¨è§£é‡Œä½¿ç”¨ rollbackForå±æ€§æ˜ç¡®æŒ‡å®šå¼‚å¸¸ï¼ˆæˆ–è€…ä½ å¯ä»¥è‡ªå·±å®šä¹‰ä¸€ä¸ªç»§æ‰¿RuntimeExceptionçš„ç±»ï¼Œç„¶åæŠ›å‡ºè¿™ä¸ªç±»ï¼‰ã€‚ ç°åœ¨addUsersæ”¹æˆè¿™æ ·ï¼Œå°±å¯ä»¥æ­£å¸¸å›æ»šäº†ï¼š @Transactional(rollbackFor = Exception.class) @Override public void addUsers(String name) throws Exception { int num = 5; for (int i = 0; i \u003c num; i++) { User user = getNewUser(name + (i + 1)); userDao.insertUser(user); if (i == 3) { throw new Exception(\"å‘ç”Ÿå†…éƒ¨é”™è¯¯äº†\"); } } } é¡¹ç›®ä»£ç ä¸‹è½½ ","date":"2019-10-27","objectID":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/:9:0","tags":["Spring","Spring Boot","MyBatis"],"title":"Spring Booté›†æˆMyBatisæ“ä½œMySQL","uri":"/spring-boot%E9%9B%86%E6%88%90mybatis%E6%93%8D%E4%BD%9Cmysql/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":" æœ€è¿‘éœ€è¦åœ¨ç”¨Pytorchåšæ·±åº¦å­¦ä¹ ï¼Œä¸ºäº†åŠ å¿«è®­ç»ƒé€Ÿåº¦ï¼Œéœ€è¦ç”¨åˆ°GPUè¿ç®—ï¼Œæ•…åœ¨æ­¤è®°å½•ä¸€ä¸‹å®‰è£…è¿‡ç¨‹ã€‚ æˆ‘çš„æœ¬æœºç¯å¢ƒï¼š Ubuntu 18.04.3 LTS GeForce RTX 2080s ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:0","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"æ£€æŸ¥BIOSå¯åŠ¨é¡¹ åœ¨å¼€æœºå¯åŠ¨é¡¹çš„Securityé€‰é¡¹ä¸­æ£€æŸ¥UEFIæ˜¯å¦å¼€å¯ï¼Œå¦‚æœå¼€å¯çš„è¯è¯·ç«‹é©¬å…³æ‰å®ƒï¼ˆé‡è¦ï¼‰ åœ¨å¼€æœºå¯åŠ¨é¡¹çš„Booté€‰é¡¹ä¸­æ£€æŸ¥Secure Bootæ˜¯å¦å¼€å¯ï¼Œå¦‚æœå¼€å¯çš„è¯è¯·ç«‹é©¬å…³æ‰å®ƒï¼ˆé‡è¦ï¼‰ï¼Œå¯¹äºæœ‰çš„BIOSï¼Œåªè¦åˆ é™¤Secure Boot Keyå°±å¥½äº†ã€‚ ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:1","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"ç¦ç”¨ nouveau è¿è¡Œå‘½ä»¤ sudo gedit /etc/modprobe.d/blacklist.conf å°†ä¸‹åˆ—ä»£ç å¢åŠ åˆ°blacklist.confæ–‡ä»¶çš„æœ«å°¾ï¼š blacklist vga16fb blacklist nouveau blacklist rivafb blacklist rivatv blacklist nvidiafb ä¿å­˜ï¼Œç„¶ååœ¨å‘½ä»¤è¡Œä¸­æ›´æ–°initramfsï¼Œè¿è¡Œï¼š sudo update-initramfs -u ä¹‹åï¼Œé‡å¯ä¸»æœº reboot åœ¨ç»ˆç«¯è¿è¡Œï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹æ˜¯å¦ç¦ç”¨nouveauæˆåŠŸï¼ˆæ— è¾“å‡ºåˆ™è¡¨ç¤ºç¦ç”¨æˆåŠŸï¼‰ï¼š lsmod | grep nouveau ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:2","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"å®‰è£…æ˜¾å¡é©±åŠ¨ åœ¨NVIDIAå®˜æ–¹é€‰æ‹©å¯¹åº”é©±åŠ¨ï¼Œç„¶åä¸‹è½½ï¼š åœ¨å®‰è£…é©±åŠ¨ä¹‹å‰ï¼Œåº”è¯¥å¸è½½åŸæœ‰çš„NVIDIAé©±åŠ¨ç¨‹åº sudo apt-get remove --purge nvidia* æŠŠä¸‹è½½çš„é©±åŠ¨æ”¾åˆ°ç”¨æˆ·ç›®å½•ä¸‹ï¼Œæˆ‘è¿™é‡Œä¸‹è½½æ–‡ä»¶ä¸ºNVIDIA-Linux-x86_64-430.50.run ä¸ºäº†å®‰è£…æ–°çš„NVIDIAé©±åŠ¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦åœæ­¢å½“å‰çš„æ˜¾ç¤ºæœåŠ¡å™¨ã€‚æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨telinitå‘½ä»¤æ›´æ”¹ä¸ºè¿è¡Œçº§åˆ«3ã€‚æ‰§è¡Œä»¥ä¸‹linuxå‘½ä»¤åï¼Œæ˜¾ç¤ºæœåŠ¡å™¨å°†åœæ­¢ï¼Œå› æ­¤è¯·ç¡®ä¿åœ¨ç»§ç»­ä¹‹å‰ä¿å­˜æ‰€æœ‰å½“å‰å·¥ä½œï¼ˆå¦‚æœæœ‰ï¼‰ï¼š sudo telinit 3 ä¹‹åä¼šè¿›å…¥ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œä¼šè¯ï¼Œä½¿ç”¨å½“å‰çš„ç”¨æˆ·åå¯†ç ç™»å½•ï¼Œç„¶åæˆäºˆé©±åŠ¨æ–‡ä»¶å¯æ‰§è¡Œæƒé™ chmod a+x NVIDIA-Linux-x86_64-430.50.run ç„¶åæ‰§è¡Œå®‰è£…ï¼š sudo ./NVIDIA-Linux-x86_64-430.50.run --no-opengl-files æ³¨æ„ï¼Œâ€“no-opengl-fileså‚æ•°å¿…é¡»åŠ å¦åˆ™ä¼šå¾ªç¯ç™»å½•ï¼Œä¹Ÿå°±æ˜¯loop login å‚æ•°ä»‹ç»ï¼š â€“no-opengl-files åªå®‰è£…é©±åŠ¨æ–‡ä»¶ï¼Œä¸å®‰è£…OpenGLæ–‡ä»¶ã€‚è¿™ä¸ªå‚æ•°æœ€é‡è¦ â€“no-x-check å®‰è£…é©±åŠ¨æ—¶ä¸æ£€æŸ¥XæœåŠ¡ â€“no-nouveau-check å®‰è£…é©±åŠ¨æ—¶ä¸æ£€æŸ¥nouveau åé¢ä¸¤ä¸ªå‚æ•°å¯ä¸åŠ ã€‚ å®‰è£…é©±åŠ¨ä¸­æ³¨æ„ï¼Œpre-install script failedè¿™ä¸ªæç¤ºæ²¡ä»€ä¹ˆå…³ç³»ï¼Œä¹‹åçš„warningæç¤ºunable to find a suitable destination to install 32-bit compatibility librariesä¹Ÿæ²¡å…³ç³»ï¼Œéƒ½é€‰okï¼Œåœ¨è¯¢é—®æ˜¯å¦ä¿®æ”¹x-configurationï¼Œè¯·é€‰æ‹©é»˜è®¤çš„noï¼Œé€‰æ‹©yesä¼šå¯¼è‡´é‡å¯åæ— æ³•è¿›å…¥ç³»ç»Ÿã€‚ ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:3","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"ä½¿ç”¨nvidia-smiå‘½ä»¤æµ‹è¯• è‹±ä¼Ÿè¾¾ç³»ç»Ÿç®¡ç†æ¥å£ï¼ˆNVIDIA System Management Interface, ç®€ç§° nvidia-smiï¼‰æ˜¯åŸºäºNVIDIA Management Library (NVML) çš„å‘½ä»¤è¡Œç®¡ç†ç»„ä»¶,æ—¨åœ¨(intened to )å¸®åŠ©ç®¡ç†å’Œç›‘æ§NVIDIA GPUè®¾å¤‡ã€‚ é©±åŠ¨å®‰è£…å®Œæˆåï¼Œå¯åŠ¨ç”µè„‘ï¼Œä¹‹åå°±èƒ½ç”¨nvidia-smiå‘½ä»¤åˆ¤æ–­é©±åŠ¨æ˜¯å¦å®‰è£…æˆåŠŸ nvidia-smi æ‰§è¡Œè¿™æ¡å‘½ä»¤å°†ä¼šæ‰“å°å‡ºå½“å‰ç³»ç»Ÿå®‰è£…çš„NVIDIAé©±åŠ¨ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š è‹¥å‡ºç°ä¸Šå›¾ä¸­çš„ç»“æœåˆ™è¯´æ˜è‹±ä¼Ÿè¾¾é©±åŠ¨å®‰è£…æˆåŠŸã€‚ ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:4","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"å®‰è£…CUDA10.1 CUDAæ˜¯ä»€ä¹ˆï¼Ÿ CUDAï¼ŒCompute Unified Device Architectureçš„ç®€ç§°ï¼Œæ˜¯ç”±NVIDIAå…¬å¸åˆ›ç«‹çš„åŸºäºä»–ä»¬å…¬å¸ç”Ÿäº§çš„å›¾å½¢å¤„ç†å™¨GPUsï¼ˆGraphics Processing Units,å¯ä»¥é€šä¿—çš„ç†è§£ä¸ºæ˜¾å¡ï¼‰çš„ä¸€ä¸ªå¹¶è¡Œè®¡ç®—å¹³å°å’Œç¼–ç¨‹æ¨¡å‹ã€‚ é€šè¿‡CUDAï¼ŒGPUså¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¢«ç”¨æ¥è¿›è¡Œé€šç”¨è®¡ç®—ï¼ˆæœ‰ç‚¹åƒåœ¨CPUä¸­è¿›è¡Œçš„æ•°å€¼è®¡ç®—ç­‰ç­‰ï¼‰ã€‚åœ¨æ²¡æœ‰CUDAä¹‹å‰ï¼ŒGPUsä¸€èˆ¬åªç”¨æ¥è¿›è¡Œå›¾å½¢æ¸²æŸ“ï¼ˆå¦‚é€šè¿‡OpenGLï¼ŒDirectXï¼‰ã€‚ ä¸‹è½½åœ°å€ï¼Œé€‰æ‹©å¯¹åº”ç‰ˆæœ¬çš„cudaå®‰è£…åŒ…ï¼Œæˆ‘è¿™é‡Œé€‰æ‹©çš„æ˜¯runfileç±»å‹çš„ï¼Œä¸è¦é€‰æ‹©ä½¿ç”¨debç‰ˆæœ¬ï¼Œå®‰è£…CUDAæ—¶ä¸€å®šä½¿ç”¨runfileæ–‡ä»¶ï¼Œè¿™æ ·å¯ä»¥è¿›è¡Œé€‰æ‹©ä¸å†å®‰è£…é©±åŠ¨ã€‚ åœ¨å®‰è£…ç•Œé¢ï¼Œæ³¨æ„é€‰æ‹©ä¸å®‰è£…æ˜¾å¡é©±åŠ¨ï¼ˆæŒ‰enteré”®å–æ¶ˆé€‰æ‹©ï¼‰ ã€‚ä¹‹åï¼Œæ‰“å¼€/usr/localæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬ä¼šå‘ç°å¤šäº†cudaå’Œcuda10.1è¿™ä¸¤ä¸ªæ–‡ä»¶å¤¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:5","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"æ·»åŠ ç¯å¢ƒå˜é‡ è¿è¡Œsudo vim /etc/profileï¼Œæœ«å°¾åŠ ä¸Šï¼š export CUDA_HOME=/usr/local/cuda export PATH=$PATH:$CUDA_HOME/bin export LD_LIBRARY_PATH=/usr/local/cuda-10.1/lib64${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}} ä¹‹åè¿è¡Œsource /etc/profileä½¿å˜é‡èµ·æ•ˆã€‚ ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:6","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"åˆ¤æ–­CUDAå®‰è£…æˆåŠŸ è¿è¡Œä¸€ä¸‹ä»£ç  cd /usr/local/cuda/samples/1_Utilities/deviceQuery sudo make ./deviceQuery å¦‚æœè¾“å‡ºå¦‚ä¸‹ç±»ä¼¼ä¿¡æ¯ï¼Œè¯´æ˜CUDAå®‰è£…æˆåŠŸï¼š åœ¨CUDAå®‰è£…ä¹‹åï¼Œæˆ‘ä»¬å…¶å®å·²ç»å¯ä»¥ç”¨PyTorchåˆ¤æ–­æ˜¯å¦æ”¯æŒGPUäº†ï¼Œè¿›å…¥pythonæ§åˆ¶å°ï¼š import torch print(torch.cuda.is_available()) ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:7","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"CUDAä¸cuDNNçš„å…³ç³» cuDNNæ˜¯GPUåŠ é€Ÿè®¡ç®—æ·±å±‚ç¥ç»ç½‘ç»œçš„åº“ã€‚æŠŠCUDAçœ‹ä½œæ˜¯ä¸€ä¸ªå·¥ä½œå°ï¼Œä¸Šé¢é…æœ‰å¾ˆå¤šå·¥å…·ï¼Œå¦‚é”¤å­ã€èºä¸åˆ€ç­‰ã€‚cuDNNæ˜¯åŸºäºCUDAçš„æ·±åº¦å­¦ä¹ GPUåŠ é€Ÿåº“ï¼Œæœ‰äº†å®ƒæ‰èƒ½åœ¨GPUä¸Šå®Œæˆæ·±åº¦å­¦ä¹ çš„è®¡ç®—ã€‚å®ƒå°±ç›¸å½“äºå·¥ä½œçš„å·¥å…·ï¼Œæ¯”å¦‚å®ƒå°±æ˜¯ä¸ªæ‰³æ‰‹ã€‚ä½†æ˜¯CUDAè¿™ä¸ªå·¥ä½œå°ä¹°æ¥çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰é€æ‰³æ‰‹ã€‚æƒ³è¦åœ¨CUDAä¸Šè¿è¡Œæ·±åº¦ç¥ç»ç½‘ç»œï¼Œå°±è¦å®‰è£…cuDNNï¼Œå°±åƒä½ æƒ³è¦æ‹§ä¸ªèºå¸½å°±è¦æŠŠæ‰³æ‰‹ä¹°å›æ¥ã€‚è¿™æ ·æ‰èƒ½ä½¿GPUè¿›è¡Œæ·±åº¦ç¥ç»ç½‘ç»œçš„å·¥ä½œï¼Œå·¥ä½œé€Ÿåº¦ç›¸è¾ƒCPUå¿«å¾ˆå¤šã€‚ ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:8","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["æœºå™¨å­¦ä¹ "],"content":"å®‰è£…cuDNN å®˜æ–¹å®‰è£…cuDNNæŒ‡å— ä»å®˜æ–¹å®‰è£…æŒ‡å—å¯ä»¥çœ‹å‡ºï¼Œåªè¦æŠŠcuDNNæ–‡ä»¶å¤åˆ¶åˆ°CUDAçš„å¯¹åº”æ–‡ä»¶å¤¹é‡Œå°±å¯ä»¥ï¼Œå³æ˜¯æ‰€è°“æ’å…¥å¼è®¾è®¡ï¼ŒæŠŠcuDNNæ•°æ®åº“æ·»åŠ CUDAé‡Œï¼ŒcuDNNæ˜¯CUDAçš„æ‰©å±•è®¡ç®—åº“ï¼Œä¸ä¼šå¯¹CUDAé€ æˆå…¶ä»–å½±å“ã€‚ é¦–å…ˆå»å®˜ç½‘ä¸‹è½½cuDNNï¼Œéœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·æ‰èƒ½ä¸‹è½½ã€‚æ³¨æ„è¦é€‰æ‹©å¯¹åº”ç‰ˆæœ¬çš„cuDNN Library for Linuxï¼ˆä¸CUDA 10.1å¯¹åº”ï¼‰ï¼š ä¸‹è½½åè¿›è¡Œè§£å‹ï¼š tar -zxvf cudnn-10.1-linux-x64-v7.6.2.24.tgz è¿›å…¥cudnn 10.1è§£å‹ä¹‹åçš„includeç›®å½•ï¼Œåœ¨å‘½ä»¤è¡Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š cd cuda/include sudo cp cudnn.h /usr/local/cuda/include #å¤åˆ¶å¤´æ–‡ä»¶ å†å°†è¿›å…¥lib64ç›®å½•ä¸‹çš„åŠ¨æ€æ–‡ä»¶è¿›è¡Œå¤åˆ¶å’Œé“¾æ¥ï¼š cd .. cd lib64 sudo cp libcudnn* /usr/local/cuda/lib64/ #å¤åˆ¶åŠ¨æ€é“¾æ¥åº“ cd /usr/local/cuda/lib64/ sudo chmod +r libcudnn.so.7.6.2 sudo ln -sf libcudnn.so.7.6.2 libcudnn.so.7 sudo ln -sf libcudnn.so.7 libcudnn.so sudo chmod a+r /usr/local/cuda/include/cudnn.h /usr/local/cuda/lib64/libcudnn* sudo ldconfig å‚è€ƒæ–‡ç« ï¼š https://blog.csdn.net/oTengYue/article/details/79506758 https://shomy.top/2016/12/29/gpu-tensorflow-install ç®€ä¹¦â€”â€”CUDAä¸cuDNN ","date":"2019-09-18","objectID":"/ubuntu_cuda_cudnn/:0:9","tags":["NVI","CUDA","cuDNN"],"title":"Ubuntuä¸Šå®‰è£…NVIDIAæ˜¾å¡é©±åŠ¨å’ŒCUDAå’ŒcuDNNåº“","uri":"/ubuntu_cuda_cudnn/"},{"categories":["å•ç‰‡æœº"],"content":"æ¦‚è§ˆ è¿™ç¯‡æ–‡ç« å¾ˆç®€å•ï¼ˆå°±æ˜¯ä¸€ç‚¹ç”µå·¥çŸ¥è¯†ï¼‰ï¼Œå°±æ˜¯åˆ©ç”¨DHT11æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨æµ‹é‡æ¸©æ¹¿åº¦å€¼ï¼Œå¹¶æŠŠç»“æœæ˜¾ç¤ºåœ¨LCD1602æ˜¾ç¤ºå™¨ä¸Šã€‚ ","date":"2019-08-30","objectID":"/arduino_dth11/:1:0","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"å®éªŒå…ƒå™¨ä»¶åˆ—è¡¨ å…ƒå™¨ä»¶ å‹å· æ•°é‡ å¤‡æ³¨ ä¸»æ§æ¿ arduino Uno 1 æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ DHT11 1 æ¶²æ™¶å± 1602 LCD 1 ç”µé˜» 1Kç”µé˜» 4 é¢åŒ…æ¿ 1 é¢åŒ…æ¿æ¡çº¿ è‹¥ä¸ª æ•°æ®çº¿ Unoæ•°æ®çº¿ 1 ","date":"2019-08-30","objectID":"/arduino_dth11/:2:0","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"å·¥å…·å’Œå…ƒå™¨ä»¶ä»‹ç» ","date":"2019-08-30","objectID":"/arduino_dth11/:3:0","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"DHT11æ¸©æ¹¿åº¦ä¼ æ„Ÿå™¨ DHT11 ä¼ æ„Ÿå™¨æ¥çº¿æ–¹æ³•å¹¶ä¸å¤æ‚ï¼ŒDHT11å°è£…æœ‰4ä¸ªå¼•è„šï¼Œå„ä¸ªå¼•è„šè¯´æ˜å¦‚ä¸‹ï¼š Pin åç§° æ³¨é‡Š 1 VDD ä¾›ç”µ 3-5.5 VDC 2 DATA ä¸²è¡Œæ•°æ®ï¼Œå•æ€»çº¿ 3 NC ç©ºè„š 4 GND æ¥åœ°ï¼Œç”µæºè´Ÿæ ","date":"2019-08-30","objectID":"/arduino_dth11/:3:1","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"LCD1602 1602å­—ç¬¦å‹æ¶²æ™¶ï¼Œæ˜¯ä¸€ç§ä¸“é—¨ç”¨æ¥æ˜¾ç¤ºå­—æ¯ã€æ•°å­—ã€ç¬¦å·ç­‰çš„ç‚¹é˜µå‹æ¶²æ™¶æ¨¡å—ï¼Œèƒ½å¤ŸåŒæ—¶æ˜¾ç¤º16x02å³32ä¸ªå­—ç¬¦ã€‚ LCD1602åˆ†ä¸ºä¸¤ç§ï¼šå¸¦èƒŒå…‰å’Œä¸å¸¦èƒŒå…‰ï¼Œå¸¦èƒŒå…‰çš„è¦åä¸€äº›ï¼Œå¼•è„šå¤š2ä¸ªï¼Œä¸º16ä¸ªå¼•è„šï¼Œå¦‚ä¸‹ï¼š å¼•è„šè¯´æ˜ LCD1602 é€šå¸¸æœ‰14æ¡å¼•è„šæˆ–16æ¡å¼•è„šï¼Œ14ä¸16å¼•è„šçš„å·®åˆ«åœ¨äº16æ¡å¼•è„šå¤šäº†èƒŒå…‰ç”µæºçº¿VCC(15è„š)å’Œåœ°çº¿GND(16è„š)ï¼Œå…¶å®ƒå¼•è„šä¸14è„šçš„LCDå®Œå…¨ä¸€æ ·ï¼Œå¦‚ä¸‹ï¼š å¼•è„š ç¬¦å· åŠŸèƒ½è¯´æ˜ 1 VSS ä¸€èˆ¬æ¥åœ° 2 VDD æ¥ç”µæºï¼ˆ+5Vï¼‰ 3 V0 æ¶²æ™¶æ˜¾ç¤ºå™¨å¯¹æ¯”åº¦è°ƒæ•´ç«¯ï¼Œæ¥æ­£ç”µæºæ—¶å¯¹æ¯”åº¦æœ€å¼±ï¼Œæ¥åœ°ç”µæºæ—¶å¯¹æ¯”åº¦æœ€é«˜ï¼ˆå¯¹æ¯”åº¦è¿‡é«˜æ—¶ä¼šäº§ç”Ÿâ€œé¬¼å½±â€ï¼Œä½¿ç”¨æ—¶å¯ä»¥é€šè¿‡ä¸€ä¸ª10Kçš„ç”µä½å™¨è°ƒæ•´å¯¹æ¯”åº¦ï¼‰ 4 RS RSä¸ºå¯„å­˜å™¨é€‰æ‹©ï¼Œé«˜ç”µå¹³1æ—¶é€‰æ‹©æ•°æ®å¯„å­˜å™¨ã€ä½ç”µå¹³0æ—¶é€‰æ‹©æŒ‡ä»¤å¯„å­˜å™¨ 5 R/W R/Wä¸ºè¯»å†™ä¿¡å·çº¿ï¼Œé«˜ç”µå¹³(1)æ—¶è¿›è¡Œè¯»æ“ä½œï¼Œä½ç”µå¹³(0)æ—¶è¿›è¡Œå†™æ“ä½œ 6 E E(æˆ–EN)ç«¯ä¸ºä½¿èƒ½(enable)ç«¯ï¼Œå†™æ“ä½œæ—¶ï¼Œä¸‹é™æ²¿ä½¿èƒ½ï¼›è¯»æ“ä½œæ—¶ï¼ŒEé«˜ç”µå¹³æœ‰æ•ˆ 7 DB0 ä½4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 0ä½ï¼ˆæœ€ä½ä½ï¼‰ 8 DB1 é«˜4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 1ä½ 9 DB2 é«˜4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 2ä½ 10 DB3 é«˜4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 3ä½ 11 DB4 é«˜4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 4ä½ 12 DB5 é«˜4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 5ä½ 13 DB6 é«˜4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 6ä½ 14 DB7 é«˜4ä½ä¸‰æ€ã€ åŒå‘æ•°æ®æ€»çº¿ 7ä½ï¼ˆbusy flagï¼‰ 15 BLA èƒŒå…‰ç”µæºæ­£æ 16 BLK èƒŒå…‰ç”µæºè´Ÿæ ","date":"2019-08-30","objectID":"/arduino_dth11/:3:2","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"é©±åŠ¨LCD1602 ","date":"2019-08-30","objectID":"/arduino_dth11/:4:0","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"é©±åŠ¨æ–¹å¼ Arduinoé©±åŠ¨LCD1602å¯ä»¥é€‰æ‹©ç›´æ¥é©±åŠ¨ï¼Œå¯ä»¥æœ‰4çº¿å’Œ8çº¿çš„é©±åŠ¨æ–¹å¼ï¼Œä¸è¿‡è¿™æ ·è¿˜æ˜¯æŒºå IOå£çš„ï¼Œè¦æ¥çš„ä¸œè¥¿å¤šäº†ï¼Œå°±ä¸å¤Ÿç”¨äº†ã€‚æ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»‹ç»IICé©±åŠ¨æ–¹å¼ï¼Œåœ¨LCD1602ä¸Šå¾—ç„Šæ¥ä¸€å—IICè½¬æ¥æ¿ï¼ˆå¦‚PCF8574Tï¼‰ï¼Œåªå ç”¨2ä¸ªIOå£å°±èƒ½é©±åŠ¨LCD1602ã€‚ IICã€ŒInter-Integrated Circuit é›†æˆç”µè·¯æ€»çº¿ã€æ˜¯ä¸€ç§ä¸²è¡Œé€šä¿¡æ€»çº¿ï¼Œåº”ç”¨äºæ¿è½½ä½é€Ÿè®¾å¤‡é—´çš„é€šè®¯ã€‚ç”±é£åˆ©æµ¦å…¬å¸å¼€å‘çš„è¿™ä¸€é€šè®¯åè®®ï¼Œå…¶ç›®çš„å°±æ˜¯ä¸ºäº†ç®€åŒ–ç³»ç»Ÿç¡¬ä»¶è®¾è®¡ï¼Œå‡å°‘è®¾å¤‡é—´çš„è¿çº¿ã€‚ IICä¸²è¡Œæ€»çº¿æœ‰ä¸¤æ ¹ä¿¡å·çº¿ï¼Œä¸€æ ¹æ˜¯åŒå‘çš„æ•°å­—çº¿SDAï¼Œå¦ä¸€æ ¹æ˜¯æ—¶é’Ÿçº¿SCLï¼Œæ¯ä¸ªIICè®¾å¤‡éƒ½æœ‰è‡ªå·±çš„åœ°å€ï¼ŒIICæ€»çº¿ä¸Šå¤šä¸ªè®¾å¤‡é—´é€šè¿‡è®¾å¤‡åœ°å€è¿›è¡ŒåŒºåˆ«ã€‚ ä¸Šå›¾ä¸ºæœ¬ç¯‡ä½¿ç”¨çš„IICè½¬æ¥æ¿ï¼Œç›´æ¥ç„Šæ¥äºLCD1602ã€‚å¯é€šè¿‡è·³çº¿å¸½è®¾ç½®æ˜¯å¦å¼€å¯èƒŒå…‰ï¼Œé€šè¿‡è“è‰²ç”µä½å™¨è°ƒèŠ‚å¯¹æ¯”åº¦ã€‚IICè®¾å¤‡åœ°å€å¯é€šè¿‡çŸ­è·¯A0/A1/A2ä¿®æ”¹ï¼Œé»˜è®¤åœ°å€ç”¨ä¸‹æ–‡çš„æ–¹æ³•æŸ¥çœ‹ã€‚ ","date":"2019-08-30","objectID":"/arduino_dth11/:4:1","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"æ¥çº¿ PCF8574T Arduino GND -\u003e GND VCC -\u003e 5V SDA -\u003e A4 SCL -\u003e A5 ","date":"2019-08-30","objectID":"/arduino_dth11/:4:2","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"æ‰«æI2Cåœ°å€ å°†ä»¥ä¸‹ä»£ç æ‹·è´åˆ°Arduino IDEï¼Œå¹¶æ‰§è¡Œã€‚ç„¶åé€‰æ‹©å·¥å…·-\u003eä¸²å£ç›‘è§†å™¨ï¼ŒæŠŠå³ä¸‹è§’çš„æ³¢ç‰¹ç‡æ”¹ä¸º115200ï¼Œå³å¯è¯»å‡ºI2Cåœ°å€: // I2C Scanner // Written by Nick Gammon // Date: 20th April 2011 #include \u003cWire.h\u003e void setup() { Serial.begin (115200); // Leonardo: wait for serial port to connect while (!Serial) { } Serial.println (); Serial.println (\"I2C scanner. Scanning ...\"); byte count = 0; Wire.begin(); for (byte i = 8; i \u003c 120; i++) { Wire.beginTransmission (i); if (Wire.endTransmission () == 0) { Serial.print (\"Found address: \"); Serial.print (i, DEC); Serial.print (\" (0x\"); Serial.print (i, HEX); Serial.println (\")\"); count++; delay (1); // maybe unneeded? } // end of good response } // end of for loop Serial.println (\"Done.\"); Serial.print (\"Found \"); Serial.print (count, DEC); Serial.println (\" device(s).\"); } // end of setup void loop() {} å¯ä»¥çœ‹åˆ°é»˜è®¤åœ°å€æ˜¯0x27ï¼ˆæ‰€ä»¥ä¸èƒ½è½»æ˜“ç›¸ä¿¡æ·˜å®å®¢æœçš„è¯ã€‚ã€‚ã€‚ï¼‰ã€‚ ","date":"2019-08-30","objectID":"/arduino_dth11/:4:3","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"å®‰è£…é©±åŠ¨åº“ LCD1602çš„é©±åŠ¨åº“éƒ½æ˜¯è¦é¢å¤–è£…çš„ã€‚ åœ¨Arduino IDEä¸­ç‚¹å‡»ã€Œé¡¹ç›®ã€â€”ã€ŒåŠ è½½åº“ã€â€”ã€Œç®¡ç†åº“ã€ï¼ŒæŸ¥æ‰¾ã€ŒLiquidCrystal_I2Cã€ï¼Œé€‰æ‹©æœ€æ–°ç‰ˆæœ¬è¿›è¡Œå®‰è£…ã€‚ ","date":"2019-08-30","objectID":"/arduino_dth11/:4:4","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"æ˜¾ç¤ºå­—ç¬¦ ä»£ç æŒºç®€å•çš„ï¼š // meng #include \u003cWire.h\u003e #include \u003cLiquidCrystal_I2C.h\u003e //å¼•ç”¨I2Cåº“ //è®¾ç½®LCD1602è®¾å¤‡åœ°å€ï¼Œè¿™é‡Œçš„åœ°å€æ˜¯0x3Fï¼Œä¸€èˆ¬æ˜¯0x20ï¼Œæˆ–è€…0x27ï¼Œå…·ä½“çœ‹æ¨¡å—æ‰‹å†Œ LiquidCrystal_I2C lcd(0x27, 16, 2); void setup() { lcd.init(); // åˆå§‹åŒ–LCD lcd.backlight(); //è®¾ç½®LCDèƒŒæ™¯ç­‰äº® } void loop() { lcd.setCursor(0,0); // è®¾ç½®æ˜¾ç¤ºæŒ‡é’ˆ lcd.print(\"Pig Love Rabbit\"); // è¾“å‡ºå­—ç¬¦åˆ°LCD1602ä¸Š lcd.setCursor(0,1); lcd.print(\" by MH.\"); delay(1000); lcd.setBacklight(LOW); // å…³æ‰èƒŒå…‰ delay(1000); delay(1000); lcd.setBacklight(HIGH); } æœ€ç»ˆæ˜¾ç¤ºæ•ˆæœï¼š ","date":"2019-08-30","objectID":"/arduino_dth11/:4:5","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"æ˜¾ç¤ºæ¸©æ¹¿åº¦ ","date":"2019-08-30","objectID":"/arduino_dth11/:5:0","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"åŠ è½½DHTçš„åº“ ä¸ºäº†èƒ½è¯»å–DHT11çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥æ–°çš„åº“ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨äº†è¿™ä¸ªåº“ï¼šDHTlibï¼Œç”¨Arduinoä¹Ÿå¯ä»¥ç›´æ¥æœåˆ° ","date":"2019-08-30","objectID":"/arduino_dth11/:5:1","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["å•ç‰‡æœº"],"content":"æ¥çº¿ æ¥çº¿è›®ç®€å•çš„ï¼ŒDHTå°±ç”¨åˆ°äº†3ä¸ªè„šï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨VCCå’ŒDHT11çš„DATAè„šä¹‹é—´æ”¾ç½®ä¸€ä¸ª10KÎ©çš„ä¸Šæ‹‰ç”µé˜»ï¼Œä»¥ä½¿å…¶ä¿æŒé«˜ç”µå¹³ï¼Œä»¥å®ç°ä¼ æ„Ÿå™¨å’ŒMCUä¹‹é—´çš„æ­£ç¡®é€šä¿¡ã€‚ ä»£ç ï¼š // meng #include \u003cWire.h\u003e #include \u003cLiquidCrystal_I2C.h\u003e //å¼•ç”¨I2Cåº“ #include \u003cdht.h\u003e //è®¾ç½®LCD1602è®¾å¤‡åœ°å€ï¼Œè¿™é‡Œçš„åœ°å€æ˜¯0x3Fï¼Œä¸€èˆ¬æ˜¯0x20ï¼Œæˆ–è€…0x27ï¼Œå…·ä½“çœ‹æ¨¡å—æ‰‹å†Œ LiquidCrystal_I2C lcd(0x27, 16, 2); #define dataPin 2 dht DHT; // Creats a DHT object void setup() { lcd.init(); // åˆå§‹åŒ–LCD lcd.backlight(); //è®¾ç½®LCDèƒŒæ™¯ç­‰äº® } void loop() { int readData = DHT.read11(dataPin); // è¯»å–æ•°æ® // int readData = DHT.read22(dataPin); // DHT22/AM2302 float t = DHT.temperature; // æ¸©åº¦ float h = DHT.humidity; // æ¹¿åº¦ lcd.setCursor(0,0); // è®¾ç½®æ˜¾ç¤ºæŒ‡é’ˆ // æ˜¾ç¤ºæ¸©åº¦ lcd.print(\"Temp: \"); lcd.print(t); // Prints the temperature value from the sensor lcd.print(\" \"); lcd.print((char)223);//shows degrees character lcd.print(\"C\"); lcd.setCursor(0,1); lcd.print(\"Humi: \"); lcd.print(h); lcd.print(\" %\"); delay(3000); } æœ€ç»ˆï¼Œæˆ‘ä»¬å®ç°äº†æŠŠDHT11çš„æ¸©æ¹¿åº¦æ˜¾ç¤ºåˆ°LCDä¸Šçš„æ•ˆæœäº†ï¼š å‚è€ƒæ–‡ç« ï¼š LCD 1602æ˜¾ç¤ºå± ","date":"2019-08-30","objectID":"/arduino_dth11/:5:2","tags":["arduino","ä¼ æ„Ÿå™¨"],"title":"Arduinoä½¿ç”¨DHT11æµ‹é‡æ¸©æ¹¿åº¦","uri":"/arduino_dth11/"},{"categories":["ç®—æ³•"],"content":"å››åˆ™è¿ç®— å››åˆ™è¿ç®—è¡¨è¾¾å¼æ˜¯æˆ‘ä»¬å°å­¦å°±æ¥è§¦çš„å†…å®¹ï¼Œå®ƒéµå¾ªâ€œå…ˆä¹˜é™¤ï¼ŒååŠ å‡ï¼Œä»å·¦åˆ°å³ï¼Œæ‹¬å·å†…å…ˆç®—â€çš„æ³•åˆ™ï¼Œä¾‹å¦‚â€œ7 + (5 - 3) * 4 + 6 / 3â€ï¼Œè¿™ä¸ªè¡¨è¾¾å¼å…ˆç®—5 - 3å¾—2ï¼Œå†ç®—2 * 4å’Œ6 / 3ï¼Œæœ€åè®¡ç®—7 + 8 +2ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆç®€å•ï¼Œå£ç®—å°±èƒ½å®Œæˆï¼Œä½†æ˜¯å¦‚æœè®©æˆ‘ä»¬åœ¨ç¨‹åºé‡Œå®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿæˆ‘ä»¬é‡åˆ°çš„å›°éš¾åœ¨äºä¹˜é™¤ä¼˜åœ¨åŠ å‡çš„åé¢ï¼Œå´è¦å…ˆè¿ç®—ï¼Œå¦å¤–è¿˜è¦è€ƒè™‘æ‹¬å·ï¼Œé—®é¢˜å°±å¤æ‚äº†ã€‚ ","date":"2019-08-19","objectID":"/stack_si_ze/:1:0","tags":["æ ˆ","å››åˆ™è¿ç®—"],"title":"æ ˆåº”ç”¨ä¹‹å››åˆ™è¿ç®—","uri":"/stack_si_ze/"},{"categories":["ç®—æ³•"],"content":"åç¼€è¡¨è¾¾å¼ æ³¢å…°æœ‰ä½ç§‘å­¦å®¶ä¹Ÿæƒ³åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œä»–æƒ³å‡ºäº†ä¸€ç§æ–°çš„ä¸éœ€è¦æ‹¬å·çš„è¡¨è¾¾å¼ï¼šâ€œåç¼€è¡¨è¾¾å¼â€ï¼Œå®ƒæ›´æœ‰åˆ©äºè®¡ç®—æœºè®¡ç®—ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒçš„æ ·å­ï¼šå¯¹äºâ€œ7 + (5 - 3) * 4 + 6 / 3â€ï¼Œåç¼€è¡¨è¾¾å¼ä¸ºâ€œ7 5 3 - 4 * + 6 3 / +â€ï¼Œå«åç¼€çš„åŸå› åœ¨äºè¿ç®—ç¬¦åœ¨æ“ä½œæ•°ä¹‹åã€‚æˆ‘ä»¬äººç±»å–œæ¬¢çœ‹åˆ°çš„è¡¨è¾¾å¼å«â€œä¸­ç¼€è¡¨è¾¾å¼â€ï¼ˆå› ä¸ºè¿ç®—ç¬¦åœ¨æ“ä½œæ•°ä¸­é—´ï¼‰ï¼Œä½†æ˜¯è®¡ç®—æœºä¸å–œæ¬¢å®ƒã€‚ ","date":"2019-08-19","objectID":"/stack_si_ze/:2:0","tags":["æ ˆ","å››åˆ™è¿ç®—"],"title":"æ ˆåº”ç”¨ä¹‹å››åˆ™è¿ç®—","uri":"/stack_si_ze/"},{"categories":["ç®—æ³•"],"content":"åç¼€è¡¨è¾¾å¼çš„æ–¹æ³• ä¸ºäº†çœ‹åˆ°åç¼€è¡¨è¾¾å¼çš„å¥½å¤„ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ï¼Œè®¡ç®—æœºå¦‚ä½•åˆ©ç”¨åç¼€è¡¨è¾¾å¼è®¡ç®—å‡ºæœ€ç»ˆç»“æœã€‚ åç¼€è¡¨è¾¾å¼ï¼š7 5 3 - 4 * + 6 3 / + è§„åˆ™ï¼šä»å·¦åˆ°å³éå†å­—ç¬¦ä¸²ï¼Œé‡åˆ°æ•°å­—åˆ™è¿›æ ˆï¼Œé‡åˆ°ç¬¦å·åˆ™å°†æ ˆé¡¶çš„ä¸¤ä¸ªæ•°å­—å‡ºæ ˆï¼Œè¿›è¡Œè®¡ç®—ï¼Œè¿ç®—ç»“æœè¿›æ ˆï¼Œä¸€ç›´åˆ°æœ€ç»ˆè·å¾—ç»“æœã€‚ åˆå§‹åŒ–ä¸€ä¸ªç©ºæ ˆï¼Œæ­¤æ ˆç”¨æ¥å¯¹è¦è¿ç®—çš„æ•°å­—è¿›å‡ºä½¿ç”¨ã€‚ å­—ç¬¦ä¸²ä¸­å‰ä¸‰ä¸ªéƒ½æ˜¯æ•°å­—ï¼Œæ‰€ä»¥7ï¼Œ5ï¼Œ3è¿›æ ˆã€‚ æ¥ä¸‹æ¥æ˜¯â€œ-â€ï¼Œæ‰€ä»¥5å’Œ3å‡ºæ ˆï¼Œ5ä½œä¸ºè¢«å‡æ•°ï¼Œ3ä½œä¸ºå‡æ•°ï¼Œ5å‡3å¾—åˆ°2ï¼Œå¹¶å°†2å…¥æ ˆã€‚ æ¥ç€æ˜¯4å…¥æ ˆã€‚ æ¥ä¸‹æ¥æ˜¯â€*â€œï¼Œæ‰€ä»¥4å’Œ2å‡ºæ ˆï¼Œ4ä¹˜ä»¥2å¾—8ï¼Œ8å…¥æ ˆã€‚ ä¸‹é¢æ˜¯â€œ+â€ï¼Œ7å’Œ8å‡ºæ ˆï¼Œ7åŠ 8å¾—15ï¼Œ15å…¥æ ˆã€‚ æ¥ä¸‹æ¥6å’Œ3æ•°å­—å…¥æ ˆã€‚ é‡åˆ°ç¬¦å·â€œ/â€ï¼Œæ‰€ä»¥6å’Œ3å‡ºæ ˆï¼Œ6ä½œä¸ºè¢«é™¤æ•°ï¼Œ3ä½œä¸ºé™¤æ•°ï¼Œ6é™¤3å¾—2ï¼Œ2å…¥æ ˆã€‚ æœ€åé‡åˆ°ç¬¦å·â€œ+â€ï¼Œ15å’Œ2å‡ºæ ˆï¼Œ15åŠ 2å¾—17ï¼Œ17å…¥æ ˆï¼Œéå†ç»“æŸï¼Œå°†æœ€åç»“æœå‡ºæ ˆï¼Œå¾—åˆ°17ã€‚ ","date":"2019-08-19","objectID":"/stack_si_ze/:2:1","tags":["æ ˆ","å››åˆ™è¿ç®—"],"title":"æ ˆåº”ç”¨ä¹‹å››åˆ™è¿ç®—","uri":"/stack_si_ze/"},{"categories":["ç®—æ³•"],"content":"ä¸­ç¼€è¡¨è¾¾å¼è½¬åç¼€è¡¨è¾¾å¼ å¯ä»¥çœ‹åˆ°åˆ©ç”¨æ ˆå°±å¾ˆå®¹æ˜“è®¡ç®—åç¼€è¡¨è¾¾å¼çš„å€¼ï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬çš„é—®é¢˜å°±æ˜¯ä¸­ç¼€è½¬åç¼€ã€‚ ä¸­ç¼€è¡¨è¾¾å¼ï¼šâ€œ8 + (7 - 2 * 3 + 2) * 3 + 10 / 2â€ è§„åˆ™ï¼šéå†å­—ç¬¦ä¸²ï¼Œé‡åˆ°æ•°å­—åˆ™è¾“å‡ºï¼Œå³æˆä¸ºåç¼€è¡¨è¾¾å¼ä¸€éƒ¨åˆ†ï¼›è‹¥æ˜¯æ“ä½œç¬¦ï¼Œåˆ™åˆ¤æ–­ä¸æ ˆé¡¶ç¬¦å·çš„ä¼˜å…ˆçº§ï¼ˆä¹˜é™¤ä¼˜å…ˆçº§æ¯”åŠ å‡ä¼˜å…ˆçº§é«˜ï¼Œä¹˜é™¤ä¼˜å…ˆçº§ä¸€æ ·ï¼ŒåŠ å’Œå‡ä¹Ÿä¸€æ ·ï¼‰ï¼Œå¦‚æœé«˜äºæ ˆé¡¶ç¬¦å·ï¼Œåˆ™å‹æ ˆï¼Œå¦åˆ™ä»æ ˆé¡¶å¼€å§‹å¼¹å‡ºå…ƒç´ ç›´åˆ°é‡åˆ°é‡åˆ°ä¼˜å…ˆçº§æ›´ä½çš„ç¬¦å·ï¼ˆæˆ–è€…é‡åˆ°â€œ(â€ï¼Œâ€œ(â€åªæœ‰é‡åˆ°â€œ)â€æ‰ä¼šå¼¹å‡ºï¼‰ï¼Œå¼¹å‡ºå®Œè¿™äº›ç¬¦å·åï¼ŒæŠŠå½“å‰ç¬¦å·å‹æ ˆã€‚ åˆå§‹åŒ–ä¸€ç©ºæ ˆï¼Œç”¨æ¥å¯¹ç¬¦å·è¿›å‡ºæ ˆä½¿ç”¨ã€‚ ç¬¬ä¸€ä¸ªå­—ç¬¦æ˜¯æ•°å­—8ï¼Œè¾“å‡º8ï¼Œåé¢ç¬¦å·æ˜¯â€œ+â€ï¼Œè¿›æ ˆã€‚ ç¬¬ä¸‰ä¸ªå­—ç¬¦æ˜¯â€œ(â€ï¼Œå› ä¸ºæ˜¯å·¦æ‹¬å·ï¼Œæ‰€ä»¥å‹æ ˆï¼Œç¬¬å››ä¸ªå­—ç¬¦æ˜¯7ï¼Œè¾“å‡ºï¼Œæ€»è¡¨è¾¾å¼ä¸º8 7ã€‚ æ¥ç€æ˜¯â€œ-â€ï¼Œå› ä¸ºæ ˆé¡¶æ˜¯â€œ(â€ï¼Œæ‰€ä»¥å‹æ ˆã€‚åé¢å­—ç¬¦æ˜¯2ï¼Œè¾“å‡ºï¼Œæ€»è¡¨è¾¾å¼ä¸º8 7 2ã€‚ ä¹‹åç¬¦å·æ˜¯â€œ*â€ï¼Œå®ƒçš„ä¼˜å…ˆçº§æ¯”æ ˆé¡¶â€œ-â€é«˜ï¼Œæ‰€ä»¥å‹æ ˆï¼Œå†ä¹‹åæ˜¯æ•°å­—3ï¼Œè¾“å‡ºï¼Œæ€»è¡¨è¾¾å¼ä¸º8 7 2 3ã€‚ æ¥ç€æ˜¯ç¬¦å·â€œ+â€ï¼Œå®ƒæ¯”â€œ*â€çš„ä¼˜å…ˆçº§ä½ï¼Œæ‰€ä»¥â€œ*â€å¼¹å‡ºæ ˆè¾“å‡ºï¼Œè€Œâ€œ-â€ä¼˜å…ˆçº§å’Œâ€œ+â€ä¸€æ ·ï¼Œä¹Ÿè¦å¼¹å‡ºæ ˆè¾“å‡ºï¼Œæ¥ä¸‹æ¥ç¢°åˆ°ç¬¦å·â€œ(â€ï¼Œå°±è¦æŠŠâ€œ+â€å‹æ ˆã€‚æ¥ç€æ˜¯æ•°å­—2ï¼Œè¾“å‡ºï¼Œæ€»è¡¨è¾¾å¼ä¸º8 7 2 3 * - 2ã€‚ æ¥ç€æ˜¯ç¬¦å·â€œ)â€ï¼Œè¿™æ—¶éœ€è¦ä»æ ˆé¡¶å¼€å§‹ä¾æ¬¡å¼¹å‡ºç¬¦å·è¾“å‡ºï¼Œç›´åˆ°é‡åˆ°â€œ(â€ï¼ˆâ€œ(â€ä¹Ÿè¦å¼¹å‡ºï¼Œåªæ˜¯ä¸è¾“å‡ºï¼‰ï¼Œâ€œ(â€ä¹‹ååªå‰©ä¸€ä¸ªâ€œ+â€ï¼Œæ‰€ä»¥å¼¹å‡ºâ€œ+â€è¾“å‡ºï¼Œæ¥ä¸‹æ¥æ˜¯ç¬¦å·â€œ*â€ï¼Œä¼˜å…ˆçº§æ¯”â€œ+â€é«˜ï¼Œæ‰€ä»¥å‹æ ˆï¼Œæ€»è¡¨è¾¾å¼ä¸º8 7 2 3 * - 2 +ã€‚ æ¥ä¸‹æ¥æ˜¯æ•°å­—3ï¼Œè¾“å‡ºï¼Œç´§æ¥ç€æ˜¯ç¬¦å·â€œ+â€ï¼Œå®ƒæ¯”æ ˆé¡¶â€œ*â€ä¼˜å…ˆçº§ä½ï¼Œæ‰€ä»¥å¼¹å‡ºâ€œ*â€è¾“å‡ºï¼Œè€Œä¹‹åæ¯”è¾ƒçš„â€œ+â€ä¼˜å…ˆçº§ä¸€æ ·ï¼Œä¹Ÿå¼¹å‡ºæ ˆè¾“å‡ºï¼Œæœ€åâ€œ+â€å‹æ ˆï¼Œæ€»è¡¨è¾¾å¼ä¸º8 7 2 3 * - 2 + 3 * +ã€‚ æ¥ç€æ˜¯æ•°å­—10ï¼Œè¾“å‡ºï¼Œæ¥ä¸‹æ¥æ˜¯ç¬¦å·â€œ/â€ï¼Œæ¯”ç¬¦å·â€œ+â€ä¼˜å…ˆçº§é«˜ï¼Œæ‰€ä»¥å‹æ ˆï¼Œæ€»è¡¨è¾¾å¼ä¸º8 7 2 3 * - 2 + 3 * + 10ã€‚ æ¥ç€æ˜¯æ•°å­—2ï¼Œè¾“å‡ºã€‚éå†ç»“æŸï¼Œä¾æ¬¡å¼¹å‡ºæ ˆä¸­å…ƒç´ ï¼Œæœ€åæ€»è¡¨è¾¾å¼ä¸º8 7 2 3 * - 2 + 3 * + 10 2 / +ã€‚ ","date":"2019-08-19","objectID":"/stack_si_ze/:2:2","tags":["æ ˆ","å››åˆ™è¿ç®—"],"title":"æ ˆåº”ç”¨ä¹‹å››åˆ™è¿ç®—","uri":"/stack_si_ze/"},{"categories":["ç®—æ³•"],"content":"ä»£ç ç¤ºä¾‹ // é¢„å…ˆç”Ÿæˆè¿ç®—ç¬¦çš„tokens prepareTokens() { this.tokens = [ new Token('#', TOKEN_TYPE.ENDEXPR), new Token('(', TOKEN_TYPE.LEFTPAREN), new Token(')', TOKEN_TYPE.RIGHTPAREN), new Token('~', TOKEN_TYPE.UNARYOP, 6), // è´Ÿå· new Token('abs', TOKEN_TYPE.UNARYOP, 6), // æ±‚ç»å¯¹å€¼ new Token('sqrt', TOKEN_TYPE.UNARYOP, 6), // å¼€å¹³æ–¹æ ¹ new Token('exp', TOKEN_TYPE.UNARYOP, 6), // eçš„xæ¬¡ new Token('ln', TOKEN_TYPE.UNARYOP, 6), // eä¸ºåº•æ•°çš„å¯¹æ•° new Token('log10', TOKEN_TYPE.UNARYOP, 6), // 10ä¸ºåº•æ•°çš„å¯¹æ•° new Token('sin', TOKEN_TYPE.UNARYOP, 6), // æ±‚sin x new Token('cos', TOKEN_TYPE.UNARYOP, 6), // æ±‚cos x new Token('tan', TOKEN_TYPE.UNARYOP, 6), // æ±‚tan x new Token('+', TOKEN_TYPE.BINARYOP, 4), // äºŒå…ƒ+ new Token('-', TOKEN_TYPE.BINARYOP, 4), // äºŒå…ƒ- new Token('*', TOKEN_TYPE.BINARYOP, 5), // ä¹˜æ³• new Token('/', TOKEN_TYPE.BINARYOP, 5), // é™¤æ³• new Token('%', TOKEN_TYPE.BINARYOP, 5), // é™¤æ¨¡å–ä½™ new Token('^', TOKEN_TYPE.BINARYOP, 6), // æŒ‡æ•°è¿ç®— ] } /** * ä¸­ç¼€è¡¨è¾¾å¼è½¬åŒ–ä¸ºåç¼€è¡¨è¾¾å¼ * @return {Array} */ transform() { const postExp = [] const opStack = [] for (let i = 0; i \u003c this.infixExp.length; i++) { const pos = this.infixExp[i] const token = this.tokens[pos] switch (token.type) { case TOKEN_TYPE.OPRAND: postExp.push(pos) break; case TOKEN_TYPE.LEFTPAREN: // â€œ(â€ç›´æ¥å…¥æ ˆ opStack.push(pos) break; case TOKEN_TYPE.RIGHTPAREN: // ä¸ºâ€œ)â€ï¼Œå‡ºæ ˆç›´åˆ°é‡åˆ°è¿ç®—ç¬¦â€œ(â€ let prePos = opStack.pop() while (prePos in this.tokens \u0026\u0026 opStack.length \u003e= 0 \u0026\u0026 this.tokens[prePos].type !== TOKEN_TYPE.LEFTPAREN) { postExp.push(prePos) prePos = opStack.pop() } break; case TOKEN_TYPE.UNARYOP: case TOKEN_TYPE.BINARYOP: let endright = 0 while (endright === 0) { if (opStack.length \u003c= 0) endright = 1 else if (this.tokens[opStack[opStack.length - 1]].type === TOKEN_TYPE.LEFTPAREN) { endright = 1 } else if (this.tokens[opStack[opStack.length - 1]].priority \u003c token.priority) { endright = 1 } else if (this.tokens[opStack[opStack.length - 1]].priority === token.priority \u0026\u0026 token.priority === MAX_PRIORITY) { endright = 1 } else { postExp.push(opStack.pop()) endright = 0 } } opStack.push(pos) break case TOKEN_TYPE.ENDEXPR: while (opStack.length \u003e= 1) { postExp.push(opStack.pop()) } break default: break } } postExp.push(0) // æ·»åŠ ç»ˆæ­¢ç¬¦ return postExp } ä¸­ç¼€è¡¨è¾¾å¼infixExpä¸­å­˜çš„æ˜¯this.tokensä¸­çš„ç´¢å¼•ï¼Œå®Œæ•´ä»£ç Github ","date":"2019-08-19","objectID":"/stack_si_ze/:2:3","tags":["æ ˆ","å››åˆ™è¿ç®—"],"title":"æ ˆåº”ç”¨ä¹‹å››åˆ™è¿ç®—","uri":"/stack_si_ze/"},{"categories":["about"],"content":"ä¸€ä¸ªçƒ­çˆ±æŠ€æœ¯ï¼Œå¾ˆå¹³å‡¡çš„äººã€‚ ","date":"2019-07-10","objectID":"/about/:0:0","tags":[],"title":"å…³äºæˆ‘","uri":"/about/"}]